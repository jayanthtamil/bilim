{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Rajesh\\\\Downloads\\\\bilim (2)\\\\bilim\\\\v1.0\\\\editors\\\\BlmCourseEditor\\\\src\\\\components\\\\content-editor\\\\components\\\\media\\\\hotspot\\\\picker\\\\classic\\\\BlmClassicPreview.tsx\";\nimport React, { useCallback, useEffect, useLayoutEffect, useRef, useState } from \"react\";\nimport clsx from \"clsx\";\nimport clamp from \"lodash/clamp\";\nimport { MediaHotspotItem } from \"types\";\nimport { StyleListTypes } from \"editor-constants\";\nimport { convertToPercentage, createShortUUID, getMouseRelativePos, resize } from \"utils\";\nimport { withBlmTemplateFrame } from \"components/frames\";\nimport { useContentEditorCtx } from \"components/content-editor/core\";\nimport { getDefaultComponentStyle } from \"components/content-editor/reducers\";\nimport BlmHotspotItem from \"../item\";\nimport { useClassicPreviewStyle } from \"./styles\";\nconst initDrag = {\n  status: false,\n  startX: 0,\n  startY: 0,\n  endX: 0,\n  endY: 0\n};\n\nfunction BlmClassicPreview(props) {\n  const {\n    data,\n    selectedItem,\n    onChange\n  } = props;\n  const {\n    media,\n    groups,\n    items,\n    display,\n    style\n  } = data;\n  const [size, setSize] = useState({\n    width: 0,\n    height: 0\n  });\n  const [container, setContainer] = useState({\n    width: 0,\n    height: 0\n  });\n  const [image, setImage] = useState({\n    width: 0,\n    height: 0\n  });\n  const [dragging, setDragging] = useState(initDrag);\n  const [dragged, setDragged] = useState();\n  const containerRef = useRef(null);\n  const classes = useClassicPreviewStyle();\n  const {\n    element\n  } = useContentEditorCtx();\n  const {\n    width,\n    height\n  } = size;\n  const styleType = (element === null || element === void 0 ? void 0 : element.isSummary) ? StyleListTypes.MediaHotspotItemSummary : StyleListTypes.MediaHotspotItem;\n  const updateChange = useCallback((name, value) => {\n    if (onChange) {\n      onChange({\n        target: {\n          name,\n          value\n        }\n      });\n    }\n  }, [onChange]); // eslint-disable-next-line react-hooks/exhaustive-deps\n\n  useLayoutEffect(() => {\n    const container = containerRef.current;\n\n    if (container) {\n      const {\n        offsetWidth,\n        offsetHeight\n      } = container;\n      setContainer(state => {\n        if (offsetWidth !== state.width || offsetHeight !== state.height) {\n          return {\n            width: offsetWidth,\n            height: offsetHeight\n          };\n        }\n\n        return state;\n      });\n    }\n  });\n  useEffect(() => {\n    setSize(resize(image.width, image.height, container.width, container.height));\n  }, [container, image]);\n  useEffect(() => {\n    if (dragged) {\n      const {\n        status,\n        startX,\n        startY,\n        endX,\n        endY,\n        item: dragItem\n      } = dragged;\n\n      if (status && dragItem) {\n        const newItem = { ...dragItem\n        };\n        const diffX = convertToPercentage(endX - startX, width);\n        const diffY = convertToPercentage(endY - startY, height);\n        newItem.x = clamp(newItem.x + diffX, 0, 100);\n        newItem.y = clamp(newItem.y + diffY, 0, 100);\n        updateChange(\"move\", newItem);\n        setDragged(undefined);\n      }\n    }\n  }, [dragged, width, height, updateChange]);\n\n  const handleMouseDown = event => {\n    var _items$length;\n\n    const {\n      x,\n      y\n    } = getMouseRelativePos(event);\n    const item = new MediaHotspotItem();\n    item.id = createShortUUID();\n    item.name = `Hotspot ${((_items$length = items === null || items === void 0 ? void 0 : items.length) !== null && _items$length !== void 0 ? _items$length : 0) + 1}`;\n    item.x = convertToPercentage(x, width);\n    item.y = convertToPercentage(y, height);\n    item.style = style !== null && style !== void 0 ? style : getDefaultComponentStyle(styleType);\n    updateChange(\"add\", item);\n  };\n\n  const handleItemMouseDown = (event, item) => {\n    var _containerRef$current;\n\n    const doc = (_containerRef$current = containerRef.current) === null || _containerRef$current === void 0 ? void 0 : _containerRef$current.ownerDocument;\n\n    if (doc) {\n      event.preventDefault();\n      event.stopPropagation();\n      setDragging({\n        status: true,\n        startX: event.pageX,\n        startY: event.pageY,\n        endX: event.pageX,\n        endY: event.pageY,\n        item\n      });\n      doc.addEventListener(\"mousemove\", handleDocumentMouseMove);\n      doc.addEventListener(\"mouseup\", handleDocumentMouseUp);\n    }\n  };\n\n  const handleDocumentMouseMove = useCallback(event => {\n    const {\n      pageX,\n      pageY\n    } = event;\n    setDragging(state => ({ ...state,\n      endX: pageX,\n      endY: pageY\n    }));\n  }, [setDragging]);\n  const handleDocumentMouseUp = useCallback(event => {\n    var _containerRef$current2;\n\n    const doc = (_containerRef$current2 = containerRef.current) === null || _containerRef$current2 === void 0 ? void 0 : _containerRef$current2.ownerDocument;\n\n    if (doc) {\n      setDragging(state => {\n        setDragged(state);\n        return { ...initDrag\n        };\n      });\n      doc.removeEventListener(\"mousemove\", handleDocumentMouseMove);\n      doc.removeEventListener(\"mouseup\", handleDocumentMouseUp);\n    }\n  }, [setDragging, setDragged, handleDocumentMouseMove]);\n\n  const handleItemDelete = deleted => {\n    updateChange(\"delete\", deleted);\n  };\n\n  const handleLoad = event => {\n    const {\n      naturalWidth,\n      naturalHeight\n    } = event.target;\n    setImage({\n      width: naturalWidth,\n      height: naturalHeight\n    });\n  };\n\n  const renderItems = () => {\n    if (items) {\n      const {\n        status,\n        startX,\n        startY,\n        endX,\n        endY,\n        item: dragItem\n      } = dragging;\n      return items.map(item => {\n        let translationX = 0;\n        let translationY = 0;\n\n        if (status && item.id === (dragItem === null || dragItem === void 0 ? void 0 : dragItem.id)) {\n          translationX = convertToPercentage(endX - startX, width);\n          translationY = convertToPercentage(endY - startY, height);\n        }\n\n        return /*#__PURE__*/React.createElement(BlmHotspotItem, {\n          key: item.id,\n          data: item,\n          groups: groups,\n          styleType: styleType,\n          selected: item === selectedItem,\n          translationX: translationX,\n          translationY: translationY,\n          onMouseDown: event => handleItemMouseDown(event, item),\n          onDelete: handleItemDelete,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 195,\n            columnNumber: 11\n          }\n        });\n      });\n    }\n  };\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    ref: containerRef,\n    className: classes.root,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 212,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    style: {\n      width: width + \"px\",\n      height: height + \"px\"\n    },\n    className: classes.container,\n    onMouseDown: handleMouseDown,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 213,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    \"blm-id\": \"1\",\n    \"blm-component\": \"media\",\n    \"blm-media\": \"hotspot\",\n    style: {\n      width: \"100%\",\n      height: \"100%\"\n    },\n    className: clsx(\"mainmedia\", \"hotspot\", display.type),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 218,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"mediawrapper\",\n    style: {\n      width: \"100%\",\n      height: \"100%\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 225,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"imagewrapper\",\n    style: {\n      width: \"100%\",\n      height: \"100%\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 226,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"img\", {\n    src: media === null || media === void 0 ? void 0 : media.url,\n    alt: \"hotspot\",\n    style: {\n      width: \"100%\",\n      height: \"100%\"\n    },\n    className: classes.img,\n    onLoad: handleLoad,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 227,\n      columnNumber: 15\n    }\n  }), renderItems())))));\n}\n\nexport default withBlmTemplateFrame(BlmClassicPreview);","map":{"version":3,"sources":["C:/Users/Rajesh/Downloads/bilim (2)/bilim/v1.0/editors/BlmCourseEditor/src/components/content-editor/components/media/hotspot/picker/classic/BlmClassicPreview.tsx"],"names":["React","useCallback","useEffect","useLayoutEffect","useRef","useState","clsx","clamp","MediaHotspotItem","StyleListTypes","convertToPercentage","createShortUUID","getMouseRelativePos","resize","withBlmTemplateFrame","useContentEditorCtx","getDefaultComponentStyle","BlmHotspotItem","useClassicPreviewStyle","initDrag","status","startX","startY","endX","endY","BlmClassicPreview","props","data","selectedItem","onChange","media","groups","items","display","style","size","setSize","width","height","container","setContainer","image","setImage","dragging","setDragging","dragged","setDragged","containerRef","classes","element","styleType","isSummary","MediaHotspotItemSummary","updateChange","name","value","target","current","offsetWidth","offsetHeight","state","item","dragItem","newItem","diffX","diffY","x","y","undefined","handleMouseDown","event","id","length","handleItemMouseDown","doc","ownerDocument","preventDefault","stopPropagation","pageX","pageY","addEventListener","handleDocumentMouseMove","handleDocumentMouseUp","removeEventListener","handleItemDelete","deleted","handleLoad","naturalWidth","naturalHeight","renderItems","map","translationX","translationY","root","type","url","img"],"mappings":"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","sourcesContent":["import React, {\r\n  MouseEvent as ReactMouseEvent,\r\n  SyntheticEvent,\r\n  useCallback,\r\n  useEffect,\r\n  useLayoutEffect,\r\n  useRef,\r\n  useState,\r\n} from \"react\";\r\nimport clsx from \"clsx\";\r\nimport clamp from \"lodash/clamp\";\r\n\r\nimport { MediaHotspotItem, CustomChangeEvent, MediaHotspot } from \"types\";\r\nimport { StyleListTypes } from \"editor-constants\";\r\nimport { convertToPercentage, createShortUUID, getMouseRelativePos, resize } from \"utils\";\r\nimport { withBlmTemplateFrame } from \"components/frames\";\r\nimport { useContentEditorCtx } from \"components/content-editor/core\";\r\nimport { getDefaultComponentStyle } from \"components/content-editor/reducers\";\r\nimport BlmHotspotItem from \"../item\";\r\nimport { useClassicPreviewStyle } from \"./styles\";\r\n\r\nexport type HotspotChangeEvent = CustomChangeEvent<MediaHotspotItem>;\r\n\r\nexport interface CompProps {\r\n  data: MediaHotspot;\r\n  selectedItem?: MediaHotspotItem;\r\n  onChange?: (event: HotspotChangeEvent) => void;\r\n}\r\n\r\ninterface DragState {\r\n  status: boolean;\r\n  startX: number;\r\n  startY: number;\r\n  endX: number;\r\n  endY: number;\r\n  item?: MediaHotspotItem;\r\n}\r\n\r\nconst initDrag: DragState = { status: false, startX: 0, startY: 0, endX: 0, endY: 0 };\r\n\r\nfunction BlmClassicPreview(props: CompProps) {\r\n  const { data, selectedItem, onChange } = props;\r\n  const { media, groups, items, display, style } = data;\r\n  const [size, setSize] = useState({ width: 0, height: 0 });\r\n  const [container, setContainer] = useState({ width: 0, height: 0 });\r\n  const [image, setImage] = useState({ width: 0, height: 0 });\r\n  const [dragging, setDragging] = useState(initDrag);\r\n  const [dragged, setDragged] = useState<DragState>();\r\n  const containerRef = useRef<HTMLDivElement>(null);\r\n  const classes = useClassicPreviewStyle();\r\n  const { element } = useContentEditorCtx();\r\n  const { width, height } = size;\r\n  const styleType = element?.isSummary\r\n    ? StyleListTypes.MediaHotspotItemSummary\r\n    : StyleListTypes.MediaHotspotItem;\r\n\r\n  const updateChange = useCallback(\r\n    (name: string, value: MediaHotspotItem) => {\r\n      if (onChange) {\r\n        onChange({ target: { name, value } });\r\n      }\r\n    },\r\n    [onChange]\r\n  );\r\n\r\n  // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  useLayoutEffect(() => {\r\n    const container = containerRef.current;\r\n\r\n    if (container) {\r\n      const { offsetWidth, offsetHeight } = container;\r\n\r\n      setContainer((state) => {\r\n        if (offsetWidth !== state.width || offsetHeight !== state.height) {\r\n          return { width: offsetWidth, height: offsetHeight };\r\n        }\r\n\r\n        return state;\r\n      });\r\n    }\r\n  });\r\n\r\n  useEffect(() => {\r\n    setSize(resize(image.width, image.height, container.width, container.height));\r\n  }, [container, image]);\r\n\r\n  useEffect(() => {\r\n    if (dragged) {\r\n      const { status, startX, startY, endX, endY, item: dragItem } = dragged;\r\n\r\n      if (status && dragItem) {\r\n        const newItem = { ...dragItem };\r\n        const diffX = convertToPercentage(endX - startX, width);\r\n        const diffY = convertToPercentage(endY - startY, height);\r\n\r\n        newItem.x = clamp(newItem.x + diffX, 0, 100);\r\n        newItem.y = clamp(newItem.y + diffY, 0, 100);\r\n\r\n        updateChange(\"move\", newItem);\r\n\r\n        setDragged(undefined);\r\n      }\r\n    }\r\n  }, [dragged, width, height, updateChange]);\r\n\r\n  const handleMouseDown = (event: ReactMouseEvent<HTMLDivElement>) => {\r\n    const { x, y } = getMouseRelativePos(event);\r\n    const item = new MediaHotspotItem();\r\n\r\n    item.id = createShortUUID();\r\n    item.name = `Hotspot ${(items?.length ?? 0) + 1}`;\r\n    item.x = convertToPercentage(x, width);\r\n    item.y = convertToPercentage(y, height);\r\n    item.style = style ?? getDefaultComponentStyle(styleType);\r\n\r\n    updateChange(\"add\", item);\r\n  };\r\n\r\n  const handleItemMouseDown = (event: ReactMouseEvent, item: MediaHotspotItem) => {\r\n    const doc = containerRef.current?.ownerDocument;\r\n\r\n    if (doc) {\r\n      event.preventDefault();\r\n      event.stopPropagation();\r\n\r\n      setDragging({\r\n        status: true,\r\n        startX: event.pageX,\r\n        startY: event.pageY,\r\n        endX: event.pageX,\r\n        endY: event.pageY,\r\n        item,\r\n      });\r\n\r\n      doc.addEventListener(\"mousemove\", handleDocumentMouseMove);\r\n      doc.addEventListener(\"mouseup\", handleDocumentMouseUp);\r\n    }\r\n  };\r\n\r\n  const handleDocumentMouseMove = useCallback(\r\n    (event: MouseEvent) => {\r\n      const { pageX, pageY } = event;\r\n\r\n      setDragging((state) => ({\r\n        ...state,\r\n        endX: pageX,\r\n        endY: pageY,\r\n      }));\r\n    },\r\n    [setDragging]\r\n  );\r\n\r\n  const handleDocumentMouseUp = useCallback(\r\n    (event: MouseEvent) => {\r\n      const doc = containerRef.current?.ownerDocument;\r\n\r\n      if (doc) {\r\n        setDragging((state) => {\r\n          setDragged(state);\r\n\r\n          return { ...initDrag };\r\n        });\r\n\r\n        doc.removeEventListener(\"mousemove\", handleDocumentMouseMove);\r\n        doc.removeEventListener(\"mouseup\", handleDocumentMouseUp);\r\n      }\r\n    },\r\n    [setDragging, setDragged, handleDocumentMouseMove]\r\n  );\r\n\r\n  const handleItemDelete = (deleted: MediaHotspotItem) => {\r\n    updateChange(\"delete\", deleted);\r\n  };\r\n\r\n  const handleLoad = (event: SyntheticEvent<HTMLImageElement>) => {\r\n    const { naturalWidth, naturalHeight } = event.target as HTMLImageElement;\r\n\r\n    setImage({ width: naturalWidth, height: naturalHeight });\r\n  };\r\n\r\n  const renderItems = () => {\r\n    if (items) {\r\n      const { status, startX, startY, endX, endY, item: dragItem } = dragging;\r\n\r\n      return items.map((item) => {\r\n        let translationX = 0;\r\n        let translationY = 0;\r\n\r\n        if (status && item.id === dragItem?.id) {\r\n          translationX = convertToPercentage(endX - startX, width);\r\n          translationY = convertToPercentage(endY - startY, height);\r\n        }\r\n\r\n        return (\r\n          <BlmHotspotItem\r\n            key={item.id}\r\n            data={item}\r\n            groups={groups}\r\n            styleType={styleType}\r\n            selected={item === selectedItem}\r\n            translationX={translationX}\r\n            translationY={translationY}\r\n            onMouseDown={(event) => handleItemMouseDown(event, item)}\r\n            onDelete={handleItemDelete}\r\n          />\r\n        );\r\n      });\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div ref={containerRef} className={classes.root}>\r\n      <div\r\n        style={{ width: width + \"px\", height: height + \"px\" }}\r\n        className={classes.container}\r\n        onMouseDown={handleMouseDown}\r\n      >\r\n        <div\r\n          blm-id=\"1\"\r\n          blm-component=\"media\"\r\n          blm-media=\"hotspot\"\r\n          style={{ width: \"100%\", height: \"100%\" }}\r\n          className={clsx(\"mainmedia\", \"hotspot\", display.type)}\r\n        >\r\n          <div className=\"mediawrapper\" style={{ width: \"100%\", height: \"100%\" }}>\r\n            <div className=\"imagewrapper\" style={{ width: \"100%\", height: \"100%\" }}>\r\n              <img\r\n                src={media?.url}\r\n                alt=\"hotspot\"\r\n                style={{ width: \"100%\", height: \"100%\" }}\r\n                className={classes.img}\r\n                onLoad={handleLoad}\r\n              />\r\n              {renderItems()}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default withBlmTemplateFrame(BlmClassicPreview);\r\n"]},"metadata":{},"sourceType":"module"}