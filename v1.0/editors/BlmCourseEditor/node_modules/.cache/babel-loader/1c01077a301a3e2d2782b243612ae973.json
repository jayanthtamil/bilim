{"ast":null,"code":"import { MediaComponent, MediaImage, MediaCustom, MediaTarget, MediaButton, ExternalVideo, StandardVideo, MediaSlideshow, MediaSlideshowItem, MediaHotspot, MediaHotspotItem, MediaHotspotGroupItem, FlipCardSide, MediaFlipCard, SynchroVideo, MediaTrackCue, MediaHotspot360 } from \"types\";\nimport { ComponentActionTypes, GotoActionTypes, HotspotDisplayTypes, ImageDisplayTypes, MediaPosition, MediaVariants, StyleListTypes } from \"editor-constants\";\nimport { createShortUUID, createUUID, filterFalsy, getObjectKey, getRandomColor, isJSON, parseTimestamp, toBoolean, toJSONObject, toNumber } from \"utils\";\nimport { createMediaConfig, createMediaFormat, getAllBLMElementsBy, getAllHTMLElements, getBLMElement, getBLMElementBy, getHTMLElement, setComponentBy } from \"../../core\";\nimport { GlTemplateBuilderStore } from \"../../store\";\nimport { createAction, createComponentStyle, getComponentStyle } from \"./common\";\nexport function getAllMediaComponent(parent, selector, repeaterId) {\n  const elements = getAllHTMLElements(parent, selector);\n  const medias = [];\n\n  for (let element of elements) {\n    const media = createMedia(element);\n    media.repeaterId = repeaterId;\n    medias.push(media);\n  }\n\n  return medias;\n}\n\nfunction createMedia(element) {\n  var _media$config;\n\n  const media = new MediaComponent();\n  const model = getBLMElement(element);\n  const {\n    attributes,\n    options,\n    editorOptions\n  } = model;\n  const options2 = toJSONObject(element.getAttribute(\"blm-options2\"));\n  setComponentBy(media, model);\n  media.classList = Array.from(element.classList);\n\n  if (attributes) {\n    media.variant = attributes[\"blm-media\"];\n    media.hasApplyStyle = attributes[\"unapplystyle\"] === undefined;\n  }\n\n  if (options) {\n    media.options = options;\n    media.config = createMediaConfig(options, media.variant);\n  }\n\n  if (options2) {\n    media.options2 = options2;\n  }\n\n  media.format = createMediaFormat(Array.from(element.classList), element.style, (_media$config = media.config) === null || _media$config === void 0 ? void 0 : _media$config.format);\n\n  if (media.variant === MediaVariants.Image) {\n    media.value = createImage(element);\n  } else if (media.variant === MediaVariants.Slideshow) {\n    media.value = createSlideshow(element);\n  } else if (media.variant === MediaVariants.Button) {\n    media.value = createButton(element);\n  } else if (media.variant === MediaVariants.FlipCard) {\n    media.value = createFlipCard(element);\n  } else if (media.variant === MediaVariants.Custom) {\n    media.value = createCustom(editorOptions);\n  } else if (media.variant === MediaVariants.Target && attributes) {\n    media.value = createTarget(attributes);\n  } else if (media.variant === MediaVariants.VideoExternal) {\n    media.value = createExternalVideo(element, media);\n  } else if (media.variant === MediaVariants.VideoStandard) {\n    media.value = createStandardVideo(element, media);\n  } else if (media.variant === MediaVariants.SynchroVideo) {\n    media.value = createSynchroVideo(element, media);\n  } else if (media.variant === MediaVariants.Hotspot) {\n    media.value = createHotspot(element);\n  } else if (media.variant === MediaVariants.Hotspot360) {\n    media.value = createHotspot360(element);\n  }\n\n  return media;\n}\n\nfunction createImage(element) {\n  const image = new MediaImage();\n  const model = getBLMElementBy(element, \".mediawrapper\");\n  const {\n    editorOptions\n  } = model || {};\n  const title = getHTMLElement(element, \".captionwrapper .title\");\n  const desc = getHTMLElement(element, \".captionwrapper .description\");\n  const caption = getHTMLElement(element, \".captionwrapper .caption\");\n\n  if (editorOptions && \"media\" in editorOptions) {\n    image.media = editorOptions.media;\n  } else {\n    //todo: need to remove legacy condition after some time\n    image.media = (model === null || model === void 0 ? void 0 : model.editorOptions) || undefined;\n  }\n\n  image.title = (title === null || title === void 0 ? void 0 : title.textContent) || \"\";\n  image.description = (desc === null || desc === void 0 ? void 0 : desc.textContent) || \"\";\n  image.caption = (caption === null || caption === void 0 ? void 0 : caption.textContent) || \"\";\n  image.option = getObjectKey(ImageDisplayTypes, element.classList, image.option);\n  image.style = createComponentStyle(element, StyleListTypes.MediaImage, true);\n  image.position = getObjectKey(MediaPosition, element.classList, image.position);\n  image.isZoom = element.hasAttribute(\"zoomonclick\");\n  return image;\n}\n\nfunction createSlideshow(element) {\n  const slideshow = new MediaSlideshow();\n  const wrappers = getAllHTMLElements(element, \".mediawrapper\");\n  slideshow.items = wrappers.map(wrapper => {\n    const item = new MediaSlideshowItem();\n    const model = getBLMElement(wrapper);\n    const {\n      editorOptions\n    } = model || {};\n    const title = getHTMLElement(wrapper, \".captionwrapper .title\");\n    const desc = getHTMLElement(wrapper, \".captionwrapper .description\");\n    const caption = getHTMLElement(wrapper, \".captionwrapper .caption\");\n    const option = getObjectKey(ImageDisplayTypes, wrapper.classList, item.option);\n    const action = toJSONObject(wrapper.getAttribute(\"blm-action\"));\n    const position = getObjectKey(MediaPosition, wrapper.classList, item.position);\n    item.id = createUUID();\n\n    if (editorOptions && \"media\" in editorOptions) {\n      item.media = editorOptions === null || editorOptions === void 0 ? void 0 : editorOptions.media;\n    } else {\n      //todo: remove legacy condition\n      item.media = editorOptions || undefined;\n    }\n\n    item.title = (title === null || title === void 0 ? void 0 : title.textContent) || \"\";\n    item.description = (desc === null || desc === void 0 ? void 0 : desc.innerHTML) || \"\";\n    item.caption = (caption === null || caption === void 0 ? void 0 : caption.textContent) || \"\";\n    item.option = option;\n    item.clickAction = createAction(\"click\", action === null || action === void 0 ? void 0 : action.onClick);\n    item.position = position;\n    return item;\n  });\n  slideshow.style = getComponentStyle(element, StyleListTypes.MediaSlideshow);\n  slideshow.slideStyle = createComponentStyle(element, StyleListTypes.MediaSlideshowItem, true, \".splide__slide\");\n  return slideshow;\n}\n\nfunction createButton(element) {\n  var _editorOptions$out, _legacyModel$editorOp, _editorOptions$over, _legacyModel$editorOp2, _editorOptions$click, _legacyModel$editorOp3, _editorOptions$icon, _legacyModel$editorOp4, _GlTemplateBuilderSto;\n\n  const button = new MediaButton();\n  const model = getBLMElementBy(element, \".mediabuttonwrapper\");\n  const {\n    editorOptions\n  } = model || {};\n  const legacyModel = getBLMElementBy(element, \".mediawrapper\"); //todo: it is for legacy buttons, need to remove this after some time.\n\n  const label = getHTMLElement(element, \".optionwrapper .label\");\n  const duration = getHTMLElement(element, \".optionwrapper .duration\");\n  const num = getHTMLElement(element, \".captionwrapper .number\");\n  const title = getHTMLElement(element, \".captionwrapper .title\");\n  const desc = getHTMLElement(element, \".captionwrapper .description\");\n  const caption = getHTMLElement(element, \".captionwrapper .caption\");\n  const action = toJSONObject(element.getAttribute(\"blm-action\"));\n\n  if (action && action.onClick && action.onClick.action === ComponentActionTypes.Goto && Object.values(GotoActionTypes).includes(action.onClick.option)) {\n    action.onClick.action = ComponentActionTypes.Navigation;\n  }\n\n  button.out = (_editorOptions$out = editorOptions === null || editorOptions === void 0 ? void 0 : editorOptions.out) !== null && _editorOptions$out !== void 0 ? _editorOptions$out : legacyModel === null || legacyModel === void 0 ? void 0 : (_legacyModel$editorOp = legacyModel.editorOptions) === null || _legacyModel$editorOp === void 0 ? void 0 : _legacyModel$editorOp.out;\n  button.over = (_editorOptions$over = editorOptions === null || editorOptions === void 0 ? void 0 : editorOptions.over) !== null && _editorOptions$over !== void 0 ? _editorOptions$over : legacyModel === null || legacyModel === void 0 ? void 0 : (_legacyModel$editorOp2 = legacyModel.editorOptions) === null || _legacyModel$editorOp2 === void 0 ? void 0 : _legacyModel$editorOp2.over;\n  button.click = (_editorOptions$click = editorOptions === null || editorOptions === void 0 ? void 0 : editorOptions.click) !== null && _editorOptions$click !== void 0 ? _editorOptions$click : legacyModel === null || legacyModel === void 0 ? void 0 : (_legacyModel$editorOp3 = legacyModel.editorOptions) === null || _legacyModel$editorOp3 === void 0 ? void 0 : _legacyModel$editorOp3.click;\n  button.icon = (_editorOptions$icon = editorOptions === null || editorOptions === void 0 ? void 0 : editorOptions.icon) !== null && _editorOptions$icon !== void 0 ? _editorOptions$icon : legacyModel === null || legacyModel === void 0 ? void 0 : (_legacyModel$editorOp4 = legacyModel.editorOptions) === null || _legacyModel$editorOp4 === void 0 ? void 0 : _legacyModel$editorOp4.icon;\n  button.title = (title === null || title === void 0 ? void 0 : title.textContent) || \"\";\n  button.description = (desc === null || desc === void 0 ? void 0 : desc.textContent) || \"\";\n  button.caption = (caption === null || caption === void 0 ? void 0 : caption.textContent) || \"\";\n  button.label = (label === null || label === void 0 ? void 0 : label.textContent) || \"\";\n  button.number = (num === null || num === void 0 ? void 0 : num.textContent) || \"\";\n  button.duration = (duration === null || duration === void 0 ? void 0 : duration.textContent) || \"\";\n  button.option = getObjectKey(ImageDisplayTypes, element.classList, button.option);\n  button.clickAction = createAction(\"click\", action === null || action === void 0 ? void 0 : action.onClick);\n  button.overAction = createAction(\"over\", action === null || action === void 0 ? void 0 : action.onRollOver);\n  button.position = getObjectKey(MediaPosition, element.classList, button.position);\n  button.style = createComponentStyle(element, ((_GlTemplateBuilderSto = GlTemplateBuilderStore.getTemplate()) === null || _GlTemplateBuilderSto === void 0 ? void 0 : _GlTemplateBuilderSto.isSummary) ? StyleListTypes.MediaButtonSummary : StyleListTypes.MediaButton, true);\n  return button;\n}\n\nfunction createFlipCard(element) {\n  var _action$onFlip;\n\n  const flipcard = new MediaFlipCard();\n  const recto = getHTMLElement(element, \".flipcardfrontwrapper\");\n  const verso = getHTMLElement(element, \".flipcardbackwrapper\");\n  const action = toJSONObject(element.getAttribute(\"blm-action\"));\n\n  if (action && action.onClick && action.onClick.action === ComponentActionTypes.Goto && Object.values(GotoActionTypes).includes(action.onClick.option)) {\n    action.onClick.action = ComponentActionTypes.Navigation;\n  }\n\n  flipcard.recto = createFlipCardSide(recto, true);\n  flipcard.verso = createFlipCardSide(verso, false);\n  flipcard.flipAction = (action === null || action === void 0 ? void 0 : (_action$onFlip = action.onFlip) === null || _action$onFlip === void 0 ? void 0 : _action$onFlip.action) === \"mouseover\";\n  flipcard.clickAction = createAction(\"click\", action === null || action === void 0 ? void 0 : action.onClick);\n  flipcard.overAction = createAction(\"over\", action === null || action === void 0 ? void 0 : action.onRollOver);\n  return flipcard;\n}\n\nfunction createFlipCardSide(element, isRecto = true) {\n  const side = new FlipCardSide();\n\n  if (element) {\n    const model = getBLMElement(element);\n    const {\n      editorOptions\n    } = model;\n    const label = getHTMLElement(element, \".optionwrapper .label\");\n    const duration = getHTMLElement(element, \".optionwrapper .duration\");\n    const num = getHTMLElement(element, \".captionwrapper .number\");\n    const title = getHTMLElement(element, \".captionwrapper .title\");\n    const desc = getHTMLElement(element, \".captionwrapper .description\");\n    const caption = getHTMLElement(element, \".captionwrapper .caption\");\n    side.media = editorOptions === null || editorOptions === void 0 ? void 0 : editorOptions.media;\n    side.icon = editorOptions === null || editorOptions === void 0 ? void 0 : editorOptions.icon;\n    side.title = (title === null || title === void 0 ? void 0 : title.textContent) || \"\";\n    side.description = (desc === null || desc === void 0 ? void 0 : desc.textContent) || \"\";\n    side.caption = (caption === null || caption === void 0 ? void 0 : caption.textContent) || \"\";\n    side.label = (label === null || label === void 0 ? void 0 : label.textContent) || \"\";\n    side.number = (num === null || num === void 0 ? void 0 : num.textContent) || \"\";\n    side.duration = (duration === null || duration === void 0 ? void 0 : duration.textContent) || \"\";\n    side.option = getObjectKey(ImageDisplayTypes, element.classList, side.option);\n    side.style = createComponentStyle(element, isRecto ? StyleListTypes.MediaFlipCardRecto : StyleListTypes.MediaFlipCardVerso, true);\n    side.position = getObjectKey(MediaPosition, element.classList, side.position);\n  }\n\n  return side;\n}\n\nfunction createCustom(editorOptions) {\n  const custom = new MediaCustom();\n\n  if (editorOptions && \"media\" in editorOptions) {\n    custom.media = editorOptions.media;\n  } else {\n    var _ref;\n\n    //todo: remove legacy condition\n    custom.media = (_ref = editorOptions) !== null && _ref !== void 0 ? _ref : undefined;\n  }\n\n  return custom;\n}\n\nfunction createTarget(attributes) {\n  const target = new MediaTarget();\n  const str = attributes[\"blm-target\"];\n\n  if (str && str !== \"\") {\n    const obj = JSON.parse(str);\n\n    if (obj) {\n      var _obj$target_backgroun;\n\n      target.name = obj.name;\n      target.template = obj.default;\n      target.transition = obj.transition;\n      target.background = (_obj$target_backgroun = obj.target_background) !== null && _obj$target_backgroun !== void 0 ? _obj$target_backgroun : target.background;\n    }\n  }\n\n  return target;\n}\n\nfunction createExternalVideo(element, component) {\n  const video = new ExternalVideo();\n  const {\n    options\n  } = component;\n  const iframe = getHTMLElement(element, \"iframe\");\n\n  if (iframe) {\n    const model = getBLMElement(iframe);\n    const media = model === null || model === void 0 ? void 0 : model.editorOptions;\n    video.url = (media === null || media === void 0 ? void 0 : media.url) || \"\";\n    video.thumbnail = (media === null || media === void 0 ? void 0 : media.thumbnail) || undefined;\n  }\n\n  if ((options === null || options === void 0 ? void 0 : options.parameters) && \"id\" in options.parameters) {\n    video.id = options.parameters.id || undefined;\n    video.server = options.parameters.server || undefined;\n  }\n\n  return video;\n}\n\nfunction createStandardVideo(element, component) {\n  const video = new StandardVideo();\n  const {\n    options\n  } = component;\n  const model = getBLMElementBy(element, \".mediawrapper\");\n  const media = model === null || model === void 0 ? void 0 : model.editorOptions;\n  const title = getHTMLElement(element, \".captionwrapper .title\");\n  const desc = getHTMLElement(element, \".captionwrapper .description\");\n  const caption = getHTMLElement(element, \".captionwrapper .caption\");\n  video.main = media === null || media === void 0 ? void 0 : media.main;\n  video.webm = media === null || media === void 0 ? void 0 : media.webm;\n  video.image = media === null || media === void 0 ? void 0 : media.image;\n  video.title = (title === null || title === void 0 ? void 0 : title.textContent) || \"\";\n  video.description = (desc === null || desc === void 0 ? void 0 : desc.textContent) || \"\";\n  video.caption = (caption === null || caption === void 0 ? void 0 : caption.textContent) || \"\";\n  video.option = getObjectKey(ImageDisplayTypes, element.classList, video.option);\n  video.style = createComponentStyle(element, StyleListTypes.MediaVideo);\n\n  if (video.main && (media === null || media === void 0 ? void 0 : media.subtitle) && (media === null || media === void 0 ? void 0 : media.marker)) {\n    //For legacy code, we can remove after some times\n    video.main.subtitle = media.subtitle;\n    video.main.marker = media.marker;\n  }\n\n  if ((options === null || options === void 0 ? void 0 : options.parameters) && \"autostart\" in options.parameters) {\n    video.autoPlay = options.parameters.autostart || false;\n    video.loop = options.parameters.loop || false;\n  }\n\n  return video;\n}\n\nfunction createSynchroVideo(element, component) {\n  const synchro = new SynchroVideo();\n  const model = getBLMElementBy(element, \".mediawrapper\");\n  const lblModels = getAllBLMElementsBy(element, \".mediawrapper .labels div\");\n  const actions = toJSONObject(element.getAttribute(\"blm-action\"));\n  const media = model === null || model === void 0 ? void 0 : model.editorOptions;\n  const {\n    main,\n    webm\n  } = media !== null && media !== void 0 ? media : {};\n  const isLottie = main && isJSON(main.type);\n  synchro.main = main;\n  synchro.webm = webm;\n\n  if (lblModels) {\n    synchro.labels = filterFalsy(lblModels.map(item => {\n      const {\n        options,\n        innerHTML\n      } = item;\n\n      if (options) {\n        const {\n          start,\n          stop,\n          position\n        } = options;\n        const [startTime, endTime] = isLottie ? [toNumber(start), toNumber(stop)] : [parseTimestamp(start), parseTimestamp(stop)];\n        const cue = new MediaTrackCue(startTime, endTime, innerHTML);\n        cue.position = position;\n        return cue;\n      }\n\n      return undefined;\n    }));\n  }\n\n  if (actions) {\n    synchro.contents = actions.map(item => {\n      const {\n        action,\n        content,\n        start,\n        stop\n      } = item;\n      const startTime = isLottie ? toNumber(start) : parseTimestamp(start);\n      const endTime = stop ? isLottie ? toNumber(stop) : parseTimestamp(stop) : NaN;\n      const cue = new MediaTrackCue(startTime, endTime);\n      cue.action = action;\n      cue.content = content;\n      return cue;\n    });\n  }\n\n  return synchro;\n}\n\nfunction createHotspot(element) {\n  var _imgModel$options;\n\n  const hotspot = new MediaHotspot();\n  const model = getBLMElementBy(element, \".mediawrapper\");\n  const imgModel = getBLMElementBy(element, \".mediawrapper .imagewrapper\");\n  const groupsWrapper = getHTMLElement(element, \".hotspotgroupwrapper\");\n  const hotspots = getAllHTMLElements(element, \".mediawrapper .imagewrapper .hotspot\");\n  const {\n    editorOptions\n  } = model || {};\n  hotspot.prerequisite = (imgModel === null || imgModel === void 0 ? void 0 : (_imgModel$options = imgModel.options) === null || _imgModel$options === void 0 ? void 0 : _imgModel$options.prerequisite) || false;\n\n  if (editorOptions && \"media\" in editorOptions) {\n    hotspot.media = (editorOptions === null || editorOptions === void 0 ? void 0 : editorOptions.media) || undefined;\n    hotspot.style = editorOptions === null || editorOptions === void 0 ? void 0 : editorOptions.style;\n  } else {\n    //todo: remvoe legacy condition\n    hotspot.media = editorOptions || undefined;\n  }\n\n  hotspot.display.type = getObjectKey(HotspotDisplayTypes, element.classList, hotspot.display.type);\n\n  if (hotspot.display.type === HotspotDisplayTypes.PanAndZoom) {\n    var _imgModel$options$cen, _imgModel$options2, _imgModel$options$all, _imgModel$options3, _imgModel$options$min, _imgModel$options4;\n\n    hotspot.display.centerImage = (_imgModel$options$cen = imgModel === null || imgModel === void 0 ? void 0 : (_imgModel$options2 = imgModel.options) === null || _imgModel$options2 === void 0 ? void 0 : _imgModel$options2.centeronclick) !== null && _imgModel$options$cen !== void 0 ? _imgModel$options$cen : true;\n    hotspot.display.allowZoom = (_imgModel$options$all = imgModel === null || imgModel === void 0 ? void 0 : (_imgModel$options3 = imgModel.options) === null || _imgModel$options3 === void 0 ? void 0 : _imgModel$options3.allowzoom) !== null && _imgModel$options$all !== void 0 ? _imgModel$options$all : true;\n    hotspot.display.miniView = (_imgModel$options$min = imgModel === null || imgModel === void 0 ? void 0 : (_imgModel$options4 = imgModel.options) === null || _imgModel$options4 === void 0 ? void 0 : _imgModel$options4.miniview) !== null && _imgModel$options$min !== void 0 ? _imgModel$options$min : false;\n  }\n\n  if (groupsWrapper) {\n    const groups = getAllHTMLElements(groupsWrapper, \"div\");\n    hotspot.groups.enabled = true;\n    hotspot.groups.style = getComponentStyle(groupsWrapper, StyleListTypes.MediaHotspotGroup);\n    hotspot.groups.items = groups.map(wrapper => {\n      const id = wrapper.getAttribute(\"blm-group-id\") || createShortUUID();\n      const name = wrapper.innerHTML;\n      const color = wrapper.getAttribute(\"blm-group-color\") || getRandomColor();\n      return new MediaHotspotGroupItem(id, name, color);\n    });\n  }\n\n  hotspot.items = hotspots.map(wrapper => {\n    var _getHTMLElement, _GlTemplateBuilderSto2, _itemModel$editorOpti;\n\n    const item = new MediaHotspotItem();\n    const itemModel = getBLMElement(wrapper);\n    const action = toJSONObject(wrapper.getAttribute(\"blm-action\"));\n    item.id = createShortUUID();\n    item.x = toNumber(wrapper.style.getPropertyValue(\"--hotspot_left\"));\n    item.y = toNumber(wrapper.style.getPropertyValue(\"--hotspot_top\"));\n    item.name = ((_getHTMLElement = getHTMLElement(wrapper, \".hotspotlabel span\")) === null || _getHTMLElement === void 0 ? void 0 : _getHTMLElement.innerHTML) || \"\";\n    item.style = getComponentStyle(wrapper, ((_GlTemplateBuilderSto2 = GlTemplateBuilderStore.getTemplate()) === null || _GlTemplateBuilderSto2 === void 0 ? void 0 : _GlTemplateBuilderSto2.isSummary) ? StyleListTypes.MediaHotspotItemSummary : StyleListTypes.MediaHotspotItem);\n    item.groupId = wrapper.getAttribute(\"blm-group\") || item.groupId;\n    item.media = (_itemModel$editorOpti = itemModel.editorOptions) === null || _itemModel$editorOpti === void 0 ? void 0 : _itemModel$editorOpti.media;\n    item.position = wrapper.getAttribute(\"blm-position\") || item.position;\n    item.size = toNumber(wrapper.getAttribute(\"blm-size\") || \"1\");\n    item.hasDark = !wrapper.classList.contains(\"light\");\n    item.callToAction = toBoolean(wrapper.getAttribute(\"blm-calltoaction\"));\n    item.clickAction = createAction(\"click\", action === null || action === void 0 ? void 0 : action.onClick, wrapper);\n    item.overAction = createAction(\"over\", action === null || action === void 0 ? void 0 : action.onRollOver, wrapper);\n    return item;\n  });\n  return hotspot;\n}\n\nfunction createHotspot360(element) {\n  const hotspot360 = new MediaHotspot360();\n  const elements = getAllHTMLElements(element, \".tab360\");\n  hotspot360.items = elements.map((element, i) => {\n    var _element$getAttribute, _getHTMLElement$textC, _getHTMLElement2, _options$prerequisite;\n\n    const hotspot = new MediaHotspot();\n    const model = getBLMElement(element);\n    const groupsWrapper = getHTMLElement(element, \".hotspotgroupwrapper\");\n    const hotspots = getAllHTMLElements(element, \".hotspot\");\n    const {\n      options,\n      editorOptions\n    } = model;\n    hotspot.id = (_element$getAttribute = element.getAttribute(\"id\")) !== null && _element$getAttribute !== void 0 ? _element$getAttribute : createShortUUID();\n    hotspot.name = (_getHTMLElement$textC = (_getHTMLElement2 = getHTMLElement(element, \".tabname\")) === null || _getHTMLElement2 === void 0 ? void 0 : _getHTMLElement2.textContent) !== null && _getHTMLElement$textC !== void 0 ? _getHTMLElement$textC : \"360-\" + String.fromCharCode((i + 1) % 26 + 64).toLowerCase();\n    hotspot.prerequisite = (_options$prerequisite = options === null || options === void 0 ? void 0 : options.prerequisite) !== null && _options$prerequisite !== void 0 ? _options$prerequisite : false;\n    hotspot.media = editorOptions === null || editorOptions === void 0 ? void 0 : editorOptions.media;\n    hotspot.style = editorOptions === null || editorOptions === void 0 ? void 0 : editorOptions.style;\n\n    if (groupsWrapper) {\n      const groups = getAllHTMLElements(groupsWrapper, \"div\");\n      hotspot.groups.enabled = true;\n      hotspot.groups.style = getComponentStyle(groupsWrapper, StyleListTypes.MediaHotspotGroup);\n      hotspot.groups.items = groups.map(wrapper => {\n        const id = wrapper.getAttribute(\"blm-group-id\") || createShortUUID();\n        const name = wrapper.innerHTML;\n        const color = wrapper.getAttribute(\"blm-group-color\") || getRandomColor();\n        return new MediaHotspotGroupItem(id, name, color);\n      });\n    }\n\n    hotspot.items = hotspots.map(wrapper => {\n      var _itemModel$options$po, _itemModel$options, _itemModel$options$po2, _itemModel$options2, _itemModel$options$po3, _itemModel$options3, _getHTMLElement3, _itemModel$editorOpti2;\n\n      const item = new MediaHotspotItem();\n      const itemModel = getBLMElement(wrapper);\n      const action = toJSONObject(wrapper.getAttribute(\"blm-action\"));\n      item.id = createShortUUID();\n      item.x = (_itemModel$options$po = (_itemModel$options = itemModel.options) === null || _itemModel$options === void 0 ? void 0 : _itemModel$options.position.x) !== null && _itemModel$options$po !== void 0 ? _itemModel$options$po : 0;\n      item.y = (_itemModel$options$po2 = (_itemModel$options2 = itemModel.options) === null || _itemModel$options2 === void 0 ? void 0 : _itemModel$options2.position.y) !== null && _itemModel$options$po2 !== void 0 ? _itemModel$options$po2 : 0;\n      item.z = (_itemModel$options$po3 = (_itemModel$options3 = itemModel.options) === null || _itemModel$options3 === void 0 ? void 0 : _itemModel$options3.position.z) !== null && _itemModel$options$po3 !== void 0 ? _itemModel$options$po3 : 0;\n      item.name = ((_getHTMLElement3 = getHTMLElement(wrapper, \".hotspotlabel span\")) === null || _getHTMLElement3 === void 0 ? void 0 : _getHTMLElement3.innerHTML) || \"\";\n      item.style = getComponentStyle(wrapper, StyleListTypes.MediaHotspotItem360);\n      item.groupId = wrapper.getAttribute(\"blm-group\") || item.groupId;\n      item.media = (_itemModel$editorOpti2 = itemModel.editorOptions) === null || _itemModel$editorOpti2 === void 0 ? void 0 : _itemModel$editorOpti2.media;\n      item.hasDark = !wrapper.classList.contains(\"light\");\n      item.callToAction = toBoolean(wrapper.getAttribute(\"blm-calltoaction\"));\n      item.clickAction = createAction(\"click\", action === null || action === void 0 ? void 0 : action.onClick, wrapper);\n      item.overAction = createAction(\"over\", action === null || action === void 0 ? void 0 : action.onRollOver, wrapper);\n      return item;\n    });\n    return hotspot;\n  });\n  return hotspot360;\n}","map":{"version":3,"sources":["C:/Users/Rajesh/Downloads/bilim (2)/bilim/v1.0/editors/BlmCourseEditor/src/template-builders/model/component/media.ts"],"names":["MediaComponent","MediaImage","MediaCustom","MediaTarget","MediaButton","ExternalVideo","StandardVideo","MediaSlideshow","MediaSlideshowItem","MediaHotspot","MediaHotspotItem","MediaHotspotGroupItem","FlipCardSide","MediaFlipCard","SynchroVideo","MediaTrackCue","MediaHotspot360","ComponentActionTypes","GotoActionTypes","HotspotDisplayTypes","ImageDisplayTypes","MediaPosition","MediaVariants","StyleListTypes","createShortUUID","createUUID","filterFalsy","getObjectKey","getRandomColor","isJSON","parseTimestamp","toBoolean","toJSONObject","toNumber","createMediaConfig","createMediaFormat","getAllBLMElementsBy","getAllHTMLElements","getBLMElement","getBLMElementBy","getHTMLElement","setComponentBy","GlTemplateBuilderStore","createAction","createComponentStyle","getComponentStyle","getAllMediaComponent","parent","selector","repeaterId","elements","medias","element","media","createMedia","push","model","attributes","options","editorOptions","options2","getAttribute","classList","Array","from","variant","hasApplyStyle","undefined","config","format","style","Image","value","createImage","Slideshow","createSlideshow","Button","createButton","FlipCard","createFlipCard","Custom","createCustom","Target","createTarget","VideoExternal","createExternalVideo","VideoStandard","createStandardVideo","createSynchroVideo","Hotspot","createHotspot","Hotspot360","createHotspot360","image","title","desc","caption","textContent","description","option","position","isZoom","hasAttribute","slideshow","wrappers","items","map","wrapper","item","action","id","innerHTML","clickAction","onClick","slideStyle","button","legacyModel","label","duration","num","Goto","Object","values","includes","Navigation","out","over","click","icon","number","overAction","onRollOver","getTemplate","isSummary","MediaButtonSummary","flipcard","recto","verso","createFlipCardSide","flipAction","onFlip","isRecto","side","MediaFlipCardRecto","MediaFlipCardVerso","custom","target","str","obj","JSON","parse","name","template","default","transition","background","target_background","component","video","iframe","url","thumbnail","parameters","server","main","webm","MediaVideo","subtitle","marker","autoPlay","autostart","loop","synchro","lblModels","actions","isLottie","type","labels","start","stop","startTime","endTime","cue","contents","content","NaN","hotspot","imgModel","groupsWrapper","hotspots","prerequisite","display","PanAndZoom","centerImage","centeronclick","allowZoom","allowzoom","miniView","miniview","groups","enabled","MediaHotspotGroup","color","itemModel","x","getPropertyValue","y","MediaHotspotItemSummary","groupId","size","hasDark","contains","callToAction","hotspot360","i","String","fromCharCode","toLowerCase","z","MediaHotspotItem360"],"mappings":"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","sourcesContent":["import {\r\n  MediaComponent,\r\n  MediaConfigJSON,\r\n  MediaFile,\r\n  MediaImage,\r\n  MediaCustom,\r\n  Attributes,\r\n  MediaTarget,\r\n  MediaButton,\r\n  SimpleObject,\r\n  ExternalVideo,\r\n  StandardVideo,\r\n  MediaSlideshow,\r\n  MediaSlideshowItem,\r\n  MediaHotspot,\r\n  MediaHotspotItem,\r\n  MediaHotspotGroupItem,\r\n  MediaHotspotOptionsJSON,\r\n  FlipCardSide,\r\n  MediaFlipCard,\r\n  SynchroVideo,\r\n  MediaTrackCue,\r\n  MediaHotspot360,\r\n  MediaConfigOptions,\r\n} from \"types\";\r\nimport {\r\n  ComponentActionTypes,\r\n  GotoActionTypes,\r\n  HotspotDisplayTypes,\r\n  ImageDisplayTypes,\r\n  MediaCueActions,\r\n  MediaCuePositions,\r\n  MediaPosition,\r\n  MediaVariants,\r\n  Positions,\r\n  StyleListTypes,\r\n} from \"editor-constants\";\r\nimport {\r\n  createShortUUID,\r\n  createUUID,\r\n  filterFalsy,\r\n  getObjectKey,\r\n  getRandomColor,\r\n  isJSON,\r\n  parseTimestamp,\r\n  toBoolean,\r\n  toJSONObject,\r\n  toNumber,\r\n} from \"utils\";\r\nimport {\r\n  createMediaConfig,\r\n  createMediaFormat,\r\n  getAllBLMElementsBy,\r\n  getAllHTMLElements,\r\n  getBLMElement,\r\n  getBLMElementBy,\r\n  getHTMLElement,\r\n  setComponentBy,\r\n} from \"../../core\";\r\nimport { GlTemplateBuilderStore } from \"../../store\";\r\nimport { createAction, createComponentStyle, getComponentStyle } from \"./common\";\r\n\r\nexport function getAllMediaComponent(parent: HTMLElement, selector: string, repeaterId?: string) {\r\n  const elements = getAllHTMLElements(parent, selector);\r\n  const medias = [];\r\n\r\n  for (let element of elements) {\r\n    const media = createMedia(element);\r\n    media.repeaterId = repeaterId;\r\n\r\n    medias.push(media);\r\n  }\r\n\r\n  return medias;\r\n}\r\n\r\nfunction createMedia(element: HTMLElement) {\r\n  const media = new MediaComponent();\r\n  const model = getBLMElement<MediaConfigJSON>(element);\r\n  const { attributes, options, editorOptions } = model;\r\n  const options2 = toJSONObject<MediaConfigOptions>(element.getAttribute(\"blm-options2\"));\r\n\r\n  setComponentBy(media, model);\r\n\r\n  media.classList = Array.from(element.classList);\r\n\r\n  if (attributes) {\r\n    media.variant = attributes[\"blm-media\"] as MediaVariants;\r\n    media.hasApplyStyle = attributes[\"unapplystyle\"] === undefined;\r\n  }\r\n\r\n  if (options) {\r\n    media.options = options;\r\n    media.config = createMediaConfig(options, media.variant);\r\n  }\r\n\r\n  if (options2) {\r\n    media.options2 = options2;\r\n  }\r\n\r\n  media.format = createMediaFormat(\r\n    Array.from(element.classList),\r\n    element.style,\r\n    media.config?.format\r\n  );\r\n\r\n  if (media.variant === MediaVariants.Image) {\r\n    media.value = createImage(element);\r\n  } else if (media.variant === MediaVariants.Slideshow) {\r\n    media.value = createSlideshow(element);\r\n  } else if (media.variant === MediaVariants.Button) {\r\n    media.value = createButton(element);\r\n  } else if (media.variant === MediaVariants.FlipCard) {\r\n    media.value = createFlipCard(element);\r\n  } else if (media.variant === MediaVariants.Custom) {\r\n    media.value = createCustom(editorOptions as MediaFile);\r\n  } else if (media.variant === MediaVariants.Target && attributes) {\r\n    media.value = createTarget(attributes);\r\n  } else if (media.variant === MediaVariants.VideoExternal) {\r\n    media.value = createExternalVideo(element, media);\r\n  } else if (media.variant === MediaVariants.VideoStandard) {\r\n    media.value = createStandardVideo(element, media);\r\n  } else if (media.variant === MediaVariants.SynchroVideo) {\r\n    media.value = createSynchroVideo(element, media);\r\n  } else if (media.variant === MediaVariants.Hotspot) {\r\n    media.value = createHotspot(element);\r\n  } else if (media.variant === MediaVariants.Hotspot360) {\r\n    media.value = createHotspot360(element);\r\n  }\r\n\r\n  return media;\r\n}\r\n\r\nfunction createImage(element: HTMLElement) {\r\n  const image = new MediaImage();\r\n  const model = getBLMElementBy<object, { media?: MediaFile } | MediaFile>(\r\n    element,\r\n    \".mediawrapper\"\r\n  );\r\n  const { editorOptions } = model || {};\r\n  const title = getHTMLElement(element, \".captionwrapper .title\");\r\n  const desc = getHTMLElement(element, \".captionwrapper .description\");\r\n  const caption = getHTMLElement(element, \".captionwrapper .caption\");\r\n\r\n  if (editorOptions && \"media\" in editorOptions) {\r\n    image.media = editorOptions.media;\r\n  } else {\r\n    //todo: need to remove legacy condition after some time\r\n    image.media = (model?.editorOptions as MediaFile) || undefined;\r\n  }\r\n\r\n  image.title = title?.textContent || \"\";\r\n  image.description = desc?.textContent || \"\";\r\n  image.caption = caption?.textContent || \"\";\r\n  image.option = getObjectKey(ImageDisplayTypes, element.classList, image.option);\r\n  image.style = createComponentStyle(element, StyleListTypes.MediaImage, true);\r\n  image.position = getObjectKey(MediaPosition, element.classList, image.position);\r\n  image.isZoom = element.hasAttribute(\"zoomonclick\");\r\n\r\n  return image;\r\n}\r\n\r\nfunction createSlideshow(element: HTMLElement) {\r\n  const slideshow = new MediaSlideshow();\r\n  const wrappers = getAllHTMLElements(element, \".mediawrapper\");\r\n\r\n  slideshow.items = wrappers.map((wrapper) => {\r\n    const item = new MediaSlideshowItem();\r\n    const model = getBLMElement<object, { media?: MediaFile } | MediaFile>(wrapper);\r\n    const { editorOptions } = model || {};\r\n    const title = getHTMLElement(wrapper, \".captionwrapper .title\");\r\n    const desc = getHTMLElement(wrapper, \".captionwrapper .description\");\r\n    const caption = getHTMLElement(wrapper, \".captionwrapper .caption\");\r\n    const option = getObjectKey(ImageDisplayTypes, wrapper.classList, item.option);\r\n    const action = toJSONObject<{\r\n      onClick?: SimpleObject;\r\n    }>(wrapper.getAttribute(\"blm-action\"));\r\n    const position = getObjectKey(MediaPosition, wrapper.classList, item.position);\r\n\r\n    item.id = createUUID();\r\n\r\n    if (editorOptions && \"media\" in editorOptions) {\r\n      item.media = editorOptions?.media;\r\n    } else {\r\n      //todo: remove legacy condition\r\n      item.media = (editorOptions as MediaFile) || undefined;\r\n    }\r\n\r\n    item.title = title?.textContent || \"\";\r\n    item.description = desc?.innerHTML || \"\";\r\n    item.caption = caption?.textContent || \"\";\r\n    item.option = option;\r\n    item.clickAction = createAction(\"click\", action?.onClick);\r\n    item.position = position;\r\n\r\n    return item;\r\n  });\r\n\r\n  slideshow.style = getComponentStyle(element, StyleListTypes.MediaSlideshow);\r\n  slideshow.slideStyle = createComponentStyle(\r\n    element,\r\n    StyleListTypes.MediaSlideshowItem,\r\n    true,\r\n    \".splide__slide\"\r\n  );\r\n\r\n  return slideshow;\r\n}\r\n\r\nfunction createButton(element: HTMLElement) {\r\n  const button = new MediaButton();\r\n  const model = getBLMElementBy<\r\n    object,\r\n    Record<\"out\" | \"over\" | \"click\" | \"icon\", MediaFile | undefined>\r\n  >(element, \".mediabuttonwrapper\");\r\n  const { editorOptions } = model || {};\r\n  const legacyModel = getBLMElementBy<\r\n    object,\r\n    Record<\"out\" | \"over\" | \"click\" | \"icon\", MediaFile | undefined>\r\n  >(element, \".mediawrapper\"); //todo: it is for legacy buttons, need to remove this after some time.\r\n  const label = getHTMLElement(element, \".optionwrapper .label\");\r\n  const duration = getHTMLElement(element, \".optionwrapper .duration\");\r\n  const num = getHTMLElement(element, \".captionwrapper .number\");\r\n  const title = getHTMLElement(element, \".captionwrapper .title\");\r\n  const desc = getHTMLElement(element, \".captionwrapper .description\");\r\n  const caption = getHTMLElement(element, \".captionwrapper .caption\");\r\n  const action = toJSONObject<{\r\n    onClick?: SimpleObject;\r\n    onRollOver?: SimpleObject;\r\n  }>(element.getAttribute(\"blm-action\"));\r\n\r\n  if (\r\n    action &&\r\n    action.onClick &&\r\n    action.onClick.action === ComponentActionTypes.Goto &&\r\n    Object.values(GotoActionTypes).includes(action.onClick.option)\r\n  ) {\r\n    action.onClick.action = ComponentActionTypes.Navigation;\r\n  }\r\n\r\n  button.out = editorOptions?.out ?? legacyModel?.editorOptions?.out;\r\n  button.over = editorOptions?.over ?? legacyModel?.editorOptions?.over;\r\n  button.click = editorOptions?.click ?? legacyModel?.editorOptions?.click;\r\n  button.icon = editorOptions?.icon ?? legacyModel?.editorOptions?.icon;\r\n  button.title = title?.textContent || \"\";\r\n  button.description = desc?.textContent || \"\";\r\n  button.caption = caption?.textContent || \"\";\r\n  button.label = label?.textContent || \"\";\r\n  button.number = num?.textContent || \"\";\r\n  button.duration = duration?.textContent || \"\";\r\n  button.option = getObjectKey(ImageDisplayTypes, element.classList, button.option);\r\n  button.clickAction = createAction(\"click\", action?.onClick);\r\n  button.overAction = createAction(\"over\", action?.onRollOver);\r\n  button.position = getObjectKey(MediaPosition, element.classList, button.position);\r\n  button.style = createComponentStyle(\r\n    element,\r\n    GlTemplateBuilderStore.getTemplate()?.isSummary\r\n      ? StyleListTypes.MediaButtonSummary\r\n      : StyleListTypes.MediaButton,\r\n    true\r\n  );\r\n\r\n  return button;\r\n}\r\n\r\nfunction createFlipCard(element: HTMLElement) {\r\n  const flipcard = new MediaFlipCard();\r\n  const recto = getHTMLElement(element, \".flipcardfrontwrapper\");\r\n  const verso = getHTMLElement(element, \".flipcardbackwrapper\");\r\n  const action = toJSONObject<{\r\n    onFlip?: SimpleObject;\r\n    onClick?: SimpleObject;\r\n    onRollOver?: SimpleObject;\r\n  }>(element.getAttribute(\"blm-action\"));\r\n\r\n  if (\r\n    action &&\r\n    action.onClick &&\r\n    action.onClick.action === ComponentActionTypes.Goto &&\r\n    Object.values(GotoActionTypes).includes(action.onClick.option)\r\n  ) {\r\n    action.onClick.action = ComponentActionTypes.Navigation;\r\n  }\r\n\r\n  flipcard.recto = createFlipCardSide(recto, true);\r\n  flipcard.verso = createFlipCardSide(verso, false);\r\n  flipcard.flipAction = action?.onFlip?.action === \"mouseover\";\r\n  flipcard.clickAction = createAction(\"click\", action?.onClick);\r\n  flipcard.overAction = createAction(\"over\", action?.onRollOver);\r\n\r\n  return flipcard;\r\n}\r\n\r\nfunction createFlipCardSide(element?: HTMLElement | null, isRecto = true) {\r\n  const side = new FlipCardSide();\r\n\r\n  if (element) {\r\n    const model = getBLMElement<object, Record<\"media\" | \"icon\", MediaFile | undefined>>(element);\r\n    const { editorOptions } = model;\r\n    const label = getHTMLElement(element, \".optionwrapper .label\");\r\n    const duration = getHTMLElement(element, \".optionwrapper .duration\");\r\n    const num = getHTMLElement(element, \".captionwrapper .number\");\r\n    const title = getHTMLElement(element, \".captionwrapper .title\");\r\n    const desc = getHTMLElement(element, \".captionwrapper .description\");\r\n    const caption = getHTMLElement(element, \".captionwrapper .caption\");\r\n\r\n    side.media = editorOptions?.media;\r\n    side.icon = editorOptions?.icon;\r\n    side.title = title?.textContent || \"\";\r\n    side.description = desc?.textContent || \"\";\r\n    side.caption = caption?.textContent || \"\";\r\n    side.label = label?.textContent || \"\";\r\n    side.number = num?.textContent || \"\";\r\n    side.duration = duration?.textContent || \"\";\r\n    side.option = getObjectKey(ImageDisplayTypes, element.classList, side.option);\r\n    side.style = createComponentStyle(\r\n      element,\r\n      isRecto ? StyleListTypes.MediaFlipCardRecto : StyleListTypes.MediaFlipCardVerso,\r\n      true\r\n    );\r\n    side.position = getObjectKey(MediaPosition, element.classList, side.position);\r\n  }\r\n\r\n  return side;\r\n}\r\n\r\nfunction createCustom(editorOptions?: { media?: MediaFile } | MediaFile) {\r\n  const custom = new MediaCustom();\r\n\r\n  if (editorOptions && \"media\" in editorOptions) {\r\n    custom.media = editorOptions.media;\r\n  } else {\r\n    //todo: remove legacy condition\r\n    custom.media = (editorOptions as MediaFile) ?? undefined;\r\n  }\r\n\r\n  return custom;\r\n}\r\n\r\nfunction createTarget(attributes: Attributes) {\r\n  const target = new MediaTarget();\r\n  const str = attributes[\"blm-target\"];\r\n\r\n  if (str && str !== \"\") {\r\n    const obj = JSON.parse(str);\r\n\r\n    if (obj) {\r\n      target.name = obj.name;\r\n      target.template = obj.default;\r\n      target.transition = obj.transition;\r\n      target.background = obj.target_background ?? target.background;\r\n    }\r\n  }\r\n\r\n  return target;\r\n}\r\n\r\nfunction createExternalVideo(element: HTMLElement, component: MediaComponent) {\r\n  const video = new ExternalVideo();\r\n  const { options } = component;\r\n  const iframe = getHTMLElement(element, \"iframe\");\r\n\r\n  if (iframe) {\r\n    const model = getBLMElement<object, { url: string; thumbnail: string }>(iframe);\r\n    const media = model?.editorOptions;\r\n\r\n    video.url = media?.url || \"\";\r\n    video.thumbnail = media?.thumbnail || undefined;\r\n  }\r\n\r\n  if (options?.parameters && \"id\" in options.parameters) {\r\n    video.id = options.parameters.id || undefined;\r\n    video.server = options.parameters.server || undefined;\r\n  }\r\n\r\n  return video;\r\n}\r\n\r\nfunction createStandardVideo(element: HTMLElement, component: MediaComponent) {\r\n  const video = new StandardVideo();\r\n  const { options } = component;\r\n  const model = getBLMElementBy<\r\n    object,\r\n    Pick<StandardVideo, \"main\" | \"webm\" | \"image\"> &\r\n      Record<\"subtitle\" | \"marker\", MediaFile | undefined>\r\n  >(element, \".mediawrapper\");\r\n  const media = model?.editorOptions;\r\n  const title = getHTMLElement(element, \".captionwrapper .title\");\r\n  const desc = getHTMLElement(element, \".captionwrapper .description\");\r\n  const caption = getHTMLElement(element, \".captionwrapper .caption\");\r\n\r\n  video.main = media?.main;\r\n  video.webm = media?.webm;\r\n  video.image = media?.image;\r\n\r\n  video.title = title?.textContent || \"\";\r\n  video.description = desc?.textContent || \"\";\r\n  video.caption = caption?.textContent || \"\";\r\n  video.option = getObjectKey(ImageDisplayTypes, element.classList, video.option);\r\n  video.style = createComponentStyle(element, StyleListTypes.MediaVideo);\r\n\r\n  if (video.main && media?.subtitle && media?.marker) {\r\n    //For legacy code, we can remove after some times\r\n    video.main.subtitle = media.subtitle;\r\n    video.main.marker = media.marker;\r\n  }\r\n\r\n  if (options?.parameters && \"autostart\" in options.parameters) {\r\n    video.autoPlay = options.parameters.autostart || false;\r\n    video.loop = options.parameters.loop || false;\r\n  }\r\n\r\n  return video;\r\n}\r\n\r\nfunction createSynchroVideo(element: HTMLElement, component: MediaComponent) {\r\n  const synchro = new SynchroVideo();\r\n  const model = getBLMElementBy<object, Pick<SynchroVideo, \"main\" | \"webm\">>(\r\n    element,\r\n    \".mediawrapper\"\r\n  );\r\n  const lblModels = getAllBLMElementsBy<Record<\"start\" | \"stop\" | \"position\", string>>(\r\n    element,\r\n    \".mediawrapper .labels div\"\r\n  );\r\n  const actions = toJSONObject<[Record<\"action\" | \"content\" | \"start\" | \"stop\", string>]>(\r\n    element.getAttribute(\"blm-action\")\r\n  );\r\n  const media = model?.editorOptions;\r\n  const { main, webm } = media ?? {};\r\n  const isLottie = main && isJSON(main.type);\r\n\r\n  synchro.main = main;\r\n  synchro.webm = webm;\r\n\r\n  if (lblModels) {\r\n    synchro.labels = filterFalsy(\r\n      lblModels.map((item) => {\r\n        const { options, innerHTML } = item;\r\n\r\n        if (options) {\r\n          const { start, stop, position } = options;\r\n          const [startTime, endTime] = isLottie\r\n            ? [toNumber(start), toNumber(stop)]\r\n            : [parseTimestamp(start), parseTimestamp(stop)];\r\n\r\n          const cue = new MediaTrackCue(startTime, endTime, innerHTML);\r\n          cue.position = position as MediaCuePositions;\r\n\r\n          return cue;\r\n        }\r\n\r\n        return undefined;\r\n      })\r\n    );\r\n  }\r\n\r\n  if (actions) {\r\n    synchro.contents = actions.map((item) => {\r\n      const { action, content, start, stop } = item;\r\n      const startTime = isLottie ? toNumber(start) : parseTimestamp(start);\r\n      const endTime = stop ? (isLottie ? toNumber(stop) : parseTimestamp(stop)) : NaN;\r\n      const cue = new MediaTrackCue(startTime, endTime);\r\n\r\n      cue.action = action as MediaCueActions;\r\n      cue.content = content as MediaCuePositions;\r\n\r\n      return cue;\r\n    });\r\n  }\r\n\r\n  return synchro;\r\n}\r\n\r\nfunction createHotspot(element: HTMLElement) {\r\n  const hotspot = new MediaHotspot();\r\n  const model = getBLMElementBy<object, { media?: MediaFile; style?: string } | MediaFile>(\r\n    element,\r\n    \".mediawrapper\"\r\n  );\r\n  const imgModel = getBLMElementBy<MediaHotspotOptionsJSON>(element, \".mediawrapper .imagewrapper\");\r\n  const groupsWrapper = getHTMLElement(element, \".hotspotgroupwrapper\");\r\n  const hotspots = getAllHTMLElements(element, \".mediawrapper .imagewrapper .hotspot\");\r\n  const { editorOptions } = model || {};\r\n\r\n  hotspot.prerequisite = imgModel?.options?.prerequisite || false;\r\n  if (editorOptions && \"media\" in editorOptions) {\r\n    hotspot.media = editorOptions?.media || undefined;\r\n    hotspot.style = editorOptions?.style;\r\n  } else {\r\n    //todo: remvoe legacy condition\r\n    hotspot.media = (editorOptions as MediaFile) || undefined;\r\n  }\r\n  hotspot.display.type = getObjectKey(HotspotDisplayTypes, element.classList, hotspot.display.type);\r\n\r\n  if (hotspot.display.type === HotspotDisplayTypes.PanAndZoom) {\r\n    hotspot.display.centerImage = imgModel?.options?.centeronclick ?? true;\r\n    hotspot.display.allowZoom = imgModel?.options?.allowzoom ?? true;\r\n    hotspot.display.miniView = imgModel?.options?.miniview ?? false;\r\n  }\r\n\r\n  if (groupsWrapper) {\r\n    const groups = getAllHTMLElements(groupsWrapper, \"div\");\r\n\r\n    hotspot.groups.enabled = true;\r\n    hotspot.groups.style = getComponentStyle(groupsWrapper, StyleListTypes.MediaHotspotGroup);\r\n    hotspot.groups.items = groups.map((wrapper) => {\r\n      const id = wrapper.getAttribute(\"blm-group-id\") || createShortUUID();\r\n      const name = wrapper.innerHTML;\r\n      const color = wrapper.getAttribute(\"blm-group-color\") || getRandomColor();\r\n\r\n      return new MediaHotspotGroupItem(id, name, color);\r\n    });\r\n  }\r\n\r\n  hotspot.items = hotspots.map((wrapper: HTMLElement) => {\r\n    const item = new MediaHotspotItem();\r\n    const itemModel = getBLMElement<object, { media?: MediaFile }>(wrapper);\r\n    const action = toJSONObject<{\r\n      onClick?: SimpleObject;\r\n      onRollOver?: SimpleObject;\r\n    }>(wrapper.getAttribute(\"blm-action\"));\r\n\r\n    item.id = createShortUUID();\r\n    item.x = toNumber(wrapper.style.getPropertyValue(\"--hotspot_left\"));\r\n    item.y = toNumber(wrapper.style.getPropertyValue(\"--hotspot_top\"));\r\n    item.name = getHTMLElement(wrapper, \".hotspotlabel span\")?.innerHTML || \"\";\r\n    item.style = getComponentStyle(\r\n      wrapper,\r\n      GlTemplateBuilderStore.getTemplate()?.isSummary\r\n        ? StyleListTypes.MediaHotspotItemSummary\r\n        : StyleListTypes.MediaHotspotItem\r\n    );\r\n    item.groupId = wrapper.getAttribute(\"blm-group\") || item.groupId;\r\n    item.media = itemModel.editorOptions?.media;\r\n    item.position = (wrapper.getAttribute(\"blm-position\") as Positions) || item.position;\r\n    item.size = toNumber(wrapper.getAttribute(\"blm-size\") || \"1\");\r\n    item.hasDark = !wrapper.classList.contains(\"light\");\r\n    item.callToAction = toBoolean(wrapper.getAttribute(\"blm-calltoaction\"));\r\n    item.clickAction = createAction(\"click\", action?.onClick, wrapper);\r\n    item.overAction = createAction(\"over\", action?.onRollOver, wrapper);\r\n\r\n    return item;\r\n  });\r\n\r\n  return hotspot;\r\n}\r\n\r\nfunction createHotspot360(element: HTMLElement) {\r\n  const hotspot360 = new MediaHotspot360();\r\n  const elements = getAllHTMLElements(element, \".tab360\");\r\n\r\n  hotspot360.items = elements.map((element, i) => {\r\n    const hotspot = new MediaHotspot();\r\n    const model = getBLMElement<{ prerequisite: boolean }, { media?: MediaFile; style?: string }>(\r\n      element\r\n    );\r\n    const groupsWrapper = getHTMLElement(element, \".hotspotgroupwrapper\");\r\n    const hotspots = getAllHTMLElements(element, \".hotspot\");\r\n    const { options, editorOptions } = model;\r\n\r\n    hotspot.id = element.getAttribute(\"id\") ?? createShortUUID();\r\n    hotspot.name =\r\n      getHTMLElement(element, \".tabname\")?.textContent ??\r\n      \"360-\" + String.fromCharCode(((i + 1) % 26) + 64).toLowerCase();\r\n    hotspot.prerequisite = options?.prerequisite ?? false;\r\n    hotspot.media = editorOptions?.media;\r\n    hotspot.style = editorOptions?.style;\r\n\r\n    if (groupsWrapper) {\r\n      const groups = getAllHTMLElements(groupsWrapper, \"div\");\r\n\r\n      hotspot.groups.enabled = true;\r\n      hotspot.groups.style = getComponentStyle(groupsWrapper, StyleListTypes.MediaHotspotGroup);\r\n      hotspot.groups.items = groups.map((wrapper) => {\r\n        const id = wrapper.getAttribute(\"blm-group-id\") || createShortUUID();\r\n        const name = wrapper.innerHTML;\r\n        const color = wrapper.getAttribute(\"blm-group-color\") || getRandomColor();\r\n\r\n        return new MediaHotspotGroupItem(id, name, color);\r\n      });\r\n    }\r\n\r\n    hotspot.items = hotspots.map((wrapper) => {\r\n      const item = new MediaHotspotItem();\r\n      const itemModel = getBLMElement<\r\n        { position: { x: number; y: number; z: number } },\r\n        { media?: MediaFile }\r\n      >(wrapper);\r\n      const action = toJSONObject<{\r\n        onClick?: SimpleObject;\r\n        onRollOver?: SimpleObject;\r\n      }>(wrapper.getAttribute(\"blm-action\"));\r\n\r\n      item.id = createShortUUID();\r\n      item.x = itemModel.options?.position.x ?? 0;\r\n      item.y = itemModel.options?.position.y ?? 0;\r\n      item.z = itemModel.options?.position.z ?? 0;\r\n      item.name = getHTMLElement(wrapper, \".hotspotlabel span\")?.innerHTML || \"\";\r\n      item.style = getComponentStyle(wrapper, StyleListTypes.MediaHotspotItem360);\r\n      item.groupId = wrapper.getAttribute(\"blm-group\") || item.groupId;\r\n      item.media = itemModel.editorOptions?.media;\r\n      item.hasDark = !wrapper.classList.contains(\"light\");\r\n      item.callToAction = toBoolean(wrapper.getAttribute(\"blm-calltoaction\"));\r\n      item.clickAction = createAction(\"click\", action?.onClick, wrapper);\r\n      item.overAction = createAction(\"over\", action?.onRollOver, wrapper);\r\n\r\n      return item;\r\n    });\r\n\r\n    return hotspot;\r\n  });\r\n\r\n  return hotspot360;\r\n}\r\n"]},"metadata":{},"sourceType":"module"}