{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Rajesh\\\\Downloads\\\\bilim (2)\\\\bilim\\\\v1.0\\\\editors\\\\BlmCourseEditor\\\\src\\\\components\\\\shared\\\\media-editor\\\\components\\\\main-timeline\\\\BlmMainTimeline.tsx\";\nimport React, { memo, useRef, useState } from \"react\";\nimport { Menu, MenuItem } from \"@material-ui/core\";\nimport { useTranslation } from \"react-i18next\";\nimport { removeObject } from \"utils\";\nimport { cloneCues, getCurrentCues, validateCue } from \"../../utils\";\nimport BlmMainCue from \"./cue\";\nimport \"./styles.scss\";\nconst initCtx = {\n  x: 0,\n  y: 0\n};\n\nfunction BlmMainTimeline(props) {\n  const {\n    type,\n    wavesurfer,\n    data,\n    onChange,\n    onTimeChange\n  } = props;\n  const containerRef = useRef(null);\n  const [ctxMenu, setCtxMenu] = useState({ ...initCtx\n  });\n  const {\n    currentTime,\n    scrollTime,\n    currentDuration\n  } = wavesurfer;\n  const curCues = getCurrentCues(type, data, scrollTime, currentDuration);\n  const startInd = data.indexOf(curCues[0]);\n  const isCtxOpen = ctxMenu.cue !== undefined;\n  const {\n    t\n  } = useTranslation(\"shared\");\n\n  const updateChange = newData => {\n    if (onChange) {\n      onChange(type, newData);\n    }\n  };\n\n  const updateTimeChange = time => {\n    if (onTimeChange) {\n      onTimeChange(time);\n    }\n  };\n\n  const handleChange = (oldCue, newCue) => {\n    const newData = cloneCues(data, oldCue, newCue);\n    updateChange(newData);\n  };\n\n  const handleDelete = cue => {\n    const newData = removeObject(data, cue);\n    updateChange(newData);\n  };\n\n  const handleTimeChange = time => {\n    updateTimeChange(time);\n  };\n\n  const handleContextMenu = (event, cue) => {\n    event.preventDefault();\n    setCtxMenu({\n      x: event.clientX - 2,\n      y: event.clientY - 4,\n      cue\n    });\n  };\n\n  const handleContextMenuClose = () => {\n    setCtxMenu({ ...initCtx\n    });\n  };\n\n  const handleContextItemClick = item => {\n    const {\n      cue\n    } = ctxMenu;\n    let newData;\n\n    if (cue) {\n      if (item === \"delete\") {\n        newData = removeObject(data, cue);\n      } else if (item === \"merge\") {\n        const ind = data.indexOf(cue);\n        const next = data[ind + 1];\n\n        if (next) {\n          newData = cloneCues(data, cue, {\n            endTime: next.endTime,\n            text: cue.text + \"\\n\" + next.text\n          });\n          newData.splice(ind + 1, 1);\n        }\n      }\n\n      if (newData) {\n        updateChange(newData);\n      }\n    }\n\n    handleContextMenuClose();\n  };\n\n  const renderChildren = () => {\n    return curCues.map((cue, ind) => {\n      const previous = ind > 0 && ind <= curCues.length ? curCues[ind - 1] : undefined;\n      const next = ind >= 0 && ind < curCues.length ? curCues[ind + 1] : undefined;\n      return /*#__PURE__*/React.createElement(BlmMainCue, {\n        key: ind,\n        data: cue,\n        index: ind,\n        wavesurfer: wavesurfer,\n        minTime: previous === null || previous === void 0 ? void 0 : previous.endTime,\n        maxTime: next === null || next === void 0 ? void 0 : next.startTime,\n        selected: cue.startTime <= currentTime && currentTime < cue.endTime,\n        invalid: !validateCue(type, data, cue),\n        onChange: handleChange,\n        onDelete: handleDelete,\n        onTimeChange: handleTimeChange,\n        onContextMenu: handleContextMenu,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 110,\n          columnNumber: 9\n        }\n      });\n    });\n  };\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    ref: containerRef,\n    style: {\n      \"--start-ind\": startInd\n    },\n    className: \"main-timeline-wrapper\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 129,\n      columnNumber: 5\n    }\n  }, renderChildren(), /*#__PURE__*/React.createElement(Menu, {\n    keepMounted: true,\n    open: isCtxOpen,\n    anchorReference: \"anchorPosition\",\n    anchorPosition: isCtxOpen ? {\n      top: ctxMenu.y,\n      left: ctxMenu.x\n    } : undefined,\n    className: \"main-timeline-ctx-menu\",\n    onClose: handleContextMenuClose,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 139,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(MenuItem, {\n    onClick: event => handleContextItemClick(\"delete\"),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 147,\n      columnNumber: 9\n    }\n  }, t(\"main_timeline.delete\")), /*#__PURE__*/React.createElement(MenuItem, {\n    onClick: event => handleContextItemClick(\"merge\"),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 150,\n      columnNumber: 9\n    }\n  }, t(\"main_timeline.merge\"))));\n}\n\nexport default memo(BlmMainTimeline);","map":{"version":3,"sources":["C:/Users/Rajesh/Downloads/bilim (2)/bilim/v1.0/editors/BlmCourseEditor/src/components/shared/media-editor/components/main-timeline/BlmMainTimeline.tsx"],"names":["React","memo","useRef","useState","Menu","MenuItem","useTranslation","removeObject","cloneCues","getCurrentCues","validateCue","BlmMainCue","initCtx","x","y","BlmMainTimeline","props","type","wavesurfer","data","onChange","onTimeChange","containerRef","ctxMenu","setCtxMenu","currentTime","scrollTime","currentDuration","curCues","startInd","indexOf","isCtxOpen","cue","undefined","t","updateChange","newData","updateTimeChange","time","handleChange","oldCue","newCue","handleDelete","handleTimeChange","handleContextMenu","event","preventDefault","clientX","clientY","handleContextMenuClose","handleContextItemClick","item","ind","next","endTime","text","splice","renderChildren","map","previous","length","startTime","top","left"],"mappings":"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","sourcesContent":["import React, { memo, useRef, MouseEvent as ReactMouseEvent, useState, CSSProperties } from \"react\";\r\nimport { Menu, MenuItem } from \"@material-ui/core\";\r\nimport { useTranslation } from \"react-i18next\";\r\n\r\nimport { MediaTrackCue, MediaWavesurfer } from \"types\";\r\nimport { MediaTrackTypes } from \"editor-constants\";\r\nimport { removeObject } from \"utils\";\r\nimport { cloneCues, getCurrentCues, validateCue } from \"../../utils\";\r\nimport BlmMainCue from \"./cue\";\r\nimport \"./styles.scss\";\r\n\r\nexport interface CompProps {\r\n  type: MediaTrackTypes;\r\n  wavesurfer: MediaWavesurfer;\r\n  data: MediaTrackCue[];\r\n  onChange?: (type: MediaTrackTypes, data: MediaTrackCue[]) => void;\r\n  onTimeChange?: (time: number) => void;\r\n}\r\n\r\ninterface CtxMenu {\r\n  cue?: MediaTrackCue;\r\n  x: number;\r\n  y: number;\r\n}\r\n\r\nconst initCtx: CtxMenu = { x: 0, y: 0 };\r\n\r\nfunction BlmMainTimeline(props: CompProps) {\r\n  const { type, wavesurfer, data, onChange, onTimeChange } = props;\r\n  const containerRef = useRef<HTMLDivElement>(null);\r\n  const [ctxMenu, setCtxMenu] = useState({ ...initCtx });\r\n  const { currentTime, scrollTime, currentDuration } = wavesurfer;\r\n  const curCues = getCurrentCues(type, data, scrollTime, currentDuration);\r\n  const startInd = data.indexOf(curCues[0]);\r\n  const isCtxOpen = ctxMenu.cue !== undefined;\r\n  const { t } = useTranslation(\"shared\");\r\n\r\n  const updateChange = (newData: MediaTrackCue[]) => {\r\n    if (onChange) {\r\n      onChange(type, newData);\r\n    }\r\n  };\r\n\r\n  const updateTimeChange = (time: number) => {\r\n    if (onTimeChange) {\r\n      onTimeChange(time);\r\n    }\r\n  };\r\n\r\n  const handleChange = (oldCue: MediaTrackCue, newCue: MediaTrackCue) => {\r\n    const newData = cloneCues(data, oldCue, newCue);\r\n\r\n    updateChange(newData);\r\n  };\r\n\r\n  const handleDelete = (cue: MediaTrackCue) => {\r\n    const newData = removeObject(data, cue);\r\n\r\n    updateChange(newData);\r\n  };\r\n\r\n  const handleTimeChange = (time: number) => {\r\n    updateTimeChange(time);\r\n  };\r\n\r\n  const handleContextMenu = (event: ReactMouseEvent, cue: MediaTrackCue) => {\r\n    event.preventDefault();\r\n\r\n    setCtxMenu({ x: event.clientX - 2, y: event.clientY - 4, cue });\r\n  };\r\n\r\n  const handleContextMenuClose = () => {\r\n    setCtxMenu({ ...initCtx });\r\n  };\r\n\r\n  const handleContextItemClick = (item: \"merge\" | \"delete\") => {\r\n    const { cue } = ctxMenu;\r\n    let newData;\r\n\r\n    if (cue) {\r\n      if (item === \"delete\") {\r\n        newData = removeObject(data, cue);\r\n      } else if (item === \"merge\") {\r\n        const ind = data.indexOf(cue);\r\n        const next = data[ind + 1];\r\n\r\n        if (next) {\r\n          newData = cloneCues(data, cue, {\r\n            endTime: next.endTime,\r\n            text: cue.text + \"\\n\" + next.text,\r\n          });\r\n          newData.splice(ind + 1, 1);\r\n        }\r\n      }\r\n\r\n      if (newData) {\r\n        updateChange(newData);\r\n      }\r\n    }\r\n\r\n    handleContextMenuClose();\r\n  };\r\n\r\n  const renderChildren = () => {\r\n    return curCues.map((cue, ind) => {\r\n      const previous = ind > 0 && ind <= curCues.length ? curCues[ind - 1] : undefined;\r\n      const next = ind >= 0 && ind < curCues.length ? curCues[ind + 1] : undefined;\r\n\r\n      return (\r\n        <BlmMainCue\r\n          key={ind}\r\n          data={cue}\r\n          index={ind}\r\n          wavesurfer={wavesurfer}\r\n          minTime={previous?.endTime}\r\n          maxTime={next?.startTime}\r\n          selected={cue.startTime <= currentTime && currentTime < cue.endTime}\r\n          invalid={!validateCue(type, data, cue)}\r\n          onChange={handleChange}\r\n          onDelete={handleDelete}\r\n          onTimeChange={handleTimeChange}\r\n          onContextMenu={handleContextMenu}\r\n        />\r\n      );\r\n    });\r\n  };\r\n\r\n  return (\r\n    <div\r\n      ref={containerRef}\r\n      style={\r\n        {\r\n          \"--start-ind\": startInd,\r\n        } as CSSProperties\r\n      }\r\n      className=\"main-timeline-wrapper\"\r\n    >\r\n      {renderChildren()}\r\n      <Menu\r\n        keepMounted\r\n        open={isCtxOpen}\r\n        anchorReference=\"anchorPosition\"\r\n        anchorPosition={isCtxOpen ? { top: ctxMenu.y, left: ctxMenu.x } : undefined}\r\n        className=\"main-timeline-ctx-menu\"\r\n        onClose={handleContextMenuClose}\r\n      >\r\n        <MenuItem onClick={(event) => handleContextItemClick(\"delete\")}>\r\n          {t(\"main_timeline.delete\")}\r\n        </MenuItem>\r\n        <MenuItem onClick={(event) => handleContextItemClick(\"merge\")}>\r\n          {t(\"main_timeline.merge\")}\r\n        </MenuItem>\r\n      </Menu>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default memo(BlmMainTimeline);\r\n"]},"metadata":{},"sourceType":"module"}