{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Rajesh\\\\Downloads\\\\bilim (2)\\\\bilim\\\\v1.0\\\\editors\\\\BlmCourseEditor\\\\src\\\\shared\\\\slider\\\\BlmSlider.tsx\";\nimport React, { useState, useRef, useEffect, useCallback } from \"react\";\nimport { convertToPercentage, convertFromPercentage } from \"utils\";\nimport { useLatest } from \"hooks\";\nimport { MarkerType } from \"./types\";\nimport BlmMarker from \"./BlmMarker\";\nimport \"./slider.scss\";\nconst initAdd = {\n  show: false,\n  x: 0,\n  value: 0\n};\nconst initRemove = {\n  show: false,\n  x: 0\n};\nconst initDragging = {\n  status: false,\n  marker: {},\n  downPosition: {\n    x: 0,\n    y: 0\n  }\n};\n\nfunction BlmSlider(props) {\n  const {\n    markers: currentMarkers,\n    hasCompletion,\n    onChange,\n    onAddClick,\n    onRemoveClick,\n    onCompletionClick\n  } = props;\n  const [markers, setMarkers] = useState(currentMarkers);\n  const [add, setAdd] = useState(initAdd);\n  const [remove, setRemove] = useState(initRemove);\n  const trackRef = useRef(null);\n  const markersRef = useLatest(markers);\n  const draggingRef = useRef(initDragging);\n  const len = markers ? markers.length : 0;\n  useEffect(() => {\n    setMarkers(currentMarkers);\n  }, [currentMarkers]); //Dragging markers\n\n  const handleMarkerMouseDown = (event, type, marker, index) => {\n    if (index === len - 1 && type === MarkerType.End) {\n      onCompletionClick(marker);\n    } else {\n      draggingRef.current = {\n        status: true,\n        marker: {\n          original: { ...marker\n          },\n          index,\n          type\n        },\n        downPosition: {\n          x: event.pageX,\n          y: event.pageY\n        }\n      };\n      addDraggingDocumentListeners();\n      event.stopPropagation();\n      event.preventDefault();\n      toggleRemove(false);\n    }\n  };\n\n  const handleDocumentMouseMove = useCallback(event => {\n    const {\n      status,\n      marker,\n      downPosition\n    } = draggingRef.current;\n    const arr = markersRef.current;\n    if (!status || !trackRef.current) return;\n    const {\n      original,\n      type,\n      index\n    } = marker;\n    const deltaX = event.pageX - downPosition.x;\n    const containerWidth = trackRef.current.offsetWidth;\n\n    if (original && index !== undefined) {\n      const {\n        start,\n        end\n      } = original;\n      const current = arr[index];\n      const sibling = type === MarkerType.Start ? arr[index - 1] : arr[index + 1];\n\n      if (type === MarkerType.Start && index !== 0) {\n        const startX = convertFromPercentage(start, containerWidth);\n        let startVal = Math.round(convertToPercentage(startX + deltaX, containerWidth));\n        startVal = Math.min(100, end - 1, Math.max(0, startVal, sibling.start + 1));\n        current.start = startVal;\n        sibling.end = current.start;\n      } else if (type === MarkerType.End && index !== arr.length - 1) {\n        const endX = convertFromPercentage(original.end, containerWidth);\n        let endVal = Math.round(convertToPercentage(endX + deltaX, containerWidth));\n        endVal = Math.min(100, sibling.end - 1, Math.max(0, start + 1, endVal));\n        current.end = endVal;\n        sibling.start = current.end;\n      }\n    }\n\n    event.stopPropagation();\n    event.preventDefault();\n    setMarkers([...arr]);\n  }, [markersRef, setMarkers]);\n  const handleDocumentMouseUp = useCallback(event => {\n    draggingRef.current = { ...initDragging\n    };\n    document.removeEventListener(\"mousemove\", handleDocumentMouseMove);\n    document.removeEventListener(\"mouseup\", handleDocumentMouseUp);\n    event.stopPropagation();\n    event.preventDefault();\n\n    if (onChange) {\n      onChange([...markersRef.current]);\n    }\n  }, [markersRef, onChange, handleDocumentMouseMove]);\n\n  const addDraggingDocumentListeners = () => {\n    document.addEventListener(\"mousemove\", handleDocumentMouseMove);\n    document.addEventListener(\"mouseup\", handleDocumentMouseUp);\n  }; //Add marker\n\n\n  const handleAddMouseEnter = event => {\n    if (!add.show) {\n      startAdding(event);\n    }\n  };\n\n  const handleAddMouseMove = event => {\n    if (add.show) {\n      toggleAdd(true, getTrackMouseX(event));\n    }\n  };\n\n  const handleAddMouseLeave = event => {\n    if (add.show) {\n      stopAdding();\n    }\n  };\n\n  const handleAddClick = event => {\n    stopAdding();\n\n    if (onAddClick) {\n      onAddClick(add.value);\n    }\n  };\n\n  const startAdding = event => {\n    toggleAdd(true, getTrackMouseX(event));\n  };\n\n  const stopAdding = () => {\n    toggleAdd(false);\n  };\n\n  const getTrackMouseX = event => {\n    if (trackRef.current) {\n      const rect = trackRef.current.getBoundingClientRect();\n      const mouseX = event.pageX - rect.x;\n      return mouseX;\n    }\n\n    return 0;\n  };\n\n  const toggleAdd = (show, xPos) => {\n    let x = xPos ? xPos : add.x;\n    let value;\n    x = Math.min(trackRef.current ? trackRef.current.offsetWidth : 0, Math.max(0, x));\n    value = convertXAxisToValue(x);\n    setAdd({\n      show,\n      x,\n      value\n    });\n  };\n\n  const convertXAxisToValue = xPos => {\n    if (trackRef.current) {\n      const containerWidth = trackRef.current.offsetWidth;\n      let xValue = convertToPercentage(xPos, containerWidth);\n      return Math.round(xValue);\n    }\n\n    return xPos;\n  }; //Remove marker\n\n\n  const handleMarkerMouseEnter = (event, type, marker, index) => {\n    if (draggingRef.current.status) {\n      return;\n    }\n\n    if (len > 2 && index < 2 && (index === 0 && type !== \"start\" || index === 1 && type !== \"end\")) {\n      const xPos = type === \"start\" ? marker.start : marker.end;\n      toggleRemove(true, xPos);\n    }\n  };\n\n  const handleMarkerMouseLeave = (event, type, marker, index) => {\n    if (remove.show) {\n      toggleRemove(false);\n    }\n  };\n\n  const handleRemoveMouseEnter = event => {\n    if (draggingRef.current.status) {\n      return;\n    }\n\n    toggleRemove(true);\n  };\n\n  const handleRemoveMouseLeave = event => {\n    if (remove.show) {\n      toggleRemove(false);\n    }\n  };\n\n  const handleRemoveClick = event => {\n    toggleRemove(false);\n\n    if (onRemoveClick) {\n      onRemoveClick();\n    }\n  };\n\n  const toggleRemove = (show, x) => {\n    setRemove({\n      x: x ? x : remove.x,\n      show: show\n    });\n  };\n\n  const renderMarkers = () => {\n    if (markers) {\n      return markers.map((marker, index) => {\n        const isAddable = !draggingRef.current.status && len === 2 && index === 0;\n        return /*#__PURE__*/React.createElement(BlmMarker, {\n          key: index,\n          data: marker,\n          isAddable: isAddable,\n          onMouseEnter: (event, type) => handleMarkerMouseEnter(event, type, marker, index),\n          onMouseLeave: (event, type) => handleMarkerMouseLeave(event, type, marker, index),\n          onMouseDown: (event, type) => handleMarkerMouseDown(event, type, marker, index),\n          onAddMouseEnter: handleAddMouseEnter,\n          onAddMouseMove: handleAddMouseMove,\n          onAddMouseLeave: handleAddMouseLeave,\n          onAddClick: handleAddClick,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 308,\n            columnNumber: 11\n          }\n        });\n      });\n    }\n  };\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"slider-container\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 326,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    ref: trackRef,\n    className: \"slider-track\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 327,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    hidden: !remove.show,\n    style: {\n      left: remove.x + \"%\"\n    },\n    className: \"slider-remove-zone\",\n    onMouseEnter: handleRemoveMouseEnter,\n    onMouseLeave: handleRemoveMouseLeave,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 328,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"slider-remove-btn\",\n    onClick: handleRemoveClick,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 335,\n      columnNumber: 11\n    }\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"slider-markers-container\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 337,\n      columnNumber: 9\n    }\n  }, renderMarkers()), /*#__PURE__*/React.createElement(\"div\", {\n    hidden: !hasCompletion,\n    className: \"slider-completion-icon\",\n    onClick: event => onCompletionClick(markers[markers.length - 1]),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 338,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    hidden: !add.show,\n    style: {\n      left: add.x + \"px\"\n    },\n    className: \"slider-add-lbl\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 343,\n      columnNumber: 9\n    }\n  }, add.value)));\n}\n\nexport default BlmSlider;","map":{"version":3,"sources":["C:/Users/Rajesh/Downloads/bilim (2)/bilim/v1.0/editors/BlmCourseEditor/src/shared/slider/BlmSlider.tsx"],"names":["React","useState","useRef","useEffect","useCallback","convertToPercentage","convertFromPercentage","useLatest","MarkerType","BlmMarker","initAdd","show","x","value","initRemove","initDragging","status","marker","downPosition","y","BlmSlider","props","markers","currentMarkers","hasCompletion","onChange","onAddClick","onRemoveClick","onCompletionClick","setMarkers","add","setAdd","remove","setRemove","trackRef","markersRef","draggingRef","len","length","handleMarkerMouseDown","event","type","index","End","current","original","pageX","pageY","addDraggingDocumentListeners","stopPropagation","preventDefault","toggleRemove","handleDocumentMouseMove","arr","deltaX","containerWidth","offsetWidth","undefined","start","end","sibling","Start","startX","startVal","Math","round","min","max","endX","endVal","handleDocumentMouseUp","document","removeEventListener","addEventListener","handleAddMouseEnter","startAdding","handleAddMouseMove","toggleAdd","getTrackMouseX","handleAddMouseLeave","stopAdding","handleAddClick","rect","getBoundingClientRect","mouseX","xPos","convertXAxisToValue","xValue","handleMarkerMouseEnter","handleMarkerMouseLeave","handleRemoveMouseEnter","handleRemoveMouseLeave","handleRemoveClick","renderMarkers","map","isAddable","left"],"mappings":"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","sourcesContent":["import React, { useState, useRef, useEffect, useCallback, MouseEvent } from \"react\";\r\n\r\nimport { convertToPercentage, convertFromPercentage } from \"utils\";\r\nimport { useLatest } from \"hooks\";\r\nimport { Marker, MarkerType } from \"./types\";\r\nimport BlmMarker from \"./BlmMarker\";\r\nimport \"./slider.scss\";\r\n\r\ninterface CompProps {\r\n  markers: Marker[];\r\n  hasCompletion: boolean;\r\n  onChange: (markers: Marker[]) => void;\r\n  onAddClick: (value: number) => void;\r\n  onRemoveClick: () => void;\r\n  onCompletionClick: (marker: Marker) => void;\r\n}\r\n\r\ninterface AddState {\r\n  show: boolean;\r\n  x: number;\r\n  value: number;\r\n}\r\n\r\ninterface RemoveState {\r\n  show: boolean;\r\n  x: number;\r\n}\r\n\r\ninterface DraggingState {\r\n  status: boolean;\r\n  downPosition: { x: number; y: number };\r\n  marker: {\r\n    original?: Marker;\r\n    type?: MarkerType;\r\n    index?: number;\r\n  };\r\n}\r\n\r\nconst initAdd: AddState = {\r\n  show: false,\r\n  x: 0,\r\n  value: 0,\r\n};\r\n\r\nconst initRemove: RemoveState = {\r\n  show: false,\r\n  x: 0,\r\n};\r\n\r\nconst initDragging: DraggingState = {\r\n  status: false,\r\n  marker: {},\r\n  downPosition: { x: 0, y: 0 },\r\n};\r\n\r\nfunction BlmSlider(props: CompProps) {\r\n  const {\r\n    markers: currentMarkers,\r\n    hasCompletion,\r\n    onChange,\r\n    onAddClick,\r\n    onRemoveClick,\r\n    onCompletionClick,\r\n  } = props;\r\n  const [markers, setMarkers] = useState(currentMarkers);\r\n  const [add, setAdd] = useState(initAdd);\r\n  const [remove, setRemove] = useState(initRemove);\r\n  const trackRef = useRef<HTMLDivElement>(null);\r\n  const markersRef = useLatest(markers);\r\n  const draggingRef = useRef(initDragging);\r\n  const len = markers ? markers.length : 0;\r\n\r\n  useEffect(() => {\r\n    setMarkers(currentMarkers);\r\n  }, [currentMarkers]);\r\n\r\n  //Dragging markers\r\n  const handleMarkerMouseDown = (\r\n    event: MouseEvent<HTMLElement>,\r\n    type: MarkerType,\r\n    marker: Marker,\r\n    index: number\r\n  ) => {\r\n    if (index === len - 1 && type === MarkerType.End) {\r\n      onCompletionClick(marker);\r\n    } else {\r\n      draggingRef.current = {\r\n        status: true,\r\n        marker: {\r\n          original: { ...marker },\r\n          index,\r\n          type,\r\n        },\r\n        downPosition: { x: event.pageX, y: event.pageY },\r\n      };\r\n\r\n      addDraggingDocumentListeners();\r\n\r\n      event.stopPropagation();\r\n      event.preventDefault();\r\n\r\n      toggleRemove(false);\r\n    }\r\n  };\r\n\r\n  const handleDocumentMouseMove = useCallback(\r\n    (event) => {\r\n      const { status, marker, downPosition } = draggingRef.current;\r\n      const arr = markersRef.current;\r\n\r\n      if (!status || !trackRef.current) return;\r\n\r\n      const { original, type, index } = marker;\r\n      const deltaX = event.pageX - downPosition.x;\r\n      const containerWidth = trackRef.current.offsetWidth;\r\n\r\n      if (original && index !== undefined) {\r\n        const { start, end } = original;\r\n        const current = arr[index];\r\n        const sibling = type === MarkerType.Start ? arr[index - 1] : arr[index + 1];\r\n\r\n        if (type === MarkerType.Start && index !== 0) {\r\n          const startX = convertFromPercentage(start, containerWidth);\r\n          let startVal = Math.round(convertToPercentage(startX + deltaX, containerWidth));\r\n\r\n          startVal = Math.min(100, end - 1, Math.max(0, startVal, sibling.start + 1));\r\n\r\n          current.start = startVal;\r\n          sibling.end = current.start;\r\n        } else if (type === MarkerType.End && index !== arr.length - 1) {\r\n          const endX = convertFromPercentage(original.end, containerWidth);\r\n          let endVal = Math.round(convertToPercentage(endX + deltaX, containerWidth));\r\n\r\n          endVal = Math.min(100, sibling.end - 1, Math.max(0, start + 1, endVal));\r\n\r\n          current.end = endVal;\r\n          sibling.start = current.end;\r\n        }\r\n      }\r\n\r\n      event.stopPropagation();\r\n      event.preventDefault();\r\n\r\n      setMarkers([...arr]);\r\n    },\r\n    [markersRef, setMarkers]\r\n  );\r\n\r\n  const handleDocumentMouseUp = useCallback(\r\n    (event) => {\r\n      draggingRef.current = { ...initDragging };\r\n\r\n      document.removeEventListener(\"mousemove\", handleDocumentMouseMove);\r\n      document.removeEventListener(\"mouseup\", handleDocumentMouseUp);\r\n\r\n      event.stopPropagation();\r\n      event.preventDefault();\r\n\r\n      if (onChange) {\r\n        onChange([...markersRef.current]);\r\n      }\r\n    },\r\n    [markersRef, onChange, handleDocumentMouseMove]\r\n  );\r\n\r\n  const addDraggingDocumentListeners = () => {\r\n    document.addEventListener(\"mousemove\", handleDocumentMouseMove);\r\n    document.addEventListener(\"mouseup\", handleDocumentMouseUp);\r\n  };\r\n\r\n  //Add marker\r\n  const handleAddMouseEnter = (event: MouseEvent<HTMLElement>) => {\r\n    if (!add.show) {\r\n      startAdding(event);\r\n    }\r\n  };\r\n\r\n  const handleAddMouseMove = (event: MouseEvent<HTMLElement>) => {\r\n    if (add.show) {\r\n      toggleAdd(true, getTrackMouseX(event));\r\n    }\r\n  };\r\n\r\n  const handleAddMouseLeave = (event: MouseEvent<HTMLElement>) => {\r\n    if (add.show) {\r\n      stopAdding();\r\n    }\r\n  };\r\n\r\n  const handleAddClick = (event: MouseEvent<HTMLElement>) => {\r\n    stopAdding();\r\n\r\n    if (onAddClick) {\r\n      onAddClick(add.value);\r\n    }\r\n  };\r\n\r\n  const startAdding = (event: MouseEvent<HTMLElement>) => {\r\n    toggleAdd(true, getTrackMouseX(event));\r\n  };\r\n\r\n  const stopAdding = () => {\r\n    toggleAdd(false);\r\n  };\r\n\r\n  const getTrackMouseX = (event: MouseEvent<HTMLElement>) => {\r\n    if (trackRef.current) {\r\n      const rect = trackRef.current.getBoundingClientRect();\r\n      const mouseX = event.pageX - rect.x;\r\n\r\n      return mouseX;\r\n    }\r\n    return 0;\r\n  };\r\n\r\n  const toggleAdd = (show: boolean, xPos?: number) => {\r\n    let x = xPos ? xPos : add.x;\r\n    let value;\r\n\r\n    x = Math.min(trackRef.current ? trackRef.current.offsetWidth : 0, Math.max(0, x));\r\n    value = convertXAxisToValue(x);\r\n\r\n    setAdd({\r\n      show,\r\n      x,\r\n      value,\r\n    });\r\n  };\r\n\r\n  const convertXAxisToValue = (xPos: number) => {\r\n    if (trackRef.current) {\r\n      const containerWidth = trackRef.current.offsetWidth;\r\n      let xValue = convertToPercentage(xPos, containerWidth);\r\n\r\n      return Math.round(xValue);\r\n    }\r\n    return xPos;\r\n  };\r\n\r\n  //Remove marker\r\n  const handleMarkerMouseEnter = (\r\n    event: MouseEvent<HTMLElement>,\r\n    type: MarkerType,\r\n    marker: Marker,\r\n    index: number\r\n  ) => {\r\n    if (draggingRef.current.status) {\r\n      return;\r\n    }\r\n\r\n    if (\r\n      len > 2 &&\r\n      index < 2 &&\r\n      ((index === 0 && type !== \"start\") || (index === 1 && type !== \"end\"))\r\n    ) {\r\n      const xPos = type === \"start\" ? marker.start : marker.end;\r\n\r\n      toggleRemove(true, xPos);\r\n    }\r\n  };\r\n\r\n  const handleMarkerMouseLeave = (\r\n    event: MouseEvent<HTMLElement>,\r\n    type: MarkerType,\r\n    marker: Marker,\r\n    index: number\r\n  ) => {\r\n    if (remove.show) {\r\n      toggleRemove(false);\r\n    }\r\n  };\r\n\r\n  const handleRemoveMouseEnter = (event: MouseEvent<HTMLElement>) => {\r\n    if (draggingRef.current.status) {\r\n      return;\r\n    }\r\n\r\n    toggleRemove(true);\r\n  };\r\n\r\n  const handleRemoveMouseLeave = (event: MouseEvent<HTMLElement>) => {\r\n    if (remove.show) {\r\n      toggleRemove(false);\r\n    }\r\n  };\r\n\r\n  const handleRemoveClick = (event: MouseEvent<HTMLElement>) => {\r\n    toggleRemove(false);\r\n\r\n    if (onRemoveClick) {\r\n      onRemoveClick();\r\n    }\r\n  };\r\n\r\n  const toggleRemove = (show: boolean, x?: number) => {\r\n    setRemove({\r\n      x: x ? x : remove.x,\r\n      show: show,\r\n    });\r\n  };\r\n\r\n  const renderMarkers = () => {\r\n    if (markers) {\r\n      return markers.map((marker, index) => {\r\n        const isAddable = !draggingRef.current.status && len === 2 && index === 0;\r\n\r\n        return (\r\n          <BlmMarker\r\n            key={index}\r\n            data={marker}\r\n            isAddable={isAddable}\r\n            onMouseEnter={(event, type) => handleMarkerMouseEnter(event, type, marker, index)}\r\n            onMouseLeave={(event, type) => handleMarkerMouseLeave(event, type, marker, index)}\r\n            onMouseDown={(event, type) => handleMarkerMouseDown(event, type, marker, index)}\r\n            onAddMouseEnter={handleAddMouseEnter}\r\n            onAddMouseMove={handleAddMouseMove}\r\n            onAddMouseLeave={handleAddMouseLeave}\r\n            onAddClick={handleAddClick}\r\n          />\r\n        );\r\n      });\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"slider-container\">\r\n      <div ref={trackRef} className=\"slider-track\">\r\n        <div\r\n          hidden={!remove.show}\r\n          style={{ left: remove.x + \"%\" }}\r\n          className=\"slider-remove-zone\"\r\n          onMouseEnter={handleRemoveMouseEnter}\r\n          onMouseLeave={handleRemoveMouseLeave}\r\n        >\r\n          <div className=\"slider-remove-btn\" onClick={handleRemoveClick} />\r\n        </div>\r\n        <div className=\"slider-markers-container\">{renderMarkers()}</div>\r\n        <div\r\n          hidden={!hasCompletion}\r\n          className=\"slider-completion-icon\"\r\n          onClick={(event) => onCompletionClick(markers[markers.length - 1])}\r\n        />\r\n        <div hidden={!add.show} style={{ left: add.x + \"px\" }} className=\"slider-add-lbl\">\r\n          {add.value}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default BlmSlider;\r\n"]},"metadata":{},"sourceType":"module"}