{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Rajesh\\\\Downloads\\\\bilim (2)\\\\bilim\\\\v1.0\\\\editors\\\\BlmCourseEditor\\\\src\\\\components\\\\properties\\\\controls\\\\chapter-evaluation\\\\BlmChapterEvaluationProps.tsx\";\nimport React, { Fragment, useCallback, useEffect } from \"react\";\nimport { RadioGroup, Radio, Checkbox, FormControlLabel, MenuItem, Select, Switch } from \"@material-ui/core\";\nimport { useTranslation } from \"react-i18next\";\nimport { ElementType, EvaluationType } from \"editor-constants\";\nimport { filterElements, getEvaluationPropsJSON } from \"utils\";\nimport { BlmSubscriptInput } from \"shared\";\nimport BlmStructureSelect from \"components/structures/select\";\nimport { BlmEvaluationFeedback } from \"components/shared\";\nimport { BlmThemes } from \"components/domain\";\nimport { changeKeyMap } from \"./utils\";\nimport \"./chapter-evaluation.scss\";\n\nfunction BlmChapterEvaluationProps(props) {\n  const {\n    element,\n    data,\n    onChange\n  } = props;\n  const state = data.evalutionJSON;\n  const totalQuestions = filterElements(element.children, [ElementType.Question]).length;\n  const {\n    t\n  } = useTranslation(\"properties\");\n  const updateChange = useCallback((newData, forceSave = false) => {\n    if (onChange) {\n      onChange(newData, forceSave);\n    }\n  }, [onChange]);\n  const updateState = useCallback((newState, forceSave = false) => {\n    const newData = { ...data,\n      isEvaluation: newState.evaluation !== EvaluationType.None,\n      hasFeedback: newState.feedback.checked,\n      theme: newState.theme,\n      evalutionJSON: newState,\n      propsJSON: getEvaluationPropsJSON(newState, data.propsJSON)\n    };\n    updateChange(newData, forceSave);\n  }, [data, updateChange]);\n  useEffect(() => {\n    if (state.randomize_questions.value > totalQuestions) {\n      let newState;\n      var newRandomizeQues = state.randomize_questions.value > totalQuestions ? totalQuestions : state.randomize_questions.value;\n      const map = changeKeyMap[\"randomize_questions_value\"];\n      const {\n        obj,\n        key\n      } = map;\n      newState = { ...state,\n        [obj]: { ...state[obj],\n          [key]: newRandomizeQues\n        }\n      };\n\n      if (newState) {\n        updateState(newState, false);\n      }\n    }\n  }, [state, totalQuestions, updateState]);\n\n  const handleChange = event => {\n    const target = event.target;\n    const name = target.name;\n    const value = target.type === \"checkbox\" ? target.checked : target.value;\n    let newState;\n\n    if (changeKeyMap.hasOwnProperty(name)) {\n      const map = changeKeyMap[name];\n      const {\n        obj,\n        key\n      } = map;\n      newState = { ...state,\n        [obj]: { ...state[obj],\n          [key]: value\n        }\n      };\n    } else if (name === \"feedback\") {\n      const {\n        score,\n        feedback\n      } = value;\n      newState = { ...state,\n        success_score: score,\n        feedback\n      };\n    } else if (name === \"randomize_questions_opt\") {\n      newState = { ...state,\n        randomize_questions: { ...state.randomize_questions,\n          value: value === \"all\" ? 0 : 1\n        }\n      };\n    } else {\n      newState = { ...state,\n        [name]: value\n      };\n    }\n\n    if (newState) {\n      updateState(newState, name === \"theme\");\n    }\n  };\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"chapter-evaluation-props-container\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 133,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"evaluation-top-container\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 134,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Select, {\n    name: \"evaluation\",\n    value: state.evaluation,\n    className: \"evaluation-dropdown\",\n    onChange: handleChange,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 135,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(MenuItem, {\n    value: EvaluationType.None,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 141,\n      columnNumber: 11\n    }\n  }, t(\"evaluation.list.none\")), /*#__PURE__*/React.createElement(MenuItem, {\n    value: EvaluationType.Evaluation,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 142,\n      columnNumber: 11\n    }\n  }, t(\"tabs.evaluation\")), data.type !== ElementType.Page && /*#__PURE__*/React.createElement(MenuItem, {\n    value: EvaluationType.Placement,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 144,\n      columnNumber: 13\n    }\n  }, t(\"evaluation.list.placement\"))), state.evaluation === EvaluationType.Evaluation && /*#__PURE__*/React.createElement(Fragment, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 148,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(FormControlLabel, {\n    name: \"related_to\",\n    label: t(\"evaluation.related_to\"),\n    control: /*#__PURE__*/React.createElement(Checkbox, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 152,\n        columnNumber: 24\n      }\n    }),\n    checked: state.related_to.checked,\n    className: \"related-to-lbl\",\n    onChange: handleChange,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 149,\n      columnNumber: 13\n    }\n  }), state.related_to.checked && /*#__PURE__*/React.createElement(BlmStructureSelect, {\n    name: \"related_to_value\",\n    value: state.related_to.value,\n    className: \"related-to-select\",\n    onChange: handleChange,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 158,\n      columnNumber: 15\n    }\n  }))), state.evaluation !== EvaluationType.None && /*#__PURE__*/React.createElement(Fragment, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 169,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(FormControlLabel, {\n    name: \"save_in_lms\",\n    label: t(\"evaluation.save_lms\"),\n    control: /*#__PURE__*/React.createElement(Switch, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 173,\n        columnNumber: 22\n      }\n    }),\n    checked: state.save_in_lms,\n    disabled: state.evaluation !== EvaluationType.Evaluation,\n    className: \"evalutaion-switch-frm-lbl\",\n    onChange: handleChange,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 170,\n      columnNumber: 11\n    }\n  }), (state.evaluation === EvaluationType.Evaluation || state.evaluation === EvaluationType.Placement) && /*#__PURE__*/React.createElement(BlmThemes, {\n    element: element,\n    theme: state.theme,\n    onChange: handleChange,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 181,\n      columnNumber: 13\n    }\n  }), (state.evaluation === EvaluationType.Evaluation || state.evaluation === EvaluationType.Placement) && state.theme && /*#__PURE__*/React.createElement(Fragment, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 186,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"evaluation-fb-quiz-container\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 187,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(BlmEvaluationFeedback, {\n    element: element,\n    score: state.success_score,\n    feedback: state.feedback,\n    onChange: handleChange,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 188,\n      columnNumber: 19\n    }\n  }), state.evaluation === EvaluationType.Evaluation && /*#__PURE__*/React.createElement(\"div\", {\n    className: \"retry-quiz-container\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 195,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(FormControlLabel, {\n    name: \"retry_quiz\",\n    label: t(\"evaluation.retry_quiz\"),\n    control: /*#__PURE__*/React.createElement(Checkbox, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 199,\n        columnNumber: 34\n      }\n    }),\n    checked: state.retry_quiz.checked,\n    className: \"evaluation-retry-quiz-frm-lbl\",\n    onChange: handleChange,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 196,\n      columnNumber: 23\n    }\n  }), state.retry_quiz.checked && /*#__PURE__*/React.createElement(Fragment, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 205,\n      columnNumber: 25\n    }\n  }, /*#__PURE__*/React.createElement(Select, {\n    name: \"retry_quiz_attempts\",\n    value: state.retry_quiz.attempts,\n    className: \"evaluation-retry-quiz-dropdown\",\n    onChange: handleChange,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 206,\n      columnNumber: 27\n    }\n  }, /*#__PURE__*/React.createElement(MenuItem, {\n    value: \"2\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 212,\n      columnNumber: 29\n    }\n  }, t(\"evaluation.list.attempt2\")), /*#__PURE__*/React.createElement(MenuItem, {\n    value: \"3\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 213,\n      columnNumber: 29\n    }\n  }, t(\"evaluation.list.attempt3\")), /*#__PURE__*/React.createElement(MenuItem, {\n    value: \"unlimited\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 214,\n      columnNumber: 29\n    }\n  }, t(\"evaluation.list.unlimited\"))), /*#__PURE__*/React.createElement(FormControlLabel, {\n    name: \"retry_quiz_lock\",\n    label: t(\"evaluation.lock\"),\n    control: /*#__PURE__*/React.createElement(Checkbox, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 219,\n        columnNumber: 38\n      }\n    }),\n    checked: state.retry_quiz.lock_when_success,\n    className: \"evaluation-retry-quiz-lock-frm-lbl\",\n    onChange: handleChange,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 216,\n      columnNumber: 27\n    }\n  })))), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"evaluation-timer-container\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 229,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(FormControlLabel, {\n    name: \"timer\",\n    label: t(\"evaluation.timer\"),\n    control: /*#__PURE__*/React.createElement(Checkbox, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 233,\n        columnNumber: 30\n      }\n    }),\n    checked: state.timer.checked,\n    className: \"evaluation-timer-frm-lbl\",\n    onChange: handleChange,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 230,\n      columnNumber: 19\n    }\n  }), /*#__PURE__*/React.createElement(BlmSubscriptInput, {\n    label: t(\"evaluation.sec\"),\n    name: \"timer_value\",\n    value: state.timer.value,\n    style: {\n      visibility: state.timer.checked ? \"visible\" : \"hidden\"\n    },\n    className: \"evaluation-timer-txt\",\n    onChange: handleChange,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 238,\n      columnNumber: 19\n    }\n  }), /*#__PURE__*/React.createElement(FormControlLabel, {\n    name: \"randomize_questions\",\n    label: t(\"evaluation.randomize_question\"),\n    control: /*#__PURE__*/React.createElement(Checkbox, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 251,\n        columnNumber: 30\n      }\n    }),\n    checked: state.randomize_questions.checked,\n    className: \"evaluation-random-quiz-frm-lbl\",\n    onChange: handleChange,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 248,\n      columnNumber: 19\n    }\n  }), /*#__PURE__*/React.createElement(RadioGroup, {\n    name: \"randomize_questions_opt\",\n    value: state.randomize_questions.value === 0 ? \"all\" : \"other\",\n    style: {\n      visibility: state.randomize_questions.checked ? \"visible\" : \"hidden\"\n    },\n    className: \"randomize-radio-group\",\n    onChange: handleChange,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 256,\n      columnNumber: 19\n    }\n  }, /*#__PURE__*/React.createElement(FormControlLabel, {\n    label: t(\"label.all\"),\n    control: /*#__PURE__*/React.createElement(Radio, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 267,\n        columnNumber: 32\n      }\n    }),\n    value: \"all\",\n    className: \"evaluation-question-validate-option mui-radio-form-ctrl-lbl-1\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 265,\n      columnNumber: 21\n    }\n  }), /*#__PURE__*/React.createElement(FormControlLabel, {\n    label: /*#__PURE__*/React.createElement(BlmSubscriptInput, {\n      name: \"randomize_questions_value\",\n      label: `/${totalQuestions}  ${t(\"evaluation.question\")}`,\n      min: 1,\n      max: totalQuestions,\n      value: state.randomize_questions.value || undefined,\n      disabled: totalQuestions === 0,\n      className: \"evaluation-random-quiz-txt\",\n      onChange: handleChange,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 273,\n        columnNumber: 25\n      }\n    }),\n    control: /*#__PURE__*/React.createElement(Radio, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 284,\n        columnNumber: 32\n      }\n    }),\n    value: \"other\",\n    disabled: totalQuestions === 0,\n    className: \"evaluation-question-validate-option mui-radio-form-ctrl-lbl-1\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 271,\n      columnNumber: 21\n    }\n  }))), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"evaluation-question-container\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 291,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"span\", {\n    className: \"evaluation-proposition-feedback-title\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 292,\n      columnNumber: 19\n    }\n  }, t(\"evaluation.proposition_fb\")), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"evaluation-proposition-feedback-group\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 295,\n      columnNumber: 19\n    }\n  }, /*#__PURE__*/React.createElement(FormControlLabel, {\n    name: \"proposition_feedback_opt1\",\n    label: t(\"evaluation.by_question\"),\n    control: /*#__PURE__*/React.createElement(Checkbox, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 299,\n        columnNumber: 32\n      }\n    }),\n    checked: state.proposition_feedback.by_question,\n    className: \"evaluation-proposition-feedback-option mui-radio-form-ctrl-lbl-1\",\n    onChange: handleChange,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 296,\n      columnNumber: 21\n    }\n  }), /*#__PURE__*/React.createElement(FormControlLabel, {\n    name: \"proposition_feedback_opt2\",\n    label: t(\"evaluation.in_evaluation_fb\"),\n    control: /*#__PURE__*/React.createElement(Checkbox, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 307,\n        columnNumber: 32\n      }\n    }),\n    checked: state.proposition_feedback.global,\n    className: \"evaluation-proposition-feedback-option mui-radio-form-ctrl-lbl-1\",\n    onChange: handleChange,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 304,\n      columnNumber: 21\n    }\n  })), /*#__PURE__*/React.createElement(\"span\", {\n    className: \"evaluation-question-feedback-title\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 313,\n      columnNumber: 19\n    }\n  }, t(\"evaluation.question_fb\")), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"evaluation-question-feedback-group\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 316,\n      columnNumber: 19\n    }\n  }, /*#__PURE__*/React.createElement(FormControlLabel, {\n    name: \"question_feedback_opt1\",\n    label: t(\"evaluation.by_question\"),\n    control: /*#__PURE__*/React.createElement(Checkbox, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 320,\n        columnNumber: 32\n      }\n    }),\n    checked: state.question_feedback.by_question,\n    className: \"evaluation-question-feedback-option mui-radio-form-ctrl-lbl-1\",\n    onChange: handleChange,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 317,\n      columnNumber: 21\n    }\n  }), /*#__PURE__*/React.createElement(FormControlLabel, {\n    name: \"question_feedback_opt2\",\n    label: t(\"evaluation.in_evaluation_fb\"),\n    control: /*#__PURE__*/React.createElement(Checkbox, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 328,\n        columnNumber: 32\n      }\n    }),\n    checked: state.question_feedback.global,\n    className: \"evaluation-question-feedback-option mui-radio-form-ctrl-lbl-1\",\n    onChange: handleChange,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 325,\n      columnNumber: 21\n    }\n  }))), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"evaluation-advanced-container\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 335,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"evaluation-advanced-title\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 336,\n      columnNumber: 19\n    }\n  }, t(\"evaluation.advanced\")), state.evaluation !== EvaluationType.Placement && /*#__PURE__*/React.createElement(FormControlLabel, {\n    name: \"advanced_opt1\",\n    label: t(\"evaluation.show_complete\"),\n    control: /*#__PURE__*/React.createElement(Checkbox, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 341,\n        columnNumber: 32\n      }\n    }),\n    checked: state.advanced.show_as_complete_even_if_no_succeed,\n    className: \"mui-radio-form-ctrl-lbl-1\",\n    onChange: handleChange,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 338,\n      columnNumber: 21\n    }\n  }), /*#__PURE__*/React.createElement(FormControlLabel, {\n    name: \"advanced_opt2\",\n    label: t(\"evaluation.all_sub_eval\"),\n    control: /*#__PURE__*/React.createElement(Checkbox, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 350,\n        columnNumber: 30\n      }\n    }),\n    checked: state.advanced.all_sub_eval_succeed_for_validate,\n    className: \"mui-radio-form-ctrl-lbl-1\",\n    onChange: handleChange,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 347,\n      columnNumber: 19\n    }\n  })))));\n}\n\nexport default BlmChapterEvaluationProps;","map":{"version":3,"sources":["C:/Users/Rajesh/Downloads/bilim (2)/bilim/v1.0/editors/BlmCourseEditor/src/components/properties/controls/chapter-evaluation/BlmChapterEvaluationProps.tsx"],"names":["React","Fragment","useCallback","useEffect","RadioGroup","Radio","Checkbox","FormControlLabel","MenuItem","Select","Switch","useTranslation","ElementType","EvaluationType","filterElements","getEvaluationPropsJSON","BlmSubscriptInput","BlmStructureSelect","BlmEvaluationFeedback","BlmThemes","changeKeyMap","BlmChapterEvaluationProps","props","element","data","onChange","state","evalutionJSON","totalQuestions","children","Question","length","t","updateChange","newData","forceSave","updateState","newState","isEvaluation","evaluation","None","hasFeedback","feedback","checked","theme","propsJSON","randomize_questions","value","newRandomizeQues","map","obj","key","handleChange","event","target","name","type","hasOwnProperty","score","success_score","Evaluation","Page","Placement","related_to","save_in_lms","retry_quiz","attempts","lock_when_success","timer","visibility","undefined","proposition_feedback","by_question","global","question_feedback","advanced","show_as_complete_even_if_no_succeed","all_sub_eval_succeed_for_validate"],"mappings":"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","sourcesContent":["import React, { ChangeEvent, Fragment, useCallback, useEffect } from \"react\";\r\nimport {\r\n  RadioGroup,\r\n  Radio,\r\n  Checkbox,\r\n  FormControlLabel,\r\n  MenuItem,\r\n  Select,\r\n  Switch,\r\n} from \"@material-ui/core\";\r\nimport { useTranslation } from \"react-i18next\";\r\n\r\nimport {\r\n  CourseElementProps,\r\n  ElementPropsComponent,\r\n  ChapterEvaluationProps,\r\n  CourseElement,\r\n  CustomChangeEvent,\r\n} from \"types\";\r\nimport { ElementType, EvaluationType } from \"editor-constants\";\r\nimport { filterElements, getEvaluationPropsJSON } from \"utils\";\r\nimport { BlmSubscriptInput } from \"shared\";\r\nimport BlmStructureSelect from \"components/structures/select\";\r\nimport { BlmEvaluationFeedback, EvaluationFeedbackChangeEvent } from \"components/shared\";\r\nimport { BlmThemes } from \"components/domain\";\r\nimport { changeKeyMap } from \"./utils\";\r\nimport \"./chapter-evaluation.scss\";\r\n\r\ninterface CompProps extends ElementPropsComponent<ChapterEvaluationProps> {\r\n  element: CourseElement;\r\n}\r\n\r\nfunction BlmChapterEvaluationProps(props: CompProps) {\r\n  const { element, data, onChange } = props;\r\n  const state = data.evalutionJSON!;\r\n  const totalQuestions = filterElements(element.children, [ElementType.Question]).length;\r\n  const { t } = useTranslation(\"properties\");\r\n\r\n  const updateChange = useCallback(\r\n    (newData: CourseElementProps<ChapterEvaluationProps>, forceSave = false) => {\r\n      if (onChange) {\r\n        onChange(newData, forceSave);\r\n      }\r\n    },\r\n    [onChange]\r\n  );\r\n\r\n  const updateState = useCallback(\r\n    (newState: ChapterEvaluationProps, forceSave = false) => {\r\n      const newData: CourseElementProps<ChapterEvaluationProps> = {\r\n        ...data,\r\n        isEvaluation: newState.evaluation !== EvaluationType.None,\r\n        hasFeedback: newState.feedback.checked,\r\n        theme: newState.theme,\r\n        evalutionJSON: newState,\r\n        propsJSON: getEvaluationPropsJSON(newState, data.propsJSON),\r\n      };\r\n\r\n      updateChange(newData, forceSave);\r\n    },\r\n    [data, updateChange]\r\n  );\r\n\r\n  useEffect(() => {\r\n    if (state.randomize_questions.value > totalQuestions) {\r\n      let newState: ChapterEvaluationProps | undefined;\r\n      var newRandomizeQues =\r\n        state.randomize_questions.value > totalQuestions\r\n          ? totalQuestions\r\n          : state.randomize_questions.value;\r\n\r\n      const map = changeKeyMap[\"randomize_questions_value\"];\r\n      const { obj, key } = map;\r\n      newState = {\r\n        ...state,\r\n        [obj]: {\r\n          ...state[obj],\r\n          [key]: newRandomizeQues,\r\n        },\r\n      };\r\n\r\n      if (newState) {\r\n        updateState(newState, false);\r\n      }\r\n    }\r\n  }, [state, totalQuestions, updateState]);\r\n\r\n  const handleChange = (\r\n    event: ChangeEvent<any> | EvaluationFeedbackChangeEvent | CustomChangeEvent<number | string>\r\n  ) => {\r\n    const target = event.target;\r\n    const name = target.name;\r\n    const value = target.type === \"checkbox\" ? target.checked : target.value;\r\n    let newState: ChapterEvaluationProps | undefined;\r\n\r\n    if (changeKeyMap.hasOwnProperty(name)) {\r\n      const map = changeKeyMap[name];\r\n      const { obj, key } = map;\r\n\r\n      newState = {\r\n        ...state,\r\n        [obj]: {\r\n          ...state[obj],\r\n          [key]: value,\r\n        },\r\n      };\r\n    } else if (name === \"feedback\") {\r\n      const { score, feedback } = value;\r\n\r\n      newState = {\r\n        ...state,\r\n        success_score: score,\r\n        feedback,\r\n      };\r\n    } else if (name === \"randomize_questions_opt\") {\r\n      newState = {\r\n        ...state,\r\n        randomize_questions: { ...state.randomize_questions, value: value === \"all\" ? 0 : 1 },\r\n      };\r\n    } else {\r\n      newState = {\r\n        ...state,\r\n        [name]: value,\r\n      };\r\n    }\r\n\r\n    if (newState) {\r\n      updateState(newState, name === \"theme\");\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"chapter-evaluation-props-container\">\r\n      <div className=\"evaluation-top-container\">\r\n        <Select\r\n          name=\"evaluation\"\r\n          value={state.evaluation}\r\n          className=\"evaluation-dropdown\"\r\n          onChange={handleChange}\r\n        >\r\n          <MenuItem value={EvaluationType.None}>{t(\"evaluation.list.none\")}</MenuItem>\r\n          <MenuItem value={EvaluationType.Evaluation}>{t(\"tabs.evaluation\")}</MenuItem>\r\n          {data.type !== ElementType.Page && (\r\n            <MenuItem value={EvaluationType.Placement}>{t(\"evaluation.list.placement\")}</MenuItem>\r\n          )}\r\n        </Select>\r\n        {state.evaluation === EvaluationType.Evaluation && (\r\n          <Fragment>\r\n            <FormControlLabel\r\n              name=\"related_to\"\r\n              label={t(\"evaluation.related_to\")}\r\n              control={<Checkbox />}\r\n              checked={state.related_to.checked}\r\n              className=\"related-to-lbl\"\r\n              onChange={handleChange}\r\n            />\r\n            {state.related_to.checked && (\r\n              <BlmStructureSelect\r\n                name=\"related_to_value\"\r\n                value={state.related_to.value}\r\n                className=\"related-to-select\"\r\n                onChange={handleChange}\r\n              />\r\n            )}\r\n          </Fragment>\r\n        )}\r\n      </div>\r\n      {state.evaluation !== EvaluationType.None && (\r\n        <Fragment>\r\n          <FormControlLabel\r\n            name=\"save_in_lms\"\r\n            label={t(\"evaluation.save_lms\")}\r\n            control={<Switch />}\r\n            checked={state.save_in_lms}\r\n            disabled={state.evaluation !== EvaluationType.Evaluation}\r\n            className=\"evalutaion-switch-frm-lbl\"\r\n            onChange={handleChange}\r\n          />\r\n          {(state.evaluation === EvaluationType.Evaluation ||\r\n            state.evaluation === EvaluationType.Placement) && (\r\n            <BlmThemes element={element} theme={state.theme} onChange={handleChange} />\r\n          )}\r\n          {(state.evaluation === EvaluationType.Evaluation ||\r\n            state.evaluation === EvaluationType.Placement) &&\r\n            state.theme && (\r\n              <Fragment>\r\n                <div className=\"evaluation-fb-quiz-container\">\r\n                  <BlmEvaluationFeedback\r\n                    element={element}\r\n                    score={state.success_score}\r\n                    feedback={state.feedback}\r\n                    onChange={handleChange}\r\n                  />\r\n                  {state.evaluation === EvaluationType.Evaluation && (\r\n                    <div className=\"retry-quiz-container\">\r\n                      <FormControlLabel\r\n                        name=\"retry_quiz\"\r\n                        label={t(\"evaluation.retry_quiz\")}\r\n                        control={<Checkbox />}\r\n                        checked={state.retry_quiz.checked}\r\n                        className=\"evaluation-retry-quiz-frm-lbl\"\r\n                        onChange={handleChange}\r\n                      />\r\n                      {state.retry_quiz.checked && (\r\n                        <Fragment>\r\n                          <Select\r\n                            name=\"retry_quiz_attempts\"\r\n                            value={state.retry_quiz.attempts}\r\n                            className=\"evaluation-retry-quiz-dropdown\"\r\n                            onChange={handleChange}\r\n                          >\r\n                            <MenuItem value=\"2\">{t(\"evaluation.list.attempt2\")}</MenuItem>\r\n                            <MenuItem value=\"3\">{t(\"evaluation.list.attempt3\")}</MenuItem>\r\n                            <MenuItem value=\"unlimited\">{t(\"evaluation.list.unlimited\")}</MenuItem>\r\n                          </Select>\r\n                          <FormControlLabel\r\n                            name=\"retry_quiz_lock\"\r\n                            label={t(\"evaluation.lock\")}\r\n                            control={<Checkbox />}\r\n                            checked={state.retry_quiz.lock_when_success}\r\n                            className=\"evaluation-retry-quiz-lock-frm-lbl\"\r\n                            onChange={handleChange}\r\n                          />\r\n                        </Fragment>\r\n                      )}\r\n                    </div>\r\n                  )}\r\n                </div>\r\n                <div className=\"evaluation-timer-container\">\r\n                  <FormControlLabel\r\n                    name=\"timer\"\r\n                    label={t(\"evaluation.timer\")}\r\n                    control={<Checkbox />}\r\n                    checked={state.timer.checked}\r\n                    className=\"evaluation-timer-frm-lbl\"\r\n                    onChange={handleChange}\r\n                  />\r\n                  <BlmSubscriptInput\r\n                    label={t(\"evaluation.sec\")}\r\n                    name=\"timer_value\"\r\n                    value={state.timer.value}\r\n                    style={{\r\n                      visibility: state.timer.checked ? \"visible\" : \"hidden\",\r\n                    }}\r\n                    className=\"evaluation-timer-txt\"\r\n                    onChange={handleChange}\r\n                  />\r\n                  <FormControlLabel\r\n                    name=\"randomize_questions\"\r\n                    label={t(\"evaluation.randomize_question\")}\r\n                    control={<Checkbox />}\r\n                    checked={state.randomize_questions.checked}\r\n                    className=\"evaluation-random-quiz-frm-lbl\"\r\n                    onChange={handleChange}\r\n                  />\r\n                  <RadioGroup\r\n                    name=\"randomize_questions_opt\"\r\n                    value={state.randomize_questions.value === 0 ? \"all\" : \"other\"}\r\n                    style={{\r\n                      visibility: state.randomize_questions.checked ? \"visible\" : \"hidden\",\r\n                    }}\r\n                    className=\"randomize-radio-group\"\r\n                    onChange={handleChange}\r\n                  >\r\n                    <FormControlLabel\r\n                      label={t(\"label.all\")}\r\n                      control={<Radio />}\r\n                      value=\"all\"\r\n                      className=\"evaluation-question-validate-option mui-radio-form-ctrl-lbl-1\"\r\n                    />\r\n                    <FormControlLabel\r\n                      label={\r\n                        <BlmSubscriptInput\r\n                          name=\"randomize_questions_value\"\r\n                          label={`/${totalQuestions}  ${t(\"evaluation.question\")}`}\r\n                          min={1}\r\n                          max={totalQuestions}\r\n                          value={state.randomize_questions.value || undefined}\r\n                          disabled={totalQuestions === 0}\r\n                          className=\"evaluation-random-quiz-txt\"\r\n                          onChange={handleChange}\r\n                        />\r\n                      }\r\n                      control={<Radio />}\r\n                      value=\"other\"\r\n                      disabled={totalQuestions === 0}\r\n                      className=\"evaluation-question-validate-option mui-radio-form-ctrl-lbl-1\"\r\n                    />\r\n                  </RadioGroup>\r\n                </div>\r\n                <div className=\"evaluation-question-container\">\r\n                  <span className=\"evaluation-proposition-feedback-title\">\r\n                    {t(\"evaluation.proposition_fb\")}\r\n                  </span>\r\n                  <div className=\"evaluation-proposition-feedback-group\">\r\n                    <FormControlLabel\r\n                      name=\"proposition_feedback_opt1\"\r\n                      label={t(\"evaluation.by_question\")}\r\n                      control={<Checkbox />}\r\n                      checked={state.proposition_feedback.by_question}\r\n                      className=\"evaluation-proposition-feedback-option mui-radio-form-ctrl-lbl-1\"\r\n                      onChange={handleChange}\r\n                    />\r\n                    <FormControlLabel\r\n                      name=\"proposition_feedback_opt2\"\r\n                      label={t(\"evaluation.in_evaluation_fb\")}\r\n                      control={<Checkbox />}\r\n                      checked={state.proposition_feedback.global}\r\n                      className=\"evaluation-proposition-feedback-option mui-radio-form-ctrl-lbl-1\"\r\n                      onChange={handleChange}\r\n                    />\r\n                  </div>\r\n                  <span className=\"evaluation-question-feedback-title\">\r\n                    {t(\"evaluation.question_fb\")}\r\n                  </span>\r\n                  <div className=\"evaluation-question-feedback-group\">\r\n                    <FormControlLabel\r\n                      name=\"question_feedback_opt1\"\r\n                      label={t(\"evaluation.by_question\")}\r\n                      control={<Checkbox />}\r\n                      checked={state.question_feedback.by_question}\r\n                      className=\"evaluation-question-feedback-option mui-radio-form-ctrl-lbl-1\"\r\n                      onChange={handleChange}\r\n                    />\r\n                    <FormControlLabel\r\n                      name=\"question_feedback_opt2\"\r\n                      label={t(\"evaluation.in_evaluation_fb\")}\r\n                      control={<Checkbox />}\r\n                      checked={state.question_feedback.global}\r\n                      className=\"evaluation-question-feedback-option mui-radio-form-ctrl-lbl-1\"\r\n                      onChange={handleChange}\r\n                    />\r\n                  </div>\r\n                </div>\r\n                <div className=\"evaluation-advanced-container\">\r\n                  <div className=\"evaluation-advanced-title\">{t(\"evaluation.advanced\")}</div>\r\n                  {state.evaluation !== EvaluationType.Placement && (\r\n                    <FormControlLabel\r\n                      name=\"advanced_opt1\"\r\n                      label={t(\"evaluation.show_complete\")}\r\n                      control={<Checkbox />}\r\n                      checked={state.advanced.show_as_complete_even_if_no_succeed}\r\n                      className=\"mui-radio-form-ctrl-lbl-1\"\r\n                      onChange={handleChange}\r\n                    />\r\n                  )}\r\n                  <FormControlLabel\r\n                    name=\"advanced_opt2\"\r\n                    label={t(\"evaluation.all_sub_eval\")}\r\n                    control={<Checkbox />}\r\n                    checked={state.advanced.all_sub_eval_succeed_for_validate}\r\n                    className=\"mui-radio-form-ctrl-lbl-1\"\r\n                    onChange={handleChange}\r\n                  />\r\n                </div>\r\n              </Fragment>\r\n            )}\r\n        </Fragment>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\nexport default BlmChapterEvaluationProps;\r\n"]},"metadata":{},"sourceType":"module"}