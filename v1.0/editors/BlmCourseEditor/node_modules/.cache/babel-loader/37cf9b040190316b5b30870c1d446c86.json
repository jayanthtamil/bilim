{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Rajesh\\\\Downloads\\\\bilim (2)\\\\bilim\\\\v1.0\\\\editors\\\\BlmCourseEditor\\\\src\\\\components\\\\templates\\\\core\\\\template\\\\BlmTemplate.tsx\";\nimport React, { forwardRef, memo, useEffect, useMemo, useRef, useState } from \"react\";\nimport { ElementType } from \"editor-constants\";\nimport { addClassToString, updateInnerHTML, createReactAttribs, removeElementInString, createHTMLElement, toNumber } from \"utils\";\nimport { BlmHTMLParser } from \"shared\";\nimport { BlmText, BlmMedia, BlmHTMLMedia, BlmButton } from \"../../components\";\nimport { validateAllowDelete } from \"./utilts\";\nconst BlmTemplate = forwardRef((props, ref) => {\n  const {\n    data,\n    onTemplateEdit,\n    ...others\n  } = props;\n  const {\n    templateType,\n    html\n  } = data;\n  const editRef = useRef({\n    status: false,\n    html,\n    timeoutId: undefined\n  });\n  const [content, setContent] = useState(html);\n  const [hoverMedia, setHoverMedia] = useState(false);\n  const mediaIds = useMemo(() => {\n    const doc = createHTMLElement(html);\n\n    if (doc) {\n      return Array.from(doc.querySelectorAll(`[blm-component=\"media\"]`)).map(media => media.getAttribute(\"blm-id\") || \"\").sort((id1, id2) => toNumber(id1) - toNumber(id2));\n    }\n  }, [html]);\n  useEffect(() => {\n    editRef.current = {\n      status: false,\n      html,\n      timeoutId: undefined\n    };\n    setContent(html);\n  }, [html]);\n\n  const updateEdit = () => {\n    const {\n      status,\n      html: editedHtml\n    } = editRef.current;\n\n    if (status) {\n      const newData = { ...data\n      };\n      newData.html = editedHtml;\n      editRef.current.status = false;\n      setContent(editedHtml);\n\n      if (onTemplateEdit) {\n        onTemplateEdit(newData);\n      }\n    }\n  };\n\n  const handleChange = event => {\n    const {\n      name,\n      value\n    } = event.target;\n    const updatedHtml = updateInnerHTML(editRef.current.html, name, value);\n    editRef.current = {\n      status: true,\n      html: updatedHtml\n    };\n  };\n\n  const handleComponentDelete = selector => {\n    const updatedHtml = addClassToString(editRef.current.html, [\"deactivated\"], selector);\n    editRef.current = {\n      status: true,\n      html: updatedHtml\n    };\n    updateEdit();\n  };\n\n  const handleRepeaterDelete = selector => {\n    const updatedHtml = removeElementInString(editRef.current.html, selector);\n    editRef.current = {\n      status: true,\n      html: updatedHtml\n    };\n    updateEdit();\n  }; // If a child receives focus, do not close the popover.\n\n\n  const handleFocus = () => {\n    clearTimeout(editRef.current.timeoutId);\n  }; // We save the template on the next tick by using setTimeout.\n  // This is necessary because we need to first check if\n  // another child of the element has received focus as\n  // the blur event fires prior to the new focus event.\n\n\n  const handleBlur = event => {\n    editRef.current.timeoutId = setTimeout(updateEdit);\n  };\n\n  const handleMediaEnter = () => {\n    setHoverMedia(true);\n  };\n\n  const handleMediaLeave = () => {\n    setHoverMedia(false);\n  };\n\n  const processingInstructions = [{\n    shouldProcessNode: function (node) {\n      if (node.attribs && node.attribs[\"blm-id\"] && node.attribs[\"blm-component\"] === \"text\") return templateType === ElementType.Question ? node.attribs[\"blm-editable\"] !== undefined : true;else return false;\n    },\n    processNode: function (node, children) {\n      const {\n        attribs\n      } = node;\n      return /*#__PURE__*/React.createElement(BlmText, Object.assign({\n        template: templateType,\n        onChange: handleChange,\n        onDelete: handleComponentDelete\n      }, createReactAttribs(attribs), {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 125,\n          columnNumber: 11\n        }\n      }), children);\n    }\n  }, {\n    shouldProcessNode: function (node) {\n      if (node.attribs && node.attribs[\"blm-id\"] && node.attribs[\"blm-component\"] === \"media\") return true;else return false;\n    },\n    processNode: function (node, children) {\n      const {\n        attribs,\n        parent\n      } = node;\n      const ind = (mediaIds === null || mediaIds === void 0 ? void 0 : mediaIds.indexOf(attribs[\"blm-id\"])) || 0;\n      const isRepeater = parent.attribs[\"blm-component\"] === \"repeater\";\n      const allowDelete = !isRepeater || validateAllowDelete(parent);\n      return /*#__PURE__*/React.createElement(BlmMedia, Object.assign({\n        allowDelete: allowDelete,\n        order: ind + 1,\n        hover: hoverMedia,\n        onDelete: isRepeater ? handleRepeaterDelete : handleComponentDelete,\n        onMouseEnter: handleMediaEnter,\n        onMouseLeave: handleMediaLeave\n      }, createReactAttribs(attribs), {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 149,\n          columnNumber: 11\n        }\n      }), children);\n    }\n  }, {\n    shouldProcessNode: function (node) {\n      if (node.attribs && node.attribs[\"blm-id\"] && node.attribs[\"blm-component\"] === \"button\") return true;else return false;\n    },\n    processNode: function (node, children) {\n      const {\n        attribs\n      } = node;\n      return /*#__PURE__*/React.createElement(BlmButton, Object.assign({}, createReactAttribs(attribs), {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 172,\n          columnNumber: 16\n        }\n      }), children);\n    }\n  }, {\n    shouldProcessNode: function (node) {\n      return node.name === \"video\" || node.name === \"audio\";\n    },\n    processNode: function (node, children) {\n      const {\n        name,\n        attribs\n      } = node;\n      return /*#__PURE__*/React.createElement(BlmHTMLMedia, Object.assign({\n        type: name\n      }, createReactAttribs(attribs), {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 183,\n          columnNumber: 11\n        }\n      }), children);\n    }\n  }];\n  return /*#__PURE__*/React.createElement(\"div\", Object.assign({\n    ref: ref,\n    onFocus: handleFocus,\n    onBlur: handleBlur\n  }, others, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 192,\n      columnNumber: 5\n    }\n  }), /*#__PURE__*/React.createElement(BlmHTMLParser, {\n    html: content,\n    processingInstructions: processingInstructions,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 193,\n      columnNumber: 7\n    }\n  }));\n});\nexport default memo(BlmTemplate);","map":{"version":3,"sources":["C:/Users/Rajesh/Downloads/bilim (2)/bilim/v1.0/editors/BlmCourseEditor/src/components/templates/core/template/BlmTemplate.tsx"],"names":["React","forwardRef","memo","useEffect","useMemo","useRef","useState","ElementType","addClassToString","updateInnerHTML","createReactAttribs","removeElementInString","createHTMLElement","toNumber","BlmHTMLParser","BlmText","BlmMedia","BlmHTMLMedia","BlmButton","validateAllowDelete","BlmTemplate","props","ref","data","onTemplateEdit","others","templateType","html","editRef","status","timeoutId","undefined","content","setContent","hoverMedia","setHoverMedia","mediaIds","doc","Array","from","querySelectorAll","map","media","getAttribute","sort","id1","id2","current","updateEdit","editedHtml","newData","handleChange","event","name","value","target","updatedHtml","handleComponentDelete","selector","handleRepeaterDelete","handleFocus","clearTimeout","handleBlur","setTimeout","handleMediaEnter","handleMediaLeave","processingInstructions","shouldProcessNode","node","attribs","Question","processNode","children","parent","ind","indexOf","isRepeater","allowDelete"],"mappings":"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","sourcesContent":["import React, { FocusEvent, forwardRef, memo, useEffect, useMemo, useRef, useState } from \"react\";\r\nimport { TProcessingInstruction } from \"html-to-react\";\r\n\r\nimport { ElementType } from \"editor-constants\";\r\nimport {\r\n  addClassToString,\r\n  updateInnerHTML,\r\n  createReactAttribs,\r\n  removeElementInString,\r\n  createHTMLElement,\r\n  toNumber,\r\n} from \"utils\";\r\nimport { BlmHTMLParser } from \"shared\";\r\nimport { TextEditorChangeEvent } from \"components/component-editor\";\r\nimport { BlmText, BlmMedia, BlmHTMLMedia, BlmButton } from \"../../components\";\r\nimport { validateAllowDelete } from \"./utilts\";\r\nimport { TemplateCompProps } from \"./types\";\r\n\r\ninterface EditState {\r\n  status: boolean;\r\n  html: string;\r\n  timeoutId?: number;\r\n}\r\n\r\nconst BlmTemplate = forwardRef<HTMLDivElement, TemplateCompProps>((props, ref) => {\r\n  const { data, onTemplateEdit, ...others } = props;\r\n  const { templateType, html } = data;\r\n  const editRef = useRef<EditState>({\r\n    status: false,\r\n    html,\r\n    timeoutId: undefined,\r\n  });\r\n  const [content, setContent] = useState(html);\r\n  const [hoverMedia, setHoverMedia] = useState(false);\r\n\r\n  const mediaIds = useMemo(() => {\r\n    const doc = createHTMLElement(html);\r\n\r\n    if (doc) {\r\n      return Array.from(doc.querySelectorAll(`[blm-component=\"media\"]`))\r\n        .map((media) => media.getAttribute(\"blm-id\") || \"\")\r\n        .sort((id1, id2) => toNumber(id1) - toNumber(id2));\r\n    }\r\n  }, [html]);\r\n\r\n  useEffect(() => {\r\n    editRef.current = { status: false, html, timeoutId: undefined };\r\n    setContent(html);\r\n  }, [html]);\r\n\r\n  const updateEdit = () => {\r\n    const { status, html: editedHtml } = editRef.current;\r\n\r\n    if (status) {\r\n      const newData = { ...data };\r\n\r\n      newData.html = editedHtml;\r\n      editRef.current.status = false;\r\n\r\n      setContent(editedHtml);\r\n\r\n      if (onTemplateEdit) {\r\n        onTemplateEdit(newData);\r\n      }\r\n    }\r\n  };\r\n\r\n  const handleChange = (event: TextEditorChangeEvent) => {\r\n    const { name, value } = event.target;\r\n    const updatedHtml = updateInnerHTML(editRef.current.html, name, value);\r\n\r\n    editRef.current = { status: true, html: updatedHtml };\r\n  };\r\n\r\n  const handleComponentDelete = (selector: string) => {\r\n    const updatedHtml = addClassToString(editRef.current.html, [\"deactivated\"], selector);\r\n\r\n    editRef.current = { status: true, html: updatedHtml };\r\n\r\n    updateEdit();\r\n  };\r\n\r\n  const handleRepeaterDelete = (selector: string) => {\r\n    const updatedHtml = removeElementInString(editRef.current.html, selector);\r\n\r\n    editRef.current = { status: true, html: updatedHtml };\r\n\r\n    updateEdit();\r\n  };\r\n\r\n  // If a child receives focus, do not close the popover.\r\n  const handleFocus = () => {\r\n    clearTimeout(editRef.current.timeoutId);\r\n  };\r\n\r\n  // We save the template on the next tick by using setTimeout.\r\n  // This is necessary because we need to first check if\r\n  // another child of the element has received focus as\r\n  // the blur event fires prior to the new focus event.\r\n  const handleBlur = (event: FocusEvent) => {\r\n    editRef.current.timeoutId = setTimeout(updateEdit);\r\n  };\r\n\r\n  const handleMediaEnter = () => {\r\n    setHoverMedia(true);\r\n  };\r\n\r\n  const handleMediaLeave = () => {\r\n    setHoverMedia(false);\r\n  };\r\n\r\n  const processingInstructions: TProcessingInstruction[] = [\r\n    {\r\n      shouldProcessNode: function (node) {\r\n        if (node.attribs && node.attribs[\"blm-id\"] && node.attribs[\"blm-component\"] === \"text\")\r\n          return templateType === ElementType.Question\r\n            ? node.attribs[\"blm-editable\"] !== undefined\r\n            : true;\r\n        else return false;\r\n      },\r\n      processNode: function (node, children) {\r\n        const { attribs } = node;\r\n\r\n        return (\r\n          <BlmText\r\n            template={templateType}\r\n            onChange={handleChange}\r\n            onDelete={handleComponentDelete}\r\n            {...(createReactAttribs(attribs) as any)}\r\n          >\r\n            {children}\r\n          </BlmText>\r\n        );\r\n      },\r\n    },\r\n    {\r\n      shouldProcessNode: function (node) {\r\n        if (node.attribs && node.attribs[\"blm-id\"] && node.attribs[\"blm-component\"] === \"media\")\r\n          return true;\r\n        else return false;\r\n      },\r\n      processNode: function (node, children) {\r\n        const { attribs, parent } = node;\r\n        const ind = mediaIds?.indexOf(attribs[\"blm-id\"]) || 0;\r\n        const isRepeater = parent.attribs[\"blm-component\"] === \"repeater\";\r\n        const allowDelete = !isRepeater || validateAllowDelete(parent);\r\n\r\n        return (\r\n          <BlmMedia\r\n            allowDelete={allowDelete}\r\n            order={ind + 1}\r\n            hover={hoverMedia}\r\n            onDelete={isRepeater ? handleRepeaterDelete : handleComponentDelete}\r\n            onMouseEnter={handleMediaEnter}\r\n            onMouseLeave={handleMediaLeave}\r\n            {...(createReactAttribs(attribs) as any)}\r\n          >\r\n            {children}\r\n          </BlmMedia>\r\n        );\r\n      },\r\n    },\r\n    {\r\n      shouldProcessNode: function (node) {\r\n        if (node.attribs && node.attribs[\"blm-id\"] && node.attribs[\"blm-component\"] === \"button\")\r\n          return true;\r\n        else return false;\r\n      },\r\n      processNode: function (node, children) {\r\n        const { attribs } = node;\r\n\r\n        return <BlmButton {...(createReactAttribs(attribs) as any)}>{children}</BlmButton>;\r\n      },\r\n    },\r\n    {\r\n      shouldProcessNode: function (node) {\r\n        return node.name === \"video\" || node.name === \"audio\";\r\n      },\r\n      processNode: function (node, children) {\r\n        const { name, attribs } = node;\r\n\r\n        return (\r\n          <BlmHTMLMedia type={name} {...(createReactAttribs(attribs) as any)}>\r\n            {children}\r\n          </BlmHTMLMedia>\r\n        );\r\n      },\r\n    },\r\n  ];\r\n\r\n  return (\r\n    <div ref={ref} onFocus={handleFocus} onBlur={handleBlur} {...others}>\r\n      <BlmHTMLParser html={content} processingInstructions={processingInstructions} />\r\n    </div>\r\n  );\r\n});\r\n\r\nexport default memo(BlmTemplate);\r\n"]},"metadata":{},"sourceType":"module"}