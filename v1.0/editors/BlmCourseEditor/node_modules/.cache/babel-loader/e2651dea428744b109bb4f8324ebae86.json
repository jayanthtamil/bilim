{"ast":null,"code":"import { ElementType } from \"editor-constants\";\nimport { filterFalsy, getRepeaterComponents, isDocumentAction, isMediaButton, isMediaCustom, isMediaHotspot, isMediaHotspot360, isMediaImage, isMediaSlideshow, isMediaStandardVideo, isMediaSynchroVideo, isPopoverAction, isQuestionCustom, isQuestionPropositions, isReplaceBackgroundAction, isVideo, isMediaFlipCard } from \"utils\";\nimport { getContentTemplateModel, getPartPageBackgroundModel, getQuestionTemplateModel, getScreenBackgroundModel, getTemplateActionModel } from \"../model\";\nexport function getAllMedias(template) {\n  const result = [];\n\n  if (template.templateType === ElementType.Screen || template.templateType === ElementType.Question || template.templateType === ElementType.SimpleContent) {\n    const background = getScreenBackgroundModel(template);\n\n    if (background) {\n      result.push(...getScreenBackgroundMedias(background));\n    }\n  } else {\n    const background = getPartPageBackgroundModel(template);\n\n    if (background) {\n      result.push(...getPartPageBackgroundMedias(background));\n    }\n  }\n\n  if (template.templateType === ElementType.Question) {\n    const question = getQuestionTemplateModel(template);\n    result.push(...getQuestionMedias(question));\n  } else {\n    const content = getContentTemplateModel(template);\n    result.push(...getContentMedias(content));\n  }\n\n  const action = getTemplateActionModel(template, {\n    dashboardType: \"standard\",\n    load: {\n      simpleContent: true,\n      background: true,\n      sound: true,\n      backgroundSound: true\n    },\n    complete: {\n      simpleContent: true,\n      background: true,\n      sound: true\n    }\n  });\n  result.push(...getTemplateActionMedias(action));\n  return filterFalsy(result);\n}\nexport function getPartPageBackgroundMedias(background) {\n  const {\n    media\n  } = background;\n  const result = [];\n  result.push(...getBackgroundMedias(media));\n  return filterFalsy(result);\n}\nexport function getScreenBackgroundMedias(background) {\n  const {\n    media\n  } = background;\n  const result = [];\n  result.push(...getBackgroundMedias(media));\n  return filterFalsy(result);\n}\n\nfunction getBackgroundMedias(background) {\n  const result = [];\n\n  if (background) {\n    if (background.main && isVideo(background.main.type)) {\n      result.push(background.main, background.webm, background.image);\n    } else {\n      result.push(background.main);\n    }\n  }\n\n  return filterFalsy(result);\n}\n\nexport function getContentMedias(content) {\n  const {\n    medias,\n    buttons,\n    sounds,\n    repeater\n  } = content;\n  const arr1 = [...medias, ...getRepeaterComponents(repeater === null || repeater === void 0 ? void 0 : repeater.medias)];\n  const arr2 = [...buttons, ...getRepeaterComponents(repeater === null || repeater === void 0 ? void 0 : repeater.buttons)];\n  const arr3 = [...sounds, ...getRepeaterComponents(repeater === null || repeater === void 0 ? void 0 : repeater.sounds)];\n  const result = [];\n  arr1.forEach(media => {\n    if (isMediaImage(media) && media.value.media) {\n      result.push(media.value.media);\n    } else if (isMediaFlipCard(media) && media.value) {\n      result.push(media.value.recto.media);\n    } else if (isMediaSlideshow(media)) {\n      media.value.items.forEach(item => {\n        result.push(item.media);\n      });\n    } else if (isMediaButton(media)) {\n      const button = media.value;\n      result.push(button.click, button.over, button.out, button.icon);\n      result.push(...getActionMedias(button.clickAction));\n      result.push(...getActionMedias(button.overAction));\n    } else if (isMediaCustom(media)) {\n      result.push(media.value.media);\n    } else if (isMediaStandardVideo(media)) {\n      var _standard$main, _standard$main2;\n\n      const standard = media.value;\n      result.push(standard.main, standard.webm, standard.image, (_standard$main = standard.main) === null || _standard$main === void 0 ? void 0 : _standard$main.subtitle, (_standard$main2 = standard.main) === null || _standard$main2 === void 0 ? void 0 : _standard$main2.marker);\n    } else if (isMediaSynchroVideo(media)) {\n      const synchro = media.value;\n      result.push(synchro.main, synchro.webm);\n    } else if (isMediaHotspot(media)) {\n      const hotspot = media.value;\n      result.push(hotspot.media);\n      hotspot.items.forEach(item => {\n        result.push(...getActionMedias(item.clickAction));\n        result.push(...getActionMedias(item.overAction));\n      });\n    } else if (isMediaHotspot360(media)) {\n      media.value.items.forEach(item => {\n        result.push(item.media);\n        item.items.forEach(item2 => {\n          result.push(...getActionMedias(item2.clickAction));\n          result.push(...getActionMedias(item2.overAction));\n        });\n      });\n    }\n  });\n  arr2.forEach(button => {\n    const btn = button.value;\n    result.push(btn.background, btn.inline);\n    result.push(...getActionMedias(btn.clickAction));\n    result.push(...getActionMedias(btn.overAction));\n  });\n  arr3.forEach(sound => {\n    var _snd$media, _snd$media2;\n\n    const snd = sound.value;\n    result.push(snd.media, snd.image, (_snd$media = snd.media) === null || _snd$media === void 0 ? void 0 : _snd$media.subtitle, (_snd$media2 = snd.media) === null || _snd$media2 === void 0 ? void 0 : _snd$media2.marker);\n  });\n  return filterFalsy(result);\n}\n\nfunction getActionMedias(action) {\n  const result = [];\n\n  if (action) {\n    if (isDocumentAction(action)) {\n      var _action$value;\n\n      result.push((_action$value = action.value) === null || _action$value === void 0 ? void 0 : _action$value.document);\n    } else if (isReplaceBackgroundAction(action)) {\n      var _action$value2;\n\n      result.push((_action$value2 = action.value) === null || _action$value2 === void 0 ? void 0 : _action$value2.background);\n    } else if (isPopoverAction(action)) {\n      var _action$value3;\n\n      result.push((_action$value3 = action.value) === null || _action$value3 === void 0 ? void 0 : _action$value3.media);\n    }\n  }\n\n  return filterFalsy(result);\n}\n\nexport function getQuestionMedias(question) {\n  var _mMedia$value;\n\n  const {\n    introduction: {\n      media: {\n        media,\n        sound\n      }\n    },\n    main: {\n      media: mMedia,\n      sound: mSound,\n      content: mContent\n    },\n    feedback: {\n      global: {\n        right: {\n          media: rMedia,\n          sound: rSound\n        },\n        wrong: {\n          media: wMedia,\n          sound: wSound\n        }\n      }\n    }\n  } = question;\n  const result = [];\n  result.push(media.value, sound.value);\n  result.push((_mMedia$value = mMedia.value) === null || _mMedia$value === void 0 ? void 0 : _mMedia$value.media, mSound.value);\n  result.push(rMedia.value, rSound.value, wMedia.value, wSound.value);\n\n  if (isQuestionPropositions(mContent)) {\n    var _mContent$value;\n\n    (_mContent$value = mContent.value) === null || _mContent$value === void 0 ? void 0 : _mContent$value.items.map(proposition => {\n      const {\n        media,\n        sound,\n        feedback: {\n          media: fbMedia,\n          sound: fbSound\n        }\n      } = proposition;\n      result.push(media.value, sound.value, fbMedia.value, fbSound.value);\n    });\n  } else if (isQuestionCustom(mContent)) {\n    result.push(mContent.value);\n  }\n\n  return filterFalsy(result);\n}\nexport function getTemplateActionMedias(action) {\n  const result = [];\n\n  if (action) {\n    var _action$load$sound$so, _action$load$sound$so2, _action$complete$soun, _action$complete$soun2;\n\n    result.push(...getBackgroundMedias(action.load.background.background), action.load.sound.sound, (_action$load$sound$so = action.load.sound.sound) === null || _action$load$sound$so === void 0 ? void 0 : _action$load$sound$so.subtitle, (_action$load$sound$so2 = action.load.sound.sound) === null || _action$load$sound$so2 === void 0 ? void 0 : _action$load$sound$so2.marker, ...getBackgroundMedias(action.complete.background.background), action.complete.sound.sound, (_action$complete$soun = action.complete.sound.sound) === null || _action$complete$soun === void 0 ? void 0 : _action$complete$soun.subtitle, (_action$complete$soun2 = action.complete.sound.sound) === null || _action$complete$soun2 === void 0 ? void 0 : _action$complete$soun2.marker);\n  }\n\n  return filterFalsy(result);\n}\nexport function getPropertiesMedias(properties) {\n  const result = [];\n\n  if (properties.mediaJSON) {\n    result.push(properties.mediaJSON.default, properties.mediaJSON.over, properties.mediaJSON.overSound);\n  }\n\n  if (properties.navigationJSON) {\n    result.push(...Object.values(properties.navigationJSON));\n  }\n\n  if (properties.backgroundJSON) {\n    result.push(...getBackgroundMedias(properties.backgroundJSON.media));\n  }\n\n  return filterFalsy(result);\n}","map":{"version":3,"sources":["C:/Users/Rajesh/Downloads/bilim (2)/bilim/v1.0/editors/BlmCourseEditor/src/template-builders/core/media.ts"],"names":["ElementType","filterFalsy","getRepeaterComponents","isDocumentAction","isMediaButton","isMediaCustom","isMediaHotspot","isMediaHotspot360","isMediaImage","isMediaSlideshow","isMediaStandardVideo","isMediaSynchroVideo","isPopoverAction","isQuestionCustom","isQuestionPropositions","isReplaceBackgroundAction","isVideo","isMediaFlipCard","getContentTemplateModel","getPartPageBackgroundModel","getQuestionTemplateModel","getScreenBackgroundModel","getTemplateActionModel","getAllMedias","template","result","templateType","Screen","Question","SimpleContent","background","push","getScreenBackgroundMedias","getPartPageBackgroundMedias","question","getQuestionMedias","content","getContentMedias","action","dashboardType","load","simpleContent","sound","backgroundSound","complete","getTemplateActionMedias","media","getBackgroundMedias","main","type","webm","image","medias","buttons","sounds","repeater","arr1","arr2","arr3","forEach","value","recto","items","item","button","click","over","out","icon","getActionMedias","clickAction","overAction","standard","subtitle","marker","synchro","hotspot","item2","btn","inline","snd","document","introduction","mMedia","mSound","mContent","feedback","global","right","rMedia","rSound","wrong","wMedia","wSound","map","proposition","fbMedia","fbSound","getPropertiesMedias","properties","mediaJSON","default","overSound","navigationJSON","Object","values","backgroundJSON"],"mappings":"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","sourcesContent":["import {\r\n  BackgroundMedia,\r\n  ButtonComponent,\r\n  ComponentAction,\r\n  ContentTemplate,\r\n  ContentTemplateAction,\r\n  CourseElementProps,\r\n  CourseElementTemplate,\r\n  MediaComponent,\r\n  MediaFile,\r\n  PartPageBackground,\r\n  QuestionTemplate,\r\n  ScreenBackground,\r\n  SoundComponent,\r\n} from \"types\";\r\nimport { ElementType } from \"editor-constants\";\r\nimport {\r\n  filterFalsy,\r\n  getRepeaterComponents,\r\n  isDocumentAction,\r\n  isMediaButton,\r\n  isMediaCustom,\r\n  isMediaHotspot,\r\n  isMediaHotspot360,\r\n  isMediaImage,\r\n  isMediaSlideshow,\r\n  isMediaStandardVideo,\r\n  isMediaSynchroVideo,\r\n  isPopoverAction,\r\n  isQuestionCustom,\r\n  isQuestionPropositions,\r\n  isReplaceBackgroundAction,\r\n  isVideo,\r\n  isMediaFlipCard,\r\n} from \"utils\";\r\nimport {\r\n  getContentTemplateModel,\r\n  getPartPageBackgroundModel,\r\n  getQuestionTemplateModel,\r\n  getScreenBackgroundModel,\r\n  getTemplateActionModel,\r\n} from \"../model\";\r\n\r\nexport function getAllMedias(template: CourseElementTemplate) {\r\n  const result: MediaFile[] = [];\r\n\r\n  if (\r\n    template.templateType === ElementType.Screen ||\r\n    template.templateType === ElementType.Question ||\r\n    template.templateType === ElementType.SimpleContent\r\n  ) {\r\n    const background = getScreenBackgroundModel(template);\r\n\r\n    if (background) {\r\n      result.push(...getScreenBackgroundMedias(background));\r\n    }\r\n  } else {\r\n    const background = getPartPageBackgroundModel(template);\r\n\r\n    if (background) {\r\n      result.push(...getPartPageBackgroundMedias(background));\r\n    }\r\n  }\r\n\r\n  if (template.templateType === ElementType.Question) {\r\n    const question = getQuestionTemplateModel(template);\r\n\r\n    result.push(...getQuestionMedias(question));\r\n  } else {\r\n    const content = getContentTemplateModel(template);\r\n\r\n    result.push(...getContentMedias(content));\r\n  }\r\n\r\n  const action = getTemplateActionModel(template, {\r\n    dashboardType: \"standard\",\r\n    load: { simpleContent: true, background: true, sound: true, backgroundSound: true },\r\n    complete: { simpleContent: true, background: true, sound: true },\r\n  });\r\n\r\n  result.push(...getTemplateActionMedias(action));\r\n\r\n  return filterFalsy(result);\r\n}\r\n\r\nexport function getPartPageBackgroundMedias(background: PartPageBackground) {\r\n  const { media } = background;\r\n  const result: (MediaFile | undefined)[] = [];\r\n\r\n  result.push(...getBackgroundMedias(media));\r\n\r\n  return filterFalsy(result);\r\n}\r\n\r\nexport function getScreenBackgroundMedias(background: ScreenBackground) {\r\n  const { media } = background;\r\n  const result: (MediaFile | undefined)[] = [];\r\n\r\n  result.push(...getBackgroundMedias(media));\r\n\r\n  return filterFalsy(result);\r\n}\r\n\r\nfunction getBackgroundMedias(background?: BackgroundMedia) {\r\n  const result = [];\r\n\r\n  if (background) {\r\n    if (background.main && isVideo(background.main.type)) {\r\n      result.push(background.main, background.webm, background.image);\r\n    } else {\r\n      result.push(background.main);\r\n    }\r\n  }\r\n\r\n  return filterFalsy(result);\r\n}\r\n\r\nexport function getContentMedias(content: ContentTemplate) {\r\n  const { medias, buttons, sounds, repeater } = content;\r\n  const arr1: MediaComponent[] = [...medias, ...getRepeaterComponents(repeater?.medias)];\r\n  const arr2: ButtonComponent[] = [...buttons, ...getRepeaterComponents(repeater?.buttons)];\r\n  const arr3: SoundComponent[] = [...sounds, ...getRepeaterComponents(repeater?.sounds)];\r\n  const result: (MediaFile | undefined)[] = [];\r\n\r\n  arr1.forEach((media) => {\r\n    if (isMediaImage(media) && media.value.media) {\r\n      result.push(media.value.media);\r\n    } else if (isMediaFlipCard(media) && media.value) {\r\n      result.push(media.value.recto.media);\r\n    } else if (isMediaSlideshow(media)) {\r\n      media.value.items.forEach((item) => {\r\n        result.push(item.media);\r\n      });\r\n    } else if (isMediaButton(media)) {\r\n      const button = media.value;\r\n\r\n      result.push(button.click, button.over, button.out, button.icon);\r\n      result.push(...getActionMedias(button.clickAction));\r\n      result.push(...getActionMedias(button.overAction));\r\n    } else if (isMediaCustom(media)) {\r\n      result.push(media.value.media);\r\n    } else if (isMediaStandardVideo(media)) {\r\n      const standard = media.value;\r\n\r\n      result.push(\r\n        standard.main,\r\n        standard.webm,\r\n        standard.image,\r\n        standard.main?.subtitle,\r\n        standard.main?.marker\r\n      );\r\n    } else if (isMediaSynchroVideo(media)) {\r\n      const synchro = media.value;\r\n\r\n      result.push(synchro.main, synchro.webm);\r\n    } else if (isMediaHotspot(media)) {\r\n      const hotspot = media.value;\r\n\r\n      result.push(hotspot.media);\r\n\r\n      hotspot.items.forEach((item) => {\r\n        result.push(...getActionMedias(item.clickAction));\r\n        result.push(...getActionMedias(item.overAction));\r\n      });\r\n    } else if (isMediaHotspot360(media)) {\r\n      media.value.items.forEach((item) => {\r\n        result.push(item.media);\r\n\r\n        item.items.forEach((item2) => {\r\n          result.push(...getActionMedias(item2.clickAction));\r\n          result.push(...getActionMedias(item2.overAction));\r\n        });\r\n      });\r\n    }\r\n  });\r\n\r\n  arr2.forEach((button) => {\r\n    const btn = button.value;\r\n\r\n    result.push(btn.background, btn.inline);\r\n    result.push(...getActionMedias(btn.clickAction));\r\n    result.push(...getActionMedias(btn.overAction));\r\n  });\r\n\r\n  arr3.forEach((sound) => {\r\n    const snd = sound.value;\r\n\r\n    result.push(snd.media, snd.image, snd.media?.subtitle, snd.media?.marker);\r\n  });\r\n\r\n  return filterFalsy(result);\r\n}\r\n\r\nfunction getActionMedias(action: ComponentAction) {\r\n  const result: (MediaFile | undefined)[] = [];\r\n\r\n  if (action) {\r\n    if (isDocumentAction(action)) {\r\n      result.push(action.value?.document);\r\n    } else if (isReplaceBackgroundAction(action)) {\r\n      result.push(action.value?.background);\r\n    } else if (isPopoverAction(action)) {\r\n      result.push(action.value?.media);\r\n    }\r\n  }\r\n\r\n  return filterFalsy(result);\r\n}\r\n\r\nexport function getQuestionMedias(question: QuestionTemplate) {\r\n  const {\r\n    introduction: {\r\n      media: { media, sound },\r\n    },\r\n    main: { media: mMedia, sound: mSound, content: mContent },\r\n    feedback: {\r\n      global: {\r\n        right: { media: rMedia, sound: rSound },\r\n        wrong: { media: wMedia, sound: wSound },\r\n      },\r\n    },\r\n  } = question;\r\n  const result: (MediaFile | undefined)[] = [];\r\n\r\n  result.push(media.value, sound.value);\r\n  result.push(mMedia.value?.media!, mSound.value);\r\n  result.push(rMedia.value, rSound.value, wMedia.value, wSound.value);\r\n\r\n  if (isQuestionPropositions(mContent)) {\r\n    mContent.value?.items.map((proposition) => {\r\n      const {\r\n        media,\r\n        sound,\r\n        feedback: { media: fbMedia, sound: fbSound },\r\n      } = proposition;\r\n\r\n      result.push(media.value, sound.value, fbMedia.value, fbSound.value);\r\n    });\r\n  } else if (isQuestionCustom(mContent)) {\r\n    result.push(mContent.value);\r\n  }\r\n\r\n  return filterFalsy(result);\r\n}\r\n\r\nexport function getTemplateActionMedias(action: ContentTemplateAction) {\r\n  const result: (MediaFile | undefined)[] = [];\r\n\r\n  if (action) {\r\n    result.push(\r\n      ...getBackgroundMedias(action.load.background.background),\r\n      action.load.sound.sound,\r\n      action.load.sound.sound?.subtitle,\r\n      action.load.sound.sound?.marker,\r\n      ...getBackgroundMedias(action.complete.background.background),\r\n      action.complete.sound.sound,\r\n      action.complete.sound.sound?.subtitle,\r\n      action.complete.sound.sound?.marker\r\n    );\r\n  }\r\n\r\n  return filterFalsy(result);\r\n}\r\n\r\nexport function getPropertiesMedias(properties: CourseElementProps) {\r\n  const result: (MediaFile | undefined | null)[] = [];\r\n\r\n  if (properties.mediaJSON) {\r\n    result.push(\r\n      properties.mediaJSON.default,\r\n      properties.mediaJSON.over,\r\n      properties.mediaJSON.overSound\r\n    );\r\n  }\r\n\r\n  if (properties.navigationJSON) {\r\n    result.push(...Object.values(properties.navigationJSON));\r\n  }\r\n\r\n  if (properties.backgroundJSON) {\r\n    result.push(...getBackgroundMedias(properties.backgroundJSON.media));\r\n  }\r\n\r\n  return filterFalsy(result);\r\n}\r\n"]},"metadata":{},"sourceType":"module"}