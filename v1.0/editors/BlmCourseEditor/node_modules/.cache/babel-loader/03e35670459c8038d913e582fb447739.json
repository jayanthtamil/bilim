{"ast":null,"code":"import { Cache, Texture, RGBFormat, RGBAFormat, CubeTexture, EventDispatcher, VideoTexture, LinearFilter, SpriteMaterial, Sprite, Color, CanvasTexture, DoubleSide, Vector3, Mesh, BackSide, Object3D, SphereBufferGeometry, MeshBasicMaterial, BufferGeometry, BufferAttribute, ShaderLib, BoxBufferGeometry, ShaderMaterial, Matrix4, Vector2, Quaternion, PlaneBufferGeometry, Math as Math$1, MOUSE, PerspectiveCamera, OrthographicCamera, Euler, Scene, StereoCamera, WebGLRenderTarget, NearestFilter, WebGLRenderer, Raycaster, Frustum, REVISION as REVISION$1 } from 'three';\nconst version = \"0.12.1\";\nconst dependencies = {\n  three: \"^0.105.2\"\n};\n/**\n * REVISION\n * @module REVISION\n * @example PANOLENS.REVISION\n * @type {string} revision\n */\n\nconst REVISION = version.split('.')[1];\n/**\n * VERSION\n * @module VERSION\n * @example PANOLENS.VERSION\n * @type {string} version\n */\n\nconst VERSION = version;\n/**\n * THREEJS REVISION\n * @module THREE_REVISION\n * @example PANOLENS.THREE_REVISION\n * @type {string} threejs revision\n */\n\nconst THREE_REVISION = dependencies.three.split('.')[1];\n/**\n * THREEJS VERSION\n * @module THREE_VERSION\n * @example PANOLENS.THREE_VERSION\n * @type {string} threejs version\n */\n\nconst THREE_VERSION = dependencies.three.replace(/[^0-9.]/g, '');\n/**\n * CONTROLS\n * @module CONTROLS\n * @example PANOLENS.CONTROLS.ORBIT\n * @property {number} ORBIT 0\n * @property {number} DEVICEORIENTATION 1\n */\n\nconst CONTROLS = {\n  ORBIT: 0,\n  DEVICEORIENTATION: 1\n};\n/**\n * MODES\n * @module MODES\n * @example PANOLENS.MODES.UNKNOWN\n * @property {number} UNKNOWN 0\n * @property {number} NORMAL 1\n * @property {number} CARDBOARD 2\n * @property {number} STEREO 3\n */\n\nconst MODES = {\n  UNKNOWN: 0,\n  NORMAL: 1,\n  CARDBOARD: 2,\n  STEREO: 3\n};\n/**\n * CONTROL_BUTTONS\n * @module CONTROL_BUTTONS\n * @example PANOLENS.VIEWER.CONTROL_BUTTONS\n * @property {string} FULLSCREEN\n * @property {string} SETTING\n * @property {string} VIDEO\n */\n\nconst CONTROL_BUTTONS = {\n  FULLSCREEN: 'fullscreen',\n  SETTING: 'setting',\n  VIDEO: 'video'\n};\n/**\n * OUTPUTS\n * @module OUTPUTS\n * @example PANOLENS.VIEWER.OUTPUTS\n * @property {string} NONE\n * @property {string} CONSOLE\n * @property {string} OVERLAY\n */\n\nconst OUTPUTS = {\n  NONE: 'none',\n  CONSOLE: 'console',\n  OVERLAY: 'overlay'\n};\n/**\n * Data URI Images\n * @module DataImage\n * @example PANOLENS.DataImage.Info\n * @property {string} Info Information Icon\n * @property {string} Arrow Arrow Icon\n * @property {string} FullscreenEnter Fullscreen Enter Icon\n * @property {string} FullscreenLeave Fullscreen Leave Icon\n * @property {string} VideoPlay Video Play Icon\n * @property {string} VideoPause Video Pause Icon\n * @property {string} WhiteTile White Tile Icon\n * @property {string} Setting Settings Icon\n * @property {string} ChevronRight Chevron Right Icon\n * @property {string} Check Check Icon\n * @property {string} ViewIndicator View Indicator Icon\n */\n\nconst DataImage = {\n  Info: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAABmJLR0QAAAAAAAD5Q7t/AAAACXBIWXMAAABIAAAASABGyWs+AAAACXZwQWcAAABAAAAAQADq8/hgAAADBklEQVR42u2bP08UQRiHnzFaSYCI/xoksdBIqGwIiYWRUBISExpCQ0ej38FWOmlIKKhoMPEbaCxsrrHiYrQgOSlQEaICrT+LHSPZzNzt3s3c3Hn7lHvLzvv82L2dm30XKioqKgYY062BJF0HpoA7wARwBbhsPz4DjoEG8AnYNcZ8Sx1Op8IXJM1KWpdUV3nq9m9nJV1I7VNGfEzSM0mNNqR9NOwxx1L7NRMflbQm6SSgeJ4TO8Zoat+8/LKkg4jieQ4kLaf2RtKwpJ0uiufZkTScSn5S0l5C+b/sSZrstvyMpKPU5uc4kjTTjkvpeYCkaeA1/+7hvcIZMGuMqUULQNIU8Aa4ltrWwyHwyBizGzwASSPAe+B2assW7AH3jTE/i+xcZoa12Qfy2Bo3i+5cKABl99zF1GYlWFTBeULLS0DZrOsDcDNggTXgc27bLWA64BhfgHvGmB8dHUXZ1DM0S45xliKMs9bKr+klIOkqsBrwv9JtVq1DewEAT4Ch1BYdMGQdygeg7Df4SmqDAKyoyXpCszPgITCeuvoAjFuX0gE8jljUdv7bCtiOOJ7XpdUZ8L/gdXHOA5QtYH5NXXVgbrgWWn1nwFTqaiPgdPIFcDd1tRFwOl307DwRuZgXwLvctgfA04hjOp18AcReZ6sZY16e3yDpUuQxnU6+S2AkcjEpcDr1zxOXSPgCKLSa0mc4nXwB/EpdbQScTr4AGqmrjYDTyRfAx9TVRsDp5Aug8LJyH+F0cgZg58z11BUHpO5ruGh2G3ybuuqAeF2aBfAqddUB8bq0OgP2U1cegH3aOQOMMb+BrdTVB2DLupQLwLIOnKY26IBT6+ClaQDGmO/ARmqLDtiwDn7HVkcY+EdjNoTlCI+tYhO2iUppm6HKslPUq2qQKHpUe8AFsjaUXuUQWCgqXyoAG8IuME/WkNRrnAHzZfqDSgdgQ6gBc2Td3b3CMTBXtkOsIzTIjZLnQhjcVtlcEIPZLJ0LoVvt8s/Va+3yuSAG84UJRxB98cpM9dJURUVFxSDzBxKde4Lk3/h2AAAAAElFTkSuQmCC',\n  Arrow: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAABmJLR0QAAAAAAAD5Q7t/AAAACXBIWXMAAABIAAAASABGyWs+AAAACXZwQWcAAABAAAAAQADq8/hgAAADPklEQVR42u2bMUscQRiG30/SRaJEI1ZKUiRErNIELRUbQYSAnX8hpVUgkDYp0wgWVjYW+QcJaQzYpLojJIXhtDDEKBpj65ti58ixmdmb2ZvZ7+T2AUHudmfmeXf2bnb3O6CmpqZmgJGqOiI5AWAWwEMA0wDuArht3r4CcAagBeAbgIaI/NQOp1fhIZKLJN+SbDKcptl3keSQtk+I+BjJVyRbJaRdtEybY9p+ReKjJN+QvIwonufS9DGq7ZuXXyd5nFA8zzHJdW1vkLxDcrdC8Ty7JO9oyc+QPFCUb3NAcqZq+TmSp9rmHZySnCvjErwOIPkUwHv8+w7vF64ALIrIfrIASM4C+ADgnratgxMACyLSiB4AyREAnwE80LbswgGAJyJy4bNxyApr6wbIw4xxy3djrwCYfeeuaZsFsEbPdULXU4DZqusLgMkEA21P05EEbf8A8FhEzos28pkBLxLKL5s/r/M1kEkz9vKQHGeatf05yfmOfubNa7G5JDle5NhtBjwHMBz5yFwAWBaRT+0XzP8pZsKwcQiH2fX8Ycojb+kzxUw4ZJn7CSQXqpRPHMKCq7+iZJ71Mvdy/DftXSQ6HcJdSDaqPPKW/mPOBO+lcbvzCU35RCFM2PpwnQKzZQfdgfe0dxH5dLA6uQJ4pC2fIASrkyuA6X6QjxyC1ckVQNn7bNHlI4ZgdXIFUObiJJl8pBCsTjGfuIwA2Cv4FN7xbYjkjqsRAHuIePXoCiDF1Zk2VidXAL+1R5sAq5MrgJb2aBNgdXIF8FV7tAmwOrkCCFs73wysTtYATHFCU3vEEWm6Ci6KvgY/ao86Ik6XogDeaY86Ik6XbjPgSHvkEThCwQy45XpDRK5JbgN4GWkgUyR9H65MRQxgW0SunZ5FezK7pfwd8e8MV8UfAPdF5Jdrg8JrAbPjprZFD2wWyQP6j8ZSEufRmGlgQ9umBBvd5IOgbjFUKLu+XnWBhG+rpsFVZGUo/coJgFVf+aAATAgNACvICpL6jSsAKyH1QcEBmBD2ASwhq+7uF84ALIVWiPUEB7lQsiOEwS2VzQUxmMXSuRCqKpd/zX4rl88FMZg/mLAEcSN+MlP/aKqmpqZmkPkL0hSjwOpNKxwAAAAASUVORK5CYII=',\n  FullscreenEnter: 'data:image/svg+xml;base64,PHN2ZyBmaWxsPSIjRkZGRkZGIiBoZWlnaHQ9IjI0IiB2aWV3Qm94PSIwIDAgMjQgMjQiIHdpZHRoPSIyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICAgIDxwYXRoIGQ9Ik0wIDBoMjR2MjRIMHoiIGZpbGw9Im5vbmUiLz4KICAgIDxwYXRoIGQ9Ik03IDE0SDV2NWg1di0ySDd2LTN6bS0yLTRoMlY3aDNWNUg1djV6bTEyIDdoLTN2Mmg1di01aC0ydjN6TTE0IDV2MmgzdjNoMlY1aC01eiIvPgo8L3N2Zz4=',\n  FullscreenLeave: 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz48IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCI+PHBhdGggc3R5bGU9ImZpbGw6I2ZmZiIgZD0iTTE0LDE0SDE5VjE2SDE2VjE5SDE0VjE0TTUsMTRIMTBWMTlIOFYxNkg1VjE0TTgsNUgxMFYxMEg1VjhIOFY1TTE5LDhWMTBIMTRWNUgxNlY4SDE5WiIgLz48L3N2Zz4=',\n  VideoPlay: 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz48IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCI+PHBhdGggc3R5bGU9ImZpbGw6I2ZmZiIgZD0iTTgsNS4xNFYxOS4xNEwxOSwxMi4xNEw4LDUuMTRaIiAvPjwvc3ZnPg==',\n  VideoPause: 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz48IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCI+PHBhdGggc3R5bGU9ImZpbGw6I2ZmZiIgZD0iTTE0LDE5LjE0SDE4VjUuMTRIMTRNNiwxOS4xNEgxMFY1LjE0SDZWMTkuMTRaIiAvPjwvc3ZnPg==',\n  WhiteTile: 'data:image/png;base64,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',\n  Setting: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAABmJLR0QAAAAAAAD5Q7t/AAAACXBIWXMAAABIAAAASABGyWs+AAAACXZwQWcAAABAAAAAQADq8/hgAAADn0lEQVR42u2bzUsVURjGnyO6CPzAMnTjppAo3LTwH1CqTfaxbeOiRS37A0wXtROFVi1aRBs3LWohSIGbQAQXViBGRhG0UIRKUCpK7q/FnOB2uc6cOXNmRnGe3eW+H8/7zLln3vNxpQoVKlQ4wjBFJAFOSRqX1O7osivpvjHmU1nChBZglvSYLYJbS0EanCvIJzWK+gnsyH34/8OuMaYjb265jwCgz6N4SWq3vodbAEmnS/KtBDgoAgyU5BteAOAkMAPcBroc7PskDWfgN+wyDwBdltMMcDI3tYBnde/pHeARMNTErgd4APzweP834oeN1dMkz5DlsFNn/yyv4kdiSK4At4AO4CqwGaDwRmza2B0210qM7YhrXU59ANAq6bWkwQTTn5KO5fIE0uVYlXTeGLOXFMx1DrjlULwKKN41x6DlnIjEEQCckPRe0okCiguJr5LOGGO+xhm5jICJQ1i8LOeJJKPYEQAMKvrtt5ZdjSf2FM0Fq/sZJI2A6UNcvCz36TiDfUcAcE1SPu/U6Mm8k/TFfu6XdFb5iX3dGPM8lQfwNod3+TowBnQ3yddtv1vPIe+b1JIBiwEJ1IAJ208k5W21trWA+V/5CHAcmAtU/A2P/DcCiTAHHE8tgCVhgLvAXgYCk17Jo/yTGfLuWe7Zd72AC8CWB4n3OAz7mLytNkZabAEXMhfeQKYfWEpJZCxA3rGUOZeA/qDF15FpAz47EvlNk9neI2e3jeWCz0BbmvipNkSMMX8kuSZYM8Z8zyqAjbHmaN5mOeYjgIXrU93MWrxHrNQjrqiDkQMLHwG+OdqF3NN3jeXKzU8AoF1SzdH8XKhJUO7HZDXLMbwAwICkJUULFxe0SbqSVQAbw3Xi7Ze0ZLmGAzAKbHs0JGU1QtvAaIjCW4B7ZOvJy2qFa5a730RPtBiaz0CgnkiZi6F5fBZDVMvho7EhcuS3xJJ2hV9IupgTqaLw0hhzab8vq23xOG/r+LDsKjLgYVzxUnU0ltwK2wDezUyJmEwqXgp/PL4rvxthaeCSI+zxuA10J8ZkWdJNSb2SLkvayKHwDRu71+ZajrG941J8agALDQ3GU/a/IvMkYCPzmCbtLNEVmacNtgs5iP9fYVNEV1Q6Hez7yNZSL+J2SarTcpqiyV2iUkG0IvPFvbz5FbEn+KEk3wMjwMeSfCsBXFBdly9CAPk9ydyffpECuB5tZfVJjaKWueOSfinln6YK4lahQoUKRxd/AcRPGTcQCAUQAAAAAElFTkSuQmCC',\n  ChevronRight: 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz48IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCI+PHBhdGggZD0iTTguNTksMTYuNThMMTMuMTcsMTJMOC41OSw3LjQxTDEwLDZMMTYsMTJMMTAsMThMOC41OSwxNi41OFoiIC8+PC9zdmc+',\n  Check: 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz48IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCI+PHBhdGggZD0iTTIxLDdMOSwxOUwzLjUsMTMuNUw0LjkxLDEyLjA5TDksMTYuMTdMMTkuNTksNS41OUwyMSw3WiIgLz48L3N2Zz4=',\n  ViewIndicator: 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPCFET0NUWVBFIHN2ZyBQVUJMSUMgIi0vL1czQy8vRFREIFNWRyAxLjEvL0VOIiAiaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkIj4KPHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBpZD0idmlldy1pbmRpY2F0b3IiIGhlaWdodD0iMzAiIHdpZHRoPSIzMCIgdmlld0JveD0iLTIuNSAtMSAzMCAzMCI+Cgk8c3R5bGUgdHlwZT0idGV4dC9jc3MiPi5zdDB7c3Ryb2tlLXdpZHRoOjI7c3Ryb2tlLW1pdGVybGltaXQ6MTA7ZmlsbDpub25lO30uc3Qxe3N0cm9rZS13aWR0aDo2O3N0cm9rZS1taXRlcmxpbWl0OjEwO30KCTwvc3R5bGU+Cgk8Zz4KCQk8cGF0aCBjbGFzcz0ic3QwIiBkPSJNIDEyLjUgMCBBIDEyLjUgMTIuNSAwIDAgMCAtMTIuNSAwIEEgMTIuNSAxMi41IDAgMCAwIDEyLjUgMCIgdHJhbnNmb3JtPSJtYXRyaXgoMSwwLDAsMSwxMywxNS41KSI+PC9wYXRoPgoJCTxwYXRoIGNsYXNzPSJzdDIiIGQ9Ik0gMTMgMCBMIDEwIDIgTCAxNiAyIFoiPjwvcGF0aD4KCQk8cGF0aCBjbGFzcz0ic3QyIiBkPSJNIDIgMCBBIDIgMiAwIDAgMCAtMiAwIEEgMiAyIDAgMCAwIDIgMCIgdHJhbnNmb3JtPSJtYXRyaXgoMSwwLDAsMSwxMywxNS41KSI+PC9wYXRoPgoJCTxwYXRoIGNsYXNzPSJzdDEiIGlkPSJpbmRpY2F0b3IiIHRyYW5zZm9ybT0ibWF0cml4KDEsMCwwLDEsMTMsMTUuNSkiPjwvcGF0aD4KCTwvZz4KPC9zdmc+'\n};\n/**\n * @module ImageLoader\n * @description Image loader with progress based on {@link https://github.com/mrdoob/three.js/blob/master/src/loaders/ImageLoader.js}\n */\n\nconst ImageLoader = {\n  /**\n   * Load image\n   * @example PANOLENS.ImageLoader.load( IMAGE_URL )\n   * @method load\n   * @param  {string}   url        - An image url\n   * @param  {function} onLoad     - On load callback\n   * @param  {function} onProgress - In progress callback\n   * @param  {function} onError    - On error callback\n   */\n  load: function (url, onLoad = () => {}, onProgress = () => {}, onError = () => {}) {\n    // Enable cache\n    Cache.enabled = true;\n    let cached, request, arrayBufferView, blob, urlCreator, image, reference; // Reference key\n\n    for (let iconName in DataImage) {\n      if (DataImage.hasOwnProperty(iconName) && url === DataImage[iconName]) {\n        reference = iconName;\n      }\n    } // Cached\n\n\n    cached = Cache.get(reference ? reference : url);\n\n    if (cached !== undefined) {\n      if (onLoad) {\n        if (cached.complete && cached.src) {\n          setTimeout(function () {\n            onProgress({\n              loaded: 1,\n              total: 1\n            });\n            onLoad(cached);\n          }, 0);\n        } else {\n          cached.addEventListener('load', function () {\n            onProgress({\n              loaded: 1,\n              total: 1\n            });\n            onLoad(cached);\n          }, false);\n        }\n      }\n\n      return cached;\n    } // Construct a new XMLHttpRequest\n\n\n    urlCreator = window.URL || window.webkitURL;\n    image = document.createElementNS('http://www.w3.org/1999/xhtml', 'img'); // Add to cache\n\n    Cache.add(reference ? reference : url, image);\n\n    const onImageLoaded = () => {\n      urlCreator.revokeObjectURL(image.src);\n      onLoad(image);\n    };\n\n    if (url.indexOf('data:') === 0) {\n      image.addEventListener('load', onImageLoaded, false);\n      image.src = url;\n      return image;\n    }\n\n    image.crossOrigin = this.crossOrigin !== undefined ? this.crossOrigin : '';\n    request = new window.XMLHttpRequest();\n    request.open('GET', url, true);\n\n    if (process.env.npm_lifecycle_event !== 'test') {\n      /* istanbul ignore next */\n      request.onreadystatechange = function () {\n        if (this.readyState === 4 && this.status >= 400) {\n          onError();\n        }\n      };\n    }\n\n    request.responseType = 'arraybuffer';\n    request.addEventListener('error', onError);\n    request.addEventListener('progress', event => {\n      if (!event) return;\n      const {\n        loaded,\n        total,\n        lengthComputable\n      } = event;\n\n      if (lengthComputable) {\n        onProgress({\n          loaded,\n          total\n        });\n      }\n    });\n    request.addEventListener('loadend', event => {\n      if (!event) return;\n      const {\n        currentTarget: {\n          response\n        }\n      } = event;\n      arrayBufferView = new Uint8Array(response);\n      blob = new window.Blob([arrayBufferView]);\n      image.addEventListener('load', onImageLoaded, false);\n      image.src = urlCreator.createObjectURL(blob);\n    });\n    request.send(null);\n  }\n};\n/**\n * @module TextureLoader\n * @description Texture loader based on {@link https://github.com/mrdoob/three.js/blob/master/src/loaders/TextureLoader.js}\n */\n\nconst TextureLoader = {\n  /**\n   * Load image texture\n   * @example PANOLENS.TextureLoader.load( IMAGE_URL )\n   * @method load\n   * @param  {string}   url        - An image url\n   * @param  {function} onLoad     - On load callback\n   * @param  {function} onProgress - In progress callback\n   * @param  {function} onError    - On error callback\n   * @return {THREE.Texture}   \t - Image texture\n   */\n  load: function (url, onLoad = () => {}, onProgress, onError) {\n    var texture = new Texture();\n    ImageLoader.load(url, function (image) {\n      texture.image = image; // JPEGs can't have an alpha channel, so memory can be saved by storing them as RGB.\n\n      const isJPEG = url.search(/\\.(jpg|jpeg)$/) > 0 || url.search(/^data\\:image\\/jpeg/) === 0;\n      texture.format = isJPEG ? RGBFormat : RGBAFormat;\n      texture.needsUpdate = true;\n      onLoad(texture);\n    }, onProgress, onError);\n    return texture;\n  }\n};\n/**\n * @module CubeTextureLoader\n * @description Cube Texture Loader based on {@link https://github.com/mrdoob/three.js/blob/master/src/loaders/CubeTextureLoader.js}\n */\n\nconst CubeTextureLoader = {\n  /**\n   * Load 6 images as a cube texture\n   * @example PANOLENS.CubeTextureLoader.load( [ 'px.png', 'nx.png', 'py.png', 'ny.png', 'pz.png', 'nz.png' ] )\n   * @method load\n   * @param  {array}   urls        - array of 6 urls to images, one for each side of the CubeTexture. The urls should be specified in the following order: pos-x, neg-x, pos-y, neg-y, pos-z, neg-z\n   * @param  {function} onLoad     - On load callback\n   * @param  {function} onProgress - In progress callback\n   * @param  {function} onError    - On error callback\n   * @return {THREE.CubeTexture}   - Cube texture\n   */\n  load: function (urls, onLoad = () => {}, onProgress = () => {}, onError) {\n    var texture, loaded, progress, all, loadings;\n    texture = new CubeTexture([]);\n    loaded = 0;\n    progress = {};\n    all = {};\n    urls.map(function (url, index) {\n      ImageLoader.load(url, function (image) {\n        texture.images[index] = image;\n        loaded++;\n\n        if (loaded === 6) {\n          texture.needsUpdate = true;\n          onLoad(texture);\n        }\n      }, function (event) {\n        progress[index] = {\n          loaded: event.loaded,\n          total: event.total\n        };\n        all.loaded = 0;\n        all.total = 0;\n        loadings = 0;\n\n        for (var i in progress) {\n          loadings++;\n          all.loaded += progress[i].loaded;\n          all.total += progress[i].total;\n        }\n\n        if (loadings < 6) {\n          all.total = all.total / loadings * 6;\n        }\n\n        onProgress(all);\n      }, onError);\n    });\n    return texture;\n  }\n};\n/**\n * @classdesc User Media\n * @constructor\n * @param {object} [constraints={ video: { width: { ideal: 1920 }, height: { ideal: 1080 }, facingMode: { exact: 'environment' } }, audio: false }]\n */\n\nfunction Media(constraints) {\n  const defaultConstraints = {\n    video: {\n      width: {\n        ideal: 1920\n      },\n      height: {\n        ideal: 1080\n      },\n      facingMode: {\n        exact: 'environment'\n      }\n    },\n    audio: false\n  };\n  this.constraints = Object.assign(defaultConstraints, constraints);\n  this.container = null;\n  this.scene = null;\n  this.element = null;\n  this.devices = [];\n  this.stream = null;\n  this.ratioScalar = 1;\n  this.videoDeviceIndex = 0;\n}\n\nMedia.prototype = Object.assign(Object.create(EventDispatcher.prototype), {\n  setContainer: function (container) {\n    this.container = container;\n  },\n  setScene: function (scene) {\n    this.scene = scene;\n  },\n\n  /**\n   * Enumerate devices\n   * @memberOf Media\n   * @instance\n   * @returns {Promise}\n   */\n  enumerateDevices: function () {\n    const devices = this.devices;\n    const resolvedPromise = new Promise(resolve => {\n      resolve(devices);\n    });\n    return devices.length > 0 ? resolvedPromise : window.navigator.mediaDevices.enumerateDevices();\n  },\n\n  /**\n   * Switch to next available video device\n   * @memberOf Media\n   * @instance\n   */\n  switchNextVideoDevice: function () {\n    const stop = this.stop.bind(this);\n    const start = this.start.bind(this);\n    const setVideDeviceIndex = this.setVideDeviceIndex.bind(this);\n    let index = this.videoDeviceIndex;\n    this.getDevices('video').then(devices => {\n      stop();\n      index++;\n\n      if (index >= devices.length) {\n        setVideDeviceIndex(0);\n        index--;\n      } else {\n        setVideDeviceIndex(index);\n      }\n\n      start(devices[index]);\n    });\n  },\n\n  /**\n   * Get devices\n   * @param {string} type - type keyword to match device.kind\n   * @memberOf Media\n   * @instance\n   */\n  getDevices: function (type = 'video') {\n    const devices = this.devices;\n\n    const validate = _devices => {\n      return _devices.map(device => {\n        if (!devices.includes(device)) {\n          devices.push(device);\n        }\n\n        return device;\n      });\n    };\n\n    const filter = _devices => {\n      const reg = new RegExp(type, 'i');\n      return _devices.filter(device => reg.test(device.kind));\n    };\n\n    return this.enumerateDevices().then(validate).then(filter);\n  },\n\n  /**\n   * Get user media\n   * @param {MediaStreamConstraints} constraints\n   * @memberOf Media\n   * @instance\n   */\n  getUserMedia: function (constraints) {\n    const setMediaStream = this.setMediaStream.bind(this);\n    const playVideo = this.playVideo.bind(this);\n\n    const onCatchError = error => {\n      console.warn(`PANOLENS.Media: ${error}`);\n    };\n\n    return window.navigator.mediaDevices.getUserMedia(constraints).then(setMediaStream).then(playVideo).catch(onCatchError);\n  },\n\n  /**\n   * Set video device index\n   * @param {number} index \n   * @memberOf Media\n   * @instance\n   */\n  setVideDeviceIndex: function (index) {\n    this.videoDeviceIndex = index;\n  },\n\n  /**\n   * Start streaming\n   * @param {MediaDeviceInfo} [targetDevice]\n   * @memberOf Media\n   * @instance\n   */\n  start: function (targetDevice) {\n    const constraints = this.constraints;\n    const getUserMedia = this.getUserMedia.bind(this);\n\n    const onVideoDevices = devices => {\n      if (!devices || devices.length === 0) {\n        throw Error('no video device found');\n      }\n\n      const device = targetDevice || devices[0];\n      constraints.video.deviceId = device.deviceId;\n      return getUserMedia(constraints);\n    };\n\n    this.element = this.createVideoElement();\n    return this.getDevices().then(onVideoDevices);\n  },\n\n  /**\n   * Stop streaming\n   * @memberOf Media\n   * @instance\n   */\n  stop: function () {\n    const stream = this.stream;\n\n    if (stream && stream.active) {\n      const track = stream.getTracks()[0];\n      track.stop();\n      window.removeEventListener('resize', this.onWindowResize.bind(this));\n      this.element = null;\n      this.stream = null;\n    }\n  },\n\n  /**\n   * Set media stream\n   * @param {MediaStream} stream \n   * @memberOf Media\n   * @instance\n   */\n  setMediaStream: function (stream) {\n    this.stream = stream;\n    this.element.srcObject = stream;\n\n    if (this.scene) {\n      this.scene.background = this.createVideoTexture();\n    }\n\n    window.addEventListener('resize', this.onWindowResize.bind(this));\n  },\n\n  /**\n   * Play video element\n   * @memberOf Media\n   * @instance\n   */\n  playVideo: function () {\n    const {\n      element\n    } = this;\n\n    if (element) {\n      element.play();\n      this.dispatchEvent({\n        type: 'play'\n      });\n    }\n  },\n\n  /**\n   * Pause video element\n   * @memberOf Media\n   * @instance\n   */\n  pauseVideo: function () {\n    const {\n      element\n    } = this;\n\n    if (element) {\n      element.pause();\n      this.dispatchEvent({\n        type: 'pause'\n      });\n    }\n  },\n\n  /**\n   * Create video texture\n   * @memberOf Media\n   * @instance\n   * @returns {THREE.VideoTexture}\n   */\n  createVideoTexture: function () {\n    const video = this.element;\n    const texture = new VideoTexture(video);\n    texture.generateMipmaps = false;\n    texture.minFilter = LinearFilter;\n    texture.magFilter = LinearFilter;\n    texture.format = RGBFormat;\n    texture.center.set(0.5, 0.5);\n    video.addEventListener('canplay', this.onWindowResize.bind(this));\n    return texture;\n  },\n\n  /**\n   * Create video element\n   * @memberOf Media\n   * @instance\n   * @returns {HTMLVideoElement}\n   * @fires Media#canplay\n   */\n  createVideoElement: function () {\n    const dispatchEvent = this.dispatchEvent.bind(this);\n    const video = document.createElement('video');\n    /**\n     * Video can play event\n     * @type {object}\n     * @event Media#canplay\n     */\n\n    const canPlay = () => dispatchEvent({\n      type: 'canplay'\n    });\n\n    video.setAttribute('autoplay', '');\n    video.setAttribute('muted', '');\n    video.setAttribute('playsinline', '');\n    video.style.position = 'absolute';\n    video.style.top = '0';\n    video.style.left = '0';\n    video.style.width = '100%';\n    video.style.height = '100%';\n    video.style.objectPosition = 'center';\n    video.style.objectFit = 'cover';\n    video.style.display = this.scene ? 'none' : '';\n    video.addEventListener('canplay', canPlay);\n    return video;\n  },\n\n  /**\n   * On window resize event\n   * @param {Event} event \n   * @memberOf Media\n   * @instance\n   */\n  onWindowResize: function () {\n    if (this.element && this.element.videoWidth && this.element.videoHeight && this.scene) {\n      const {\n        clientWidth: width,\n        clientHeight: height\n      } = this.container;\n      const texture = this.scene.background;\n      const {\n        videoWidth,\n        videoHeight\n      } = this.element;\n      const cameraRatio = videoHeight / videoWidth;\n      const viewportRatio = this.container ? width / height : 1.0;\n      const ratio = cameraRatio * viewportRatio * this.ratioScalar;\n\n      if (width > height) {\n        texture.repeat.set(ratio, 1);\n      } else {\n        texture.repeat.set(1, 1 / ratio);\n      }\n    }\n  }\n});\n/**\n * @classdesc Reticle 3D Sprite\n * @constructor\n * @param {THREE.Color} [color=0xffffff] - Color of the reticle sprite\n * @param {boolean} [autoSelect=true] - Auto selection\n * @param {number} [dwellTime=1500] - Duration for dwelling sequence to complete\n */\n\nfunction Reticle(color = 0xffffff, autoSelect = true, dwellTime = 1500) {\n  this.dpr = window.devicePixelRatio;\n  const {\n    canvas,\n    context\n  } = this.createCanvas();\n  const material = new SpriteMaterial({\n    color,\n    map: this.createCanvasTexture(canvas)\n  });\n  Sprite.call(this, material);\n  this.canvasWidth = canvas.width;\n  this.canvasHeight = canvas.height;\n  this.context = context;\n  this.color = color instanceof Color ? color : new Color(color);\n  this.autoSelect = autoSelect;\n  this.dwellTime = dwellTime;\n  this.rippleDuration = 500;\n  this.position.z = -10;\n  this.center.set(0.5, 0.5);\n  this.scale.set(0.5, 0.5, 1);\n  this.startTimestamp = null;\n  this.timerId = null;\n  this.callback = null;\n  this.frustumCulled = false;\n  this.updateCanvasArcByProgress(0);\n}\n\nReticle.prototype = Object.assign(Object.create(Sprite.prototype), {\n  constructor: Reticle,\n\n  /**\n   * Set material color\n   * @param {THREE.Color} color \n   * @memberOf Reticle\n   * @instance\n   */\n  setColor: function (color) {\n    this.material.color.copy(color instanceof Color ? color : new Color(color));\n  },\n\n  /**\n   * Create canvas texture\n   * @param {HTMLCanvasElement} canvas \n   * @memberOf Reticle\n   * @instance\n   * @returns {THREE.CanvasTexture}\n   */\n  createCanvasTexture: function (canvas) {\n    const texture = new CanvasTexture(canvas);\n    texture.minFilter = LinearFilter;\n    texture.magFilter = LinearFilter;\n    texture.generateMipmaps = false;\n    return texture;\n  },\n\n  /**\n   * Create canvas element\n   * @memberOf Reticle\n   * @instance\n   * @returns {object} object\n   * @returns {HTMLCanvasElement} object.canvas\n   * @returns {CanvasRenderingContext2D} object.context\n   */\n  createCanvas: function () {\n    const width = 32;\n    const height = 32;\n    const canvas = document.createElement('canvas');\n    const context = canvas.getContext('2d');\n    const dpr = this.dpr;\n    canvas.width = width * dpr;\n    canvas.height = height * dpr;\n    context.scale(dpr, dpr);\n    context.shadowBlur = 5;\n    context.shadowColor = 'rgba(200,200,200,0.9)';\n    return {\n      canvas,\n      context\n    };\n  },\n\n  /**\n   * Update canvas arc by progress\n   * @param {number} progress \n   * @memberOf Reticle\n   * @instance\n   */\n  updateCanvasArcByProgress: function (progress) {\n    const context = this.context;\n    const {\n      canvasWidth,\n      canvasHeight,\n      material\n    } = this;\n    const dpr = this.dpr;\n    const degree = progress * Math.PI * 2;\n    const color = this.color.getStyle();\n    const x = canvasWidth * 0.5 / dpr;\n    const y = canvasHeight * 0.5 / dpr;\n    const lineWidth = 3;\n    context.clearRect(0, 0, canvasWidth, canvasHeight);\n    context.beginPath();\n\n    if (progress === 0) {\n      context.arc(x, y, canvasWidth / 16, 0, 2 * Math.PI);\n      context.fillStyle = color;\n      context.fill();\n    } else {\n      context.arc(x, y, canvasWidth / 4 - lineWidth, -Math.PI / 2, -Math.PI / 2 + degree);\n      context.strokeStyle = color;\n      context.lineWidth = lineWidth;\n      context.stroke();\n    }\n\n    context.closePath();\n    material.map.needsUpdate = true;\n  },\n\n  /**\n   * Ripple effect\n   * @memberOf Reticle\n   * @instance\n   * @fires Reticle#reticle-ripple-start\n   * @fires Reticle#reticle-ripple-end\n   */\n  ripple: function () {\n    const context = this.context;\n    const {\n      canvasWidth,\n      canvasHeight,\n      material\n    } = this;\n    const duration = this.rippleDuration;\n    const timestamp = performance.now();\n    const color = this.color;\n    const dpr = this.dpr;\n    const x = canvasWidth * 0.5 / dpr;\n    const y = canvasHeight * 0.5 / dpr;\n\n    const update = () => {\n      const timerId = window.requestAnimationFrame(update);\n      const elapsed = performance.now() - timestamp;\n      const progress = elapsed / duration;\n      const opacity = 1.0 - progress > 0 ? 1.0 - progress : 0;\n      const radius = progress * canvasWidth * 0.5 / dpr;\n      context.clearRect(0, 0, canvasWidth, canvasHeight);\n      context.beginPath();\n      context.arc(x, y, radius, 0, Math.PI * 2);\n      context.fillStyle = `rgba(${color.r * 255}, ${color.g * 255}, ${color.b * 255}, ${opacity})`;\n      context.fill();\n      context.closePath();\n\n      if (progress >= 1.0) {\n        window.cancelAnimationFrame(timerId);\n        this.updateCanvasArcByProgress(0);\n        /**\n         * Reticle ripple end event\n         * @type {object}\n         * @event Reticle#reticle-ripple-end\n         */\n\n        this.dispatchEvent({\n          type: 'reticle-ripple-end'\n        });\n      }\n\n      material.map.needsUpdate = true;\n    };\n    /**\n     * Reticle ripple start event\n     * @type {object}\n     * @event Reticle#reticle-ripple-start\n     */\n\n\n    this.dispatchEvent({\n      type: 'reticle-ripple-start'\n    });\n    update();\n  },\n\n  /**\n   * Make reticle visible\n   * @memberOf Reticle\n   * @instance\n   */\n  show: function () {\n    this.visible = true;\n  },\n\n  /**\n   * Make reticle invisible\n   * @memberOf Reticle\n   * @instance\n   */\n  hide: function () {\n    this.visible = false;\n  },\n\n  /**\n   * Start dwelling\n   * @param {function} callback \n   * @memberOf Reticle\n   * @instance\n   * @fires Reticle#reticle-start\n   */\n  start: function (callback) {\n    if (!this.autoSelect) {\n      return;\n    }\n    /**\n     * Reticle start event\n     * @type {object}\n     * @event Reticle#reticle-start\n     */\n\n\n    this.dispatchEvent({\n      type: 'reticle-start'\n    });\n    this.startTimestamp = performance.now();\n    this.callback = callback;\n    this.update();\n  },\n\n  /**\n   * End dwelling\n   * @memberOf Reticle\n   * @instance\n   * @fires Reticle#reticle-end\n   */\n  end: function () {\n    if (!this.startTimestamp) {\n      return;\n    }\n\n    window.cancelAnimationFrame(this.timerId);\n    this.updateCanvasArcByProgress(0);\n    this.callback = null;\n    this.timerId = null;\n    this.startTimestamp = null;\n    /**\n     * Reticle end event\n     * @type {object}\n     * @event Reticle#reticle-end\n     */\n\n    this.dispatchEvent({\n      type: 'reticle-end'\n    });\n  },\n\n  /**\n   * Update dwelling\n   * @memberOf Reticle\n   * @instance\n   * @fires Reticle#reticle-update\n   */\n  update: function () {\n    this.timerId = window.requestAnimationFrame(this.update.bind(this));\n    const elapsed = performance.now() - this.startTimestamp;\n    const progress = elapsed / this.dwellTime;\n    this.updateCanvasArcByProgress(progress);\n    /**\n     * Reticle update event\n     * @type {object}\n     * @event Reticle#reticle-update\n     */\n\n    this.dispatchEvent({\n      type: 'reticle-update',\n      progress\n    });\n\n    if (progress >= 1.0) {\n      window.cancelAnimationFrame(this.timerId);\n\n      if (this.callback) {\n        this.callback();\n      }\n\n      this.end();\n      this.ripple();\n    }\n  }\n});\n\nfunction createCommonjsModule(fn, module) {\n  return module = {\n    exports: {}\n  }, fn(module, module.exports), module.exports;\n}\n\nvar Tween = createCommonjsModule(function (module, exports) {\n  /**\n   * Tween.js - Licensed under the MIT license\n   * https://github.com/tweenjs/tween.js\n   * ----------------------------------------------\n   *\n   * See https://github.com/tweenjs/tween.js/graphs/contributors for the full list of contributors.\n   * Thank you all, you're awesome!\n   */\n  var _Group = function () {\n    this._tweens = {};\n    this._tweensAddedDuringUpdate = {};\n  };\n\n  _Group.prototype = {\n    getAll: function () {\n      return Object.keys(this._tweens).map(function (tweenId) {\n        return this._tweens[tweenId];\n      }.bind(this));\n    },\n    removeAll: function () {\n      this._tweens = {};\n    },\n    add: function (tween) {\n      this._tweens[tween.getId()] = tween;\n      this._tweensAddedDuringUpdate[tween.getId()] = tween;\n    },\n    remove: function (tween) {\n      delete this._tweens[tween.getId()];\n      delete this._tweensAddedDuringUpdate[tween.getId()];\n    },\n    update: function (time, preserve) {\n      var tweenIds = Object.keys(this._tweens);\n\n      if (tweenIds.length === 0) {\n        return false;\n      }\n\n      time = time !== undefined ? time : TWEEN.now(); // Tweens are updated in \"batches\". If you add a new tween during an update, then the\n      // new tween will be updated in the next batch.\n      // If you remove a tween during an update, it may or may not be updated. However,\n      // if the removed tween was added during the current batch, then it will not be updated.\n\n      while (tweenIds.length > 0) {\n        this._tweensAddedDuringUpdate = {};\n\n        for (var i = 0; i < tweenIds.length; i++) {\n          var tween = this._tweens[tweenIds[i]];\n\n          if (tween && tween.update(time) === false) {\n            tween._isPlaying = false;\n\n            if (!preserve) {\n              delete this._tweens[tweenIds[i]];\n            }\n          }\n        }\n\n        tweenIds = Object.keys(this._tweensAddedDuringUpdate);\n      }\n\n      return true;\n    }\n  };\n  var TWEEN = new _Group();\n  TWEEN.Group = _Group;\n  TWEEN._nextId = 0;\n\n  TWEEN.nextId = function () {\n    return TWEEN._nextId++;\n  }; // Include a performance.now polyfill.\n  // In node.js, use process.hrtime.\n\n\n  if (typeof self === 'undefined' && typeof process !== 'undefined' && process.hrtime) {\n    TWEEN.now = function () {\n      var time = process.hrtime(); // Convert [seconds, nanoseconds] to milliseconds.\n\n      return time[0] * 1000 + time[1] / 1000000;\n    };\n  } // In a browser, use self.performance.now if it is available.\n  else if (typeof self !== 'undefined' && self.performance !== undefined && self.performance.now !== undefined) {\n      // This must be bound, because directly assigning this function\n      // leads to an invocation exception in Chrome.\n      TWEEN.now = self.performance.now.bind(self.performance);\n    } // Use Date.now if it is available.\n    else if (Date.now !== undefined) {\n        TWEEN.now = Date.now;\n      } // Otherwise, use 'new Date().getTime()'.\n      else {\n          TWEEN.now = function () {\n            return new Date().getTime();\n          };\n        }\n\n  TWEEN.Tween = function (object, group) {\n    this._object = object;\n    this._valuesStart = {};\n    this._valuesEnd = {};\n    this._valuesStartRepeat = {};\n    this._duration = 1000;\n    this._repeat = 0;\n    this._repeatDelayTime = undefined;\n    this._yoyo = false;\n    this._isPlaying = false;\n    this._reversed = false;\n    this._delayTime = 0;\n    this._startTime = null;\n    this._easingFunction = TWEEN.Easing.Linear.None;\n    this._interpolationFunction = TWEEN.Interpolation.Linear;\n    this._chainedTweens = [];\n    this._onStartCallback = null;\n    this._onStartCallbackFired = false;\n    this._onUpdateCallback = null;\n    this._onRepeatCallback = null;\n    this._onCompleteCallback = null;\n    this._onStopCallback = null;\n    this._group = group || TWEEN;\n    this._id = TWEEN.nextId();\n  };\n\n  TWEEN.Tween.prototype = {\n    getId: function () {\n      return this._id;\n    },\n    isPlaying: function () {\n      return this._isPlaying;\n    },\n    to: function (properties, duration) {\n      this._valuesEnd = Object.create(properties);\n\n      if (duration !== undefined) {\n        this._duration = duration;\n      }\n\n      return this;\n    },\n    duration: function duration(d) {\n      this._duration = d;\n      return this;\n    },\n    start: function (time) {\n      this._group.add(this);\n\n      this._isPlaying = true;\n      this._onStartCallbackFired = false;\n      this._startTime = time !== undefined ? typeof time === 'string' ? TWEEN.now() + parseFloat(time) : time : TWEEN.now();\n      this._startTime += this._delayTime;\n\n      for (var property in this._valuesEnd) {\n        // Check if an Array was provided as property value\n        if (this._valuesEnd[property] instanceof Array) {\n          if (this._valuesEnd[property].length === 0) {\n            continue;\n          } // Create a local copy of the Array with the start value at the front\n\n\n          this._valuesEnd[property] = [this._object[property]].concat(this._valuesEnd[property]);\n        } // If `to()` specifies a property that doesn't exist in the source object,\n        // we should not set that property in the object\n\n\n        if (this._object[property] === undefined) {\n          continue;\n        } // Save the starting value.\n\n\n        this._valuesStart[property] = this._object[property];\n\n        if (this._valuesStart[property] instanceof Array === false) {\n          this._valuesStart[property] *= 1.0; // Ensures we're using numbers, not strings\n        }\n\n        this._valuesStartRepeat[property] = this._valuesStart[property] || 0;\n      }\n\n      return this;\n    },\n    stop: function () {\n      if (!this._isPlaying) {\n        return this;\n      }\n\n      this._group.remove(this);\n\n      this._isPlaying = false;\n\n      if (this._onStopCallback !== null) {\n        this._onStopCallback(this._object);\n      }\n\n      this.stopChainedTweens();\n      return this;\n    },\n    end: function () {\n      this.update(Infinity);\n      return this;\n    },\n    stopChainedTweens: function () {\n      for (var i = 0, numChainedTweens = this._chainedTweens.length; i < numChainedTweens; i++) {\n        this._chainedTweens[i].stop();\n      }\n    },\n    group: function (group) {\n      this._group = group;\n      return this;\n    },\n    delay: function (amount) {\n      this._delayTime = amount;\n      return this;\n    },\n    repeat: function (times) {\n      this._repeat = times;\n      return this;\n    },\n    repeatDelay: function (amount) {\n      this._repeatDelayTime = amount;\n      return this;\n    },\n    yoyo: function (yoyo) {\n      this._yoyo = yoyo;\n      return this;\n    },\n    easing: function (easingFunction) {\n      this._easingFunction = easingFunction;\n      return this;\n    },\n    interpolation: function (interpolationFunction) {\n      this._interpolationFunction = interpolationFunction;\n      return this;\n    },\n    chain: function () {\n      this._chainedTweens = arguments;\n      return this;\n    },\n    onStart: function (callback) {\n      this._onStartCallback = callback;\n      return this;\n    },\n    onUpdate: function (callback) {\n      this._onUpdateCallback = callback;\n      return this;\n    },\n    onRepeat: function onRepeat(callback) {\n      this._onRepeatCallback = callback;\n      return this;\n    },\n    onComplete: function (callback) {\n      this._onCompleteCallback = callback;\n      return this;\n    },\n    onStop: function (callback) {\n      this._onStopCallback = callback;\n      return this;\n    },\n    update: function (time) {\n      var property;\n      var elapsed;\n      var value;\n\n      if (time < this._startTime) {\n        return true;\n      }\n\n      if (this._onStartCallbackFired === false) {\n        if (this._onStartCallback !== null) {\n          this._onStartCallback(this._object);\n        }\n\n        this._onStartCallbackFired = true;\n      }\n\n      elapsed = (time - this._startTime) / this._duration;\n      elapsed = this._duration === 0 || elapsed > 1 ? 1 : elapsed;\n      value = this._easingFunction(elapsed);\n\n      for (property in this._valuesEnd) {\n        // Don't update properties that do not exist in the source object\n        if (this._valuesStart[property] === undefined) {\n          continue;\n        }\n\n        var start = this._valuesStart[property] || 0;\n        var end = this._valuesEnd[property];\n\n        if (end instanceof Array) {\n          this._object[property] = this._interpolationFunction(end, value);\n        } else {\n          // Parses relative end values with start as base (e.g.: +10, -3)\n          if (typeof end === 'string') {\n            if (end.charAt(0) === '+' || end.charAt(0) === '-') {\n              end = start + parseFloat(end);\n            } else {\n              end = parseFloat(end);\n            }\n          } // Protect against non numeric properties.\n\n\n          if (typeof end === 'number') {\n            this._object[property] = start + (end - start) * value;\n          }\n        }\n      }\n\n      if (this._onUpdateCallback !== null) {\n        this._onUpdateCallback(this._object, elapsed);\n      }\n\n      if (elapsed === 1) {\n        if (this._repeat > 0) {\n          if (isFinite(this._repeat)) {\n            this._repeat--;\n          } // Reassign starting values, restart by making startTime = now\n\n\n          for (property in this._valuesStartRepeat) {\n            if (typeof this._valuesEnd[property] === 'string') {\n              this._valuesStartRepeat[property] = this._valuesStartRepeat[property] + parseFloat(this._valuesEnd[property]);\n            }\n\n            if (this._yoyo) {\n              var tmp = this._valuesStartRepeat[property];\n              this._valuesStartRepeat[property] = this._valuesEnd[property];\n              this._valuesEnd[property] = tmp;\n            }\n\n            this._valuesStart[property] = this._valuesStartRepeat[property];\n          }\n\n          if (this._yoyo) {\n            this._reversed = !this._reversed;\n          }\n\n          if (this._repeatDelayTime !== undefined) {\n            this._startTime = time + this._repeatDelayTime;\n          } else {\n            this._startTime = time + this._delayTime;\n          }\n\n          if (this._onRepeatCallback !== null) {\n            this._onRepeatCallback(this._object);\n          }\n\n          return true;\n        } else {\n          if (this._onCompleteCallback !== null) {\n            this._onCompleteCallback(this._object);\n          }\n\n          for (var i = 0, numChainedTweens = this._chainedTweens.length; i < numChainedTweens; i++) {\n            // Make the chained tweens start exactly at the time they should,\n            // even if the `update()` method was called way past the duration of the tween\n            this._chainedTweens[i].start(this._startTime + this._duration);\n          }\n\n          return false;\n        }\n      }\n\n      return true;\n    }\n  };\n  TWEEN.Easing = {\n    Linear: {\n      None: function (k) {\n        return k;\n      }\n    },\n    Quadratic: {\n      In: function (k) {\n        return k * k;\n      },\n      Out: function (k) {\n        return k * (2 - k);\n      },\n      InOut: function (k) {\n        if ((k *= 2) < 1) {\n          return 0.5 * k * k;\n        }\n\n        return -0.5 * (--k * (k - 2) - 1);\n      }\n    },\n    Cubic: {\n      In: function (k) {\n        return k * k * k;\n      },\n      Out: function (k) {\n        return --k * k * k + 1;\n      },\n      InOut: function (k) {\n        if ((k *= 2) < 1) {\n          return 0.5 * k * k * k;\n        }\n\n        return 0.5 * ((k -= 2) * k * k + 2);\n      }\n    },\n    Quartic: {\n      In: function (k) {\n        return k * k * k * k;\n      },\n      Out: function (k) {\n        return 1 - --k * k * k * k;\n      },\n      InOut: function (k) {\n        if ((k *= 2) < 1) {\n          return 0.5 * k * k * k * k;\n        }\n\n        return -0.5 * ((k -= 2) * k * k * k - 2);\n      }\n    },\n    Quintic: {\n      In: function (k) {\n        return k * k * k * k * k;\n      },\n      Out: function (k) {\n        return --k * k * k * k * k + 1;\n      },\n      InOut: function (k) {\n        if ((k *= 2) < 1) {\n          return 0.5 * k * k * k * k * k;\n        }\n\n        return 0.5 * ((k -= 2) * k * k * k * k + 2);\n      }\n    },\n    Sinusoidal: {\n      In: function (k) {\n        return 1 - Math.cos(k * Math.PI / 2);\n      },\n      Out: function (k) {\n        return Math.sin(k * Math.PI / 2);\n      },\n      InOut: function (k) {\n        return 0.5 * (1 - Math.cos(Math.PI * k));\n      }\n    },\n    Exponential: {\n      In: function (k) {\n        return k === 0 ? 0 : Math.pow(1024, k - 1);\n      },\n      Out: function (k) {\n        return k === 1 ? 1 : 1 - Math.pow(2, -10 * k);\n      },\n      InOut: function (k) {\n        if (k === 0) {\n          return 0;\n        }\n\n        if (k === 1) {\n          return 1;\n        }\n\n        if ((k *= 2) < 1) {\n          return 0.5 * Math.pow(1024, k - 1);\n        }\n\n        return 0.5 * (-Math.pow(2, -10 * (k - 1)) + 2);\n      }\n    },\n    Circular: {\n      In: function (k) {\n        return 1 - Math.sqrt(1 - k * k);\n      },\n      Out: function (k) {\n        return Math.sqrt(1 - --k * k);\n      },\n      InOut: function (k) {\n        if ((k *= 2) < 1) {\n          return -0.5 * (Math.sqrt(1 - k * k) - 1);\n        }\n\n        return 0.5 * (Math.sqrt(1 - (k -= 2) * k) + 1);\n      }\n    },\n    Elastic: {\n      In: function (k) {\n        if (k === 0) {\n          return 0;\n        }\n\n        if (k === 1) {\n          return 1;\n        }\n\n        return -Math.pow(2, 10 * (k - 1)) * Math.sin((k - 1.1) * 5 * Math.PI);\n      },\n      Out: function (k) {\n        if (k === 0) {\n          return 0;\n        }\n\n        if (k === 1) {\n          return 1;\n        }\n\n        return Math.pow(2, -10 * k) * Math.sin((k - 0.1) * 5 * Math.PI) + 1;\n      },\n      InOut: function (k) {\n        if (k === 0) {\n          return 0;\n        }\n\n        if (k === 1) {\n          return 1;\n        }\n\n        k *= 2;\n\n        if (k < 1) {\n          return -0.5 * Math.pow(2, 10 * (k - 1)) * Math.sin((k - 1.1) * 5 * Math.PI);\n        }\n\n        return 0.5 * Math.pow(2, -10 * (k - 1)) * Math.sin((k - 1.1) * 5 * Math.PI) + 1;\n      }\n    },\n    Back: {\n      In: function (k) {\n        var s = 1.70158;\n        return k * k * ((s + 1) * k - s);\n      },\n      Out: function (k) {\n        var s = 1.70158;\n        return --k * k * ((s + 1) * k + s) + 1;\n      },\n      InOut: function (k) {\n        var s = 1.70158 * 1.525;\n\n        if ((k *= 2) < 1) {\n          return 0.5 * (k * k * ((s + 1) * k - s));\n        }\n\n        return 0.5 * ((k -= 2) * k * ((s + 1) * k + s) + 2);\n      }\n    },\n    Bounce: {\n      In: function (k) {\n        return 1 - TWEEN.Easing.Bounce.Out(1 - k);\n      },\n      Out: function (k) {\n        if (k < 1 / 2.75) {\n          return 7.5625 * k * k;\n        } else if (k < 2 / 2.75) {\n          return 7.5625 * (k -= 1.5 / 2.75) * k + 0.75;\n        } else if (k < 2.5 / 2.75) {\n          return 7.5625 * (k -= 2.25 / 2.75) * k + 0.9375;\n        } else {\n          return 7.5625 * (k -= 2.625 / 2.75) * k + 0.984375;\n        }\n      },\n      InOut: function (k) {\n        if (k < 0.5) {\n          return TWEEN.Easing.Bounce.In(k * 2) * 0.5;\n        }\n\n        return TWEEN.Easing.Bounce.Out(k * 2 - 1) * 0.5 + 0.5;\n      }\n    }\n  };\n  TWEEN.Interpolation = {\n    Linear: function (v, k) {\n      var m = v.length - 1;\n      var f = m * k;\n      var i = Math.floor(f);\n      var fn = TWEEN.Interpolation.Utils.Linear;\n\n      if (k < 0) {\n        return fn(v[0], v[1], f);\n      }\n\n      if (k > 1) {\n        return fn(v[m], v[m - 1], m - f);\n      }\n\n      return fn(v[i], v[i + 1 > m ? m : i + 1], f - i);\n    },\n    Bezier: function (v, k) {\n      var b = 0;\n      var n = v.length - 1;\n      var pw = Math.pow;\n      var bn = TWEEN.Interpolation.Utils.Bernstein;\n\n      for (var i = 0; i <= n; i++) {\n        b += pw(1 - k, n - i) * pw(k, i) * v[i] * bn(n, i);\n      }\n\n      return b;\n    },\n    CatmullRom: function (v, k) {\n      var m = v.length - 1;\n      var f = m * k;\n      var i = Math.floor(f);\n      var fn = TWEEN.Interpolation.Utils.CatmullRom;\n\n      if (v[0] === v[m]) {\n        if (k < 0) {\n          i = Math.floor(f = m * (1 + k));\n        }\n\n        return fn(v[(i - 1 + m) % m], v[i], v[(i + 1) % m], v[(i + 2) % m], f - i);\n      } else {\n        if (k < 0) {\n          return v[0] - (fn(v[0], v[0], v[1], v[1], -f) - v[0]);\n        }\n\n        if (k > 1) {\n          return v[m] - (fn(v[m], v[m], v[m - 1], v[m - 1], f - m) - v[m]);\n        }\n\n        return fn(v[i ? i - 1 : 0], v[i], v[m < i + 1 ? m : i + 1], v[m < i + 2 ? m : i + 2], f - i);\n      }\n    },\n    Utils: {\n      Linear: function (p0, p1, t) {\n        return (p1 - p0) * t + p0;\n      },\n      Bernstein: function (n, i) {\n        var fc = TWEEN.Interpolation.Utils.Factorial;\n        return fc(n) / fc(i) / fc(n - i);\n      },\n      Factorial: function () {\n        var a = [1];\n        return function (n) {\n          var s = 1;\n\n          if (a[n]) {\n            return a[n];\n          }\n\n          for (var i = n; i > 1; i--) {\n            s *= i;\n          }\n\n          a[n] = s;\n          return s;\n        };\n      }(),\n      CatmullRom: function (p0, p1, p2, p3, t) {\n        var v0 = (p2 - p0) * 0.5;\n        var v1 = (p3 - p1) * 0.5;\n        var t2 = t * t;\n        var t3 = t * t2;\n        return (2 * p1 - 2 * p2 + v0 + v1) * t3 + (-3 * p1 + 3 * p2 - 2 * v0 - v1) * t2 + v0 * t + p1;\n      }\n    }\n  }; // UMD (Universal Module Definition)\n\n  (function (root) {\n    {\n      // Node.js\n      module.exports = TWEEN;\n    }\n  })();\n});\n/**\n * @classdesc Information spot attached to panorama\n * @constructor\n * @param {number} [scale=300] - Default scale\n * @param {string} [imageSrc=PANOLENS.DataImage.Info] - Image overlay info\n * @param {boolean} [animated=true] - Enable default hover animation\n */\n\nfunction Infospot(scale = 300, imageSrc, animated) {\n  const duration = 500,\n        scaleFactor = 1.3;\n  imageSrc = imageSrc || DataImage.Info;\n  Sprite.call(this);\n  this.type = 'infospot';\n  this.animated = animated !== undefined ? animated : true;\n  this.isHovering = false;\n  /*\n   * TODO: Three.js bug hotfix for sprite raycasting r104\n   * https://github.com/mrdoob/three.js/issues/14624\n   */\n\n  this.frustumCulled = false;\n  this.element = null;\n  this.toPanorama = null;\n  this.cursorStyle = null;\n  this.mode = MODES.NORMAL;\n  this.scale.set(scale, scale, 1);\n  this.rotation.y = Math.PI;\n  this.container = null;\n  this.originalRaycast = this.raycast; // Event Handler\n\n  this.HANDLER_FOCUS = null;\n  this.material.side = DoubleSide;\n  this.material.depthTest = false;\n  this.material.transparent = true;\n  this.material.opacity = 0;\n  this.scaleUpAnimation = new Tween.Tween();\n  this.scaleDownAnimation = new Tween.Tween();\n\n  const postLoad = function (texture) {\n    if (!this.material) {\n      return;\n    }\n\n    const ratio = texture.image.width / texture.image.height;\n    const textureScale = new Vector3();\n    texture.image.width = texture.image.naturalWidth || 64;\n    texture.image.height = texture.image.naturalHeight || 64;\n    this.scale.set(ratio * scale, scale, 1);\n    textureScale.copy(this.scale);\n    this.scaleUpAnimation = new Tween.Tween(this.scale).to({\n      x: textureScale.x * scaleFactor,\n      y: textureScale.y * scaleFactor\n    }, duration).easing(Tween.Easing.Elastic.Out);\n    this.scaleDownAnimation = new Tween.Tween(this.scale).to({\n      x: textureScale.x,\n      y: textureScale.y\n    }, duration).easing(Tween.Easing.Elastic.Out);\n    this.material.map = texture;\n    this.material.needsUpdate = true;\n  }.bind(this); // Add show and hide animations\n\n\n  this.showAnimation = new Tween.Tween(this.material).to({\n    opacity: 1\n  }, duration).onStart(this.enableRaycast.bind(this, true)).easing(Tween.Easing.Quartic.Out);\n  this.hideAnimation = new Tween.Tween(this.material).to({\n    opacity: 0\n  }, duration).onStart(this.enableRaycast.bind(this, false)).easing(Tween.Easing.Quartic.Out); // Attach event listeners\n\n  this.addEventListener('click', this.onClick);\n  this.addEventListener('hover', this.onHover);\n  this.addEventListener('hoverenter', this.onHoverStart);\n  this.addEventListener('hoverleave', this.onHoverEnd);\n  this.addEventListener('panolens-dual-eye-effect', this.onDualEyeEffect);\n  this.addEventListener('panolens-container', this.setContainer.bind(this));\n  this.addEventListener('dismiss', this.onDismiss);\n  this.addEventListener('panolens-infospot-focus', this.setFocusMethod);\n  TextureLoader.load(imageSrc, postLoad);\n}\n\nInfospot.prototype = Object.assign(Object.create(Sprite.prototype), {\n  constructor: Infospot,\n\n  /**\n   * Set infospot container\n   * @param {HTMLElement|object} data - Data with container information\n   * @memberOf Infospot\n   * @instance\n   */\n  setContainer: function (data) {\n    let container;\n\n    if (data instanceof HTMLElement) {\n      container = data;\n    } else if (data && data.container) {\n      container = data.container;\n    } // Append element if exists\n\n\n    if (container && this.element) {\n      container.appendChild(this.element);\n    }\n\n    this.container = container;\n  },\n\n  /**\n   * Get container\n   * @memberOf Infospot\n   * @instance\n   * @return {HTMLElement} - The container of this infospot\n   */\n  getContainer: function () {\n    return this.container;\n  },\n\n  /**\n   * This will be called by a click event\n   * Translate and lock the hovering element if any\n   * @param  {object} event - Event containing mouseEvent with clientX and clientY\n   * @memberOf Infospot\n   * @instance\n   */\n  onClick: function (event) {\n    if (this.element && this.getContainer()) {\n      this.onHoverStart(event); // Lock element\n\n      this.lockHoverElement();\n    }\n  },\n\n  /**\n   * Dismiss current element if any\n   * @param  {object} event - Dismiss event\n   * @memberOf Infospot\n   * @instance\n   */\n  onDismiss: function () {\n    if (this.element) {\n      this.unlockHoverElement();\n      this.onHoverEnd();\n    }\n  },\n\n  /**\n   * This will be called by a mouse hover event\n   * Translate the hovering element if any\n   * @param  {object} event - Event containing mouseEvent with clientX and clientY\n   * @memberOf Infospot\n   * @instance\n   */\n  onHover: function () {},\n\n  /**\n   * This will be called on a mouse hover start\n   * Sets cursor style to 'pointer', display the element and scale up the infospot\n   * @param {object} event\n   * @memberOf Infospot\n   * @instance\n   */\n  onHoverStart: function (event) {\n    if (!this.getContainer()) {\n      return;\n    }\n\n    const cursorStyle = this.cursorStyle || (this.mode === MODES.NORMAL ? 'pointer' : 'default');\n    const {\n      scaleDownAnimation,\n      scaleUpAnimation,\n      element\n    } = this;\n    this.isHovering = true;\n    this.container.style.cursor = cursorStyle;\n\n    if (this.animated) {\n      scaleDownAnimation.stop();\n      scaleUpAnimation.start();\n    }\n\n    if (element && event.mouseEvent.clientX >= 0 && event.mouseEvent.clientY >= 0) {\n      const {\n        left,\n        right,\n        style\n      } = element;\n\n      if (this.mode === MODES.CARDBOARD || this.mode === MODES.STEREO) {\n        style.display = 'none';\n        left.style.display = 'block';\n        right.style.display = 'block'; // Store element width for reference\n\n        element._width = left.clientWidth;\n        element._height = left.clientHeight;\n      } else {\n        style.display = 'block';\n\n        if (left) {\n          left.style.display = 'none';\n        }\n\n        if (right) {\n          right.style.display = 'none';\n        } // Store element width for reference\n\n\n        element._width = element.clientWidth;\n        element._height = element.clientHeight;\n      }\n    }\n  },\n\n  /**\n   * This will be called on a mouse hover end\n   * Sets cursor style to 'default', hide the element and scale down the infospot\n   * @memberOf Infospot\n   * @instance\n   */\n  onHoverEnd: function () {\n    if (!this.getContainer()) {\n      return;\n    }\n\n    const {\n      scaleDownAnimation,\n      scaleUpAnimation,\n      element\n    } = this;\n    this.isHovering = false;\n    this.container.style.cursor = 'default';\n\n    if (this.animated) {\n      scaleUpAnimation.stop();\n      scaleDownAnimation.start();\n    }\n\n    if (element && !this.element.locked) {\n      const {\n        left,\n        right,\n        style\n      } = element;\n      style.display = 'none';\n\n      if (left) {\n        left.style.display = 'none';\n      }\n\n      if (right) {\n        right.style.display = 'none';\n      }\n\n      this.unlockHoverElement();\n    }\n  },\n\n  /**\n   * On dual eye effect handler\n   * Creates duplicate left and right element\n   * @param  {object} event - panolens-dual-eye-effect event\n   * @memberOf Infospot\n   * @instance\n   */\n  onDualEyeEffect: function (event) {\n    if (!this.getContainer()) {\n      return;\n    }\n\n    let element, halfWidth, halfHeight;\n    this.mode = event.mode;\n    element = this.element;\n    halfWidth = this.container.clientWidth / 2;\n    halfHeight = this.container.clientHeight / 2;\n\n    if (!element) {\n      return;\n    }\n\n    if (!element.left && !element.right) {\n      element.left = element.cloneNode(true);\n      element.right = element.cloneNode(true);\n    }\n\n    if (this.mode === MODES.CARDBOARD || this.mode === MODES.STEREO) {\n      element.left.style.display = element.style.display;\n      element.right.style.display = element.style.display;\n      element.style.display = 'none';\n    } else {\n      element.style.display = element.left.style.display;\n      element.left.style.display = 'none';\n      element.right.style.display = 'none';\n    } // Update elements translation\n\n\n    this.translateElement(halfWidth, halfHeight);\n    this.container.appendChild(element.left);\n    this.container.appendChild(element.right);\n  },\n\n  /**\n   * Translate the hovering element by css transform\n   * @param  {number} x - X position on the window screen\n   * @param  {number} y - Y position on the window screen\n   * @memberOf Infospot\n   * @instance\n   */\n  translateElement: function (x, y) {\n    if (!this.element._width || !this.element._height || !this.getContainer()) {\n      return;\n    }\n\n    let left, top, element, width, height, delta, container;\n    container = this.container;\n    element = this.element;\n    width = element._width / 2;\n    height = element._height / 2;\n    delta = element.verticalDelta !== undefined ? element.verticalDelta : 40;\n    left = x - width;\n    top = y - height - delta;\n\n    if ((this.mode === MODES.CARDBOARD || this.mode === MODES.STEREO) && element.left && element.right && !(x === container.clientWidth / 2 && y === container.clientHeight / 2)) {\n      left = container.clientWidth / 4 - width + (x - container.clientWidth / 2);\n      top = container.clientHeight / 2 - height - delta + (y - container.clientHeight / 2);\n      this.setElementStyle('transform', element.left, 'translate(' + left + 'px, ' + top + 'px)');\n      left += container.clientWidth / 2;\n      this.setElementStyle('transform', element.right, 'translate(' + left + 'px, ' + top + 'px)');\n    } else {\n      this.setElementStyle('transform', element, 'translate(' + left + 'px, ' + top + 'px)');\n    }\n  },\n\n  /**\n   * Set vendor specific css\n   * @param {string} type - CSS style name\n   * @param {HTMLElement} element - The element to be modified\n   * @param {string} value - Style value\n   * @memberOf Infospot\n   * @instance\n   */\n  setElementStyle: function (type, element, value) {\n    const style = element.style;\n\n    if (type === 'transform') {\n      style.webkitTransform = style.msTransform = style.transform = value;\n    }\n  },\n\n  /**\n   * Set hovering text content\n   * @param {string} text - Text to be displayed\n   * @memberOf Infospot\n   * @instance\n   */\n  setText: function (text) {\n    if (this.element) {\n      this.element.textContent = text;\n    }\n  },\n\n  /**\n   * Set cursor css style on hover\n   * @memberOf Infospot\n   * @instance\n   */\n  setCursorHoverStyle: function (style) {\n    this.cursorStyle = style;\n  },\n\n  /**\n   * Add hovering text element\n   * @param {string} text - Text to be displayed\n   * @param {number} [delta=40] - Vertical delta to the infospot\n   * @memberOf Infospot\n   * @instance\n   */\n  addHoverText: function (text, delta = 40) {\n    if (!this.element) {\n      this.element = document.createElement('div');\n      this.element.style.display = 'none';\n      this.element.style.color = '#fff';\n      this.element.style.top = 0;\n      this.element.style.maxWidth = '50%';\n      this.element.style.maxHeight = '50%';\n      this.element.style.textShadow = '0 0 3px #000000';\n      this.element.style.fontFamily = '\"Trebuchet MS\", Helvetica, sans-serif';\n      this.element.style.position = 'absolute';\n      this.element.classList.add('panolens-infospot');\n      this.element.verticalDelta = delta;\n    }\n\n    this.setText(text);\n  },\n\n  /**\n   * Add hovering element by cloning an element\n   * @param {HTMLDOMElement} el - Element to be cloned and displayed\n   * @param {number} [delta=40] - Vertical delta to the infospot\n   * @memberOf Infospot\n   * @instance\n   */\n  addHoverElement: function (el, delta = 40) {\n    if (!this.element) {\n      this.element = el.cloneNode(true);\n      this.element.style.display = 'none';\n      this.element.style.top = 0;\n      this.element.style.position = 'absolute';\n      this.element.classList.add('panolens-infospot');\n      this.element.verticalDelta = delta;\n    }\n  },\n\n  /**\n   * Remove hovering element\n   * @memberOf Infospot\n   * @instance\n   */\n  removeHoverElement: function () {\n    if (this.element) {\n      if (this.element.left) {\n        this.container.removeChild(this.element.left);\n        this.element.left = null;\n      }\n\n      if (this.element.right) {\n        this.container.removeChild(this.element.right);\n        this.element.right = null;\n      }\n\n      this.container.removeChild(this.element);\n      this.element = null;\n    }\n  },\n\n  /**\n   * Lock hovering element\n   * @memberOf Infospot\n   * @instance\n   */\n  lockHoverElement: function () {\n    if (this.element) {\n      this.element.locked = true;\n    }\n  },\n\n  /**\n   * Unlock hovering element\n   * @memberOf Infospot\n   * @instance\n   */\n  unlockHoverElement: function () {\n    if (this.element) {\n      this.element.locked = false;\n    }\n  },\n\n  /**\n   * Enable raycasting\n   * @param {boolean} [enabled=true]\n   * @memberOf Infospot\n   * @instance\n   */\n  enableRaycast: function (enabled = true) {\n    if (enabled) {\n      this.raycast = this.originalRaycast;\n    } else {\n      this.raycast = () => {};\n    }\n  },\n\n  /**\n   * Show infospot\n   * @param  {number} [delay=0] - Delay time to show\n   * @memberOf Infospot\n   * @instance\n   */\n  show: function (delay = 0) {\n    const {\n      animated,\n      hideAnimation,\n      showAnimation,\n      material\n    } = this;\n\n    if (animated) {\n      hideAnimation.stop();\n      showAnimation.delay(delay).start();\n    } else {\n      this.enableRaycast(true);\n      material.opacity = 1;\n    }\n  },\n\n  /**\n   * Hide infospot\n   * @param  {number} [delay=0] - Delay time to hide\n   * @memberOf Infospot\n   * @instance\n   */\n  hide: function (delay = 0) {\n    const {\n      animated,\n      hideAnimation,\n      showAnimation,\n      material,\n      element\n    } = this;\n\n    if (element) {\n      const {\n        style\n      } = element;\n      style.display = 'none';\n    }\n\n    if (animated) {\n      showAnimation.stop();\n      hideAnimation.delay(delay).start();\n    } else {\n      this.enableRaycast(false);\n      material.opacity = 0;\n    }\n  },\n\n  /**\n   * Set focus event handler\n   * @memberOf Infospot\n   * @instance\n   */\n  setFocusMethod: function (event) {\n    if (event) {\n      this.HANDLER_FOCUS = event.method;\n    }\n  },\n\n  /**\n   * Focus camera center to this infospot\n   * @param {number} [duration=1000] - Duration to tween\n   * @param {function} [easing=TWEEN.Easing.Exponential.Out] - Easing function\n   * @memberOf Infospot\n   * @instance\n   */\n  focus: function (duration, easing) {\n    if (this.HANDLER_FOCUS) {\n      this.HANDLER_FOCUS(this.position, duration, easing);\n      this.onDismiss();\n    }\n  },\n\n  /**\n   * Dispose\n   * @memberOf Infospot\n   * @instance\n   */\n  dispose: function () {\n    const {\n      geometry,\n      material\n    } = this;\n    const {\n      map\n    } = material;\n    this.removeHoverElement();\n\n    if (this.parent) {\n      this.parent.remove(this);\n    }\n\n    if (map) {\n      map.dispose();\n      material.map = null;\n    }\n\n    if (geometry) {\n      geometry.dispose();\n      this.geometry = null;\n    }\n\n    if (material) {\n      material.dispose();\n      this.material = null;\n    }\n  }\n});\n/**\n * @classdesc Widget for controls\n * @constructor\n * @param {HTMLElement} container - A domElement where default control widget will be attached to\n */\n\nfunction Widget(container) {\n  if (!container) {\n    console.warn('PANOLENS.Widget: No container specified');\n  }\n\n  EventDispatcher.call(this);\n  this.DEFAULT_TRANSITION = 'all 0.27s ease';\n  this.TOUCH_ENABLED = !!('ontouchstart' in window || window.DocumentTouch && document instanceof DocumentTouch);\n\n  this.PREVENT_EVENT_HANDLER = function (event) {\n    event.preventDefault();\n    event.stopPropagation();\n  };\n\n  this.container = container;\n  this.barElement = null;\n  this.fullscreenElement = null;\n  this.videoElement = null;\n  this.settingElement = null;\n  this.mainMenu = null;\n  this.activeMainItem = null;\n  this.activeSubMenu = null;\n  this.mask = null;\n}\n\nWidget.prototype = Object.assign(Object.create(EventDispatcher.prototype), {\n  constructor: Widget,\n\n  /**\n   * Add control bar\n   * @memberOf Widget\n   * @instance\n   */\n  addControlBar: function () {\n    if (!this.container) {\n      console.warn('Widget container not set');\n      return;\n    }\n\n    var scope = this,\n        bar,\n        styleTranslate,\n        styleOpacity,\n        gradientStyle;\n    gradientStyle = 'linear-gradient(bottom, rgba(0,0,0,0.2), rgba(0,0,0,0))';\n    bar = document.createElement('div');\n    bar.style.width = '100%';\n    bar.style.height = '44px';\n    bar.style.float = 'left';\n    bar.style.transform = bar.style.webkitTransform = bar.style.msTransform = 'translateY(-100%)';\n    bar.style.background = '-webkit-' + gradientStyle;\n    bar.style.background = '-moz-' + gradientStyle;\n    bar.style.background = '-o-' + gradientStyle;\n    bar.style.background = '-ms-' + gradientStyle;\n    bar.style.background = gradientStyle;\n    bar.style.transition = this.DEFAULT_TRANSITION;\n    bar.style.pointerEvents = 'none';\n    bar.isHidden = false;\n\n    bar.toggle = function () {\n      bar.isHidden = !bar.isHidden;\n      styleTranslate = bar.isHidden ? 'translateY(0)' : 'translateY(-100%)';\n      styleOpacity = bar.isHidden ? 0 : 1;\n      bar.style.transform = bar.style.webkitTransform = bar.style.msTransform = styleTranslate;\n      bar.style.opacity = styleOpacity;\n    }; // Menu\n\n\n    var menu = this.createDefaultMenu();\n    this.mainMenu = this.createMainMenu(menu);\n    bar.appendChild(this.mainMenu); // Mask\n\n    var mask = this.createMask();\n    this.mask = mask;\n    this.container.appendChild(mask); // Dispose\n\n    bar.dispose = function () {\n      if (scope.fullscreenElement) {\n        bar.removeChild(scope.fullscreenElement);\n        scope.fullscreenElement.dispose();\n        scope.fullscreenElement = null;\n      }\n\n      if (scope.settingElement) {\n        bar.removeChild(scope.settingElement);\n        scope.settingElement.dispose();\n        scope.settingElement = null;\n      }\n\n      if (scope.videoElement) {\n        bar.removeChild(scope.videoElement);\n        scope.videoElement.dispose();\n        scope.videoElement = null;\n      }\n    };\n\n    this.container.appendChild(bar); // Mask events\n\n    this.mask.addEventListener('mousemove', this.PREVENT_EVENT_HANDLER, true);\n    this.mask.addEventListener('mouseup', this.PREVENT_EVENT_HANDLER, true);\n    this.mask.addEventListener('mousedown', this.PREVENT_EVENT_HANDLER, true);\n    this.mask.addEventListener(scope.TOUCH_ENABLED ? 'touchend' : 'click', function (event) {\n      event.preventDefault();\n      event.stopPropagation();\n      scope.mask.hide();\n      scope.settingElement.deactivate();\n    }, false); // Event listener\n\n    this.addEventListener('control-bar-toggle', bar.toggle);\n    this.barElement = bar;\n  },\n\n  /**\n   * Create default menu\n   * @memberOf Widget\n   * @instance\n   */\n  createDefaultMenu: function () {\n    var scope = this,\n        handler;\n\n    handler = function (method, data) {\n      return function () {\n        scope.dispatchEvent({\n          type: 'panolens-viewer-handler',\n          method: method,\n          data: data\n        });\n      };\n    };\n\n    return [{\n      title: 'Control',\n      subMenu: [{\n        title: this.TOUCH_ENABLED ? 'Touch' : 'Mouse',\n        handler: handler('enableControl', CONTROLS.ORBIT)\n      }, {\n        title: 'Sensor',\n        handler: handler('enableControl', CONTROLS.DEVICEORIENTATION)\n      }]\n    }, {\n      title: 'Mode',\n      subMenu: [{\n        title: 'Normal',\n        handler: handler('disableEffect')\n      }, {\n        title: 'Cardboard',\n        handler: handler('enableEffect', MODES.CARDBOARD)\n      }, {\n        title: 'Stereoscopic',\n        handler: handler('enableEffect', MODES.STEREO)\n      }]\n    }];\n  },\n\n  /**\n   * Add buttons on top of control bar\n   * @param {string} name - The control button name to be created\n   * @memberOf Widget\n   * @instance\n   */\n  addControlButton: function (name) {\n    let element;\n\n    switch (name) {\n      case 'fullscreen':\n        element = this.createFullscreenButton();\n        this.fullscreenElement = element;\n        break;\n\n      case 'setting':\n        element = this.createSettingButton();\n        this.settingElement = element;\n        break;\n\n      case 'video':\n        element = this.createVideoControl();\n        this.videoElement = element;\n        break;\n\n      default:\n        return;\n    }\n\n    if (!element) {\n      return;\n    }\n\n    this.barElement.appendChild(element);\n  },\n\n  /**\n   * Create modal mask\n   * @memberOf Widget\n   * @instance\n   */\n  createMask: function () {\n    const element = document.createElement('div');\n    element.style.position = 'absolute';\n    element.style.top = 0;\n    element.style.left = 0;\n    element.style.width = '100%';\n    element.style.height = '100%';\n    element.style.background = 'transparent';\n    element.style.display = 'none';\n\n    element.show = function () {\n      this.style.display = 'block';\n    };\n\n    element.hide = function () {\n      this.style.display = 'none';\n    };\n\n    return element;\n  },\n\n  /**\n   * Create Setting button to toggle menu\n   * @memberOf Widget\n   * @instance\n   */\n  createSettingButton: function () {\n    let scope = this,\n        item;\n\n    function onTap(event) {\n      event.preventDefault();\n      event.stopPropagation();\n      scope.mainMenu.toggle();\n\n      if (this.activated) {\n        this.deactivate();\n      } else {\n        this.activate();\n      }\n    }\n\n    item = this.createCustomItem({\n      style: {\n        backgroundImage: 'url(\"' + DataImage.Setting + '\")',\n        webkitTransition: this.DEFAULT_TRANSITION,\n        transition: this.DEFAULT_TRANSITION\n      },\n      onTap: onTap\n    });\n\n    item.activate = function () {\n      this.style.transform = 'rotate3d(0,0,1,90deg)';\n      this.activated = true;\n      scope.mask.show();\n    };\n\n    item.deactivate = function () {\n      this.style.transform = 'rotate3d(0,0,0,0)';\n      this.activated = false;\n      scope.mask.hide();\n\n      if (scope.mainMenu && scope.mainMenu.visible) {\n        scope.mainMenu.hide();\n      }\n\n      if (scope.activeSubMenu && scope.activeSubMenu.visible) {\n        scope.activeSubMenu.hide();\n      }\n\n      if (scope.mainMenu && scope.mainMenu._width) {\n        scope.mainMenu.changeSize(scope.mainMenu._width);\n        scope.mainMenu.unslideAll();\n      }\n    };\n\n    item.activated = false;\n    return item;\n  },\n\n  /**\n   * Create Fullscreen button\n   * @return {HTMLSpanElement} - The dom element icon for fullscreen\n   * @memberOf Widget\n   * @instance\n   * @fires Widget#panolens-viewer-handler\n   */\n  createFullscreenButton: function () {\n    let scope = this,\n        item,\n        isFullscreen = false,\n        tapSkipped = true,\n        stylesheetId;\n    const {\n      container\n    } = this;\n    stylesheetId = 'panolens-style-addon'; // Don't create button if no support\n\n    if (!document.fullscreenEnabled && !document.webkitFullscreenEnabled && !document.mozFullScreenEnabled && !document.msFullscreenEnabled) {\n      return;\n    }\n\n    function onTap(event) {\n      event.preventDefault();\n      event.stopPropagation();\n      tapSkipped = false;\n\n      if (!isFullscreen) {\n        if (container.requestFullscreen) {\n          container.requestFullscreen();\n        }\n\n        if (container.msRequestFullscreen) {\n          container.msRequestFullscreen();\n        }\n\n        if (container.mozRequestFullScreen) {\n          container.mozRequestFullScreen();\n        }\n\n        if (container.webkitRequestFullscreen) {\n          container.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT);\n        }\n\n        isFullscreen = true;\n      } else {\n        if (document.exitFullscreen) {\n          document.exitFullscreen();\n        }\n\n        if (document.msExitFullscreen) {\n          document.msExitFullscreen();\n        }\n\n        if (document.mozCancelFullScreen) {\n          document.mozCancelFullScreen();\n        }\n\n        if (document.webkitExitFullscreen) {\n          document.webkitExitFullscreen();\n        }\n\n        isFullscreen = false;\n      }\n\n      this.style.backgroundImage = isFullscreen ? 'url(\"' + DataImage.FullscreenLeave + '\")' : 'url(\"' + DataImage.FullscreenEnter + '\")';\n    }\n\n    function onFullScreenChange() {\n      if (tapSkipped) {\n        isFullscreen = !isFullscreen;\n        item.style.backgroundImage = isFullscreen ? 'url(\"' + DataImage.FullscreenLeave + '\")' : 'url(\"' + DataImage.FullscreenEnter + '\")';\n      }\n      /**\n       * Viewer handler event\n       * @type {object}\n       * @event Widget#panolens-viewer-handler\n       * @property {string} method - 'onWindowResize' function call on Viewer\n       */\n\n\n      scope.dispatchEvent({\n        type: 'panolens-viewer-handler',\n        method: 'onWindowResize'\n      });\n      tapSkipped = true;\n    }\n\n    document.addEventListener('fullscreenchange', onFullScreenChange, false);\n    document.addEventListener('webkitfullscreenchange', onFullScreenChange, false);\n    document.addEventListener('mozfullscreenchange', onFullScreenChange, false);\n    document.addEventListener('MSFullscreenChange', onFullScreenChange, false);\n    item = this.createCustomItem({\n      style: {\n        backgroundImage: 'url(\"' + DataImage.FullscreenEnter + '\")'\n      },\n      onTap: onTap\n    }); // Add fullscreen stlye if not exists\n\n    if (!document.querySelector(stylesheetId)) {\n      const sheet = document.createElement('style');\n      sheet.id = stylesheetId;\n      sheet.innerHTML = ':-webkit-full-screen { width: 100% !important; height: 100% !important }';\n      document.body.appendChild(sheet);\n    }\n\n    return item;\n  },\n\n  /**\n   * Create video control container\n   * @memberOf Widget\n   * @instance\n   * @return {HTMLSpanElement} - The dom element icon for video control\n   */\n  createVideoControl: function () {\n    const item = document.createElement('span');\n    item.style.display = 'none';\n\n    item.show = function () {\n      item.style.display = '';\n    };\n\n    item.hide = function () {\n      item.style.display = 'none';\n      item.controlButton.paused = true;\n      item.controlButton.update();\n    };\n\n    item.controlButton = this.createVideoControlButton();\n    item.seekBar = this.createVideoControlSeekbar();\n    item.appendChild(item.controlButton);\n    item.appendChild(item.seekBar);\n\n    item.dispose = function () {\n      item.removeChild(item.controlButton);\n      item.removeChild(item.seekBar);\n      item.controlButton.dispose();\n      item.controlButton = null;\n      item.seekBar.dispose();\n      item.seekBar = null;\n    };\n\n    this.addEventListener('video-control-show', item.show);\n    this.addEventListener('video-control-hide', item.hide);\n    return item;\n  },\n\n  /**\n   * Create video control button\n   * @memberOf Widget\n   * @instance\n   * @return {HTMLSpanElement} - The dom element icon for video control\n   * @fires Widget#panolens-viewer-handler\n   */\n  createVideoControlButton: function () {\n    const scope = this;\n\n    function onTap(event) {\n      event.preventDefault();\n      event.stopPropagation();\n      /**\n       * Viewer handler event\n       * @type {object}\n       * @event Widget#panolens-viewer-handler\n       * @property {string} method - 'toggleVideoPlay' function call on Viewer\n       */\n\n      scope.dispatchEvent({\n        type: 'panolens-viewer-handler',\n        method: 'toggleVideoPlay',\n        data: !this.paused\n      });\n      this.paused = !this.paused;\n      item.update();\n    }\n\n    const item = this.createCustomItem({\n      style: {\n        float: 'left',\n        backgroundImage: 'url(\"' + DataImage.VideoPlay + '\")'\n      },\n      onTap: onTap\n    });\n    item.paused = true;\n\n    item.update = function (paused) {\n      this.paused = paused !== undefined ? paused : this.paused;\n      this.style.backgroundImage = 'url(\"' + (this.paused ? DataImage.VideoPlay : DataImage.VideoPause) + '\")';\n    };\n\n    return item;\n  },\n\n  /**\n   * Create video seekbar\n   * @memberOf Widget\n   * @instance\n   * @return {HTMLSpanElement} - The dom element icon for video seekbar\n   * @fires Widget#panolens-viewer-handler\n   */\n  createVideoControlSeekbar: function () {\n    let scope = this,\n        item,\n        progressElement,\n        progressElementControl,\n        isDragging = false,\n        mouseX,\n        percentageNow,\n        percentageNext;\n    progressElement = document.createElement('div');\n    progressElement.style.width = '0%';\n    progressElement.style.height = '100%';\n    progressElement.style.backgroundColor = '#fff';\n    progressElementControl = document.createElement('div');\n    progressElementControl.style.float = 'right';\n    progressElementControl.style.width = '14px';\n    progressElementControl.style.height = '14px';\n    progressElementControl.style.transform = 'translate(7px, -5px)';\n    progressElementControl.style.borderRadius = '50%';\n    progressElementControl.style.backgroundColor = '#ddd';\n    progressElementControl.addEventListener('mousedown', onMouseDown, {\n      passive: true\n    });\n    progressElementControl.addEventListener('touchstart', onMouseDown, {\n      passive: true\n    });\n\n    function onMouseDown(event) {\n      event.stopPropagation();\n      isDragging = true;\n      mouseX = event.clientX || event.changedTouches && event.changedTouches[0].clientX;\n      percentageNow = parseInt(progressElement.style.width) / 100;\n      addControlListeners();\n    }\n\n    function onVideoControlDrag(event) {\n      if (isDragging) {\n        const clientX = event.clientX || event.changedTouches && event.changedTouches[0].clientX;\n        percentageNext = (clientX - mouseX) / item.clientWidth;\n        percentageNext = percentageNow + percentageNext;\n        percentageNext = percentageNext > 1 ? 1 : percentageNext < 0 ? 0 : percentageNext;\n        item.setProgress(percentageNext);\n        /**\n         * Viewer handler event\n         * @type {object}\n         * @event Widget#panolens-viewer-handler\n         * @property {string} method - 'setVideoCurrentTime' function call on Viewer\n         * @property {number} data - Percentage of current video. Range from 0.0 to 1.0\n         */\n\n        scope.dispatchEvent({\n          type: 'panolens-viewer-handler',\n          method: 'setVideoCurrentTime',\n          data: percentageNext\n        });\n      }\n    }\n\n    function onVideoControlStop(event) {\n      event.stopPropagation();\n      isDragging = false;\n      removeControlListeners();\n    }\n\n    function addControlListeners() {\n      scope.container.addEventListener('mousemove', onVideoControlDrag, {\n        passive: true\n      });\n      scope.container.addEventListener('mouseup', onVideoControlStop, {\n        passive: true\n      });\n      scope.container.addEventListener('touchmove', onVideoControlDrag, {\n        passive: true\n      });\n      scope.container.addEventListener('touchend', onVideoControlStop, {\n        passive: true\n      });\n    }\n\n    function removeControlListeners() {\n      scope.container.removeEventListener('mousemove', onVideoControlDrag, false);\n      scope.container.removeEventListener('mouseup', onVideoControlStop, false);\n      scope.container.removeEventListener('touchmove', onVideoControlDrag, false);\n      scope.container.removeEventListener('touchend', onVideoControlStop, false);\n    }\n\n    function onTap(event) {\n      event.preventDefault();\n      event.stopPropagation();\n\n      if (event.target === progressElementControl) {\n        return;\n      }\n\n      const percentage = event.changedTouches && event.changedTouches.length > 0 ? (event.changedTouches[0].pageX - event.target.getBoundingClientRect().left) / this.clientWidth : event.offsetX / this.clientWidth;\n      /**\n       * Viewer handler event\n       * @type {object}\n       * @property {string} method - 'setVideoCurrentTime' function call on Viewer\n       * @property {number} data - Percentage of current video. Range from 0.0 to 1.0\n       */\n\n      scope.dispatchEvent({\n        type: 'panolens-viewer-handler',\n        method: 'setVideoCurrentTime',\n        data: percentage\n      });\n      item.setProgress(event.offsetX / this.clientWidth);\n    }\n\n    function onDispose() {\n      removeControlListeners();\n      progressElement = null;\n      progressElementControl = null;\n    }\n\n    progressElement.appendChild(progressElementControl);\n    item = this.createCustomItem({\n      style: {\n        float: 'left',\n        width: '30%',\n        height: '4px',\n        marginTop: '20px',\n        backgroundColor: 'rgba(188,188,188,0.8)'\n      },\n      onTap: onTap,\n      onDispose: onDispose\n    });\n    item.appendChild(progressElement);\n\n    item.setProgress = function (percentage) {\n      progressElement.style.width = percentage * 100 + '%';\n    };\n\n    this.addEventListener('video-update', function (event) {\n      item.setProgress(event.percentage);\n    });\n    item.progressElement = progressElement;\n    item.progressElementControl = progressElementControl;\n    return item;\n  },\n\n  /**\n   * Create menu item\n   * @param  {string} title - Title to display\n   * @memberOf Widget\n   * @instance\n   * @return {HTMLElement} - An anchor tag element\n   */\n  createMenuItem: function (title) {\n    const scope = this;\n    const item = document.createElement('a');\n    item.textContent = title;\n    item.style.display = 'block';\n    item.style.padding = '10px';\n    item.style.textDecoration = 'none';\n    item.style.cursor = 'pointer';\n    item.style.pointerEvents = 'auto';\n    item.style.transition = this.DEFAULT_TRANSITION;\n\n    item.slide = function (right) {\n      this.style.transform = 'translateX(' + (right ? '' : '-') + '100%)';\n    };\n\n    item.unslide = function () {\n      this.style.transform = 'translateX(0)';\n    };\n\n    item.setIcon = function (url) {\n      if (this.icon) {\n        this.icon.style.backgroundImage = 'url(' + url + ')';\n      }\n    };\n\n    item.setSelectionTitle = function (title) {\n      if (this.selection) {\n        this.selection.textContent = title;\n      }\n    };\n\n    item.addSelection = function (name) {\n      const selection = document.createElement('span');\n      selection.style.fontSize = '13px';\n      selection.style.fontWeight = '300';\n      selection.style.float = 'right';\n      this.selection = selection;\n      this.setSelectionTitle(name);\n      this.appendChild(selection);\n      return this;\n    };\n\n    item.addIcon = function (url = DataImage.ChevronRight, left = false, flip = false) {\n      const element = document.createElement('span');\n      element.style.float = left ? 'left' : 'right';\n      element.style.width = '17px';\n      element.style.height = '17px';\n      element.style['margin' + (left ? 'Right' : 'Left')] = '12px';\n      element.style.backgroundSize = 'cover';\n\n      if (flip) {\n        element.style.transform = 'rotateZ(180deg)';\n      }\n\n      this.icon = element;\n      this.setIcon(url);\n      this.appendChild(element);\n      return this;\n    };\n\n    item.addSubMenu = function (title, items) {\n      this.subMenu = scope.createSubMenu(title, items);\n      return this;\n    };\n\n    item.addEventListener('mouseenter', function () {\n      this.style.backgroundColor = '#e0e0e0';\n    }, false);\n    item.addEventListener('mouseleave', function () {\n      this.style.backgroundColor = '#fafafa';\n    }, false);\n    return item;\n  },\n\n  /**\n   * Create menu item header\n   * @param  {string} title - Title to display\n   * @memberOf Widget\n   * @instance\n   * @return {HTMLElement} - An anchor tag element\n   */\n  createMenuItemHeader: function (title) {\n    const header = this.createMenuItem(title);\n    header.style.borderBottom = '1px solid #333';\n    header.style.paddingBottom = '15px';\n    return header;\n  },\n\n  /**\n   * Create main menu\n   * @param  {array} menus - Menu array list\n   * @memberOf Widget\n   * @instance\n   * @return {HTMLElement} - A span element\n   */\n  createMainMenu: function (menus) {\n    let scope = this,\n        menu = this.createMenu();\n    menu._width = 200;\n    menu.changeSize(menu._width);\n\n    function onTap(event) {\n      event.preventDefault();\n      event.stopPropagation();\n      let mainMenu = scope.mainMenu,\n          subMenu = this.subMenu;\n\n      function onNextTick() {\n        mainMenu.changeSize(subMenu.clientWidth);\n        subMenu.show();\n        subMenu.unslideAll();\n      }\n\n      mainMenu.hide();\n      mainMenu.slideAll();\n      mainMenu.parentElement.appendChild(subMenu);\n      scope.activeMainItem = this;\n      scope.activeSubMenu = subMenu;\n      window.requestAnimationFrame(onNextTick);\n    }\n\n    for (var i = 0; i < menus.length; i++) {\n      var item = menu.addItem(menus[i].title);\n      item.style.paddingLeft = '20px';\n      item.addIcon().addEventListener(scope.TOUCH_ENABLED ? 'touchend' : 'click', onTap, false);\n\n      if (menus[i].subMenu && menus[i].subMenu.length > 0) {\n        var title = menus[i].subMenu[0].title;\n        item.addSelection(title).addSubMenu(menus[i].title, menus[i].subMenu);\n      }\n    }\n\n    return menu;\n  },\n\n  /**\n   * Create sub menu\n   * @param {string} title - Sub menu title\n   * @param {array} items - Item array list\n   * @memberOf Widget\n   * @instance\n   * @return {HTMLElement} - A span element\n   */\n  createSubMenu: function (title, items) {\n    let scope = this,\n        menu,\n        subMenu = this.createMenu();\n    subMenu.items = items;\n    subMenu.activeItem = null;\n\n    function onTap(event) {\n      event.preventDefault();\n      event.stopPropagation();\n      menu = scope.mainMenu;\n      menu.changeSize(menu._width);\n      menu.unslideAll();\n      menu.show();\n      subMenu.slideAll(true);\n      subMenu.hide();\n\n      if (this.type !== 'header') {\n        subMenu.setActiveItem(this);\n        scope.activeMainItem.setSelectionTitle(this.textContent);\n\n        if (this.handler) {\n          this.handler();\n        }\n      }\n    }\n\n    subMenu.addHeader(title).addIcon(undefined, true, true).addEventListener(scope.TOUCH_ENABLED ? 'touchend' : 'click', onTap, false);\n\n    for (let i = 0; i < items.length; i++) {\n      const item = subMenu.addItem(items[i].title);\n      item.style.fontWeight = 300;\n      item.handler = items[i].handler;\n      item.addIcon(' ', true);\n      item.addEventListener(scope.TOUCH_ENABLED ? 'touchend' : 'click', onTap, false);\n\n      if (!subMenu.activeItem) {\n        subMenu.setActiveItem(item);\n      }\n    }\n\n    subMenu.slideAll(true);\n    return subMenu;\n  },\n\n  /**\n   * Create general menu\n   * @memberOf Widget\n   * @instance\n   * @return {HTMLElement} - A span element\n   */\n  createMenu: function () {\n    const scope = this;\n    const menu = document.createElement('span');\n    const style = menu.style;\n    style.padding = '5px 0';\n    style.position = 'fixed';\n    style.bottom = '100%';\n    style.right = '14px';\n    style.backgroundColor = '#fafafa';\n    style.fontFamily = 'Helvetica Neue';\n    style.fontSize = '14px';\n    style.visibility = 'hidden';\n    style.opacity = 0;\n    style.boxShadow = '0 0 12pt rgba(0,0,0,0.25)';\n    style.borderRadius = '2px';\n    style.overflow = 'hidden';\n    style.willChange = 'width, height, opacity';\n    style.pointerEvents = 'auto';\n    style.transition = this.DEFAULT_TRANSITION;\n    menu.visible = false;\n\n    menu.changeSize = function (width, height) {\n      if (width) {\n        this.style.width = width + 'px';\n      }\n\n      if (height) {\n        this.style.height = height + 'px';\n      }\n    };\n\n    menu.show = function () {\n      this.style.opacity = 1;\n      this.style.visibility = 'visible';\n      this.visible = true;\n    };\n\n    menu.hide = function () {\n      this.style.opacity = 0;\n      this.style.visibility = 'hidden';\n      this.visible = false;\n    };\n\n    menu.toggle = function () {\n      if (this.visible) {\n        this.hide();\n      } else {\n        this.show();\n      }\n    };\n\n    menu.slideAll = function (right) {\n      for (let i = 0; i < menu.children.length; i++) {\n        if (menu.children[i].slide) {\n          menu.children[i].slide(right);\n        }\n      }\n    };\n\n    menu.unslideAll = function () {\n      for (let i = 0; i < menu.children.length; i++) {\n        if (menu.children[i].unslide) {\n          menu.children[i].unslide();\n        }\n      }\n    };\n\n    menu.addHeader = function (title) {\n      const header = scope.createMenuItemHeader(title);\n      header.type = 'header';\n      this.appendChild(header);\n      return header;\n    };\n\n    menu.addItem = function (title) {\n      const item = scope.createMenuItem(title);\n      item.type = 'item';\n      this.appendChild(item);\n      return item;\n    };\n\n    menu.setActiveItem = function (item) {\n      if (this.activeItem) {\n        this.activeItem.setIcon(' ');\n      }\n\n      item.setIcon(DataImage.Check);\n      this.activeItem = item;\n    };\n\n    menu.addEventListener('mousemove', this.PREVENT_EVENT_HANDLER, true);\n    menu.addEventListener('mouseup', this.PREVENT_EVENT_HANDLER, true);\n    menu.addEventListener('mousedown', this.PREVENT_EVENT_HANDLER, true);\n    return menu;\n  },\n\n  /**\n   * Create custom item element\n   * @memberOf Widget\n   * @instance\n   * @return {HTMLSpanElement} - The dom element icon\n   */\n  createCustomItem: function (options = {}) {\n    const scope = this;\n    const item = options.element || document.createElement('span');\n    const {\n      onDispose\n    } = options;\n    item.style.cursor = 'pointer';\n    item.style.float = 'right';\n    item.style.width = '44px';\n    item.style.height = '100%';\n    item.style.backgroundSize = '60%';\n    item.style.backgroundRepeat = 'no-repeat';\n    item.style.backgroundPosition = 'center';\n    item.style.webkitUserSelect = item.style.MozUserSelect = item.style.userSelect = 'none';\n    item.style.position = 'relative';\n    item.style.pointerEvents = 'auto'; // White glow on icon\n\n    item.addEventListener(scope.TOUCH_ENABLED ? 'touchstart' : 'mouseenter', function () {\n      item.style.filter = item.style.webkitFilter = 'drop-shadow(0 0 5px rgba(255,255,255,1))';\n    }, {\n      passive: true\n    });\n    item.addEventListener(scope.TOUCH_ENABLED ? 'touchend' : 'mouseleave', function () {\n      item.style.filter = item.style.webkitFilter = '';\n    }, {\n      passive: true\n    });\n    this.mergeStyleOptions(item, options.style);\n\n    if (options.onTap) {\n      item.addEventListener(scope.TOUCH_ENABLED ? 'touchend' : 'click', options.onTap, false);\n    }\n\n    item.dispose = function () {\n      item.removeEventListener(scope.TOUCH_ENABLED ? 'touchend' : 'click', options.onTap, false);\n\n      if (onDispose) {\n        options.onDispose();\n      }\n    };\n\n    return item;\n  },\n\n  /**\n   * Merge item css style\n   * @param  {HTMLElement} element - The element to be merged with style\n   * @param  {object} options - The style options\n   * @memberOf Widget\n   * @instance\n   * @return {HTMLElement} - The same element with merged styles\n   */\n  mergeStyleOptions: function (element, options = {}) {\n    for (let property in options) {\n      if (options.hasOwnProperty(property)) {\n        element.style[property] = options[property];\n      }\n    }\n\n    return element;\n  },\n\n  /**\n   * Dispose widgets by detaching dom elements from container\n   * @memberOf Widget\n   * @instance\n   */\n  dispose: function () {\n    if (this.barElement) {\n      this.container.removeChild(this.barElement);\n      this.barElement.dispose();\n      this.barElement = null;\n    }\n  }\n});\n/**\n * @classdesc Base Panorama\n * @constructor\n * @param {THREE.Geometry} geometry - The geometry for this panorama\n * @param {THREE.Material} material - The material for this panorama\n */\n\nfunction Panorama(geometry, material) {\n  Mesh.call(this, geometry, material);\n  this.type = 'panorama';\n  this.ImageQualityLow = 1;\n  this.ImageQualityFair = 2;\n  this.ImageQualityMedium = 3;\n  this.ImageQualityHigh = 4;\n  this.ImageQualitySuperHigh = 5;\n  this.animationDuration = 1000;\n  this.defaultInfospotSize = 350;\n  this.container = undefined;\n  this.loaded = false;\n  this.linkedSpots = [];\n  this.isInfospotVisible = false;\n  this.linkingImageURL = undefined;\n  this.linkingImageScale = undefined;\n  this.material.side = BackSide;\n  this.material.opacity = 0;\n  this.scale.x *= -1;\n  this.renderOrder = -1;\n  this.active = false;\n  this.infospotAnimation = new Tween.Tween(this).to({}, this.animationDuration / 2);\n  this.addEventListener('load', this.fadeIn.bind(this));\n  this.addEventListener('panolens-container', this.setContainer.bind(this));\n  this.addEventListener('click', this.onClick.bind(this));\n  this.setupTransitions();\n}\n\nPanorama.prototype = Object.assign(Object.create(Mesh.prototype), {\n  constructor: Panorama,\n\n  /**\n   * Adding an object\n   * To counter the scale.x = -1, it will automatically add an \n   * empty object with inverted scale on x\n   * @memberOf Panorama\n   * @instance\n   * @param {THREE.Object3D} object - The object to be added\n   */\n  add: function (object) {\n    let invertedObject;\n\n    if (arguments.length > 1) {\n      for (var i = 0; i < arguments.length; i++) {\n        this.add(arguments[i]);\n      }\n\n      return this;\n    } // In case of infospots\n\n\n    if (object instanceof Infospot) {\n      invertedObject = object;\n\n      if (object.dispatchEvent) {\n        const {\n          container\n        } = this;\n\n        if (container) {\n          object.dispatchEvent({\n            type: 'panolens-container',\n            container\n          });\n        }\n\n        object.dispatchEvent({\n          type: 'panolens-infospot-focus',\n          method: function (vector, duration, easing) {\n            /**\n             * Infospot focus handler event\n             * @type {object}\n             * @event Panorama#panolens-viewer-handler\n             * @property {string} method - Viewer function name\n             * @property {*} data - The argument to be passed into the method\n             */\n            this.dispatchEvent({\n              type: 'panolens-viewer-handler',\n              method: 'tweenControlCenter',\n              data: [vector, duration, easing]\n            });\n          }.bind(this)\n        });\n      }\n    } else {\n      // Counter scale.x = -1 effect\n      invertedObject = new Object3D();\n      invertedObject.scale.x = -1;\n      invertedObject.scalePlaceHolder = true;\n      invertedObject.add(object);\n    }\n\n    Object3D.prototype.add.call(this, invertedObject);\n  },\n  load: function () {\n    this.onLoad();\n  },\n\n  /**\n   * Click event handler\n   * @param  {object} event - Click event\n   * @memberOf Panorama\n   * @instance\n   * @fires Infospot#dismiss\n   */\n  onClick: function (event) {\n    if (event.intersects && event.intersects.length === 0) {\n      this.traverse(function (object) {\n        /**\n         * Dimiss event\n         * @type {object}\n         * @event Infospot#dismiss\n         */\n        object.dispatchEvent({\n          type: 'dismiss'\n        });\n      });\n    }\n  },\n\n  /**\n   * Set container of this panorama \n   * @param {HTMLElement|object} data - Data with container information\n   * @memberOf Panorama\n   * @instance\n   * @fires Infospot#panolens-container\n   */\n  setContainer: function (data) {\n    let container;\n\n    if (data instanceof HTMLElement) {\n      container = data;\n    } else if (data && data.container) {\n      container = data.container;\n    }\n\n    if (container) {\n      this.children.forEach(function (child) {\n        if (child instanceof Infospot && child.dispatchEvent) {\n          /**\n           * Set container event\n           * @type {object}\n           * @event Infospot#panolens-container\n           * @property {HTMLElement} container - The container of this panorama\n           */\n          child.dispatchEvent({\n            type: 'panolens-container',\n            container: container\n          });\n        }\n      });\n      this.container = container;\n    }\n  },\n\n  /**\n   * This will be called when panorama is loaded\n   * @memberOf Panorama\n   * @instance\n   * @fires Panorama#load\n   */\n  onLoad: function () {\n    this.loaded = true;\n    /**\n     * Load panorama event\n     * @type {object}\n     * @event Panorama#load\n     */\n\n    this.dispatchEvent({\n      type: 'load'\n    });\n  },\n\n  /**\n   * This will be called when panorama is in progress\n   * @memberOf Panorama\n   * @instance\n   * @fires Panorama#progress\n   */\n  onProgress: function (progress) {\n    /**\n     * Loading panorama progress event\n     * @type {object}\n     * @event Panorama#progress\n     * @property {object} progress - The progress object containing loaded and total amount\n     */\n    this.dispatchEvent({\n      type: 'progress',\n      progress: progress\n    });\n  },\n\n  /**\n   * This will be called when panorama loading has error\n   * @memberOf Panorama\n   * @instance\n   * @fires Panorama#error\n   */\n  onError: function () {\n    /**\n     * Loading panorama error event\n     * @type {object}\n     * @event Panorama#error\n     */\n    this.dispatchEvent({\n      type: 'error'\n    });\n  },\n\n  /**\n   * Get zoom level based on window width\n   * @memberOf Panorama\n   * @instance\n   * @return {number} zoom level indicating image quality\n   */\n  getZoomLevel: function () {\n    let zoomLevel;\n\n    if (window.innerWidth <= 800) {\n      zoomLevel = this.ImageQualityFair;\n    } else if (window.innerWidth > 800 && window.innerWidth <= 1280) {\n      zoomLevel = this.ImageQualityMedium;\n    } else if (window.innerWidth > 1280 && window.innerWidth <= 1920) {\n      zoomLevel = this.ImageQualityHigh;\n    } else if (window.innerWidth > 1920) {\n      zoomLevel = this.ImageQualitySuperHigh;\n    } else {\n      zoomLevel = this.ImageQualityLow;\n    }\n\n    return zoomLevel;\n  },\n\n  /**\n   * Update texture of a panorama\n   * @memberOf Panorama\n   * @instance\n   * @param {THREE.Texture} texture - Texture to be updated\n   */\n  updateTexture: function (texture) {\n    this.material.map = texture;\n    this.material.needsUpdate = true;\n  },\n\n  /**\n   * Toggle visibility of infospots in this panorama\n   * @param  {boolean} isVisible - Visibility of infospots\n   * @param  {number} delay - Delay in milliseconds to change visibility\n   * @memberOf Panorama\n   * @instance\n   * @fires Panorama#infospot-animation-complete\n   */\n  toggleInfospotVisibility: function (isVisible, delay) {\n    delay = delay !== undefined ? delay : 0;\n    const visible = isVisible !== undefined ? isVisible : this.isInfospotVisible ? false : true;\n    this.traverse(function (object) {\n      if (object instanceof Infospot) {\n        if (visible) {\n          object.show(delay);\n        } else {\n          object.hide(delay);\n        }\n      }\n    });\n    this.isInfospotVisible = visible; // Animation complete event\n\n    this.infospotAnimation.onComplete(function () {\n      /**\n       * Complete toggling infospot visibility\n       * @event Panorama#infospot-animation-complete\n       * @type {object} \n       */\n      this.dispatchEvent({\n        type: 'infospot-animation-complete',\n        visible: visible\n      });\n    }.bind(this)).delay(delay).start();\n  },\n\n  /**\n   * Set image of this panorama's linking infospot\n   * @memberOf Panorama\n   * @instance\n   * @param {string} url   - Url to the image asset\n   * @param {number} scale - Scale factor of the infospot\n   */\n  setLinkingImage: function (url, scale) {\n    this.linkingImageURL = url;\n    this.linkingImageScale = scale;\n  },\n\n  /**\n   * Link one-way panorama\n   * @param  {Panorama} pano  - The panorama to be linked to\n   * @param  {THREE.Vector3} position - The position of infospot which navigates to the pano\n   * @param  {number} [imageScale=300] - Image scale of linked infospot\n   * @param  {string} [imageSrc=DataImage.Arrow] - The image source of linked infospot\n   * @memberOf Panorama\n   * @instance\n   */\n  link: function (pano, position, imageScale, imageSrc) {\n    let scale, img;\n    this.visible = true;\n\n    if (!position) {\n      console.warn('Please specify infospot position for linking');\n      return;\n    } // Infospot scale\n\n\n    if (imageScale !== undefined) {\n      scale = imageScale;\n    } else if (pano.linkingImageScale !== undefined) {\n      scale = pano.linkingImageScale;\n    } else {\n      scale = 300;\n    } // Infospot image\n\n\n    if (imageSrc) {\n      img = imageSrc;\n    } else if (pano.linkingImageURL) {\n      img = pano.linkingImageURL;\n    } else {\n      img = DataImage.Arrow;\n    } // Creates a new infospot\n\n\n    const spot = new Infospot(scale, img);\n    spot.position.copy(position);\n    spot.toPanorama = pano;\n    spot.addEventListener('click', function () {\n      /**\n       * Viewer handler event\n       * @type {object}\n       * @event Panorama#panolens-viewer-handler\n       * @property {string} method - Viewer function name\n       * @property {*} data - The argument to be passed into the method\n       */\n      this.dispatchEvent({\n        type: 'panolens-viewer-handler',\n        method: 'setPanorama',\n        data: pano\n      });\n    }.bind(this));\n    this.linkedSpots.push(spot);\n    this.add(spot);\n    this.visible = false;\n  },\n  reset: function () {\n    this.children.length = 0;\n  },\n  setupTransitions: function () {\n    this.fadeInAnimation = new Tween.Tween(this.material).easing(Tween.Easing.Quartic.Out).onStart(function () {\n      this.visible = true; // this.material.visible = true;\n\n      /**\n       * Enter panorama fade in start event\n       * @event Panorama#enter-fade-start\n       * @type {object} \n       */\n\n      this.dispatchEvent({\n        type: 'enter-fade-start'\n      });\n    }.bind(this));\n    this.fadeOutAnimation = new Tween.Tween(this.material).easing(Tween.Easing.Quartic.Out).onComplete(function () {\n      this.visible = false; // this.material.visible = true;\n\n      /**\n       * Leave panorama complete event\n       * @event Panorama#leave-complete\n       * @type {object} \n       */\n\n      this.dispatchEvent({\n        type: 'leave-complete'\n      });\n    }.bind(this));\n    this.enterTransition = new Tween.Tween(this).easing(Tween.Easing.Quartic.Out).onComplete(function () {\n      /**\n       * Enter panorama and animation complete event\n       * @event Panorama#enter-complete\n       * @type {object} \n       */\n      this.dispatchEvent({\n        type: 'enter-complete'\n      });\n    }.bind(this)).start();\n    this.leaveTransition = new Tween.Tween(this).easing(Tween.Easing.Quartic.Out);\n  },\n  onFadeAnimationUpdate: function () {\n    const alpha = this.material.opacity;\n    const {\n      uniforms\n    } = this.material;\n\n    if (uniforms && uniforms.opacity) {\n      uniforms.opacity.value = alpha;\n    }\n  },\n\n  /**\n   * Start fading in animation\n   * @memberOf Panorama\n   * @instance\n   * @fires Panorama#enter-fade-complete\n   */\n  fadeIn: function (duration) {\n    duration = duration >= 0 ? duration : this.animationDuration;\n    this.fadeOutAnimation.stop();\n    this.fadeInAnimation.to({\n      opacity: 1\n    }, duration).onUpdate(this.onFadeAnimationUpdate.bind(this)).onComplete(function () {\n      this.toggleInfospotVisibility(true, duration / 2);\n      /**\n       * Enter panorama fade complete event\n       * @event Panorama#enter-fade-complete\n       * @type {object} \n       */\n\n      this.dispatchEvent({\n        type: 'enter-fade-complete'\n      });\n    }.bind(this)).start();\n  },\n\n  /**\n   * Start fading out animation\n   * @memberOf Panorama\n   * @instance\n   */\n  fadeOut: function (duration) {\n    duration = duration >= 0 ? duration : this.animationDuration;\n    this.fadeInAnimation.stop();\n    this.fadeOutAnimation.to({\n      opacity: 0\n    }, duration).onUpdate(this.onFadeAnimationUpdate.bind(this)).start();\n  },\n\n  /**\n   * This will be called when entering a panorama \n   * @memberOf Panorama\n   * @instance\n   * @fires Panorama#enter\n   * @fires Panorama#enter-start\n   */\n  onEnter: function () {\n    const duration = this.animationDuration;\n    this.leaveTransition.stop();\n    this.enterTransition.to({}, duration).onStart(function () {\n      /**\n       * Enter panorama and animation starting event\n       * @event Panorama#enter-start\n       * @type {object} \n       */\n      this.dispatchEvent({\n        type: 'enter-start'\n      });\n\n      if (this.loaded) {\n        this.fadeIn(duration);\n      } else {\n        this.load();\n      }\n    }.bind(this)).start();\n    /**\n     * Enter panorama event\n     * @event Panorama#enter\n     * @type {object} \n     */\n\n    this.dispatchEvent({\n      type: 'enter'\n    });\n    this.children.forEach(child => {\n      child.dispatchEvent({\n        type: 'panorama-enter'\n      });\n    });\n    this.active = true;\n  },\n\n  /**\n   * This will be called when leaving a panorama\n   * @memberOf Panorama\n   * @instance\n   * @fires Panorama#leave\n   */\n  onLeave: function () {\n    const duration = this.animationDuration;\n    this.enterTransition.stop();\n    this.leaveTransition.to({}, duration).onStart(function () {\n      /**\n       * Leave panorama and animation starting event\n       * @event Panorama#leave-start\n       * @type {object} \n       */\n      this.dispatchEvent({\n        type: 'leave-start'\n      });\n      this.fadeOut(duration);\n      this.toggleInfospotVisibility(false);\n    }.bind(this)).start();\n    /**\n     * Leave panorama event\n     * @event Panorama#leave\n     * @type {object} \n     */\n\n    this.dispatchEvent({\n      type: 'leave'\n    });\n    this.children.forEach(child => {\n      child.dispatchEvent({\n        type: 'panorama-leave'\n      });\n    });\n    this.active = false;\n  },\n\n  /**\n   * Dispose panorama\n   * @memberOf Panorama\n   * @instance\n   */\n  dispose: function () {\n    this.infospotAnimation.stop();\n    this.fadeInAnimation.stop();\n    this.fadeOutAnimation.stop();\n    this.enterTransition.stop();\n    this.leaveTransition.stop();\n    /**\n     * On panorama dispose handler\n     * @type {object}\n     * @event Panorama#panolens-viewer-handler\n     * @property {string} method - Viewer function name\n     * @property {*} data - The argument to be passed into the method\n     */\n\n    this.dispatchEvent({\n      type: 'panolens-viewer-handler',\n      method: 'onPanoramaDispose',\n      data: this\n    }); // recursive disposal on 3d objects\n\n    function recursiveDispose(object) {\n      const {\n        geometry,\n        material\n      } = object;\n\n      for (var i = object.children.length - 1; i >= 0; i--) {\n        recursiveDispose(object.children[i]);\n        object.remove(object.children[i]);\n      }\n\n      if (object instanceof Infospot) {\n        object.dispose();\n      }\n\n      if (geometry) {\n        geometry.dispose();\n        object.geometry = null;\n      }\n\n      if (material) {\n        material.dispose();\n        object.material = null;\n      }\n    }\n\n    recursiveDispose(this);\n\n    if (this.parent) {\n      this.parent.remove(this);\n    }\n  }\n});\n/**\n * @classdesc Equirectangular based image panorama\n * @constructor\n * @param {string} image - Image url or HTMLImageElement\n */\n\nfunction ImagePanorama(image, _geometry, _material) {\n  const radius = 5000;\n  const geometry = _geometry || new SphereBufferGeometry(radius, 60, 40);\n  const material = _material || new MeshBasicMaterial({\n    opacity: 0,\n    transparent: true\n  });\n  Panorama.call(this, geometry, material);\n  this.src = image;\n  this.radius = radius;\n}\n\nImagePanorama.prototype = Object.assign(Object.create(Panorama.prototype), {\n  constructor: ImagePanorama,\n\n  /**\n   * Load image asset\n   * @param  {*} src - Url or image element\n   * @memberOf ImagePanorama\n   * @instance\n   */\n  load: function (src) {\n    src = src || this.src;\n\n    if (!src) {\n      console.warn('Image source undefined');\n      return;\n    } else if (typeof src === 'string') {\n      TextureLoader.load(src, this.onLoad.bind(this), this.onProgress.bind(this), this.onError.bind(this));\n    } else if (src instanceof HTMLImageElement) {\n      this.onLoad(new Texture(src));\n    }\n  },\n\n  /**\n   * This will be called when image is loaded\n   * @param  {THREE.Texture} texture - Texture to be updated\n   * @memberOf ImagePanorama\n   * @instance\n   */\n  onLoad: function (texture) {\n    texture.minFilter = texture.magFilter = LinearFilter;\n    texture.needsUpdate = true;\n    this.updateTexture(texture);\n    window.requestAnimationFrame(Panorama.prototype.onLoad.bind(this));\n  },\n\n  /**\n   * Reset\n   * @memberOf ImagePanorama\n   * @instance\n   */\n  reset: function () {\n    Panorama.prototype.reset.call(this);\n  },\n\n  /**\n   * Dispose\n   * @memberOf ImagePanorama\n   * @instance\n   */\n  dispose: function () {\n    const {\n      material: {\n        map\n      }\n    } = this; // Release cached image\n\n    Cache.remove(this.src);\n\n    if (map) {\n      map.dispose();\n    }\n\n    Panorama.prototype.dispose.call(this);\n  }\n});\n/**\n * @classdesc Empty panorama\n * @constructor\n */\n\nfunction EmptyPanorama() {\n  const geometry = new BufferGeometry();\n  const material = new MeshBasicMaterial({\n    color: 0x000000,\n    opacity: 0,\n    transparent: true\n  });\n  geometry.addAttribute('position', new BufferAttribute(new Float32Array(), 1));\n  Panorama.call(this, geometry, material);\n}\n\nEmptyPanorama.prototype = Object.assign(Object.create(Panorama.prototype), {\n  constructor: EmptyPanorama\n});\n/**\n * @classdesc Cubemap-based panorama\n * @constructor\n * @param {array} images - Array of 6 urls to images, one for each side of the CubeTexture. The urls should be specified in the following order: pos-x, neg-x, pos-y, neg-y, pos-z, neg-z\n */\n\nfunction CubePanorama(images = []) {\n  const edgeLength = 10000;\n  const shader = Object.assign({}, ShaderLib['cube']);\n  const geometry = new BoxBufferGeometry(edgeLength, edgeLength, edgeLength);\n  const material = new ShaderMaterial({\n    fragmentShader: shader.fragmentShader,\n    vertexShader: shader.vertexShader,\n    uniforms: shader.uniforms,\n    side: BackSide,\n    transparent: true\n  });\n  Panorama.call(this, geometry, material);\n  this.images = images;\n  this.edgeLength = edgeLength;\n  this.material.uniforms.opacity.value = 0;\n}\n\nCubePanorama.prototype = Object.assign(Object.create(Panorama.prototype), {\n  constructor: CubePanorama,\n\n  /**\n   * Load 6 images and bind listeners\n   * @memberOf CubePanorama\n   * @instance\n   */\n  load: function () {\n    CubeTextureLoader.load(this.images, this.onLoad.bind(this), this.onProgress.bind(this), this.onError.bind(this));\n  },\n\n  /**\n   * This will be called when 6 textures are ready\n   * @param  {THREE.CubeTexture} texture - Cube texture\n   * @memberOf CubePanorama\n   * @instance\n   */\n  onLoad: function (texture) {\n    this.material.uniforms['tCube'].value = texture;\n    Panorama.prototype.onLoad.call(this);\n  },\n\n  /**\n   * Dispose\n   * @memberOf CubePanorama\n   * @instance\n   */\n  dispose: function () {\n    const {\n      value\n    } = this.material.uniforms.tCube;\n    this.images.forEach(image => {\n      Cache.remove(image);\n    });\n\n    if (value instanceof CubeTexture) {\n      value.dispose();\n    }\n\n    Panorama.prototype.dispose.call(this);\n  }\n});\n/**\n * @classdesc Basic panorama with 6 pre-defined grid images\n * @constructor\n */\n\nfunction BasicPanorama() {\n  const images = [];\n\n  for (let i = 0; i < 6; i++) {\n    images.push(DataImage.WhiteTile);\n  }\n\n  CubePanorama.call(this, images);\n}\n\nBasicPanorama.prototype = Object.assign(Object.create(CubePanorama.prototype), {\n  constructor: BasicPanorama\n});\n/**\n * @classdesc Video Panorama\n * @constructor\n * @param {string} src - Equirectangular video url\n * @param {object} [options] - Option for video settings\n * @param {HTMLElement} [options.videoElement] - HTML5 video element contains the video\n * @param {boolean} [options.loop=true] - Specify if the video should loop in the end\n * @param {boolean} [options.muted=true] - Mute the video or not. Need to be true in order to autoplay on some browsers\n * @param {boolean} [options.autoplay=false] - Specify if the video should auto play\n * @param {boolean} [options.playsinline=true] - Specify if video should play inline for iOS. If you want it to auto play inline, set both autoplay and muted options to true\n * @param {string} [options.crossOrigin=\"anonymous\"] - Sets the cross-origin attribute for the video, which allows for cross-origin videos in some browsers (Firefox, Chrome). Set to either \"anonymous\" or \"use-credentials\".\n * @param {number} [radius=5000] - The minimum radius for this panoram\n */\n\nfunction VideoPanorama(src, options = {}) {\n  const radius = 5000;\n  const geometry = new SphereBufferGeometry(radius, 60, 40);\n  const material = new MeshBasicMaterial({\n    opacity: 0,\n    transparent: true\n  });\n  Panorama.call(this, geometry, material);\n  this.src = src;\n  this.options = {\n    videoElement: document.createElement('video'),\n    loop: true,\n    muted: true,\n    autoplay: false,\n    playsinline: true,\n    crossOrigin: 'anonymous'\n  };\n  Object.assign(this.options, options);\n  this.videoElement = this.options.videoElement;\n  this.videoProgress = 0;\n  this.radius = radius;\n  this.addEventListener('leave', this.pauseVideo.bind(this));\n  this.addEventListener('enter-fade-start', this.resumeVideoProgress.bind(this));\n  this.addEventListener('video-toggle', this.toggleVideo.bind(this));\n  this.addEventListener('video-time', this.setVideoCurrentTime.bind(this));\n}\n\nVideoPanorama.prototype = Object.assign(Object.create(Panorama.prototype), {\n  constructor: VideoPanorama,\n  isMobile: function () {\n    let check = false;\n\n    (function (a) {\n      if (/(android|bb\\d+|meego).+mobile|avantgo|bada\\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a) || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\\-(n|u)|c55\\/|capi|ccwa|cdm\\-|cell|chtm|cldc|cmd\\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\\-s|devi|dica|dmob|do(c|p)o|ds(12|\\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\\-|_)|g1 u|g560|gene|gf\\-5|g\\-mo|go(\\.w|od)|gr(ad|un)|haie|hcit|hd\\-(m|p|t)|hei\\-|hi(pt|ta)|hp( i|ip)|hs\\-c|ht(c(\\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\\-(20|go|ma)|i230|iac( |\\-|\\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\\/)|klon|kpt |kwc\\-|kyo(c|k)|le(no|xi)|lg( g|\\/(k|l|u)|50|54|\\-[a-w])|libw|lynx|m1\\-w|m3ga|m50\\/|ma(te|ui|xo)|mc(01|21|ca)|m\\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\\-2|po(ck|rt|se)|prox|psio|pt\\-g|qa\\-a|qc(07|12|21|32|60|\\-[2-7]|i\\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\\-|oo|p\\-)|sdk\\/|se(c(\\-|0|1)|47|mc|nd|ri)|sgh\\-|shar|sie(\\-|m)|sk\\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\\-|v\\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\\-|tdg\\-|tel(i|m)|tim\\-|t\\-mo|to(pl|sh)|ts(70|m\\-|m3|m5)|tx\\-9|up(\\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\\-|your|zeto|zte\\-/i.test(a.substr(0, 4))) check = true;\n    })(window.navigator.userAgent || window.navigator.vendor || window.opera);\n\n    return check;\n  },\n\n  /**\n   * Load video panorama\n   * @memberOf VideoPanorama\n   * @instance\n   * @fires  Panorama#panolens-viewer-handler\n   */\n  load: function () {\n    const {\n      muted,\n      loop,\n      autoplay,\n      playsinline,\n      crossOrigin\n    } = this.options;\n    const video = this.videoElement;\n    const material = this.material;\n    const onProgress = this.onProgress.bind(this);\n    const onLoad = this.onLoad.bind(this);\n    video.loop = loop;\n    video.autoplay = autoplay;\n    video.playsinline = playsinline;\n    video.crossOrigin = crossOrigin;\n    video.muted = muted;\n\n    if (playsinline) {\n      video.setAttribute('playsinline', '');\n      video.setAttribute('webkit-playsinline', '');\n    }\n\n    const onloadeddata = function () {\n      this.setVideoTexture(video);\n\n      if (autoplay) {\n        /**\n         * Viewer handler event\n         * @type {object}\n         * @property {string} method - 'updateVideoPlayButton'\n         * @property {boolean} data - Pause video or not\n         */\n        this.dispatchEvent({\n          type: 'panolens-viewer-handler',\n          method: 'updateVideoPlayButton',\n          data: false\n        });\n      } // For mobile silent autoplay\n\n\n      if (this.isMobile()) {\n        video.pause();\n\n        if (autoplay && muted) {\n          /**\n           * Viewer handler event\n           * @type {object}\n           * @property {string} method - 'updateVideoPlayButton'\n           * @property {boolean} data - Pause video or not\n           */\n          this.dispatchEvent({\n            type: 'panolens-viewer-handler',\n            method: 'updateVideoPlayButton',\n            data: false\n          });\n        } else {\n          /**\n           * Viewer handler event\n           * @type {object}\n           * @property {string} method - 'updateVideoPlayButton'\n           * @property {boolean} data - Pause video or not\n           */\n          this.dispatchEvent({\n            type: 'panolens-viewer-handler',\n            method: 'updateVideoPlayButton',\n            data: true\n          });\n        }\n      }\n\n      const loaded = () => {\n        // Fix for threejs r89 delayed update\n        material.map.needsUpdate = true;\n        onProgress({\n          loaded: 1,\n          total: 1\n        });\n        onLoad();\n      };\n\n      window.requestAnimationFrame(loaded);\n    };\n    /**\n     * Ready state of the audio/video element\n     * 0 = HAVE_NOTHING - no information whether or not the audio/video is ready\n     * 1 = HAVE_METADATA - metadata for the audio/video is ready\n     * 2 = HAVE_CURRENT_DATA - data for the current playback position is available, but not enough data to play next frame/millisecond\n     * 3 = HAVE_FUTURE_DATA - data for the current and at least the next frame is available\n     * 4 = HAVE_ENOUGH_DATA - enough data available to start playing\n     */\n\n\n    if (video.readyState > 2) {\n      onloadeddata.call(this);\n    } else {\n      if (video.querySelectorAll('source').length === 0) {\n        const source = document.createElement('source');\n        source.src = this.src;\n        video.appendChild(source);\n      }\n\n      video.load();\n    }\n\n    video.addEventListener('loadeddata', onloadeddata.bind(this));\n    video.addEventListener('timeupdate', function () {\n      this.videoProgress = video.duration >= 0 ? video.currentTime / video.duration : 0;\n      /**\n       * Viewer handler event\n       * @type {object}\n       * @property {string} method - 'onVideoUpdate'\n       * @property {number} data - The percentage of video progress. Range from 0.0 to 1.0\n       */\n\n      this.dispatchEvent({\n        type: 'panolens-viewer-handler',\n        method: 'onVideoUpdate',\n        data: this.videoProgress\n      });\n    }.bind(this));\n    video.addEventListener('ended', function () {\n      if (!loop) {\n        this.resetVideo();\n        this.dispatchEvent({\n          type: 'panolens-viewer-handler',\n          method: 'updateVideoPlayButton',\n          data: true\n        });\n      }\n    }.bind(this), false);\n  },\n\n  /**\n   * Set video texture\n   * @memberOf VideoPanorama\n   * @instance\n   * @param {HTMLVideoElement} video  - The html5 video element\n   * @fires Panorama#panolens-viewer-handler\n   */\n  setVideoTexture: function (video) {\n    if (!video) return;\n    const videoTexture = new VideoTexture(video);\n    videoTexture.minFilter = LinearFilter;\n    videoTexture.magFilter = LinearFilter;\n    videoTexture.format = RGBFormat;\n    this.updateTexture(videoTexture);\n  },\n\n  /**\n   * Reset\n   * @memberOf VideoPanorama\n   * @instance\n   */\n  reset: function () {\n    this.videoElement = undefined;\n    Panorama.prototype.reset.call(this);\n  },\n\n  /**\n   * Check if video is paused\n   * @memberOf VideoPanorama\n   * @instance\n   * @return {boolean} - is video paused or not\n   */\n  isVideoPaused: function () {\n    return this.videoElement.paused;\n  },\n\n  /**\n   * Toggle video to play or pause\n   * @memberOf VideoPanorama\n   * @instance\n   */\n  toggleVideo: function () {\n    const video = this.videoElement;\n\n    if (!video) {\n      return;\n    }\n\n    video[video.paused ? 'play' : 'pause']();\n  },\n\n  /**\n   * Set video currentTime\n   * @memberOf VideoPanorama\n   * @instance\n   * @param {object} event - Event contains percentage. Range from 0.0 to 1.0\n   */\n  setVideoCurrentTime: function ({\n    percentage\n  }) {\n    const video = this.videoElement;\n\n    if (video && !Number.isNaN(percentage) && percentage !== 1) {\n      video.currentTime = video.duration * percentage;\n      this.dispatchEvent({\n        type: 'panolens-viewer-handler',\n        method: 'onVideoUpdate',\n        data: percentage\n      });\n    }\n  },\n\n  /**\n   * Play video\n   * @memberOf VideoPanorama\n   * @instance\n   * @fires VideoPanorama#play\n   * @fires VideoPanorama#play-error\n   */\n  playVideo: function () {\n    const video = this.videoElement;\n    const playVideo = this.playVideo.bind(this);\n    const dispatchEvent = this.dispatchEvent.bind(this);\n\n    const onSuccess = () => {\n      /**\n       * Play event\n       * @type {object}\n       * @event VideoPanorama#play\n       *\n       */\n      dispatchEvent({\n        type: 'play'\n      });\n    };\n\n    const onError = error => {\n      // Error playing video. Retry next frame. Possibly Waiting for user interaction\n      window.requestAnimationFrame(playVideo);\n      /**\n       * Play event\n       * @type {object}\n       * @event VideoPanorama#play-error\n       *\n       */\n\n      dispatchEvent({\n        type: 'play-error',\n        error\n      });\n    };\n\n    if (video && video.paused) {\n      video.play().then(onSuccess).catch(onError);\n    }\n  },\n\n  /**\n   * Pause video\n   * @memberOf VideoPanorama\n   * @instance\n   * @fires VideoPanorama#pause\n   */\n  pauseVideo: function () {\n    const video = this.videoElement;\n\n    if (video && !video.paused) {\n      video.pause();\n    }\n    /**\n     * Pause event\n     * @type {object}\n     * @event VideoPanorama#pause\n     *\n     */\n\n\n    this.dispatchEvent({\n      type: 'pause'\n    });\n  },\n\n  /**\n   * Resume video\n   * @memberOf VideoPanorama\n   * @instance\n   */\n  resumeVideoProgress: function () {\n    const video = this.videoElement;\n\n    if (video.readyState >= 4 && video.autoplay && !this.isMobile()) {\n      this.playVideo();\n      /**\n       * Viewer handler event\n       * @type {object}\n       * @property {string} method - 'updateVideoPlayButton'\n       * @property {boolean} data - Pause video or not\n       */\n\n      this.dispatchEvent({\n        type: 'panolens-viewer-handler',\n        method: 'updateVideoPlayButton',\n        data: false\n      });\n    } else {\n      this.pauseVideo();\n      /**\n       * Viewer handler event\n       * @type {object}\n       * @property {string} method - 'updateVideoPlayButton'\n       * @property {boolean} data - Pause video or not\n       */\n\n      this.dispatchEvent({\n        type: 'panolens-viewer-handler',\n        method: 'updateVideoPlayButton',\n        data: true\n      });\n    }\n\n    this.setVideoCurrentTime({\n      percentage: this.videoProgress\n    });\n  },\n\n  /**\n   * Reset video at stating point\n   * @memberOf VideoPanorama\n   * @instance\n   */\n  resetVideo: function () {\n    const video = this.videoElement;\n\n    if (video) {\n      this.setVideoCurrentTime({\n        percentage: 0\n      });\n    }\n  },\n\n  /**\n   * Check if video is muted\n   * @memberOf VideoPanorama\n   * @instance\n   * @return {boolean} - is video muted or not\n   */\n  isVideoMuted: function () {\n    return this.videoElement.muted;\n  },\n\n  /**\n   * Mute video\n   * @memberOf VideoPanorama\n   * @instance\n   */\n  muteVideo: function () {\n    const video = this.videoElement;\n\n    if (video && !video.muted) {\n      video.muted = true;\n    }\n\n    this.dispatchEvent({\n      type: 'volumechange'\n    });\n  },\n\n  /**\n   * Unmute video\n   * @memberOf VideoPanorama\n   * @instance\n   */\n  unmuteVideo: function () {\n    const video = this.videoElement;\n\n    if (video && this.isVideoMuted()) {\n      video.muted = false;\n    }\n\n    this.dispatchEvent({\n      type: 'volumechange'\n    });\n  },\n\n  /**\n   * Returns the video element\n   * @memberOf VideoPanorama\n   * @instance\n   * @returns {HTMLElement}\n   */\n  getVideoElement: function () {\n    return this.videoElement;\n  },\n\n  /**\n   * Dispose video panorama\n   * @memberOf VideoPanorama\n   * @instance\n   */\n  dispose: function () {\n    const {\n      material: {\n        map\n      }\n    } = this;\n    this.pauseVideo();\n    this.removeEventListener('leave', this.pauseVideo.bind(this));\n    this.removeEventListener('enter-fade-start', this.resumeVideoProgress.bind(this));\n    this.removeEventListener('video-toggle', this.toggleVideo.bind(this));\n    this.removeEventListener('video-time', this.setVideoCurrentTime.bind(this));\n\n    if (map) {\n      map.dispose();\n    }\n\n    Panorama.prototype.dispose.call(this);\n  }\n});\n/**\n * @classdesc Google Street View Loader\n * @constructor\n * @param {object} parameters \n */\n\nfunction GoogleStreetviewLoader(parameters = {}) {\n  this._parameters = parameters;\n  this._zoom = null;\n  this._panoId = null;\n  this._panoClient = new google.maps.StreetViewService();\n  this._count = 0;\n  this._total = 0;\n  this._canvas = [];\n  this._ctx = [];\n  this._wc = 0;\n  this._hc = 0;\n  this.result = null;\n  this.rotation = 0;\n  this.copyright = '';\n  this.onSizeChange = null;\n  this.onPanoramaLoad = null;\n  this.levelsW = [1, 2, 4, 7, 13, 26];\n  this.levelsH = [1, 1, 2, 4, 7, 13];\n  this.widths = [416, 832, 1664, 3328, 6656, 13312];\n  this.heights = [416, 416, 832, 1664, 3328, 6656];\n  this.maxW = 6656;\n  this.maxH = 6656;\n  let gl;\n\n  try {\n    const canvas = document.createElement('canvas');\n    gl = canvas.getContext('experimental-webgl');\n\n    if (!gl) {\n      gl = canvas.getContext('webgl');\n    }\n  } catch (error) {}\n\n  this.maxW = Math.max(gl.getParameter(gl.MAX_TEXTURE_SIZE), this.maxW);\n  this.maxH = Math.max(gl.getParameter(gl.MAX_TEXTURE_SIZE), this.maxH);\n}\n\nObject.assign(GoogleStreetviewLoader.prototype, {\n  constructor: GoogleStreetviewLoader,\n\n  /**\n   * Set progress\n   * @param {number} loaded \n   * @param {number} total \n   * @memberOf GoogleStreetviewLoader\n   * @instance\n   */\n  setProgress: function (loaded, total) {\n    if (this.onProgress) {\n      this.onProgress({\n        loaded: loaded,\n        total: total\n      });\n    }\n  },\n\n  /**\n   * Adapt texture to zoom\n   * @memberOf GoogleStreetviewLoader\n   * @instance\n   */\n  adaptTextureToZoom: function () {\n    const w = this.widths[this._zoom];\n    const h = this.heights[this._zoom];\n    const maxW = this.maxW;\n    const maxH = this.maxH;\n    this._wc = Math.ceil(w / maxW);\n    this._hc = Math.ceil(h / maxH);\n\n    for (let y = 0; y < this._hc; y++) {\n      for (let x = 0; x < this._wc; x++) {\n        const c = document.createElement('canvas');\n        if (x < this._wc - 1) c.width = maxW;else c.width = w - maxW * x;\n        if (y < this._hc - 1) c.height = maxH;else c.height = h - maxH * y;\n\n        this._canvas.push(c);\n\n        this._ctx.push(c.getContext('2d'));\n      }\n    }\n  },\n\n  /**\n   * Compose from tile\n   * @param {number} x \n   * @param {number} y \n   * @param {*} texture \n   * @memberOf GoogleStreetviewLoader\n   * @instance\n   */\n  composeFromTile: function (x, y, texture) {\n    const maxW = this.maxW;\n    const maxH = this.maxH;\n    x *= 512;\n    y *= 512;\n    const px = Math.floor(x / maxW);\n    const py = Math.floor(y / maxH);\n    x -= px * maxW;\n    y -= py * maxH;\n\n    this._ctx[py * this._wc + px].drawImage(texture, 0, 0, texture.width, texture.height, x, y, 512, 512);\n\n    this.progress();\n  },\n\n  /**\n   * Progress\n   * @memberOf GoogleStreetviewLoader\n   * @instance\n   */\n  progress: function () {\n    this._count++;\n    this.setProgress(this._count, this._total);\n\n    if (this._count === this._total) {\n      this.canvas = this._canvas;\n      this.panoId = this._panoId;\n      this.zoom = this._zoom;\n\n      if (this.onPanoramaLoad) {\n        this.onPanoramaLoad(this._canvas[0]);\n      }\n    }\n  },\n\n  /**\n   * Compose panorama\n   * @memberOf GoogleStreetviewLoader\n   * @instance\n   */\n  composePanorama: function () {\n    this.setProgress(0, 1);\n    const w = this.levelsW[this._zoom];\n    const h = this.levelsH[this._zoom];\n    const self = this;\n    this._count = 0;\n    this._total = w * h;\n    const {\n      useWebGL\n    } = this._parameters;\n\n    for (let y = 0; y < h; y++) {\n      for (let x = 0; x < w; x++) {\n        const url = 'https://geo0.ggpht.com/cbk?cb_client=maps_sv.tactile&authuser=0&hl=en&output=tile&zoom=' + this._zoom + '&x=' + x + '&y=' + y + '&panoid=' + this._panoId + '&nbt&fover=2';\n\n        (function (x, y) {\n          if (useWebGL) {\n            const texture = TextureLoader.load(url, null, function () {\n              self.composeFromTile(x, y, texture);\n            });\n          } else {\n            const img = new Image();\n            img.addEventListener('load', function () {\n              self.composeFromTile(x, y, this);\n            });\n            img.crossOrigin = '';\n            img.src = url;\n          }\n        })(x, y);\n      }\n    }\n  },\n\n  /**\n   * Load\n   * @param {string} panoid \n   * @memberOf GoogleStreetviewLoader\n   * @instance\n   */\n  load: function (panoid) {\n    this.loadPano(panoid);\n  },\n\n  /**\n   * Load panorama\n   * @param {string} id\n   * @memberOf GoogleStreetviewLoader\n   * @instance\n   */\n  loadPano: function (id) {\n    const self = this;\n\n    this._panoClient.getPanoramaById(id, function (result, status) {\n      if (status === google.maps.StreetViewStatus.OK) {\n        self.result = result;\n        self.copyright = result.copyright;\n        self._panoId = result.location.pano;\n        self.composePanorama();\n      }\n    });\n  },\n\n  /**\n   * Set zoom level\n   * @param {number} z \n   * @memberOf GoogleStreetviewLoader\n   * @instance\n   */\n  setZoom: function (z) {\n    this._zoom = z;\n    this.adaptTextureToZoom();\n  }\n});\n/**\n * @classdesc Google streetview panorama\n * @description [How to get Panorama ID]{@link http://stackoverflow.com/questions/29916149/google-maps-streetview-how-to-get-panorama-id}\n * @constructor\n * @param {string} panoId - Panorama id from Google Streetview \n * @param {string} [apiKey] - Google Street View API Key\n */\n\nfunction GoogleStreetviewPanorama(panoId, apiKey) {\n  ImagePanorama.call(this);\n  this.panoId = panoId;\n  this.gsvLoader = null;\n  this.loadRequested = false;\n  this.setupGoogleMapAPI(apiKey);\n}\n\nGoogleStreetviewPanorama.prototype = Object.assign(Object.create(ImagePanorama.prototype), {\n  constructor: GoogleStreetviewPanorama,\n\n  /**\n   * Load Google Street View by panorama id\n   * @param {string} panoId - Gogogle Street View panorama id\n   * @memberOf GoogleStreetviewPanorama\n   * @instance\n   */\n  load: function (panoId) {\n    this.loadRequested = true;\n    panoId = panoId || this.panoId || {};\n\n    if (panoId && this.gsvLoader) {\n      this.loadGSVLoader(panoId);\n    }\n  },\n\n  /**\n   * Setup Google Map API\n   * @param {string}  apiKey\n   * @memberOf GoogleStreetviewPanorama\n   * @instance\n   */\n  setupGoogleMapAPI: function (apiKey) {\n    const script = document.createElement('script');\n    script.src = 'https://maps.googleapis.com/maps/api/js?';\n    script.src += apiKey ? 'key=' + apiKey : '';\n    script.onreadystatechange = this.setGSVLoader.bind(this);\n    script.onload = this.setGSVLoader.bind(this);\n    document.querySelector('head').appendChild(script);\n  },\n\n  /**\n   * Set GSV Loader\n   * @memberOf GoogleStreetviewPanorama\n   * @instance\n   */\n  setGSVLoader: function () {\n    this.gsvLoader = new GoogleStreetviewLoader();\n\n    if (this.loadRequested) {\n      this.load();\n    }\n  },\n\n  /**\n   * Get GSV Loader\n   * @memberOf GoogleStreetviewPanorama\n   * @instance\n   * @return {GoogleStreetviewLoader} GSV Loader instance\n   */\n  getGSVLoader: function () {\n    return this.gsvLoader;\n  },\n\n  /**\n   * Load GSV Loader\n   * @param  {string} panoId - Gogogle Street View panorama id\n   * @memberOf GoogleStreetviewPanorama\n   * @instance\n   */\n  loadGSVLoader: function (panoId) {\n    this.loadRequested = false;\n    this.gsvLoader.onProgress = this.onProgress.bind(this);\n    this.gsvLoader.onPanoramaLoad = this.onLoad.bind(this);\n    this.gsvLoader.setZoom(this.getZoomLevel());\n    this.gsvLoader.load(panoId);\n    this.gsvLoader.loaded = true;\n  },\n\n  /**\n   * This will be called when panorama is loaded\n   * @param  {HTMLCanvasElement} canvas - Canvas where the tiles have been drawn\n   * @memberOf GoogleStreetviewPanorama\n   * @instance\n   */\n  onLoad: function (canvas) {\n    ImagePanorama.prototype.onLoad.call(this, new Texture(canvas));\n  },\n\n  /**\n   * Reset\n   * @memberOf GoogleStreetviewPanorama\n   * @instance\n   */\n  reset: function () {\n    this.gsvLoader = undefined;\n    ImagePanorama.prototype.reset.call(this);\n  }\n});\n/**\n * Stereographic projection shader\n * based on http://notlion.github.io/streetview-stereographic\n * @author pchen66\n */\n\n/**\n * @description Stereograhpic Shader\n * @module StereographicShader\n * @property {object} uniforms\n * @property {THREE.Texture} uniforms.tDiffuse diffuse map\n * @property {number} uniforms.resolution image resolution\n * @property {THREE.Matrix4} uniforms.transform transformation matrix\n * @property {number} uniforms.zoom image zoom factor\n * @property {number} uniforms.opacity image opacity\n * @property {string} vertexShader vertex shader\n * @property {string} fragmentShader fragment shader\n */\n\nconst StereographicShader = {\n  uniforms: {\n    'tDiffuse': {\n      value: new Texture()\n    },\n    'resolution': {\n      value: 1.0\n    },\n    'transform': {\n      value: new Matrix4()\n    },\n    'zoom': {\n      value: 1.0\n    },\n    'opacity': {\n      value: 1.0\n    }\n  },\n  vertexShader: ['varying vec2 vUv;', 'void main() {', 'vUv = uv;', 'gl_Position = vec4( position, 1.0 );', '}'].join('\\n'),\n  fragmentShader: ['uniform sampler2D tDiffuse;', 'uniform float resolution;', 'uniform mat4 transform;', 'uniform float zoom;', 'uniform float opacity;', 'varying vec2 vUv;', 'const float PI = 3.141592653589793;', 'void main(){', 'vec2 position = -1.0 +  2.0 * vUv;', 'position *= vec2( zoom * resolution, zoom * 0.5 );', 'float x2y2 = position.x * position.x + position.y * position.y;', 'vec3 sphere_pnt = vec3( 2. * position, x2y2 - 1. ) / ( x2y2 + 1. );', 'sphere_pnt = vec3( transform * vec4( sphere_pnt, 1.0 ) );', 'vec2 sampleUV = vec2(', '(atan(sphere_pnt.y, sphere_pnt.x) / PI + 1.0) * 0.5,', '(asin(sphere_pnt.z) / PI + 0.5)', ');', 'gl_FragColor = texture2D( tDiffuse, sampleUV );', 'gl_FragColor.a *= opacity;', '}'].join('\\n')\n};\n/**\n * @classdesc Little Planet\n * @constructor\n * @param {string} type \t\t- Type of little planet basic class\n * @param {string} source \t\t- URL for the image source\n * @param {number} [size=10000] - Size of plane geometry\n * @param {number} [ratio=0.5]  - Ratio of plane geometry's height against width\n */\n\nfunction LittlePlanet(type = 'image', source, size = 10000, ratio = 0.5) {\n  if (type === 'image') {\n    ImagePanorama.call(this, source, this.createGeometry(size, ratio), this.createMaterial(size));\n  }\n\n  this.size = size;\n  this.ratio = ratio;\n  this.EPS = 0.000001;\n  this.frameId = null;\n  this.dragging = false;\n  this.userMouse = new Vector2();\n  this.quatA = new Quaternion();\n  this.quatB = new Quaternion();\n  this.quatCur = new Quaternion();\n  this.quatSlerp = new Quaternion();\n  this.vectorX = new Vector3(1, 0, 0);\n  this.vectorY = new Vector3(0, 1, 0);\n  this.addEventListener('window-resize', this.onWindowResize);\n}\n\nLittlePlanet.prototype = Object.assign(Object.create(ImagePanorama.prototype), {\n  constructor: LittlePlanet,\n  add: function (object) {\n    if (arguments.length > 1) {\n      for (let i = 0; i < arguments.length; i++) {\n        this.add(arguments[i]);\n      }\n\n      return this;\n    }\n\n    if (object instanceof Infospot) {\n      object.material.depthTest = false;\n    }\n\n    ImagePanorama.prototype.add.call(this, object);\n  },\n  createGeometry: function (size, ratio) {\n    return new PlaneBufferGeometry(size, size * ratio);\n  },\n  createMaterial: function (size) {\n    const shader = Object.assign({}, StereographicShader),\n          uniforms = shader.uniforms;\n    uniforms.zoom.value = size;\n    uniforms.opacity.value = 0.0;\n    return new ShaderMaterial({\n      uniforms: uniforms,\n      vertexShader: shader.vertexShader,\n      fragmentShader: shader.fragmentShader,\n      side: BackSide,\n      transparent: true\n    });\n  },\n  registerMouseEvents: function () {\n    this.container.addEventListener('mousedown', this.onMouseDown.bind(this), {\n      passive: true\n    });\n    this.container.addEventListener('mousemove', this.onMouseMove.bind(this), {\n      passive: true\n    });\n    this.container.addEventListener('mouseup', this.onMouseUp.bind(this), {\n      passive: true\n    });\n    this.container.addEventListener('touchstart', this.onMouseDown.bind(this), {\n      passive: true\n    });\n    this.container.addEventListener('touchmove', this.onMouseMove.bind(this), {\n      passive: true\n    });\n    this.container.addEventListener('touchend', this.onMouseUp.bind(this), {\n      passive: true\n    });\n    this.container.addEventListener('mousewheel', this.onMouseWheel.bind(this), {\n      passive: false\n    });\n    this.container.addEventListener('DOMMouseScroll', this.onMouseWheel.bind(this), {\n      passive: false\n    });\n    this.container.addEventListener('contextmenu', this.onContextMenu.bind(this), {\n      passive: true\n    });\n  },\n  unregisterMouseEvents: function () {\n    this.container.removeEventListener('mousedown', this.onMouseDown.bind(this), false);\n    this.container.removeEventListener('mousemove', this.onMouseMove.bind(this), false);\n    this.container.removeEventListener('mouseup', this.onMouseUp.bind(this), false);\n    this.container.removeEventListener('touchstart', this.onMouseDown.bind(this), false);\n    this.container.removeEventListener('touchmove', this.onMouseMove.bind(this), false);\n    this.container.removeEventListener('touchend', this.onMouseUp.bind(this), false);\n    this.container.removeEventListener('mousewheel', this.onMouseWheel.bind(this), false);\n    this.container.removeEventListener('DOMMouseScroll', this.onMouseWheel.bind(this), false);\n    this.container.removeEventListener('contextmenu', this.onContextMenu.bind(this), false);\n  },\n  onMouseDown: function (event) {\n    const inputCount = event.touches && event.touches.length || 1;\n\n    switch (inputCount) {\n      case 1:\n        const x = event.clientX >= 0 ? event.clientX : event.touches[0].clientX;\n        const y = event.clientY >= 0 ? event.clientY : event.touches[0].clientY;\n        this.dragging = true;\n        this.userMouse.set(x, y);\n        break;\n\n      case 2:\n        const dx = event.touches[0].pageX - event.touches[1].pageX;\n        const dy = event.touches[0].pageY - event.touches[1].pageY;\n        const distance = Math.sqrt(dx * dx + dy * dy);\n        this.userMouse.pinchDistance = distance;\n        break;\n\n      default:\n        break;\n    }\n\n    this.onUpdateCallback();\n  },\n  onMouseMove: function (event) {\n    const inputCount = event.touches && event.touches.length || 1;\n\n    switch (inputCount) {\n      case 1:\n        const x = event.clientX >= 0 ? event.clientX : event.touches[0].clientX;\n        const y = event.clientY >= 0 ? event.clientY : event.touches[0].clientY;\n        const angleX = Math$1.degToRad(x - this.userMouse.x) * 0.4;\n        const angleY = Math$1.degToRad(y - this.userMouse.y) * 0.4;\n\n        if (this.dragging) {\n          this.quatA.setFromAxisAngle(this.vectorY, angleX);\n          this.quatB.setFromAxisAngle(this.vectorX, angleY);\n          this.quatCur.multiply(this.quatA).multiply(this.quatB);\n          this.userMouse.set(x, y);\n        }\n\n        break;\n\n      case 2:\n        const dx = event.touches[0].pageX - event.touches[1].pageX;\n        const dy = event.touches[0].pageY - event.touches[1].pageY;\n        const distance = Math.sqrt(dx * dx + dy * dy);\n        this.addZoomDelta(this.userMouse.pinchDistance - distance);\n        break;\n\n      default:\n        break;\n    }\n  },\n  onMouseUp: function () {\n    this.dragging = false;\n  },\n  onMouseWheel: function (event) {\n    event.preventDefault();\n    event.stopPropagation();\n    let delta = 0;\n\n    if (event.wheelDelta !== undefined) {\n      // WebKit / Opera / Explorer 9\n      delta = event.wheelDelta;\n    } else if (event.detail !== undefined) {\n      // Firefox\n      delta = -event.detail;\n    }\n\n    this.addZoomDelta(delta);\n    this.onUpdateCallback();\n  },\n  addZoomDelta: function (delta) {\n    const uniforms = this.material.uniforms;\n    const lowerBound = this.size * 0.1;\n    const upperBound = this.size * 10;\n    uniforms.zoom.value += delta;\n\n    if (uniforms.zoom.value <= lowerBound) {\n      uniforms.zoom.value = lowerBound;\n    } else if (uniforms.zoom.value >= upperBound) {\n      uniforms.zoom.value = upperBound;\n    }\n  },\n  onUpdateCallback: function () {\n    this.frameId = window.requestAnimationFrame(this.onUpdateCallback.bind(this));\n    this.quatSlerp.slerp(this.quatCur, 0.1);\n\n    if (this.material) {\n      this.material.uniforms.transform.value.makeRotationFromQuaternion(this.quatSlerp);\n    }\n\n    if (!this.dragging && 1.0 - this.quatSlerp.clone().dot(this.quatCur) < this.EPS) {\n      window.cancelAnimationFrame(this.frameId);\n    }\n  },\n  reset: function () {\n    this.quatCur.set(0, 0, 0, 1);\n    this.quatSlerp.set(0, 0, 0, 1);\n    this.onUpdateCallback();\n  },\n  onLoad: function (texture) {\n    this.material.uniforms.resolution.value = this.container.clientWidth / this.container.clientHeight;\n    this.registerMouseEvents();\n    this.onUpdateCallback();\n    this.dispatchEvent({\n      type: 'panolens-viewer-handler',\n      method: 'disableControl'\n    });\n    ImagePanorama.prototype.onLoad.call(this, texture);\n  },\n  onLeave: function () {\n    this.unregisterMouseEvents();\n    this.dispatchEvent({\n      type: 'panolens-viewer-handler',\n      method: 'enableControl',\n      data: CONTROLS.ORBIT\n    });\n    window.cancelAnimationFrame(this.frameId);\n    ImagePanorama.prototype.onLeave.call(this);\n  },\n  onWindowResize: function () {\n    this.material.uniforms.resolution.value = this.container.clientWidth / this.container.clientHeight;\n  },\n  onContextMenu: function () {\n    this.dragging = false;\n  },\n  dispose: function () {\n    this.unregisterMouseEvents();\n    ImagePanorama.prototype.dispose.call(this);\n  }\n});\n/**\n * @classdesc Image Little Planet\n * @constructor\n * @param {string} source \t\t- URL for the image source\n * @param {number} [size=10000] - Size of plane geometry\n * @param {number} [ratio=0.5]  - Ratio of plane geometry's height against width\n */\n\nfunction ImageLittlePlanet(source, size, ratio) {\n  LittlePlanet.call(this, 'image', source, size, ratio);\n}\n\nImageLittlePlanet.prototype = Object.assign(Object.create(LittlePlanet.prototype), {\n  constructor: ImageLittlePlanet,\n\n  /**\n   * On loaded with texture\n   * @param {THREE.Texture} texture\n   * @memberOf ImageLittlePlanet\n   * @instance\n   */\n  onLoad: function (texture) {\n    this.updateTexture(texture);\n    LittlePlanet.prototype.onLoad.call(this, texture);\n  },\n\n  /**\n   * Update texture\n   * @param {THREE.Texture} texture \n   * @memberOf ImageLittlePlanet\n   * @instance\n   */\n  updateTexture: function (texture) {\n    texture.minFilter = texture.magFilter = LinearFilter;\n    this.material.uniforms['tDiffuse'].value = texture;\n  },\n\n  /**\n   * Dispose\n   * @memberOf ImageLittlePlanet\n   * @instance\n   */\n  dispose: function () {\n    const tDiffuse = this.material.uniforms['tDiffuse'];\n\n    if (tDiffuse && tDiffuse.value) {\n      tDiffuse.value.dispose();\n    }\n\n    LittlePlanet.prototype.dispose.call(this);\n  }\n});\n/**\n * @classdesc Camera panorama\n * @description See {@link https://developer.mozilla.org/en-US/docs/Web/API/MediaStreamConstraints|MediaStreamConstraints} for constraints\n * @param {object} - camera constraints\n * @constructor\n */\n\nfunction CameraPanorama(constraints) {\n  const radius = 5000;\n  const geometry = new SphereBufferGeometry(radius, 60, 40);\n  const material = new MeshBasicMaterial({\n    visible: false\n  });\n  Panorama.call(this, geometry, material);\n  this.media = new Media(constraints);\n  this.radius = radius;\n  this.addEventListener('enter', this.start.bind(this));\n  this.addEventListener('leave', this.stop.bind(this));\n  this.addEventListener('panolens-container', this.onPanolensContainer.bind(this));\n  this.addEventListener('panolens-scene', this.onPanolensScene.bind(this));\n}\n\nCameraPanorama.prototype = Object.assign(Object.create(Panorama.prototype), {\n  constructor: CameraPanorama,\n\n  /**\n   * On container event\n   * @param {object} event\n   * @memberOf CameraPanorama\n   * @instance\n   */\n  onPanolensContainer: function ({\n    container\n  }) {\n    this.media.setContainer(container);\n  },\n\n  /**\n   * On scene event\n   * @param {object} event \n   * @memberOf CameraPanorama\n   * @instance\n   */\n  onPanolensScene: function ({\n    scene\n  }) {\n    this.media.setScene(scene);\n  },\n\n  /**\n   * Start camera streaming\n   * @memberOf CameraPanorama\n   * @instance\n   * @returns {Promise}\n   */\n  start: function () {\n    return this.media.start();\n  },\n\n  /**\n   * Stop camera streaming\n   * @memberOf CameraPanorama\n   * @instance\n   */\n  stop: function () {\n    this.media.stop();\n  }\n});\n/**\n * @classdesc Orbit Controls\n * @constructor\n * @external OrbitControls\n * @param {THREE.Object} object \n * @param {HTMLElement} domElement \n */\n\nfunction OrbitControls(object, domElement) {\n  this.object = object;\n  this.domElement = domElement !== undefined ? domElement : document;\n  this.document = domElement !== undefined ? domElement.ownerDocument : document;\n  this.frameId = null; // API\n  // Set to false to disable this control\n\n  this.enabled = true;\n  /*\n   * \"target\" sets the location of focus, where the control orbits around\n   * and where it pans with respect to.\n   */\n\n  this.target = new Vector3(); // center is old, deprecated; use \"target\" instead\n\n  this.center = this.target;\n  /*\n   * This option actually enables dollying in and out; left as \"zoom\" for\n   * backwards compatibility\n   */\n\n  this.noZoom = false;\n  this.zoomSpeed = 1.0; // Limits to how far you can dolly in and out ( PerspectiveCamera only )\n\n  this.minDistance = 0;\n  this.maxDistance = Infinity; // Limits to how far you can zoom in and out ( OrthographicCamera only )\n\n  this.minZoom = 0;\n  this.maxZoom = Infinity; // Set to true to disable this control\n\n  this.noRotate = false;\n  this.rotateSpeed = -0.15; // Set to true to disable this control\n\n  this.noPan = true;\n  this.keyPanSpeed = 7.0; // pixels moved per arrow key push\n  // Set to true to automatically rotate around the target\n\n  this.autoRotate = false;\n  this.autoRotateSpeed = 2.0; // 30 seconds per round when fps is 60\n\n  /*\n   * How far you can orbit vertically, upper and lower limits.\n   * Range is 0 to Math.PI radians.\n   */\n\n  this.minPolarAngle = 0; // radians\n\n  this.maxPolarAngle = Math.PI; // radians\n  // Momentum\n\n  this.momentumDampingFactor = 0.90;\n  this.momentumScalingFactor = -0.005;\n  this.momentumKeydownFactor = 20; // Fov\n\n  this.minFov = 30;\n  this.maxFov = 120;\n  /*\n   * How far you can orbit horizontally, upper and lower limits.\n   * If set, must be a sub-interval of the interval [ - Math.PI, Math.PI ].\n   */\n\n  this.minAzimuthAngle = -Infinity; // radians\n\n  this.maxAzimuthAngle = Infinity; // radians\n  // Set to true to disable use of the keys\n\n  this.noKeys = false; // The four arrow keys\n\n  this.keys = {\n    LEFT: 37,\n    UP: 38,\n    RIGHT: 39,\n    BOTTOM: 40\n  }; // Mouse buttons\n\n  this.mouseButtons = {\n    ORBIT: MOUSE.LEFT,\n    ZOOM: MOUSE.MIDDLE,\n    PAN: MOUSE.RIGHT\n  };\n  /*\n   * //////////\n   * internals\n   */\n\n  var scope = this;\n  var EPS = 10e-8;\n  var MEPS = 10e-5;\n  var rotateStart = new Vector2();\n  var rotateEnd = new Vector2();\n  var rotateDelta = new Vector2();\n  var panStart = new Vector2();\n  var panEnd = new Vector2();\n  var panDelta = new Vector2();\n  var panOffset = new Vector3();\n  var offset = new Vector3();\n  var dollyStart = new Vector2();\n  var dollyEnd = new Vector2();\n  var dollyDelta = new Vector2();\n  var theta = 0;\n  var phi = 0;\n  var phiDelta = 0;\n  var thetaDelta = 0;\n  var scale = 1;\n  var pan = new Vector3();\n  var lastPosition = new Vector3();\n  var lastQuaternion = new Quaternion();\n  var momentumLeft = 0,\n      momentumUp = 0;\n  var eventPrevious;\n  var momentumOn = false;\n  var keyUp, keyBottom, keyLeft, keyRight;\n  var STATE = {\n    NONE: -1,\n    ROTATE: 0,\n    DOLLY: 1,\n    PAN: 2,\n    TOUCH_ROTATE: 3,\n    TOUCH_DOLLY: 4,\n    TOUCH_PAN: 5\n  };\n  var state = STATE.NONE; // for reset\n\n  this.target0 = this.target.clone();\n  this.position0 = this.object.position.clone();\n  this.zoom0 = this.object.zoom; // so camera.up is the orbit axis\n\n  var quat = new Quaternion().setFromUnitVectors(object.up, new Vector3(0, 1, 0));\n  var quatInverse = quat.clone().inverse(); // events\n\n  var changeEvent = {\n    type: 'change'\n  };\n  var startEvent = {\n    type: 'start'\n  };\n  var endEvent = {\n    type: 'end'\n  };\n\n  this.setLastQuaternion = function (quaternion) {\n    lastQuaternion.copy(quaternion);\n    scope.object.quaternion.copy(quaternion);\n  };\n\n  this.getLastPosition = function () {\n    return lastPosition;\n  };\n\n  this.rotateLeft = function (angle) {\n    if (angle === undefined) {\n      angle = getAutoRotationAngle();\n    }\n\n    thetaDelta -= angle;\n  };\n\n  this.rotateUp = function (angle) {\n    if (angle === undefined) {\n      angle = getAutoRotationAngle();\n    }\n\n    phiDelta -= angle;\n  }; // pass in distance in world space to move left\n\n\n  this.panLeft = function (distance) {\n    var te = this.object.matrix.elements; // get X column of matrix\n\n    panOffset.set(te[0], te[1], te[2]);\n    panOffset.multiplyScalar(-distance);\n    pan.add(panOffset);\n  }; // pass in distance in world space to move up\n\n\n  this.panUp = function (distance) {\n    var te = this.object.matrix.elements; // get Y column of matrix\n\n    panOffset.set(te[4], te[5], te[6]);\n    panOffset.multiplyScalar(distance);\n    pan.add(panOffset);\n  };\n  /*\n   * pass in x,y of change desired in pixel space,\n   * right and down are positive\n   */\n\n\n  this.pan = function (deltaX, deltaY) {\n    var element = scope.domElement === document ? scope.domElement.body : scope.domElement;\n\n    if (scope.object instanceof PerspectiveCamera) {\n      // perspective\n      var position = scope.object.position;\n      var offset = position.clone().sub(scope.target);\n      var targetDistance = offset.length(); // half of the fov is center to top of screen\n\n      targetDistance *= Math.tan(scope.object.fov / 2 * Math.PI / 180.0); // we actually don't use screenWidth, since perspective camera is fixed to screen height\n\n      scope.panLeft(2 * deltaX * targetDistance / element.clientHeight);\n      scope.panUp(2 * deltaY * targetDistance / element.clientHeight);\n    } else if (scope.object instanceof OrthographicCamera) {\n      // orthographic\n      scope.panLeft(deltaX * (scope.object.right - scope.object.left) / element.clientWidth);\n      scope.panUp(deltaY * (scope.object.top - scope.object.bottom) / element.clientHeight);\n    } else {\n      // camera neither orthographic or perspective\n      console.warn('WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.');\n    }\n  };\n\n  this.momentum = function () {\n    if (!momentumOn) return;\n\n    if (Math.abs(momentumLeft) < MEPS && Math.abs(momentumUp) < MEPS) {\n      momentumOn = false;\n      return;\n    }\n\n    momentumUp *= this.momentumDampingFactor;\n    momentumLeft *= this.momentumDampingFactor;\n    thetaDelta -= this.momentumScalingFactor * momentumLeft;\n    phiDelta -= this.momentumScalingFactor * momentumUp;\n  };\n\n  this.dollyIn = function (dollyScale) {\n    if (dollyScale === undefined) {\n      dollyScale = getZoomScale();\n    }\n\n    if (scope.object instanceof PerspectiveCamera) {\n      scale /= dollyScale;\n    } else if (scope.object instanceof OrthographicCamera) {\n      scope.object.zoom = Math.max(this.minZoom, Math.min(this.maxZoom, this.object.zoom * dollyScale));\n      scope.object.updateProjectionMatrix();\n      scope.dispatchEvent(changeEvent);\n    } else {\n      console.warn('WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.');\n    }\n  };\n\n  this.dollyOut = function (dollyScale) {\n    if (dollyScale === undefined) {\n      dollyScale = getZoomScale();\n    }\n\n    if (scope.object instanceof PerspectiveCamera) {\n      scale *= dollyScale;\n    } else if (scope.object instanceof OrthographicCamera) {\n      scope.object.zoom = Math.max(this.minZoom, Math.min(this.maxZoom, this.object.zoom / dollyScale));\n      scope.object.updateProjectionMatrix();\n      scope.dispatchEvent(changeEvent);\n    } else {\n      console.warn('WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.');\n    }\n  };\n\n  this.update = function (ignoreUpdate) {\n    var position = this.object.position;\n    offset.copy(position).sub(this.target); // rotate offset to \"y-axis-is-up\" space\n\n    offset.applyQuaternion(quat); // angle from z-axis around y-axis\n\n    theta = Math.atan2(offset.x, offset.z); // angle from y-axis\n\n    phi = Math.atan2(Math.sqrt(offset.x * offset.x + offset.z * offset.z), offset.y);\n\n    if (this.autoRotate && state === STATE.NONE) {\n      this.rotateLeft(getAutoRotationAngle());\n    }\n\n    this.momentum();\n    theta += thetaDelta;\n    phi += phiDelta; // restrict theta to be between desired limits\n\n    theta = Math.max(this.minAzimuthAngle, Math.min(this.maxAzimuthAngle, theta)); // restrict phi to be between desired limits\n\n    phi = Math.max(this.minPolarAngle, Math.min(this.maxPolarAngle, phi)); // restrict phi to be betwee EPS and PI-EPS\n\n    phi = Math.max(EPS, Math.min(Math.PI - EPS, phi));\n    var radius = offset.length() * scale; // restrict radius to be between desired limits\n\n    radius = Math.max(this.minDistance, Math.min(this.maxDistance, radius)); // move target to panned location\n\n    this.target.add(pan);\n    offset.x = radius * Math.sin(phi) * Math.sin(theta);\n    offset.y = radius * Math.cos(phi);\n    offset.z = radius * Math.sin(phi) * Math.cos(theta); // rotate offset back to \"camera-up-vector-is-up\" space\n\n    offset.applyQuaternion(quatInverse);\n    position.copy(this.target).add(offset);\n    this.object.lookAt(this.target);\n    thetaDelta = 0;\n    phiDelta = 0;\n    scale = 1;\n    pan.set(0, 0, 0);\n    /*\n     * update condition is:\n     * min(camera displacement, camera rotation in radians)^2 > EPS\n     * using small-angle approximation cos(x/2) = 1 - x^2 / 8\n     */\n\n    if (lastPosition.distanceToSquared(this.object.position) > EPS || 8 * (1 - lastQuaternion.dot(this.object.quaternion)) > EPS) {\n      if (ignoreUpdate !== true) {\n        this.dispatchEvent(changeEvent);\n      }\n\n      lastPosition.copy(this.object.position);\n      lastQuaternion.copy(this.object.quaternion);\n    }\n  };\n\n  this.reset = function () {\n    state = STATE.NONE;\n    this.target.copy(this.target0);\n    this.object.position.copy(this.position0);\n    this.object.zoom = this.zoom0;\n    this.object.updateProjectionMatrix();\n    this.dispatchEvent(changeEvent);\n    this.update();\n  };\n\n  this.getPolarAngle = function () {\n    return phi;\n  };\n\n  this.getAzimuthalAngle = function () {\n    return theta;\n  };\n\n  function getAutoRotationAngle() {\n    return 2 * Math.PI / 60 / 60 * scope.autoRotateSpeed;\n  }\n\n  function getZoomScale() {\n    return Math.pow(0.95, scope.zoomSpeed);\n  }\n\n  function onMouseDown(event) {\n    momentumOn = false;\n    momentumLeft = momentumUp = 0;\n    if (scope.enabled === false) return;\n    event.preventDefault();\n\n    if (event.button === scope.mouseButtons.ORBIT) {\n      if (scope.noRotate === true) return;\n      state = STATE.ROTATE;\n      rotateStart.set(event.clientX, event.clientY);\n    } else if (event.button === scope.mouseButtons.ZOOM) {\n      if (scope.noZoom === true) return;\n      state = STATE.DOLLY;\n      dollyStart.set(event.clientX, event.clientY);\n    } else if (event.button === scope.mouseButtons.PAN) {\n      if (scope.noPan === true) return;\n      state = STATE.PAN;\n      panStart.set(event.clientX, event.clientY);\n    }\n\n    if (state !== STATE.NONE) {\n      scope.document.addEventListener('mousemove', onMouseMove, false);\n      scope.document.addEventListener('mouseup', onMouseUp, false);\n      scope.dispatchEvent(startEvent);\n    }\n\n    scope.update();\n  }\n\n  function onMouseMove(event) {\n    if (scope.enabled === false) return;\n    event.preventDefault();\n    var element = scope.domElement === document ? scope.domElement.body : scope.domElement;\n\n    if (state === STATE.ROTATE) {\n      if (scope.noRotate === true) return;\n      rotateEnd.set(event.clientX, event.clientY);\n      rotateDelta.subVectors(rotateEnd, rotateStart); // rotating across whole screen goes 360 degrees around\n\n      scope.rotateLeft(2 * Math.PI * rotateDelta.x / element.clientWidth * scope.rotateSpeed); // rotating up and down along whole screen attempts to go 360, but limited to 180\n\n      scope.rotateUp(2 * Math.PI * rotateDelta.y / element.clientHeight * scope.rotateSpeed);\n      rotateStart.copy(rotateEnd);\n\n      if (eventPrevious) {\n        momentumLeft = event.clientX - eventPrevious.clientX;\n        momentumUp = event.clientY - eventPrevious.clientY;\n      }\n\n      eventPrevious = event;\n    } else if (state === STATE.DOLLY) {\n      if (scope.noZoom === true) return;\n      dollyEnd.set(event.clientX, event.clientY);\n      dollyDelta.subVectors(dollyEnd, dollyStart);\n\n      if (dollyDelta.y > 0) {\n        scope.dollyIn();\n      } else if (dollyDelta.y < 0) {\n        scope.dollyOut();\n      }\n\n      dollyStart.copy(dollyEnd);\n    } else if (state === STATE.PAN) {\n      if (scope.noPan === true) return;\n      panEnd.set(event.clientX, event.clientY);\n      panDelta.subVectors(panEnd, panStart);\n      scope.pan(panDelta.x, panDelta.y);\n      panStart.copy(panEnd);\n    }\n\n    if (state !== STATE.NONE) scope.update();\n  }\n\n  function onMouseUp()\n  /* event */\n  {\n    momentumOn = true;\n    eventPrevious = undefined;\n    if (scope.enabled === false) return;\n    scope.document.removeEventListener('mousemove', onMouseMove, false);\n    scope.document.removeEventListener('mouseup', onMouseUp, false);\n    scope.dispatchEvent(endEvent);\n    state = STATE.NONE;\n  }\n\n  function onMouseWheel(event) {\n    if (scope.enabled === false || scope.noZoom === true || state !== STATE.NONE) return;\n    event.preventDefault();\n    event.stopPropagation();\n    var delta = 0;\n\n    if (event.wheelDelta !== undefined) {\n      // WebKit / Opera / Explorer 9\n      delta = event.wheelDelta;\n    } else if (event.detail !== undefined) {\n      // Firefox\n      delta = -event.detail;\n    }\n\n    if (delta > 0) {\n      // scope.dollyOut();\n      scope.object.fov = scope.object.fov < scope.maxFov ? scope.object.fov + 1 : scope.maxFov;\n      scope.object.updateProjectionMatrix();\n    } else if (delta < 0) {\n      // scope.dollyIn();\n      scope.object.fov = scope.object.fov > scope.minFov ? scope.object.fov - 1 : scope.minFov;\n      scope.object.updateProjectionMatrix();\n    }\n\n    scope.update();\n    scope.dispatchEvent(changeEvent);\n    scope.dispatchEvent(startEvent);\n    scope.dispatchEvent(endEvent);\n  }\n\n  function onKeyUp(event) {\n    switch (event.keyCode) {\n      case scope.keys.UP:\n        keyUp = false;\n        break;\n\n      case scope.keys.BOTTOM:\n        keyBottom = false;\n        break;\n\n      case scope.keys.LEFT:\n        keyLeft = false;\n        break;\n\n      case scope.keys.RIGHT:\n        keyRight = false;\n        break;\n    }\n  }\n\n  function onKeyDown(event) {\n    if (scope.enabled === false || scope.noKeys === true || scope.noRotate === true) return;\n\n    switch (event.keyCode) {\n      case scope.keys.UP:\n        keyUp = true;\n        break;\n\n      case scope.keys.BOTTOM:\n        keyBottom = true;\n        break;\n\n      case scope.keys.LEFT:\n        keyLeft = true;\n        break;\n\n      case scope.keys.RIGHT:\n        keyRight = true;\n        break;\n    }\n\n    if (keyUp || keyBottom || keyLeft || keyRight) {\n      momentumOn = true;\n      if (keyUp) momentumUp = -scope.rotateSpeed * scope.momentumKeydownFactor;\n      if (keyBottom) momentumUp = scope.rotateSpeed * scope.momentumKeydownFactor;\n      if (keyLeft) momentumLeft = -scope.rotateSpeed * scope.momentumKeydownFactor;\n      if (keyRight) momentumLeft = scope.rotateSpeed * scope.momentumKeydownFactor;\n    }\n  }\n\n  function touchstart(event) {\n    momentumOn = false;\n    momentumLeft = momentumUp = 0;\n    if (scope.enabled === false) return;\n\n    switch (event.touches.length) {\n      case 1:\n        // one-fingered touch: rotate\n        if (scope.noRotate === true) return;\n        state = STATE.TOUCH_ROTATE;\n        rotateStart.set(event.touches[0].pageX, event.touches[0].pageY);\n        break;\n\n      case 2:\n        // two-fingered touch: dolly\n        if (scope.noZoom === true) return;\n        state = STATE.TOUCH_DOLLY;\n        var dx = event.touches[0].pageX - event.touches[1].pageX;\n        var dy = event.touches[0].pageY - event.touches[1].pageY;\n        var distance = Math.sqrt(dx * dx + dy * dy);\n        dollyStart.set(0, distance);\n        break;\n\n      case 3:\n        // three-fingered touch: pan\n        if (scope.noPan === true) return;\n        state = STATE.TOUCH_PAN;\n        panStart.set(event.touches[0].pageX, event.touches[0].pageY);\n        break;\n\n      default:\n        state = STATE.NONE;\n    }\n\n    if (state !== STATE.NONE) scope.dispatchEvent(startEvent);\n  }\n\n  function touchmove(event) {\n    if (scope.enabled === false) return;\n    event.preventDefault();\n    event.stopPropagation();\n    var element = scope.domElement === document ? scope.domElement.body : scope.domElement;\n\n    switch (event.touches.length) {\n      case 1:\n        // one-fingered touch: rotate\n        if (scope.noRotate === true) return;\n        if (state !== STATE.TOUCH_ROTATE) return;\n        rotateEnd.set(event.touches[0].pageX, event.touches[0].pageY);\n        rotateDelta.subVectors(rotateEnd, rotateStart); // rotating across whole screen goes 360 degrees around\n\n        scope.rotateLeft(2 * Math.PI * rotateDelta.x / element.clientWidth * scope.rotateSpeed); // rotating up and down along whole screen attempts to go 360, but limited to 180\n\n        scope.rotateUp(2 * Math.PI * rotateDelta.y / element.clientHeight * scope.rotateSpeed);\n        rotateStart.copy(rotateEnd);\n\n        if (eventPrevious) {\n          momentumLeft = event.touches[0].pageX - eventPrevious.pageX;\n          momentumUp = event.touches[0].pageY - eventPrevious.pageY;\n        }\n\n        eventPrevious = {\n          pageX: event.touches[0].pageX,\n          pageY: event.touches[0].pageY\n        };\n        scope.update();\n        break;\n\n      case 2:\n        // two-fingered touch: dolly\n        if (scope.noZoom === true) return;\n        if (state !== STATE.TOUCH_DOLLY) return;\n        var dx = event.touches[0].pageX - event.touches[1].pageX;\n        var dy = event.touches[0].pageY - event.touches[1].pageY;\n        var distance = Math.sqrt(dx * dx + dy * dy);\n        dollyEnd.set(0, distance);\n        dollyDelta.subVectors(dollyEnd, dollyStart);\n\n        if (dollyDelta.y < 0) {\n          scope.object.fov = scope.object.fov < scope.maxFov ? scope.object.fov + 1 : scope.maxFov;\n          scope.object.updateProjectionMatrix();\n        } else if (dollyDelta.y > 0) {\n          scope.object.fov = scope.object.fov > scope.minFov ? scope.object.fov - 1 : scope.minFov;\n          scope.object.updateProjectionMatrix();\n        }\n\n        dollyStart.copy(dollyEnd);\n        scope.update();\n        scope.dispatchEvent(changeEvent);\n        break;\n\n      case 3:\n        // three-fingered touch: pan\n        if (scope.noPan === true) return;\n        if (state !== STATE.TOUCH_PAN) return;\n        panEnd.set(event.touches[0].pageX, event.touches[0].pageY);\n        panDelta.subVectors(panEnd, panStart);\n        scope.pan(panDelta.x, panDelta.y);\n        panStart.copy(panEnd);\n        scope.update();\n        break;\n\n      default:\n        state = STATE.NONE;\n    }\n  }\n\n  function touchend()\n  /* event */\n  {\n    momentumOn = true;\n    eventPrevious = undefined;\n    if (scope.enabled === false) return;\n    scope.dispatchEvent(endEvent);\n    state = STATE.NONE;\n  }\n\n  this.dispose = function () {\n    this.domElement.removeEventListener('mousedown', onMouseDown);\n    this.domElement.removeEventListener('mousewheel', onMouseWheel);\n    this.domElement.removeEventListener('DOMMouseScroll', onMouseWheel);\n    this.domElement.removeEventListener('touchstart', touchstart);\n    this.domElement.removeEventListener('touchend', touchend);\n    this.domElement.removeEventListener('touchmove', touchmove);\n    window.removeEventListener('keyup', onKeyUp);\n    window.removeEventListener('keydown', onKeyDown);\n  }; // this.domElement.addEventListener( 'contextmenu', function ( event ) { event.preventDefault(); }, false );\n\n\n  this.domElement.addEventListener('mousedown', onMouseDown, {\n    passive: false\n  });\n  this.domElement.addEventListener('mousewheel', onMouseWheel, {\n    passive: false\n  });\n  this.domElement.addEventListener('DOMMouseScroll', onMouseWheel, {\n    passive: false\n  }); // firefox\n\n  this.domElement.addEventListener('touchstart', touchstart, {\n    passive: false\n  });\n  this.domElement.addEventListener('touchend', touchend, {\n    passive: false\n  });\n  this.domElement.addEventListener('touchmove', touchmove, {\n    passive: false\n  });\n  window.addEventListener('keyup', onKeyUp, {\n    passive: false\n  });\n  window.addEventListener('keydown', onKeyDown, {\n    passive: false\n  }); // force an update at start\n\n  this.update();\n}\n\nOrbitControls.prototype = Object.assign(Object.create(EventDispatcher.prototype), {\n  constructor: OrbitControls\n});\n/**\n * @classdesc Device Orientation Control\n * @constructor\n * @external DeviceOrientationControls\n * @param {THREE.Camera} camera \n * @param {HTMLElement} domElement \n */\n\nfunction DeviceOrientationControls(camera, domElement) {\n  var scope = this;\n  var changeEvent = {\n    type: 'change'\n  };\n  var rotY = 0;\n  var rotX = 0;\n  var tempX = 0;\n  var tempY = 0;\n  this.camera = camera;\n  this.camera.rotation.reorder('YXZ');\n  this.domElement = domElement !== undefined ? domElement : document;\n  this.enabled = true;\n  this.deviceOrientation = {};\n  this.screenOrientation = 0;\n  this.alpha = 0;\n  this.alphaOffsetAngle = 0;\n\n  var onDeviceOrientationChangeEvent = function (event) {\n    scope.deviceOrientation = event;\n  };\n\n  var onScreenOrientationChangeEvent = function () {\n    scope.screenOrientation = window.orientation || 0;\n  };\n\n  var onTouchStartEvent = function (event) {\n    event.preventDefault();\n    event.stopPropagation();\n    tempX = event.touches[0].pageX;\n    tempY = event.touches[0].pageY;\n  };\n\n  var onTouchMoveEvent = function (event) {\n    event.preventDefault();\n    event.stopPropagation();\n    rotY += Math$1.degToRad((event.touches[0].pageX - tempX) / 4);\n    rotX += Math$1.degToRad((tempY - event.touches[0].pageY) / 4);\n    scope.updateAlphaOffsetAngle(rotY);\n    tempX = event.touches[0].pageX;\n    tempY = event.touches[0].pageY;\n  }; // The angles alpha, beta and gamma form a set of intrinsic Tait-Bryan angles of type Z-X'-Y''\n\n\n  var setCameraQuaternion = function (quaternion, alpha, beta, gamma, orient) {\n    var zee = new Vector3(0, 0, 1);\n    var euler = new Euler();\n    var q0 = new Quaternion();\n    var q1 = new Quaternion(-Math.sqrt(0.5), 0, 0, Math.sqrt(0.5)); // - PI/2 around the x-axis\n\n    var vectorFingerY;\n    var fingerQY = new Quaternion();\n    var fingerQX = new Quaternion();\n\n    if (scope.screenOrientation == 0) {\n      vectorFingerY = new Vector3(1, 0, 0);\n      fingerQY.setFromAxisAngle(vectorFingerY, -rotX);\n    } else if (scope.screenOrientation == 180) {\n      vectorFingerY = new Vector3(1, 0, 0);\n      fingerQY.setFromAxisAngle(vectorFingerY, rotX);\n    } else if (scope.screenOrientation == 90) {\n      vectorFingerY = new Vector3(0, 1, 0);\n      fingerQY.setFromAxisAngle(vectorFingerY, rotX);\n    } else if (scope.screenOrientation == -90) {\n      vectorFingerY = new Vector3(0, 1, 0);\n      fingerQY.setFromAxisAngle(vectorFingerY, -rotX);\n    }\n\n    q1.multiply(fingerQY);\n    q1.multiply(fingerQX);\n    euler.set(beta, alpha, -gamma, 'YXZ'); // 'ZXY' for the device, but 'YXZ' for us\n\n    quaternion.setFromEuler(euler); // orient the device\n\n    quaternion.multiply(q1); // camera looks out the back of the device, not the top\n\n    quaternion.multiply(q0.setFromAxisAngle(zee, -orient)); // adjust for screen orientation\n  };\n\n  this.connect = function () {\n    onScreenOrientationChangeEvent(); // run once on load\n\n    window.addEventListener('orientationchange', onScreenOrientationChangeEvent, {\n      passive: true\n    });\n    window.addEventListener('deviceorientation', onDeviceOrientationChangeEvent, {\n      passive: true\n    });\n    window.addEventListener('deviceorientation', this.update.bind(this), {\n      passive: true\n    });\n    scope.domElement.addEventListener('touchstart', onTouchStartEvent, {\n      passive: false\n    });\n    scope.domElement.addEventListener('touchmove', onTouchMoveEvent, {\n      passive: false\n    });\n    scope.enabled = true;\n  };\n\n  this.disconnect = function () {\n    window.removeEventListener('orientationchange', onScreenOrientationChangeEvent, false);\n    window.removeEventListener('deviceorientation', onDeviceOrientationChangeEvent, false);\n    window.removeEventListener('deviceorientation', this.update.bind(this), false);\n    scope.domElement.removeEventListener('touchstart', onTouchStartEvent, false);\n    scope.domElement.removeEventListener('touchmove', onTouchMoveEvent, false);\n    scope.enabled = false;\n  };\n\n  this.update = function (ignoreUpdate) {\n    if (scope.enabled === false) return;\n    var alpha = scope.deviceOrientation.alpha ? Math$1.degToRad(scope.deviceOrientation.alpha) + scope.alphaOffsetAngle : 0; // Z\n\n    var beta = scope.deviceOrientation.beta ? Math$1.degToRad(scope.deviceOrientation.beta) : 0; // X'\n\n    var gamma = scope.deviceOrientation.gamma ? Math$1.degToRad(scope.deviceOrientation.gamma) : 0; // Y''\n\n    var orient = scope.screenOrientation ? Math$1.degToRad(scope.screenOrientation) : 0; // O\n\n    setCameraQuaternion(scope.camera.quaternion, alpha, beta, gamma, orient);\n    scope.alpha = alpha;\n\n    if (ignoreUpdate !== true) {\n      scope.dispatchEvent(changeEvent);\n    }\n  };\n\n  this.updateAlphaOffsetAngle = function (angle) {\n    this.alphaOffsetAngle = angle;\n    this.update();\n  };\n\n  this.dispose = function () {\n    this.disconnect();\n  };\n\n  this.connect();\n}\n\nDeviceOrientationControls.prototype = Object.assign(Object.create(EventDispatcher.prototype), {\n  constructor: DeviceOrientationControls\n});\n/**\n * @classdesc Google Cardboard Effect Composer\n * @constructor\n * @external CardboardEffect\n * @param {THREE.WebGLRenderer} renderer \n */\n\nfunction CardboardEffect(renderer) {\n  var _camera = new OrthographicCamera(-1, 1, 1, -1, 0, 1);\n\n  var _scene = new Scene();\n\n  var _stereo = new StereoCamera();\n\n  _stereo.aspect = 0.5;\n  var _params = {\n    minFilter: LinearFilter,\n    magFilter: NearestFilter,\n    format: RGBAFormat\n  };\n\n  var _renderTarget = new WebGLRenderTarget(512, 512, _params);\n\n  _renderTarget.scissorTest = true;\n  _renderTarget.texture.generateMipmaps = false;\n  /*\n   * Distortion Mesh ported from:\n   * https://github.com/borismus/webvr-boilerplate/blob/master/src/distortion/barrel-distortion-fragment.js\n   */\n\n  var distortion = new Vector2(0.441, 0.156);\n  var geometry = new PlaneBufferGeometry(1, 1, 10, 20).removeAttribute('normal').toNonIndexed();\n  var positions = geometry.attributes.position.array;\n  var uvs = geometry.attributes.uv.array; // duplicate\n\n  geometry.attributes.position.count *= 2;\n  geometry.attributes.uv.count *= 2;\n  var positions2 = new Float32Array(positions.length * 2);\n  positions2.set(positions);\n  positions2.set(positions, positions.length);\n  var uvs2 = new Float32Array(uvs.length * 2);\n  uvs2.set(uvs);\n  uvs2.set(uvs, uvs.length);\n  var vector = new Vector2();\n  var length = positions.length / 3;\n\n  for (var i = 0, l = positions2.length / 3; i < l; i++) {\n    vector.x = positions2[i * 3 + 0];\n    vector.y = positions2[i * 3 + 1];\n    var dot = vector.dot(vector);\n    var scalar = 1.5 + (distortion.x + distortion.y * dot) * dot;\n    var offset = i < length ? 0 : 1;\n    positions2[i * 3 + 0] = vector.x / scalar * 1.5 - 0.5 + offset;\n    positions2[i * 3 + 1] = vector.y / scalar * 3.0;\n    uvs2[i * 2] = (uvs2[i * 2] + offset) * 0.5;\n  }\n\n  geometry.attributes.position.array = positions2;\n  geometry.attributes.uv.array = uvs2; //\n\n  var material = new MeshBasicMaterial({\n    map: _renderTarget.texture\n  });\n  var mesh = new Mesh(geometry, material);\n\n  _scene.add(mesh); //\n\n\n  this.setSize = function (width, height) {\n    renderer.setSize(width, height);\n    var pixelRatio = renderer.getPixelRatio();\n\n    _renderTarget.setSize(width * pixelRatio, height * pixelRatio);\n  };\n\n  this.render = function (scene, camera) {\n    scene.updateMatrixWorld();\n    if (camera.parent === null) camera.updateMatrixWorld();\n\n    _stereo.update(camera);\n\n    var width = _renderTarget.width / 2;\n    var height = _renderTarget.height;\n    if (renderer.autoClear) renderer.clear();\n\n    _renderTarget.scissor.set(0, 0, width, height);\n\n    _renderTarget.viewport.set(0, 0, width, height);\n\n    renderer.setRenderTarget(_renderTarget);\n    renderer.render(scene, _stereo.cameraL);\n    renderer.clearDepth();\n\n    _renderTarget.scissor.set(width, 0, width, height);\n\n    _renderTarget.viewport.set(width, 0, width, height);\n\n    renderer.setRenderTarget(_renderTarget);\n    renderer.render(scene, _stereo.cameraR);\n    renderer.clearDepth();\n    renderer.setRenderTarget(null);\n    renderer.render(_scene, _camera);\n  };\n}\n/**\n * @classdesc Stereo Effect Composer\n * @constructor\n * @external StereoEffect\n * @param {THREE.WebGLRenderer} renderer \n */\n\n\nconst StereoEffect = function (renderer) {\n  var _stereo = new StereoCamera();\n\n  _stereo.aspect = 0.5;\n  var size = new Vector2();\n\n  this.setEyeSeparation = function (eyeSep) {\n    _stereo.eyeSep = eyeSep;\n  };\n\n  this.setSize = function (width, height) {\n    renderer.setSize(width, height);\n  };\n\n  this.render = function (scene, camera) {\n    scene.updateMatrixWorld();\n    if (camera.parent === null) camera.updateMatrixWorld();\n\n    _stereo.update(camera);\n\n    renderer.getSize(size);\n    if (renderer.autoClear) renderer.clear();\n    renderer.setScissorTest(true);\n    renderer.setScissor(0, 0, size.width / 2, size.height);\n    renderer.setViewport(0, 0, size.width / 2, size.height);\n    renderer.render(scene, _stereo.cameraL);\n    renderer.setScissor(size.width / 2, 0, size.width / 2, size.height);\n    renderer.setViewport(size.width / 2, 0, size.width / 2, size.height);\n    renderer.render(scene, _stereo.cameraR);\n    renderer.setScissorTest(false);\n  };\n};\n/**\n * @classdesc Viewer contains pre-defined scene, camera and renderer\n * @constructor\n * @param {object} [options] - Use custom or default config options\n * @param {HTMLElement} [options.container] - A HTMLElement to host the canvas\n * @param {THREE.Scene} [options.scene=THREE.Scene] - A THREE.Scene which contains panorama and 3D objects\n * @param {THREE.Camera} [options.camera=THREE.PerspectiveCamera] - A THREE.Camera to view the scene\n * @param {THREE.WebGLRenderer} [options.renderer=THREE.WebGLRenderer] - A THREE.WebGLRenderer to render canvas\n * @param {boolean} [options.controlBar=true] - Show/hide control bar on the bottom of the container\n * @param {array}   [options.controlButtons=[]] - Button names to mount on controlBar if controlBar exists, Defaults to ['fullscreen', 'setting', 'video']\n * @param {boolean} [options.autoHideControlBar=false] - Auto hide control bar when click on non-active area\n * @param {boolean} [options.autoHideInfospot=true] - Auto hide infospots when click on non-active area\n * @param {boolean} [options.horizontalView=false] - Allow only horizontal camera control\n * @param {number}  [options.clickTolerance=10] - Distance tolerance to tigger click / tap event\n * @param {number}  [options.cameraFov=60] - Camera field of view value\n * @param {boolean} [options.reverseDragging=false] - Reverse dragging direction\n * @param {boolean} [options.enableReticle=false] - Enable reticle for mouseless interaction other than VR mode\n * @param {number}  [options.dwellTime=1500] - Dwell time for reticle selection in ms\n * @param {boolean} [options.autoReticleSelect=true] - Auto select a clickable target after dwellTime\n * @param {boolean} [options.viewIndicator=false] - Adds an angle view indicator in upper left corner\n * @param {number}  [options.indicatorSize=30] - Size of View Indicator\n * @param {string}  [options.output='none'] - Whether and where to output raycast position. Could be 'event', 'console' or 'overlay'.\n * @param {boolean} [options.autoRotate=false] - Auto rotate\n * @param {number}  [options.autoRotateSpeed=2.0] - Auto rotate speed as in degree per second. Positive is counter-clockwise and negative is clockwise.\n * @param {number}  [options.autoRotateActivationDuration=5000] - Duration before auto rotatation when no user interactivity in ms\n */\n\n\nfunction Viewer(options) {\n  let container;\n  options = options || {};\n  options.controlBar = options.controlBar !== undefined ? options.controlBar : true;\n  options.controlButtons = options.controlButtons || ['fullscreen', 'setting', 'video'];\n  options.autoHideControlBar = options.autoHideControlBar !== undefined ? options.autoHideControlBar : false;\n  options.autoHideInfospot = options.autoHideInfospot !== undefined ? options.autoHideInfospot : true;\n  options.horizontalView = options.horizontalView !== undefined ? options.horizontalView : false;\n  options.clickTolerance = options.clickTolerance || 10;\n  options.cameraFov = options.cameraFov || 60;\n  options.reverseDragging = options.reverseDragging || false;\n  options.enableReticle = options.enableReticle || false;\n  options.dwellTime = options.dwellTime || 1500;\n  options.autoReticleSelect = options.autoReticleSelect !== undefined ? options.autoReticleSelect : true;\n  options.viewIndicator = options.viewIndicator !== undefined ? options.viewIndicator : false;\n  options.indicatorSize = options.indicatorSize || 30;\n  options.output = options.output ? options.output : 'none';\n  options.autoRotate = options.autoRotate || false;\n  options.autoRotateSpeed = options.autoRotateSpeed || 2.0;\n  options.autoRotateActivationDuration = options.autoRotateActivationDuration || 5000;\n  this.options = options;\n  /*\n   * CSS Icon\n   * const styleLoader = new StyleLoader();\n   * styleLoader.inject( 'icono' );\n   */\n  // Container\n\n  if (options.container) {\n    container = options.container;\n    container._width = container.clientWidth;\n    container._height = container.clientHeight;\n  } else {\n    container = document.createElement('div');\n    container.classList.add('panolens-container');\n    container.style.width = '100%';\n    container.style.height = '100%';\n    container._width = window.innerWidth;\n    container._height = window.innerHeight;\n    document.body.appendChild(container);\n  }\n\n  this.container = container;\n  this.camera = options.camera || new PerspectiveCamera(this.options.cameraFov, this.container.clientWidth / this.container.clientHeight, 1, 10000);\n  this.scene = options.scene || new Scene();\n  this.renderer = options.renderer || new WebGLRenderer({\n    alpha: true,\n    antialias: false\n  });\n  this.sceneReticle = new Scene();\n  this.viewIndicatorSize = this.options.indicatorSize;\n  this.reticle = {};\n  this.tempEnableReticle = this.options.enableReticle;\n  this.mode = MODES.NORMAL;\n  this.panorama = null;\n  this.widget = null;\n  this.hoverObject = null;\n  this.infospot = null;\n  this.pressEntityObject = null;\n  this.pressObject = null;\n  this.raycaster = new Raycaster();\n  this.raycasterPoint = new Vector2();\n  this.userMouse = new Vector2();\n  this.updateCallbacks = [];\n  this.requestAnimationId = null;\n  this.cameraFrustum = new Frustum();\n  this.cameraViewProjectionMatrix = new Matrix4();\n  this.autoRotateRequestId = null;\n  this.outputDivElement = null;\n  this.touchSupported = 'ontouchstart' in window || window.DocumentTouch && document instanceof DocumentTouch; // Handler references\n\n  this.HANDLER_MOUSE_DOWN = this.onMouseDown.bind(this);\n  this.HANDLER_MOUSE_UP = this.onMouseUp.bind(this);\n  this.HANDLER_MOUSE_MOVE = this.onMouseMove.bind(this);\n  this.HANDLER_WINDOW_RESIZE = this.onWindowResize.bind(this);\n  this.HANDLER_KEY_DOWN = this.onKeyDown.bind(this);\n  this.HANDLER_KEY_UP = this.onKeyUp.bind(this);\n  this.HANDLER_TAP = this.onTap.bind(this, {\n    clientX: this.container.clientWidth / 2,\n    clientY: this.container.clientHeight / 2\n  }); // Flag for infospot output\n\n  this.OUTPUT_INFOSPOT = false; // Animations\n\n  this.tweenLeftAnimation = new Tween.Tween();\n  this.tweenUpAnimation = new Tween.Tween(); // Renderer\n\n  this.renderer.setPixelRatio(window.devicePixelRatio);\n  this.renderer.setSize(this.container.clientWidth, this.container.clientHeight);\n  this.renderer.setClearColor(0x000000, 0);\n  this.renderer.autoClear = false; // Append Renderer Element to container\n\n  this.renderer.domElement.classList.add('panolens-canvas');\n  this.renderer.domElement.style.display = 'block';\n  this.container.style.backgroundColor = '#000';\n  this.container.appendChild(this.renderer.domElement); // Camera Controls\n\n  this.OrbitControls = new OrbitControls(this.camera, this.container);\n  this.OrbitControls.id = 'orbit';\n  this.OrbitControls.minDistance = 1;\n  this.OrbitControls.noPan = true;\n  this.OrbitControls.autoRotate = this.options.autoRotate;\n  this.OrbitControls.autoRotateSpeed = this.options.autoRotateSpeed;\n  this.DeviceOrientationControls = new DeviceOrientationControls(this.camera, this.container);\n  this.DeviceOrientationControls.id = 'device-orientation';\n  this.DeviceOrientationControls.enabled = false;\n  this.camera.position.z = 1; // Register change event if passiveRenering\n\n  if (this.options.passiveRendering) {\n    console.warn('passiveRendering is now deprecated');\n  } // Controls\n\n\n  this.controls = [this.OrbitControls, this.DeviceOrientationControls];\n  this.control = this.OrbitControls; // Cardboard effect\n\n  this.CardboardEffect = new CardboardEffect(this.renderer);\n  this.CardboardEffect.setSize(this.container.clientWidth, this.container.clientHeight); // Stereo effect\n\n  this.StereoEffect = new StereoEffect(this.renderer);\n  this.StereoEffect.setSize(this.container.clientWidth, this.container.clientHeight);\n  this.effect = this.CardboardEffect; // Add default hidden reticle\n\n  this.addReticle(); // Lock horizontal view\n\n  if (this.options.horizontalView) {\n    this.OrbitControls.minPolarAngle = Math.PI / 2;\n    this.OrbitControls.maxPolarAngle = Math.PI / 2;\n  } // Add Control UI\n\n\n  if (this.options.controlBar !== false) {\n    this.addDefaultControlBar(this.options.controlButtons);\n  } // Add View Indicator\n\n\n  if (this.options.viewIndicator) {\n    this.addViewIndicator();\n  } // Reverse dragging direction\n\n\n  if (this.options.reverseDragging) {\n    this.reverseDraggingDirection();\n  } // Register event if reticle is enabled, otherwise defaults to mouse\n\n\n  if (this.options.enableReticle) {\n    this.enableReticleControl();\n  } else {\n    this.registerMouseAndTouchEvents();\n  } // Output infospot position to an overlay container if specified\n\n\n  if (this.options.output === 'overlay') {\n    this.addOutputElement();\n  } // Register dom event listeners\n\n\n  this.registerEventListeners(); // Animate\n\n  this.animate.call(this);\n}\n\nViewer.prototype = Object.assign(Object.create(EventDispatcher.prototype), {\n  constructor: Viewer,\n\n  /**\n   * Add an object to the scene\n   * Automatically hookup with panolens-viewer-handler listener\n   * to communicate with viewer method\n   * @param {THREE.Object3D} object - The object to be added\n   * @memberOf Viewer\n   * @instance\n   */\n  add: function (object) {\n    if (arguments.length > 1) {\n      for (let i = 0; i < arguments.length; i++) {\n        this.add(arguments[i]);\n      }\n\n      return this;\n    }\n\n    this.scene.add(object); // All object added to scene has 'panolens-viewer-handler' event to handle viewer communication\n\n    if (object.addEventListener) {\n      object.addEventListener('panolens-viewer-handler', this.eventHandler.bind(this));\n    } // All object added to scene being passed with container\n\n\n    if (object instanceof Panorama && object.dispatchEvent) {\n      object.dispatchEvent({\n        type: 'panolens-container',\n        container: this.container\n      });\n    }\n\n    if (object instanceof CameraPanorama) {\n      object.dispatchEvent({\n        type: 'panolens-scene',\n        scene: this.scene\n      });\n    } // Hookup default panorama event listeners\n\n\n    if (object.type === 'panorama') {\n      this.addPanoramaEventListener(object);\n\n      if (!this.panorama) {\n        this.setPanorama(object);\n      }\n    }\n  },\n\n  /**\n   * Remove an object from the scene\n   * @param  {THREE.Object3D} object - Object to be removed\n   * @memberOf Viewer\n   * @instance\n   */\n  remove: function (object) {\n    if (object.removeEventListener) {\n      object.removeEventListener('panolens-viewer-handler', this.eventHandler.bind(this));\n    }\n\n    this.scene.remove(object);\n  },\n\n  /**\n   * Add default control bar\n   * @param {array} array - The control buttons array\n   * @memberOf Viewer\n   * @instance\n   */\n  addDefaultControlBar: function (array) {\n    if (this.widget) {\n      console.warn('Default control bar exists');\n      return;\n    }\n\n    const widget = new Widget(this.container);\n    widget.addEventListener('panolens-viewer-handler', this.eventHandler.bind(this));\n    widget.addControlBar();\n    array.forEach(buttonName => {\n      widget.addControlButton(buttonName);\n    });\n    this.widget = widget;\n  },\n\n  /**\n   * Set a panorama to be the current one\n   * @param {Panorama} pano - Panorama to be set\n   * @memberOf Viewer\n   * @instance\n   */\n  setPanorama: function (pano) {\n    const leavingPanorama = this.panorama;\n\n    if (pano.type === 'panorama' && leavingPanorama !== pano) {\n      // Clear exisiting infospot\n      this.hideInfospot();\n\n      const afterEnterComplete = function () {\n        if (leavingPanorama) {\n          leavingPanorama.onLeave();\n        }\n\n        pano.removeEventListener('enter-fade-start', afterEnterComplete);\n      };\n\n      pano.addEventListener('enter-fade-start', afterEnterComplete); // Assign and enter panorama\n\n      (this.panorama = pano).onEnter();\n    }\n  },\n\n  /**\n   * Event handler to execute commands from child objects\n   * @param {object} event - The dispatched event with method as function name and data as an argument\n   * @memberOf Viewer\n   * @instance\n   */\n  eventHandler: function (event) {\n    if (event.method && this[event.method]) {\n      this[event.method](event.data);\n    }\n  },\n\n  /**\n   * Dispatch event to all descendants\n   * @param  {object} event - Event to be passed along\n   * @memberOf Viewer\n   * @instance\n   */\n  dispatchEventToChildren: function (event) {\n    this.scene.traverse(function (object) {\n      if (object.dispatchEvent) {\n        object.dispatchEvent(event);\n      }\n    });\n  },\n\n  /**\n   * Set widget content\n   * @method activateWidgetItem\n   * @param  {integer} controlIndex - Control index\n   * @param  {integer} mode - Modes for effects\n   * @memberOf Viewer\n   * @instance\n   */\n  activateWidgetItem: function (controlIndex, mode) {\n    const mainMenu = this.widget.mainMenu;\n    const ControlMenuItem = mainMenu.children[0];\n    const ModeMenuItem = mainMenu.children[1];\n    let item;\n\n    if (controlIndex !== undefined) {\n      switch (controlIndex) {\n        case 0:\n          item = ControlMenuItem.subMenu.children[1];\n          break;\n\n        case 1:\n          item = ControlMenuItem.subMenu.children[2];\n          break;\n\n        default:\n          item = ControlMenuItem.subMenu.children[1];\n          break;\n      }\n\n      ControlMenuItem.subMenu.setActiveItem(item);\n      ControlMenuItem.setSelectionTitle(item.textContent);\n    }\n\n    if (mode !== undefined) {\n      switch (mode) {\n        case MODES.CARDBOARD:\n          item = ModeMenuItem.subMenu.children[2];\n          break;\n\n        case MODES.STEREO:\n          item = ModeMenuItem.subMenu.children[3];\n          break;\n\n        default:\n          item = ModeMenuItem.subMenu.children[1];\n          break;\n      }\n\n      ModeMenuItem.subMenu.setActiveItem(item);\n      ModeMenuItem.setSelectionTitle(item.textContent);\n    }\n  },\n\n  /**\n   * Enable rendering effect\n   * @param  {MODES} mode - Modes for effects\n   * @memberOf Viewer\n   * @instance\n   */\n  enableEffect: function (mode) {\n    if (this.mode === mode) {\n      return;\n    }\n\n    if (mode === MODES.NORMAL) {\n      this.disableEffect();\n      return;\n    } else {\n      this.mode = mode;\n    }\n\n    const fov = this.camera.fov;\n\n    switch (mode) {\n      case MODES.CARDBOARD:\n        this.effect = this.CardboardEffect;\n        this.enableReticleControl();\n        break;\n\n      case MODES.STEREO:\n        this.effect = this.StereoEffect;\n        this.enableReticleControl();\n        break;\n\n      default:\n        this.effect = null;\n        this.disableReticleControl();\n        break;\n    }\n\n    this.activateWidgetItem(undefined, this.mode);\n    /**\n     * Dual eye effect event\n     * @type {object}\n     * @event Infospot#panolens-dual-eye-effect\n     * @property {MODES} mode - Current display mode\n     */\n\n    this.dispatchEventToChildren({\n      type: 'panolens-dual-eye-effect',\n      mode: this.mode\n    }); // Force effect stereo camera to update by refreshing fov\n\n    this.camera.fov = fov + 10e-3;\n    this.effect.setSize(this.container.clientWidth, this.container.clientHeight);\n    this.render();\n    this.camera.fov = fov;\n    /**\n     * Dispatch mode change event\n     * @type {object}\n     * @event Viewer#mode-change\n     * @property {MODES} mode - Current display mode\n     */\n\n    this.dispatchEvent({\n      type: 'mode-change',\n      mode: this.mode\n    });\n  },\n\n  /**\n   * Disable additional rendering effect\n   * @memberOf Viewer\n   * @instance\n   */\n  disableEffect: function () {\n    if (this.mode === MODES.NORMAL) {\n      return;\n    }\n\n    this.mode = MODES.NORMAL;\n    this.disableReticleControl();\n    this.activateWidgetItem(undefined, this.mode);\n    /**\n     * Dual eye effect event\n     * @type {object}\n     * @event Infospot#panolens-dual-eye-effect\n     * @property {MODES} mode - Current display mode\n     */\n\n    this.dispatchEventToChildren({\n      type: 'panolens-dual-eye-effect',\n      mode: this.mode\n    });\n    this.renderer.setSize(this.container.clientWidth, this.container.clientHeight);\n    this.render();\n    /**\n     * Dispatch mode change event\n     * @type {object}\n     * @event Viewer#mode-change\n     * @property {MODES} mode - Current display mode\n     */\n\n    this.dispatchEvent({\n      type: 'mode-change',\n      mode: this.mode\n    });\n  },\n\n  /**\n   * Enable reticle control\n   * @memberOf Viewer\n   * @instance\n   */\n  enableReticleControl: function () {\n    if (this.reticle.visible) {\n      return;\n    }\n\n    this.tempEnableReticle = true; // Register reticle event and unregister mouse event\n\n    this.unregisterMouseAndTouchEvents();\n    this.reticle.show();\n    this.registerReticleEvent();\n    this.updateReticleEvent();\n  },\n\n  /**\n   * Disable reticle control\n   * @memberOf Viewer\n   * @instance\n   */\n  disableReticleControl: function () {\n    this.tempEnableReticle = false; // Register mouse event and unregister reticle event\n\n    if (!this.options.enableReticle) {\n      this.reticle.hide();\n      this.unregisterReticleEvent();\n      this.registerMouseAndTouchEvents();\n    } else {\n      this.updateReticleEvent();\n    }\n  },\n\n  /**\n   * Enable auto rotation\n   * @memberOf Viewer\n   * @instance\n   */\n  enableAutoRate: function () {\n    this.options.autoRotate = true;\n    this.OrbitControls.autoRotate = true;\n  },\n\n  /**\n   * Disable auto rotation\n   * @memberOf Viewer\n   * @instance\n   */\n  disableAutoRate: function () {\n    clearTimeout(this.autoRotateRequestId);\n    this.options.autoRotate = false;\n    this.OrbitControls.autoRotate = false;\n  },\n\n  /**\n   * Toggle video play or stop\n   * @param {boolean} pause\n   * @memberOf Viewer\n   * @instance\n   * @fires Viewer#video-toggle\n   */\n  toggleVideoPlay: function (pause) {\n    if (this.panorama instanceof VideoPanorama) {\n      /**\n       * Toggle video event\n       * @type {object}\n       * @event Viewer#video-toggle\n       */\n      this.panorama.dispatchEvent({\n        type: 'video-toggle',\n        pause: pause\n      });\n    }\n  },\n\n  /**\n   * Set currentTime in a video\n   * @param {number} percentage - Percentage of a video. Range from 0.0 to 1.0\n   * @memberOf Viewer\n   * @instance\n   * @fires Viewer#video-time\n   */\n  setVideoCurrentTime: function (percentage) {\n    if (this.panorama instanceof VideoPanorama) {\n      /**\n       * Setting video time event\n       * @type {object}\n       * @event Viewer#video-time\n       * @property {number} percentage - Percentage of a video. Range from 0.0 to 1.0\n       */\n      this.panorama.dispatchEvent({\n        type: 'video-time',\n        percentage: percentage\n      });\n    }\n  },\n\n  /**\n   * This will be called when video updates if an widget is present\n   * @param {number} percentage - Percentage of a video. Range from 0.0 to 1.0\n   * @memberOf Viewer\n   * @instance\n   * @fires Viewer#video-update\n   */\n  onVideoUpdate: function (percentage) {\n    const {\n      widget\n    } = this;\n    /**\n     * Video update event\n     * @type {object}\n     * @event Viewer#video-update\n     * @property {number} percentage - Percentage of a video. Range from 0.0 to 1.0\n     */\n\n    if (widget) {\n      widget.dispatchEvent({\n        type: 'video-update',\n        percentage: percentage\n      });\n    }\n  },\n\n  /**\n   * Add update callback to be called every animation frame\n   * @param {function} callback\n   * @memberOf Viewer\n   * @instance\n   */\n  addUpdateCallback: function (fn) {\n    if (fn) {\n      this.updateCallbacks.push(fn);\n    }\n  },\n\n  /**\n   * Remove update callback\n   * @param  {function} fn - The function to be removed\n   * @memberOf Viewer\n   * @instance\n   */\n  removeUpdateCallback: function (fn) {\n    const index = this.updateCallbacks.indexOf(fn);\n\n    if (fn && index >= 0) {\n      this.updateCallbacks.splice(index, 1);\n    }\n  },\n\n  /**\n   * Show video widget\n   * @memberOf Viewer\n   * @instance\n   */\n  showVideoWidget: function () {\n    const {\n      widget\n    } = this;\n    /**\n     * Show video widget event\n     * @type {object}\n     * @event Viewer#video-control-show\n     */\n\n    if (widget) {\n      widget.dispatchEvent({\n        type: 'video-control-show'\n      });\n    }\n  },\n\n  /**\n   * Hide video widget\n   * @memberOf Viewer\n   * @instance\n   */\n  hideVideoWidget: function () {\n    const {\n      widget\n    } = this;\n    /**\n     * Hide video widget\n     * @type {object}\n     * @event Viewer#video-control-hide\n     */\n\n    if (widget) {\n      widget.dispatchEvent({\n        type: 'video-control-hide'\n      });\n    }\n  },\n\n  /**\n   * Update video play button\n   * @param {boolean} paused \n   * @memberOf Viewer\n   * @instance\n   */\n  updateVideoPlayButton: function (paused) {\n    const {\n      widget\n    } = this;\n\n    if (widget && widget.videoElement && widget.videoElement.controlButton) {\n      widget.videoElement.controlButton.update(paused);\n    }\n  },\n\n  /**\n   * Add default panorama event listeners\n   * @param {Panorama} pano - The panorama to be added with event listener\n   * @memberOf Viewer\n   * @instance\n   */\n  addPanoramaEventListener: function (pano) {\n    // Set camera control on every panorama\n    pano.addEventListener('enter-fade-start', this.setCameraControl.bind(this)); // Show and hide widget event only when it's VideoPanorama\n\n    if (pano instanceof VideoPanorama) {\n      pano.addEventListener('enter-fade-start', this.showVideoWidget.bind(this));\n      pano.addEventListener('leave', function () {\n        if (!(this.panorama instanceof VideoPanorama)) {\n          this.hideVideoWidget.call(this);\n        }\n      }.bind(this));\n    }\n  },\n\n  /**\n   * Set camera control\n   * @memberOf Viewer\n   * @instance\n   */\n  setCameraControl: function () {\n    this.OrbitControls.target.copy(this.panorama.position);\n  },\n\n  /**\n   * Get current camera control\n   * @return {object} - Current navigation control\n   * @memberOf Viewer\n   * @instance\n   * @returns {THREE.OrbitControls|THREE.DeviceOrientationControls}\n   */\n  getControl: function () {\n    return this.control;\n  },\n\n  /**\n   * Get scene\n   * @memberOf Viewer\n   * @instance\n   * @return {THREE.Scene} - Current scene which the viewer is built on\n   */\n  getScene: function () {\n    return this.scene;\n  },\n\n  /**\n   * Get camera\n   * @memberOf Viewer\n   * @instance\n   * @return {THREE.Camera} - The scene camera\n   */\n  getCamera: function () {\n    return this.camera;\n  },\n\n  /**\n   * Get renderer\n   * @memberOf Viewer\n   * @instance\n   * @return {THREE.WebGLRenderer} - The renderer using webgl\n   */\n  getRenderer: function () {\n    return this.renderer;\n  },\n\n  /**\n   * Get container\n   * @memberOf Viewer\n   * @instance\n   * @return {HTMLElement} - The container holds rendererd canvas\n   */\n  getContainer: function () {\n    return this.container;\n  },\n\n  /**\n   * Get control id\n   * @memberOf Viewer\n   * @instance\n   * @return {string} - Control id. 'orbit' or 'device-orientation'\n   */\n  getControlId: function () {\n    return this.control.id;\n  },\n\n  /**\n   * Get next navigation control id\n   * @memberOf Viewer\n   * @instance\n   * @return {string} - Next control id\n   */\n  getNextControlId: function () {\n    return this.controls[this.getNextControlIndex()].id;\n  },\n\n  /**\n   * Get next navigation control index\n   * @memberOf Viewer\n   * @instance\n   * @return {number} - Next control index\n   */\n  getNextControlIndex: function () {\n    const controls = this.controls;\n    const control = this.control;\n    const nextIndex = controls.indexOf(control) + 1;\n    return nextIndex >= controls.length ? 0 : nextIndex;\n  },\n\n  /**\n   * Set field of view of camera\n   * @param {number} fov\n   * @memberOf Viewer\n   * @instance\n   */\n  setCameraFov: function (fov) {\n    this.camera.fov = fov;\n    this.camera.updateProjectionMatrix();\n  },\n\n  /**\n   * Enable control by index\n   * @param  {CONTROLS} index - Index of camera control\n   * @memberOf Viewer\n   * @instance\n   */\n  enableControl: function (index) {\n    index = index >= 0 && index < this.controls.length ? index : 0;\n    this.control.enabled = false;\n    this.control = this.controls[index];\n    this.control.enabled = true;\n\n    switch (index) {\n      case CONTROLS.ORBIT:\n        this.camera.position.copy(this.panorama.position);\n        this.camera.position.z += 1;\n        break;\n\n      case CONTROLS.DEVICEORIENTATION:\n        this.camera.position.copy(this.panorama.position);\n        break;\n\n      default:\n        break;\n    }\n\n    this.control.update();\n    this.activateWidgetItem(index, undefined);\n  },\n\n  /**\n   * Disable current control\n   * @memberOf Viewer\n   * @instance\n   */\n  disableControl: function () {\n    this.control.enabled = false;\n  },\n\n  /**\n   * Toggle next control\n   * @memberOf Viewer\n   * @instance\n   */\n  toggleNextControl: function () {\n    this.enableControl(this.getNextControlIndex());\n  },\n\n  /**\n   * Screen Space Projection\n   * @memberOf Viewer\n   * @instance\n   */\n  getScreenVector: function (worldVector) {\n    const vector = worldVector.clone();\n    const widthHalf = this.container.clientWidth / 2;\n    const heightHalf = this.container.clientHeight / 2;\n    vector.project(this.camera);\n    vector.x = vector.x * widthHalf + widthHalf;\n    vector.y = -(vector.y * heightHalf) + heightHalf;\n    vector.z = 0;\n    return vector;\n  },\n\n  /**\n   * Check Sprite in Viewport\n   * @memberOf Viewer\n   * @instance\n   */\n  checkSpriteInViewport: function (sprite) {\n    this.camera.matrixWorldInverse.getInverse(this.camera.matrixWorld);\n    this.cameraViewProjectionMatrix.multiplyMatrices(this.camera.projectionMatrix, this.camera.matrixWorldInverse);\n    this.cameraFrustum.setFromMatrix(this.cameraViewProjectionMatrix);\n    return sprite.visible && this.cameraFrustum.intersectsSprite(sprite);\n  },\n\n  /**\n   * Reverse dragging direction\n   * @memberOf Viewer\n   * @instance\n   */\n  reverseDraggingDirection: function () {\n    this.OrbitControls.rotateSpeed *= -1;\n    this.OrbitControls.momentumScalingFactor *= -1;\n  },\n\n  /**\n   * Add reticle \n   * @memberOf Viewer\n   * @instance\n   */\n  addReticle: function () {\n    this.reticle = new Reticle(0xffffff, true, this.options.dwellTime);\n    this.reticle.hide();\n    this.camera.add(this.reticle);\n    this.sceneReticle.add(this.camera);\n  },\n\n  /**\n   * Tween control looking center\n   * @param {THREE.Vector3} vector - Vector to be looked at the center\n   * @param {number} [duration=1000] - Duration to tween\n   * @param {function} [easing=TWEEN.Easing.Exponential.Out] - Easing function\n   * @memberOf Viewer\n   * @instance\n   */\n  tweenControlCenter: function (vector, duration, easing) {\n    if (this.control !== this.OrbitControls) {\n      return;\n    } // Pass in arguments as array\n\n\n    if (vector instanceof Array) {\n      duration = vector[1];\n      easing = vector[2];\n      vector = vector[0];\n    }\n\n    duration = duration !== undefined ? duration : 1000;\n    easing = easing || Tween.Easing.Exponential.Out;\n    let scope, ha, va, chv, cvv, hv, vv, vptc, ov, nv;\n    scope = this;\n    chv = this.camera.getWorldDirection(new Vector3());\n    cvv = chv.clone();\n    vptc = this.panorama.getWorldPosition(new Vector3()).sub(this.camera.getWorldPosition(new Vector3()));\n    hv = vector.clone(); // Scale effect\n\n    hv.x *= -1;\n    hv.add(vptc).normalize();\n    vv = hv.clone();\n    chv.y = 0;\n    hv.y = 0;\n    ha = Math.atan2(hv.z, hv.x) - Math.atan2(chv.z, chv.x);\n    ha = ha > Math.PI ? ha - 2 * Math.PI : ha;\n    ha = ha < -Math.PI ? ha + 2 * Math.PI : ha;\n    va = Math.abs(cvv.angleTo(chv) + (cvv.y * vv.y <= 0 ? vv.angleTo(hv) : -vv.angleTo(hv)));\n    va *= vv.y < cvv.y ? 1 : -1;\n    ov = {\n      left: 0,\n      up: 0\n    };\n    nv = {\n      left: 0,\n      up: 0\n    };\n    this.tweenLeftAnimation.stop();\n    this.tweenUpAnimation.stop();\n    this.tweenLeftAnimation = new Tween.Tween(ov).to({\n      left: ha\n    }, duration).easing(easing).onUpdate(function (ov) {\n      scope.control.rotateLeft(ov.left - nv.left);\n      nv.left = ov.left;\n    }).start();\n    this.tweenUpAnimation = new Tween.Tween(ov).to({\n      up: va\n    }, duration).easing(easing).onUpdate(function (ov) {\n      scope.control.rotateUp(ov.up - nv.up);\n      nv.up = ov.up;\n    }).start();\n  },\n\n  /**\n   * Tween control looking center by object\n   * @param {THREE.Object3D} object - Object to be looked at the center\n   * @param {number} [duration=1000] - Duration to tween\n   * @param {function} [easing=TWEEN.Easing.Exponential.Out] - Easing function\n   * @memberOf Viewer\n   * @instance\n   */\n  tweenControlCenterByObject: function (object, duration, easing) {\n    let isUnderScalePlaceHolder = false;\n    object.traverseAncestors(function (ancestor) {\n      if (ancestor.scalePlaceHolder) {\n        isUnderScalePlaceHolder = true;\n      }\n    });\n\n    if (isUnderScalePlaceHolder) {\n      const invertXVector = new Vector3(-1, 1, 1);\n      this.tweenControlCenter(object.getWorldPosition(new Vector3()).multiply(invertXVector), duration, easing);\n    } else {\n      this.tweenControlCenter(object.getWorldPosition(new Vector3()), duration, easing);\n    }\n  },\n\n  /**\n   * This is called when window size is changed\n   * @fires Viewer#window-resize\n   * @param {number} [windowWidth] - Specify if custom element has changed width\n   * @param {number} [windowHeight] - Specify if custom element has changed height\n   * @memberOf Viewer\n   * @instance\n   */\n  onWindowResize: function (windowWidth, windowHeight) {\n    let width, height;\n    const expand = this.container.classList.contains('panolens-container') || this.container.isFullscreen;\n\n    if (windowWidth !== undefined && windowHeight !== undefined) {\n      width = windowWidth;\n      height = windowHeight;\n      this.container._width = windowWidth;\n      this.container._height = windowHeight;\n    } else {\n      const isAndroid = /(android)/i.test(window.navigator.userAgent);\n      const adjustWidth = isAndroid ? Math.min(document.documentElement.clientWidth, window.innerWidth || 0) : Math.max(document.documentElement.clientWidth, window.innerWidth || 0);\n      const adjustHeight = isAndroid ? Math.min(document.documentElement.clientHeight, window.innerHeight || 0) : Math.max(document.documentElement.clientHeight, window.innerHeight || 0);\n      width = expand ? adjustWidth : this.container.clientWidth;\n      height = expand ? adjustHeight : this.container.clientHeight;\n      this.container._width = width;\n      this.container._height = height;\n    }\n\n    this.camera.aspect = width / height;\n    this.camera.updateProjectionMatrix();\n    this.renderer.setSize(width, height); // Update reticle\n\n    if (this.options.enableReticle || this.tempEnableReticle) {\n      this.updateReticleEvent();\n    }\n    /**\n     * Window resizing event\n     * @type {object}\n     * @event Viewer#window-resize\n     * @property {number} width  - Width of the window\n     * @property {number} height - Height of the window\n     */\n\n\n    this.dispatchEvent({\n      type: 'window-resize',\n      width: width,\n      height: height\n    });\n    this.scene.traverse(function (object) {\n      if (object.dispatchEvent) {\n        object.dispatchEvent({\n          type: 'window-resize',\n          width: width,\n          height: height\n        });\n      }\n    });\n  },\n\n  /**\n   * Add output element\n   * @memberOf Viewer\n   * @instance\n   */\n  addOutputElement: function () {\n    const element = document.createElement('div');\n    element.style.position = 'absolute';\n    element.style.right = '10px';\n    element.style.top = '10px';\n    element.style.color = '#fff';\n    this.container.appendChild(element);\n    this.outputDivElement = element;\n  },\n\n  /**\n   * Output position in developer console by holding down Ctrl button\n   * @memberOf Viewer\n   * @instance\n   */\n  outputPosition: function () {\n    const intersects = this.raycaster.intersectObject(this.panorama, true);\n\n    if (intersects.length > 0) {\n      const point = intersects[0].point.clone();\n      const converter = new Vector3(-1, 1, 1);\n      const world = this.panorama.getWorldPosition(new Vector3());\n      point.sub(world).multiply(converter);\n      const position = {\n        x: point.x.toFixed(2),\n        y: point.y.toFixed(2),\n        z: point.z.toFixed(2)\n      };\n      const message = `${position.x}, ${position.y}, ${position.z}`;\n\n      if (point.length() === 0) {\n        return;\n      }\n\n      switch (this.options.output) {\n        case 'event':\n          /**\n           * Dispatch raycast position as event\n           * @type {object}\n           * @event Viewer#position-output\n           */\n          this.dispatchEvent({\n            type: 'position-output',\n            position: position\n          });\n          break;\n\n        case 'console':\n          console.info(message);\n          break;\n\n        case 'overlay':\n          this.outputDivElement.textContent = message;\n          break;\n\n        default:\n          break;\n      }\n    }\n  },\n\n  /**\n   * On mouse down\n   * @param {MouseEvent} event \n   * @memberOf Viewer\n   * @instance\n   */\n  onMouseDown: function (event) {\n    event.preventDefault();\n    this.userMouse.x = event.clientX >= 0 ? event.clientX : event.touches[0].clientX;\n    this.userMouse.y = event.clientY >= 0 ? event.clientY : event.touches[0].clientY;\n    this.userMouse.type = 'mousedown';\n    this.onTap(event);\n  },\n\n  /**\n   * On mouse move\n   * @param {MouseEvent} event \n   * @memberOf Viewer\n   * @instance\n   */\n  onMouseMove: function (event) {\n    event.preventDefault();\n    this.userMouse.type = 'mousemove';\n    this.onTap(event);\n  },\n\n  /**\n   * On mouse up\n   * @param {MouseEvent} event \n   * @memberOf Viewer\n   * @instance\n   */\n  onMouseUp: function (event) {\n    let onTarget = false;\n    this.userMouse.type = 'mouseup';\n    const type = this.userMouse.x >= event.clientX - this.options.clickTolerance && this.userMouse.x <= event.clientX + this.options.clickTolerance && this.userMouse.y >= event.clientY - this.options.clickTolerance && this.userMouse.y <= event.clientY + this.options.clickTolerance || event.changedTouches && this.userMouse.x >= event.changedTouches[0].clientX - this.options.clickTolerance && this.userMouse.x <= event.changedTouches[0].clientX + this.options.clickTolerance && this.userMouse.y >= event.changedTouches[0].clientY - this.options.clickTolerance && this.userMouse.y <= event.changedTouches[0].clientY + this.options.clickTolerance ? 'click' : undefined; // Event should happen on canvas\n\n    if (event && event.target && !event.target.classList.contains('panolens-canvas')) {\n      return;\n    }\n\n    event.preventDefault();\n\n    if (event.changedTouches && event.changedTouches.length === 1) {\n      onTarget = this.onTap({\n        clientX: event.changedTouches[0].clientX,\n        clientY: event.changedTouches[0].clientY\n      }, type);\n    } else {\n      onTarget = this.onTap(event, type);\n    }\n\n    this.userMouse.type = 'none';\n\n    if (onTarget) {\n      return;\n    }\n\n    if (type === 'click') {\n      const {\n        options: {\n          autoHideInfospot,\n          autoHideControlBar\n        },\n        panorama,\n        toggleControlBar\n      } = this;\n\n      if (autoHideInfospot && panorama) {\n        panorama.toggleInfospotVisibility();\n      }\n\n      if (autoHideControlBar) {\n        toggleControlBar();\n      }\n    }\n  },\n\n  /**\n   * On tap eveny frame\n   * @param {MouseEvent} event \n   * @param {string} type \n   * @memberOf Viewer\n   * @instance\n   */\n  onTap: function (event, type) {\n    const {\n      left,\n      top\n    } = this.container.getBoundingClientRect();\n    const {\n      clientWidth,\n      clientHeight\n    } = this.container;\n    this.raycasterPoint.x = (event.clientX - left) / clientWidth * 2 - 1;\n    this.raycasterPoint.y = -((event.clientY - top) / clientHeight) * 2 + 1;\n    this.raycaster.setFromCamera(this.raycasterPoint, this.camera); // Return if no panorama \n\n    if (!this.panorama) {\n      return;\n    } // output infospot information\n\n\n    if (event.type !== 'mousedown' && this.touchSupported || this.OUTPUT_INFOSPOT) {\n      this.outputPosition();\n    }\n\n    const intersects = this.raycaster.intersectObjects(this.panorama.children, true);\n    const intersect_entity = this.getConvertedIntersect(intersects);\n    const intersect = intersects.length > 0 ? intersects[0].object : undefined;\n\n    if (this.userMouse.type === 'mouseup') {\n      if (intersect_entity && this.pressEntityObject === intersect_entity && this.pressEntityObject.dispatchEvent) {\n        this.pressEntityObject.dispatchEvent({\n          type: 'pressstop-entity',\n          mouseEvent: event\n        });\n      }\n\n      this.pressEntityObject = undefined;\n    }\n\n    if (this.userMouse.type === 'mouseup') {\n      if (intersect && this.pressObject === intersect && this.pressObject.dispatchEvent) {\n        this.pressObject.dispatchEvent({\n          type: 'pressstop',\n          mouseEvent: event\n        });\n      }\n\n      this.pressObject = undefined;\n    }\n\n    if (type === 'click') {\n      this.panorama.dispatchEvent({\n        type: 'click',\n        intersects: intersects,\n        mouseEvent: event\n      });\n\n      if (intersect_entity && intersect_entity.dispatchEvent) {\n        intersect_entity.dispatchEvent({\n          type: 'click-entity',\n          mouseEvent: event\n        });\n      }\n\n      if (intersect && intersect.dispatchEvent) {\n        intersect.dispatchEvent({\n          type: 'click',\n          mouseEvent: event\n        });\n      }\n    } else {\n      this.panorama.dispatchEvent({\n        type: 'hover',\n        intersects: intersects,\n        mouseEvent: event\n      });\n\n      if (this.hoverObject && intersects.length > 0 && this.hoverObject !== intersect_entity || this.hoverObject && intersects.length === 0) {\n        if (this.hoverObject.dispatchEvent) {\n          this.hoverObject.dispatchEvent({\n            type: 'hoverleave',\n            mouseEvent: event\n          });\n          this.reticle.end();\n        }\n\n        this.hoverObject = undefined;\n      }\n\n      if (intersect_entity && intersects.length > 0) {\n        if (this.hoverObject !== intersect_entity) {\n          this.hoverObject = intersect_entity;\n\n          if (this.hoverObject.dispatchEvent) {\n            this.hoverObject.dispatchEvent({\n              type: 'hoverenter',\n              mouseEvent: event\n            }); // Start reticle timer\n\n            if (this.options.autoReticleSelect && this.options.enableReticle || this.tempEnableReticle) {\n              this.reticle.start(this.onTap.bind(this, event, 'click'));\n            }\n          }\n        }\n\n        if (this.userMouse.type === 'mousedown' && this.pressEntityObject != intersect_entity) {\n          this.pressEntityObject = intersect_entity;\n\n          if (this.pressEntityObject.dispatchEvent) {\n            this.pressEntityObject.dispatchEvent({\n              type: 'pressstart-entity',\n              mouseEvent: event\n            });\n          }\n        }\n\n        if (this.userMouse.type === 'mousedown' && this.pressObject != intersect) {\n          this.pressObject = intersect;\n\n          if (this.pressObject.dispatchEvent) {\n            this.pressObject.dispatchEvent({\n              type: 'pressstart',\n              mouseEvent: event\n            });\n          }\n        }\n\n        if (this.userMouse.type === 'mousemove' || this.options.enableReticle) {\n          if (intersect && intersect.dispatchEvent) {\n            intersect.dispatchEvent({\n              type: 'hover',\n              mouseEvent: event\n            });\n          }\n\n          if (this.pressEntityObject && this.pressEntityObject.dispatchEvent) {\n            this.pressEntityObject.dispatchEvent({\n              type: 'pressmove-entity',\n              mouseEvent: event\n            });\n          }\n\n          if (this.pressObject && this.pressObject.dispatchEvent) {\n            this.pressObject.dispatchEvent({\n              type: 'pressmove',\n              mouseEvent: event\n            });\n          }\n        }\n      }\n\n      if (!intersect_entity && this.pressEntityObject && this.pressEntityObject.dispatchEvent) {\n        this.pressEntityObject.dispatchEvent({\n          type: 'pressstop-entity',\n          mouseEvent: event\n        });\n        this.pressEntityObject = undefined;\n      }\n\n      if (!intersect && this.pressObject && this.pressObject.dispatchEvent) {\n        this.pressObject.dispatchEvent({\n          type: 'pressstop',\n          mouseEvent: event\n        });\n        this.pressObject = undefined;\n      }\n    } // Infospot handler\n\n\n    if (intersect && intersect instanceof Infospot) {\n      this.infospot = intersect;\n\n      if (type === 'click') {\n        return true;\n      }\n    } else if (this.infospot) {\n      this.hideInfospot();\n    } // Auto rotate\n\n\n    if (this.options.autoRotate && this.userMouse.type !== 'mousemove') {\n      // Auto-rotate idle timer\n      clearTimeout(this.autoRotateRequestId);\n\n      if (this.control === this.OrbitControls) {\n        this.OrbitControls.autoRotate = false;\n        this.autoRotateRequestId = window.setTimeout(this.enableAutoRate.bind(this), this.options.autoRotateActivationDuration);\n      }\n    }\n  },\n\n  /**\n   * Get converted intersect\n   * @param {array} intersects \n   * @memberOf Viewer\n   * @instance\n   */\n  getConvertedIntersect: function (intersects) {\n    let intersect;\n\n    for (let i = 0; i < intersects.length; i++) {\n      if (intersects[i].distance >= 0 && intersects[i].object && !intersects[i].object.passThrough) {\n        if (intersects[i].object.entity && intersects[i].object.entity.passThrough) {\n          continue;\n        } else if (intersects[i].object.entity && !intersects[i].object.entity.passThrough) {\n          intersect = intersects[i].object.entity;\n          break;\n        } else {\n          intersect = intersects[i].object;\n          break;\n        }\n      }\n    }\n\n    return intersect;\n  },\n\n  /**\n   * Hide infospot\n   * @memberOf Viewer\n   * @instance\n   */\n  hideInfospot: function () {\n    if (this.infospot) {\n      this.infospot.onHoverEnd();\n      this.infospot = undefined;\n    }\n  },\n\n  /**\n   * Toggle control bar\n   * @memberOf Viewer\n   * @instance\n   * @fires Viewer#control-bar-toggle\n   */\n  toggleControlBar: function () {\n    const {\n      widget\n    } = this;\n    /**\n     * Toggle control bar event\n     * @type {object}\n     * @event Viewer#control-bar-toggle\n     */\n\n    if (widget) {\n      widget.dispatchEvent({\n        type: 'control-bar-toggle'\n      });\n    }\n  },\n\n  /**\n   * On key down\n   * @param {KeyboardEvent} event \n   * @memberOf Viewer\n   * @instance\n   */\n  onKeyDown: function (event) {\n    if (this.options.output && this.options.output !== 'none' && event.key === 'Control') {\n      this.OUTPUT_INFOSPOT = true;\n    }\n  },\n\n  /**\n   * On key up\n   * @param {KeyboardEvent} event \n   * @memberOf Viewer\n   * @instance\n   */\n  onKeyUp: function () {\n    this.OUTPUT_INFOSPOT = false;\n  },\n\n  /**\n   * Update control and callbacks\n   * @memberOf Viewer\n   * @instance\n   */\n  update: function () {\n    Tween.update();\n    this.updateCallbacks.forEach(function (callback) {\n      callback();\n    });\n    this.control.update();\n    this.scene.traverse(function (child) {\n      if (child instanceof Infospot && child.element && (this.hoverObject === child || child.element.style.display !== 'none' || child.element.left && child.element.left.style.display !== 'none' || child.element.right && child.element.right.style.display !== 'none')) {\n        if (this.checkSpriteInViewport(child)) {\n          const {\n            x,\n            y\n          } = this.getScreenVector(child.getWorldPosition(new Vector3()));\n          child.translateElement(x, y);\n        } else {\n          child.onDismiss();\n        }\n      }\n    }.bind(this));\n  },\n\n  /**\n   * Rendering function to be called on every animation frame\n   * Render reticle last\n   * @memberOf Viewer\n   * @instance\n   */\n  render: function () {\n    if (this.mode === MODES.CARDBOARD || this.mode === MODES.STEREO) {\n      this.renderer.clear();\n      this.effect.render(this.scene, this.camera);\n      this.effect.render(this.sceneReticle, this.camera);\n    } else {\n      this.renderer.clear();\n      this.renderer.render(this.scene, this.camera);\n      this.renderer.clearDepth();\n      this.renderer.render(this.sceneReticle, this.camera);\n    }\n  },\n\n  /**\n   * Animate\n   * @memberOf Viewer\n   * @instance\n   */\n  animate: function () {\n    this.requestAnimationId = window.requestAnimationFrame(this.animate.bind(this));\n    this.onChange();\n  },\n\n  /**\n   * On change\n   * @memberOf Viewer\n   * @instance\n   */\n  onChange: function () {\n    this.update();\n    this.render();\n  },\n\n  /**\n   * Register mouse and touch event on container\n   * @memberOf Viewer\n   * @instance\n   */\n  registerMouseAndTouchEvents: function () {\n    const options = {\n      passive: false\n    };\n    this.container.addEventListener('mousedown', this.HANDLER_MOUSE_DOWN, options);\n    this.container.addEventListener('mousemove', this.HANDLER_MOUSE_MOVE, options);\n    this.container.addEventListener('mouseup', this.HANDLER_MOUSE_UP, options);\n    this.container.addEventListener('touchstart', this.HANDLER_MOUSE_DOWN, options);\n    this.container.addEventListener('touchend', this.HANDLER_MOUSE_UP, options);\n  },\n\n  /**\n   * Unregister mouse and touch event on container\n   * @memberOf Viewer\n   * @instance\n   */\n  unregisterMouseAndTouchEvents: function () {\n    this.container.removeEventListener('mousedown', this.HANDLER_MOUSE_DOWN, false);\n    this.container.removeEventListener('mousemove', this.HANDLER_MOUSE_MOVE, false);\n    this.container.removeEventListener('mouseup', this.HANDLER_MOUSE_UP, false);\n    this.container.removeEventListener('touchstart', this.HANDLER_MOUSE_DOWN, false);\n    this.container.removeEventListener('touchend', this.HANDLER_MOUSE_UP, false);\n  },\n\n  /**\n   * Register reticle event\n   * @memberOf Viewer\n   * @instance\n   */\n  registerReticleEvent: function () {\n    this.addUpdateCallback(this.HANDLER_TAP);\n  },\n\n  /**\n   * Unregister reticle event\n   * @memberOf Viewer\n   * @instance\n   */\n  unregisterReticleEvent: function () {\n    this.removeUpdateCallback(this.HANDLER_TAP);\n  },\n\n  /**\n   * Update reticle event\n   * @memberOf Viewer\n   * @instance\n   */\n  updateReticleEvent: function () {\n    const clientX = this.container.clientWidth / 2 + this.container.offsetLeft;\n    const clientY = this.container.clientHeight / 2;\n    this.removeUpdateCallback(this.HANDLER_TAP);\n    this.HANDLER_TAP = this.onTap.bind(this, {\n      clientX,\n      clientY\n    });\n    this.addUpdateCallback(this.HANDLER_TAP);\n  },\n\n  /**\n   * Register container and window listeners\n   * @memberOf Viewer\n   * @instance\n   */\n  registerEventListeners: function () {\n    // Resize Event\n    window.addEventListener('resize', this.HANDLER_WINDOW_RESIZE, true); // Keyboard Event\n\n    window.addEventListener('keydown', this.HANDLER_KEY_DOWN, true);\n    window.addEventListener('keyup', this.HANDLER_KEY_UP, true);\n  },\n\n  /**\n   * Unregister container and window listeners\n   * @memberOf Viewer\n   * @instance\n   */\n  unregisterEventListeners: function () {\n    // Resize Event\n    window.removeEventListener('resize', this.HANDLER_WINDOW_RESIZE, true); // Keyboard Event\n\n    window.removeEventListener('keydown', this.HANDLER_KEY_DOWN, true);\n    window.removeEventListener('keyup', this.HANDLER_KEY_UP, true);\n  },\n\n  /**\n   * Dispose all scene objects and clear cache\n   * @memberOf Viewer\n   * @instance\n   */\n  dispose: function () {\n    this.tweenLeftAnimation.stop();\n    this.tweenUpAnimation.stop(); // Unregister dom event listeners\n\n    this.unregisterEventListeners(); // recursive disposal on 3d objects\n\n    function recursiveDispose(object) {\n      for (let i = object.children.length - 1; i >= 0; i--) {\n        recursiveDispose(object.children[i]);\n        object.remove(object.children[i]);\n      }\n\n      if (object instanceof Panorama || object instanceof Infospot) {\n        object.dispose();\n        object = null;\n      } else if (object.dispatchEvent) {\n        object.dispatchEvent('dispose');\n      }\n    }\n\n    recursiveDispose(this.scene); // dispose widget\n\n    if (this.widget) {\n      this.widget.dispose();\n      this.widget = null;\n    } // clear cache\n\n\n    if (Cache && Cache.enabled) {\n      Cache.clear();\n    }\n  },\n\n  /**\n   * Destroy viewer by disposing and stopping requestAnimationFrame\n   * @memberOf Viewer\n   * @instance\n   */\n  destroy: function () {\n    this.dispose();\n    this.render();\n    window.cancelAnimationFrame(this.requestAnimationId);\n  },\n\n  /**\n   * On panorama dispose\n   * @memberOf Viewer\n   * @instance\n   */\n  onPanoramaDispose: function (panorama) {\n    if (panorama instanceof VideoPanorama) {\n      this.hideVideoWidget();\n    }\n\n    if (panorama === this.panorama) {\n      this.panorama = null;\n    }\n  },\n\n  /**\n   * Load ajax call\n   * @param {string} url - URL to be requested\n   * @param {function} [callback] - Callback after request completes\n   * @memberOf Viewer\n   * @instance\n   */\n  loadAsyncRequest: function (url, callback = () => {}) {\n    const request = new window.XMLHttpRequest();\n\n    request.onloadend = function (event) {\n      callback(event);\n    };\n\n    request.open('GET', url, true);\n    request.send(null);\n  },\n\n  /**\n   * View indicator in upper left\n   * @memberOf Viewer\n   * @instance\n   */\n  addViewIndicator: function () {\n    const scope = this;\n\n    function loadViewIndicator(asyncEvent) {\n      if (asyncEvent.loaded === 0) return;\n      const viewIndicatorDiv = asyncEvent.target.responseXML.documentElement;\n      viewIndicatorDiv.style.width = scope.viewIndicatorSize + 'px';\n      viewIndicatorDiv.style.height = scope.viewIndicatorSize + 'px';\n      viewIndicatorDiv.style.position = 'absolute';\n      viewIndicatorDiv.style.top = '10px';\n      viewIndicatorDiv.style.left = '10px';\n      viewIndicatorDiv.style.opacity = '0.5';\n      viewIndicatorDiv.style.cursor = 'pointer';\n      viewIndicatorDiv.id = 'panolens-view-indicator-container';\n      scope.container.appendChild(viewIndicatorDiv);\n      const indicator = viewIndicatorDiv.querySelector('#indicator');\n\n      const setIndicatorD = function () {\n        scope.radius = scope.viewIndicatorSize * 0.225;\n        scope.currentPanoAngle = scope.camera.rotation.y - Math$1.degToRad(90);\n        scope.fovAngle = Math$1.degToRad(scope.camera.fov);\n        scope.leftAngle = -scope.currentPanoAngle - scope.fovAngle / 2;\n        scope.rightAngle = -scope.currentPanoAngle + scope.fovAngle / 2;\n        scope.leftX = scope.radius * Math.cos(scope.leftAngle);\n        scope.leftY = scope.radius * Math.sin(scope.leftAngle);\n        scope.rightX = scope.radius * Math.cos(scope.rightAngle);\n        scope.rightY = scope.radius * Math.sin(scope.rightAngle);\n        scope.indicatorD = 'M ' + scope.leftX + ' ' + scope.leftY + ' A ' + scope.radius + ' ' + scope.radius + ' 0 0 1 ' + scope.rightX + ' ' + scope.rightY;\n\n        if (scope.leftX && scope.leftY && scope.rightX && scope.rightY && scope.radius) {\n          indicator.setAttribute('d', scope.indicatorD);\n        }\n      };\n\n      scope.addUpdateCallback(setIndicatorD);\n\n      const indicatorOnMouseEnter = function () {\n        this.style.opacity = '1';\n      };\n\n      const indicatorOnMouseLeave = function () {\n        this.style.opacity = '0.5';\n      };\n\n      viewIndicatorDiv.addEventListener('mouseenter', indicatorOnMouseEnter);\n      viewIndicatorDiv.addEventListener('mouseleave', indicatorOnMouseLeave);\n    }\n\n    this.loadAsyncRequest(DataImage.ViewIndicator, loadViewIndicator);\n  },\n\n  /**\n   * Append custom control item to existing control bar\n   * @param {object} [option={}] - Style object to overwirte default element style. It takes 'style', 'onTap' and 'group' properties.\n   * @memberOf Viewer\n   * @instance\n   */\n  appendControlItem: function (option) {\n    const item = this.widget.createCustomItem(option);\n\n    if (option.group === 'video') {\n      this.widget.videoElement.appendChild(item);\n    } else {\n      this.widget.barElement.appendChild(item);\n    }\n\n    return item;\n  },\n\n  /**\n   * Clear all cached files\n   * @memberOf Viewer\n   * @instance\n   */\n  clearAllCache: function () {\n    Cache.clear();\n  }\n});\n\nif (REVISION$1 != THREE_REVISION) {\n  console.warn(`three.js version is not matched. Please consider use the target revision ${THREE_REVISION}`);\n}\n/**\n * Panolens.js\n * @author pchen66\n * @namespace PANOLENS\n */\n\n\nwindow.TWEEN = Tween;\nexport { BasicPanorama, CONTROLS, CONTROL_BUTTONS, CameraPanorama, CubePanorama, CubeTextureLoader, DataImage, EmptyPanorama, GoogleStreetviewPanorama, ImageLittlePlanet, ImageLoader, ImagePanorama, Infospot, LittlePlanet, MODES, Media, OUTPUTS, Panorama, REVISION, Reticle, THREE_REVISION, THREE_VERSION, TextureLoader, VERSION, VideoPanorama, Viewer, Widget };","map":{"version":3,"sources":["C:/Users/Rajesh/Downloads/bilim (2)/bilim/v1.0/editors/BlmCourseEditor/node_modules/panolens/build/panolens.module.js"],"names":["Cache","Texture","RGBFormat","RGBAFormat","CubeTexture","EventDispatcher","VideoTexture","LinearFilter","SpriteMaterial","Sprite","Color","CanvasTexture","DoubleSide","Vector3","Mesh","BackSide","Object3D","SphereBufferGeometry","MeshBasicMaterial","BufferGeometry","BufferAttribute","ShaderLib","BoxBufferGeometry","ShaderMaterial","Matrix4","Vector2","Quaternion","PlaneBufferGeometry","Math","Math$1","MOUSE","PerspectiveCamera","OrthographicCamera","Euler","Scene","StereoCamera","WebGLRenderTarget","NearestFilter","WebGLRenderer","Raycaster","Frustum","REVISION","REVISION$1","version","dependencies","three","split","VERSION","THREE_REVISION","THREE_VERSION","replace","CONTROLS","ORBIT","DEVICEORIENTATION","MODES","UNKNOWN","NORMAL","CARDBOARD","STEREO","CONTROL_BUTTONS","FULLSCREEN","SETTING","VIDEO","OUTPUTS","NONE","CONSOLE","OVERLAY","DataImage","Info","Arrow","FullscreenEnter","FullscreenLeave","VideoPlay","VideoPause","WhiteTile","Setting","ChevronRight","Check","ViewIndicator","ImageLoader","load","url","onLoad","onProgress","onError","enabled","cached","request","arrayBufferView","blob","urlCreator","image","reference","iconName","hasOwnProperty","get","undefined","complete","src","setTimeout","loaded","total","addEventListener","window","URL","webkitURL","document","createElementNS","add","onImageLoaded","revokeObjectURL","indexOf","crossOrigin","XMLHttpRequest","open","process","env","npm_lifecycle_event","onreadystatechange","readyState","status","responseType","event","lengthComputable","currentTarget","response","Uint8Array","Blob","createObjectURL","send","TextureLoader","texture","isJPEG","search","format","needsUpdate","CubeTextureLoader","urls","progress","all","loadings","map","index","images","i","Media","constraints","defaultConstraints","video","width","ideal","height","facingMode","exact","audio","Object","assign","container","scene","element","devices","stream","ratioScalar","videoDeviceIndex","prototype","create","setContainer","setScene","enumerateDevices","resolvedPromise","Promise","resolve","length","navigator","mediaDevices","switchNextVideoDevice","stop","bind","start","setVideDeviceIndex","getDevices","then","type","validate","_devices","device","includes","push","filter","reg","RegExp","test","kind","getUserMedia","setMediaStream","playVideo","onCatchError","error","console","warn","catch","targetDevice","onVideoDevices","Error","deviceId","createVideoElement","active","track","getTracks","removeEventListener","onWindowResize","srcObject","background","createVideoTexture","play","dispatchEvent","pauseVideo","pause","generateMipmaps","minFilter","magFilter","center","set","createElement","canPlay","setAttribute","style","position","top","left","objectPosition","objectFit","display","videoWidth","videoHeight","clientWidth","clientHeight","cameraRatio","viewportRatio","ratio","repeat","Reticle","color","autoSelect","dwellTime","dpr","devicePixelRatio","canvas","context","createCanvas","material","createCanvasTexture","call","canvasWidth","canvasHeight","rippleDuration","z","scale","startTimestamp","timerId","callback","frustumCulled","updateCanvasArcByProgress","constructor","setColor","copy","getContext","shadowBlur","shadowColor","degree","PI","getStyle","x","y","lineWidth","clearRect","beginPath","arc","fillStyle","fill","strokeStyle","stroke","closePath","ripple","duration","timestamp","performance","now","update","requestAnimationFrame","elapsed","opacity","radius","r","g","b","cancelAnimationFrame","show","visible","hide","end","createCommonjsModule","fn","module","exports","Tween","_Group","_tweens","_tweensAddedDuringUpdate","getAll","keys","tweenId","removeAll","tween","getId","remove","time","preserve","tweenIds","TWEEN","_isPlaying","Group","_nextId","nextId","self","hrtime","Date","getTime","object","group","_object","_valuesStart","_valuesEnd","_valuesStartRepeat","_duration","_repeat","_repeatDelayTime","_yoyo","_reversed","_delayTime","_startTime","_easingFunction","Easing","Linear","None","_interpolationFunction","Interpolation","_chainedTweens","_onStartCallback","_onStartCallbackFired","_onUpdateCallback","_onRepeatCallback","_onCompleteCallback","_onStopCallback","_group","_id","isPlaying","to","properties","d","parseFloat","property","Array","concat","stopChainedTweens","Infinity","numChainedTweens","delay","amount","times","repeatDelay","yoyo","easing","easingFunction","interpolation","interpolationFunction","chain","arguments","onStart","onUpdate","onRepeat","onComplete","onStop","value","charAt","isFinite","tmp","k","Quadratic","In","Out","InOut","Cubic","Quartic","Quintic","Sinusoidal","cos","sin","Exponential","pow","Circular","sqrt","Elastic","Back","s","Bounce","v","m","f","floor","Utils","Bezier","n","pw","bn","Bernstein","CatmullRom","p0","p1","t","fc","Factorial","a","p2","p3","v0","v1","t2","t3","root","Infospot","imageSrc","animated","scaleFactor","isHovering","toPanorama","cursorStyle","mode","rotation","originalRaycast","raycast","HANDLER_FOCUS","side","depthTest","transparent","scaleUpAnimation","scaleDownAnimation","postLoad","textureScale","naturalWidth","naturalHeight","showAnimation","enableRaycast","hideAnimation","onClick","onHover","onHoverStart","onHoverEnd","onDualEyeEffect","onDismiss","setFocusMethod","data","HTMLElement","appendChild","getContainer","lockHoverElement","unlockHoverElement","cursor","mouseEvent","clientX","clientY","right","_width","_height","locked","halfWidth","halfHeight","cloneNode","translateElement","delta","verticalDelta","setElementStyle","webkitTransform","msTransform","transform","setText","text","textContent","setCursorHoverStyle","addHoverText","maxWidth","maxHeight","textShadow","fontFamily","classList","addHoverElement","el","removeHoverElement","removeChild","method","focus","dispose","geometry","parent","Widget","DEFAULT_TRANSITION","TOUCH_ENABLED","DocumentTouch","PREVENT_EVENT_HANDLER","preventDefault","stopPropagation","barElement","fullscreenElement","videoElement","settingElement","mainMenu","activeMainItem","activeSubMenu","mask","addControlBar","scope","bar","styleTranslate","styleOpacity","gradientStyle","float","transition","pointerEvents","isHidden","toggle","menu","createDefaultMenu","createMainMenu","createMask","deactivate","handler","title","subMenu","addControlButton","name","createFullscreenButton","createSettingButton","createVideoControl","item","onTap","activated","activate","createCustomItem","backgroundImage","webkitTransition","changeSize","unslideAll","isFullscreen","tapSkipped","stylesheetId","fullscreenEnabled","webkitFullscreenEnabled","mozFullScreenEnabled","msFullscreenEnabled","requestFullscreen","msRequestFullscreen","mozRequestFullScreen","webkitRequestFullscreen","Element","ALLOW_KEYBOARD_INPUT","exitFullscreen","msExitFullscreen","mozCancelFullScreen","webkitExitFullscreen","onFullScreenChange","querySelector","sheet","id","innerHTML","body","controlButton","paused","createVideoControlButton","seekBar","createVideoControlSeekbar","progressElement","progressElementControl","isDragging","mouseX","percentageNow","percentageNext","backgroundColor","borderRadius","onMouseDown","passive","changedTouches","parseInt","addControlListeners","onVideoControlDrag","setProgress","onVideoControlStop","removeControlListeners","target","percentage","pageX","getBoundingClientRect","offsetX","onDispose","marginTop","createMenuItem","padding","textDecoration","slide","unslide","setIcon","icon","setSelectionTitle","selection","addSelection","fontSize","fontWeight","addIcon","flip","backgroundSize","addSubMenu","items","createSubMenu","createMenuItemHeader","header","borderBottom","paddingBottom","menus","createMenu","onNextTick","slideAll","parentElement","addItem","paddingLeft","activeItem","setActiveItem","addHeader","bottom","visibility","boxShadow","overflow","willChange","children","options","backgroundRepeat","backgroundPosition","webkitUserSelect","MozUserSelect","userSelect","webkitFilter","mergeStyleOptions","Panorama","ImageQualityLow","ImageQualityFair","ImageQualityMedium","ImageQualityHigh","ImageQualitySuperHigh","animationDuration","defaultInfospotSize","linkedSpots","isInfospotVisible","linkingImageURL","linkingImageScale","renderOrder","infospotAnimation","fadeIn","setupTransitions","invertedObject","vector","scalePlaceHolder","intersects","traverse","forEach","child","getZoomLevel","zoomLevel","innerWidth","updateTexture","toggleInfospotVisibility","isVisible","setLinkingImage","link","pano","imageScale","img","spot","reset","fadeInAnimation","fadeOutAnimation","enterTransition","leaveTransition","onFadeAnimationUpdate","alpha","uniforms","fadeOut","onEnter","onLeave","recursiveDispose","ImagePanorama","_geometry","_material","HTMLImageElement","EmptyPanorama","addAttribute","Float32Array","CubePanorama","edgeLength","shader","fragmentShader","vertexShader","tCube","BasicPanorama","VideoPanorama","loop","muted","autoplay","playsinline","videoProgress","resumeVideoProgress","toggleVideo","setVideoCurrentTime","isMobile","check","substr","userAgent","vendor","opera","onloadeddata","setVideoTexture","querySelectorAll","source","currentTime","resetVideo","videoTexture","isVideoPaused","Number","isNaN","onSuccess","isVideoMuted","muteVideo","unmuteVideo","getVideoElement","GoogleStreetviewLoader","parameters","_parameters","_zoom","_panoId","_panoClient","google","maps","StreetViewService","_count","_total","_canvas","_ctx","_wc","_hc","result","copyright","onSizeChange","onPanoramaLoad","levelsW","levelsH","widths","heights","maxW","maxH","gl","max","getParameter","MAX_TEXTURE_SIZE","adaptTextureToZoom","w","h","ceil","c","composeFromTile","px","py","drawImage","panoId","zoom","composePanorama","useWebGL","Image","panoid","loadPano","getPanoramaById","StreetViewStatus","OK","location","setZoom","GoogleStreetviewPanorama","apiKey","gsvLoader","loadRequested","setupGoogleMapAPI","loadGSVLoader","script","setGSVLoader","onload","getGSVLoader","StereographicShader","join","LittlePlanet","size","createGeometry","createMaterial","EPS","frameId","dragging","userMouse","quatA","quatB","quatCur","quatSlerp","vectorX","vectorY","registerMouseEvents","onMouseMove","onMouseUp","onMouseWheel","onContextMenu","unregisterMouseEvents","inputCount","touches","dx","dy","pageY","distance","pinchDistance","onUpdateCallback","angleX","degToRad","angleY","setFromAxisAngle","multiply","addZoomDelta","wheelDelta","detail","lowerBound","upperBound","slerp","makeRotationFromQuaternion","clone","dot","resolution","ImageLittlePlanet","tDiffuse","CameraPanorama","media","onPanolensContainer","onPanolensScene","OrbitControls","domElement","ownerDocument","noZoom","zoomSpeed","minDistance","maxDistance","minZoom","maxZoom","noRotate","rotateSpeed","noPan","keyPanSpeed","autoRotate","autoRotateSpeed","minPolarAngle","maxPolarAngle","momentumDampingFactor","momentumScalingFactor","momentumKeydownFactor","minFov","maxFov","minAzimuthAngle","maxAzimuthAngle","noKeys","LEFT","UP","RIGHT","BOTTOM","mouseButtons","ZOOM","MIDDLE","PAN","MEPS","rotateStart","rotateEnd","rotateDelta","panStart","panEnd","panDelta","panOffset","offset","dollyStart","dollyEnd","dollyDelta","theta","phi","phiDelta","thetaDelta","pan","lastPosition","lastQuaternion","momentumLeft","momentumUp","eventPrevious","momentumOn","keyUp","keyBottom","keyLeft","keyRight","STATE","ROTATE","DOLLY","TOUCH_ROTATE","TOUCH_DOLLY","TOUCH_PAN","state","target0","position0","zoom0","quat","setFromUnitVectors","up","quatInverse","inverse","changeEvent","startEvent","endEvent","setLastQuaternion","quaternion","getLastPosition","rotateLeft","angle","getAutoRotationAngle","rotateUp","panLeft","te","matrix","elements","multiplyScalar","panUp","deltaX","deltaY","sub","targetDistance","tan","fov","momentum","abs","dollyIn","dollyScale","getZoomScale","min","updateProjectionMatrix","dollyOut","ignoreUpdate","applyQuaternion","atan2","lookAt","distanceToSquared","getPolarAngle","getAzimuthalAngle","button","subVectors","onKeyUp","keyCode","onKeyDown","touchstart","touchmove","touchend","DeviceOrientationControls","camera","rotY","rotX","tempX","tempY","reorder","deviceOrientation","screenOrientation","alphaOffsetAngle","onDeviceOrientationChangeEvent","onScreenOrientationChangeEvent","orientation","onTouchStartEvent","onTouchMoveEvent","updateAlphaOffsetAngle","setCameraQuaternion","beta","gamma","orient","zee","euler","q0","q1","vectorFingerY","fingerQY","fingerQX","setFromEuler","connect","disconnect","CardboardEffect","renderer","_camera","_scene","_stereo","aspect","_params","_renderTarget","scissorTest","distortion","removeAttribute","toNonIndexed","positions","attributes","array","uvs","uv","count","positions2","uvs2","l","scalar","mesh","setSize","pixelRatio","getPixelRatio","render","updateMatrixWorld","autoClear","clear","scissor","viewport","setRenderTarget","cameraL","clearDepth","cameraR","StereoEffect","setEyeSeparation","eyeSep","getSize","setScissorTest","setScissor","setViewport","Viewer","controlBar","controlButtons","autoHideControlBar","autoHideInfospot","horizontalView","clickTolerance","cameraFov","reverseDragging","enableReticle","autoReticleSelect","viewIndicator","indicatorSize","output","autoRotateActivationDuration","innerHeight","antialias","sceneReticle","viewIndicatorSize","reticle","tempEnableReticle","panorama","widget","hoverObject","infospot","pressEntityObject","pressObject","raycaster","raycasterPoint","updateCallbacks","requestAnimationId","cameraFrustum","cameraViewProjectionMatrix","autoRotateRequestId","outputDivElement","touchSupported","HANDLER_MOUSE_DOWN","HANDLER_MOUSE_UP","HANDLER_MOUSE_MOVE","HANDLER_WINDOW_RESIZE","HANDLER_KEY_DOWN","HANDLER_KEY_UP","HANDLER_TAP","OUTPUT_INFOSPOT","tweenLeftAnimation","tweenUpAnimation","setPixelRatio","setClearColor","passiveRendering","controls","control","effect","addReticle","addDefaultControlBar","addViewIndicator","reverseDraggingDirection","enableReticleControl","registerMouseAndTouchEvents","addOutputElement","registerEventListeners","animate","eventHandler","addPanoramaEventListener","setPanorama","buttonName","leavingPanorama","hideInfospot","afterEnterComplete","dispatchEventToChildren","activateWidgetItem","controlIndex","ControlMenuItem","ModeMenuItem","enableEffect","disableEffect","disableReticleControl","unregisterMouseAndTouchEvents","registerReticleEvent","updateReticleEvent","unregisterReticleEvent","enableAutoRate","disableAutoRate","clearTimeout","toggleVideoPlay","onVideoUpdate","addUpdateCallback","removeUpdateCallback","splice","showVideoWidget","hideVideoWidget","updateVideoPlayButton","setCameraControl","getControl","getScene","getCamera","getRenderer","getControlId","getNextControlId","getNextControlIndex","nextIndex","setCameraFov","enableControl","disableControl","toggleNextControl","getScreenVector","worldVector","widthHalf","heightHalf","project","checkSpriteInViewport","sprite","matrixWorldInverse","getInverse","matrixWorld","multiplyMatrices","projectionMatrix","setFromMatrix","intersectsSprite","tweenControlCenter","ha","va","chv","cvv","hv","vv","vptc","ov","nv","getWorldDirection","getWorldPosition","normalize","angleTo","tweenControlCenterByObject","isUnderScalePlaceHolder","traverseAncestors","ancestor","invertXVector","windowWidth","windowHeight","expand","contains","isAndroid","adjustWidth","documentElement","adjustHeight","outputPosition","intersectObject","point","converter","world","toFixed","message","info","onTarget","toggleControlBar","setFromCamera","intersectObjects","intersect_entity","getConvertedIntersect","intersect","passThrough","entity","key","onChange","offsetLeft","unregisterEventListeners","destroy","onPanoramaDispose","loadAsyncRequest","onloadend","loadViewIndicator","asyncEvent","viewIndicatorDiv","responseXML","indicator","setIndicatorD","currentPanoAngle","fovAngle","leftAngle","rightAngle","leftX","leftY","rightX","rightY","indicatorD","indicatorOnMouseEnter","indicatorOnMouseLeave","appendControlItem","option","clearAllCache"],"mappings":"AAAA,SAASA,KAAT,EAAgBC,OAAhB,EAAyBC,SAAzB,EAAoCC,UAApC,EAAgDC,WAAhD,EAA6DC,eAA7D,EAA8EC,YAA9E,EAA4FC,YAA5F,EAA0GC,cAA1G,EAA0HC,MAA1H,EAAkIC,KAAlI,EAAyIC,aAAzI,EAAwJC,UAAxJ,EAAoKC,OAApK,EAA6KC,IAA7K,EAAmLC,QAAnL,EAA6LC,QAA7L,EAAuMC,oBAAvM,EAA6NC,iBAA7N,EAAgPC,cAAhP,EAAgQC,eAAhQ,EAAiRC,SAAjR,EAA4RC,iBAA5R,EAA+SC,cAA/S,EAA+TC,OAA/T,EAAwUC,OAAxU,EAAiVC,UAAjV,EAA6VC,mBAA7V,EAAkXC,IAAI,IAAIC,MAA1X,EAAkYC,KAAlY,EAAyYC,iBAAzY,EAA4ZC,kBAA5Z,EAAgbC,KAAhb,EAAubC,KAAvb,EAA8bC,YAA9b,EAA4cC,iBAA5c,EAA+dC,aAA/d,EAA8eC,aAA9e,EAA6fC,SAA7f,EAAwgBC,OAAxgB,EAAihBC,QAAQ,IAAIC,UAA7hB,QAA+iB,OAA/iB;AAEA,MAAMC,OAAO,GAAC,QAAd;AAAuB,MAAMC,YAAY,GAAC;AAACC,EAAAA,KAAK,EAAC;AAAP,CAAnB;AAEvB;;;;;;;AAMA,MAAMJ,QAAQ,GAAGE,OAAO,CAACG,KAAR,CAAe,GAAf,EAAsB,CAAtB,CAAjB;AAEA;;;;;;;AAMA,MAAMC,OAAO,GAAGJ,OAAhB;AAEA;;;;;;;AAMA,MAAMK,cAAc,GAAGJ,YAAY,CAACC,KAAb,CAAmBC,KAAnB,CAA0B,GAA1B,EAAiC,CAAjC,CAAvB;AAEA;;;;;;;AAMA,MAAMG,aAAa,GAAGL,YAAY,CAACC,KAAb,CAAmBK,OAAnB,CAA4B,UAA5B,EAAwC,EAAxC,CAAtB;AAEA;;;;;;;;AAOA,MAAMC,QAAQ,GAAG;AAAEC,EAAAA,KAAK,EAAE,CAAT;AAAYC,EAAAA,iBAAiB,EAAE;AAA/B,CAAjB;AAEA;;;;;;;;;;AASA,MAAMC,KAAK,GAAG;AAAEC,EAAAA,OAAO,EAAE,CAAX;AAAcC,EAAAA,MAAM,EAAE,CAAtB;AAAyBC,EAAAA,SAAS,EAAE,CAApC;AAAuCC,EAAAA,MAAM,EAAE;AAA/C,CAAd;AAEA;;;;;;;;;AAQA,MAAMC,eAAe,GAAG;AAAEC,EAAAA,UAAU,EAAE,YAAd;AAA4BC,EAAAA,OAAO,EAAE,SAArC;AAAgDC,EAAAA,KAAK,EAAE;AAAvD,CAAxB;AAEA;;;;;;;;;AAQA,MAAMC,OAAO,GAAG;AAAEC,EAAAA,IAAI,EAAE,MAAR;AAAgBC,EAAAA,OAAO,EAAE,SAAzB;AAAoCC,EAAAA,OAAO,EAAE;AAA7C,CAAhB;AAEA;;;;;;;;;;;;;;;;;AAgBA,MAAMC,SAAS,GAAG;AACdC,EAAAA,IAAI,EAAE,4rCADQ;AAEdC,EAAAA,KAAK,EAAE,wwCAFO;AAGdC,EAAAA,eAAe,EAAE,gWAHH;AAIdC,EAAAA,eAAe,EAAE,gjBAJH;AAKdC,EAAAA,SAAS,EAAE,weALG;AAMdC,EAAAA,UAAU,EAAE,4fANE;AAOdC,EAAAA,SAAS,EAAE,goEAPG;AAQdC,EAAAA,OAAO,EAAE,w4CARK;AASdC,EAAAA,YAAY,EAAE,ofATA;AAUdC,EAAAA,KAAK,EAAE,gfAVO;AAWdC,EAAAA,aAAa,EAAE;AAXD,CAAlB;AAcA;;;;;AAIA,MAAMC,WAAW,GAAG;AAEhB;;;;;;;;;AASAC,EAAAA,IAAI,EAAE,UAAWC,GAAX,EAAgBC,MAAM,GAAG,MAAM,CAAE,CAAjC,EAAmCC,UAAU,GAAG,MAAM,CAAE,CAAxD,EAA0DC,OAAO,GAAG,MAAM,CAAE,CAA5E,EAA+E;AAEjF;AACApF,IAAAA,KAAK,CAACqF,OAAN,GAAgB,IAAhB;AAEA,QAAIC,MAAJ,EAAYC,OAAZ,EAAqBC,eAArB,EAAsCC,IAAtC,EAA4CC,UAA5C,EAAwDC,KAAxD,EAA+DC,SAA/D,CALiF,CAOjF;;AACA,SAAK,IAAIC,QAAT,IAAqB1B,SAArB,EAAgC;AAE5B,UAAIA,SAAS,CAAC2B,cAAV,CAAyBD,QAAzB,KAAsCZ,GAAG,KAAKd,SAAS,CAAC0B,QAAD,CAA3D,EAAuE;AAEnED,QAAAA,SAAS,GAAGC,QAAZ;AAEH;AAEJ,KAhBgF,CAkBjF;;;AACAP,IAAAA,MAAM,GAAGtF,KAAK,CAAC+F,GAAN,CAAUH,SAAS,GAAGA,SAAH,GAAeX,GAAlC,CAAT;;AAEA,QAAIK,MAAM,KAAKU,SAAf,EAA0B;AAEtB,UAAId,MAAJ,EAAY;AAER,YAAKI,MAAM,CAACW,QAAP,IAAmBX,MAAM,CAACY,GAA/B,EAAqC;AACjCC,UAAAA,UAAU,CAAE,YAAY;AAEpBhB,YAAAA,UAAU,CAAE;AAAEiB,cAAAA,MAAM,EAAE,CAAV;AAAaC,cAAAA,KAAK,EAAE;AAApB,aAAF,CAAV;AACAnB,YAAAA,MAAM,CAAEI,MAAF,CAAN;AAEH,WALS,EAKP,CALO,CAAV;AAMH,SAPD,MAOO;AACHA,UAAAA,MAAM,CAACgB,gBAAP,CAAyB,MAAzB,EAAiC,YAAY;AAEzCnB,YAAAA,UAAU,CAAE;AAAEiB,cAAAA,MAAM,EAAE,CAAV;AAAaC,cAAAA,KAAK,EAAE;AAApB,aAAF,CAAV;AACAnB,YAAAA,MAAM,CAAEI,MAAF,CAAN;AAEH,WALD,EAKG,KALH;AAMH;AAEJ;;AAED,aAAOA,MAAP;AAEH,KA7CgF,CA+CjF;;;AACAI,IAAAA,UAAU,GAAGa,MAAM,CAACC,GAAP,IAAcD,MAAM,CAACE,SAAlC;AACAd,IAAAA,KAAK,GAAGe,QAAQ,CAACC,eAAT,CAAyB,8BAAzB,EAAyD,KAAzD,CAAR,CAjDiF,CAmDjF;;AACA3G,IAAAA,KAAK,CAAC4G,GAAN,CAAUhB,SAAS,GAAGA,SAAH,GAAeX,GAAlC,EAAuCU,KAAvC;;AAEA,UAAMkB,aAAa,GAAG,MAAM;AAExBnB,MAAAA,UAAU,CAACoB,eAAX,CAA2BnB,KAAK,CAACO,GAAjC;AACAhB,MAAAA,MAAM,CAACS,KAAD,CAAN;AAEH,KALD;;AAOA,QAAIV,GAAG,CAAC8B,OAAJ,CAAY,OAAZ,MAAyB,CAA7B,EAAgC;AAE5BpB,MAAAA,KAAK,CAACW,gBAAN,CAAuB,MAAvB,EAA+BO,aAA/B,EAA8C,KAA9C;AACAlB,MAAAA,KAAK,CAACO,GAAN,GAAYjB,GAAZ;AACA,aAAOU,KAAP;AACH;;AAEDA,IAAAA,KAAK,CAACqB,WAAN,GAAoB,KAAKA,WAAL,KAAqBhB,SAArB,GAAiC,KAAKgB,WAAtC,GAAoD,EAAxE;AAEAzB,IAAAA,OAAO,GAAG,IAAIgB,MAAM,CAACU,cAAX,EAAV;AACA1B,IAAAA,OAAO,CAAC2B,IAAR,CAAa,KAAb,EAAoBjC,GAApB,EAAyB,IAAzB;;AACA,QAAIkC,OAAO,CAACC,GAAR,CAAYC,mBAAZ,KAAoC,MAAxC,EAAgD;AAC5C;AACA9B,MAAAA,OAAO,CAAC+B,kBAAR,GAA6B,YAAY;AACrC,YAAI,KAAKC,UAAL,KAAoB,CAApB,IAAyB,KAAKC,MAAL,IAAe,GAA5C,EAAiD;AAC7CpC,UAAAA,OAAO;AACV;AACJ,OAJD;AAKH;;AACDG,IAAAA,OAAO,CAACkC,YAAR,GAAuB,aAAvB;AACAlC,IAAAA,OAAO,CAACe,gBAAR,CAA0B,OAA1B,EAAmClB,OAAnC;AACAG,IAAAA,OAAO,CAACe,gBAAR,CAA0B,UAA1B,EAAsCoB,KAAK,IAAI;AAE3C,UAAM,CAACA,KAAP,EAAe;AAEf,YAAM;AAAEtB,QAAAA,MAAF;AAAUC,QAAAA,KAAV;AAAiBsB,QAAAA;AAAjB,UAAsCD,KAA5C;;AAEA,UAAKC,gBAAL,EAAwB;AAEpBxC,QAAAA,UAAU,CAAE;AAAEiB,UAAAA,MAAF;AAAUC,UAAAA;AAAV,SAAF,CAAV;AAEH;AAEJ,KAZD;AAcAd,IAAAA,OAAO,CAACe,gBAAR,CAA0B,SAA1B,EAAqCoB,KAAK,IAAI;AAE1C,UAAM,CAACA,KAAP,EAAe;AACf,YAAM;AAAEE,QAAAA,aAAa,EAAE;AAAEC,UAAAA;AAAF;AAAjB,UAAkCH,KAAxC;AAEAlC,MAAAA,eAAe,GAAG,IAAIsC,UAAJ,CAAgBD,QAAhB,CAAlB;AACApC,MAAAA,IAAI,GAAG,IAAIc,MAAM,CAACwB,IAAX,CAAiB,CAAEvC,eAAF,CAAjB,CAAP;AAEAG,MAAAA,KAAK,CAACW,gBAAN,CAAwB,MAAxB,EAAgCO,aAAhC,EAA+C,KAA/C;AACAlB,MAAAA,KAAK,CAACO,GAAN,GAAYR,UAAU,CAACsC,eAAX,CAA4BvC,IAA5B,CAAZ;AAEH,KAXD;AAaAF,IAAAA,OAAO,CAAC0C,IAAR,CAAa,IAAb;AAEH;AA1He,CAApB;AA8HA;;;;;AAIA,MAAMC,aAAa,GAAG;AAElB;;;;;;;;;;AAUAlD,EAAAA,IAAI,EAAE,UAAWC,GAAX,EAAgBC,MAAM,GAAG,MAAM,CAAE,CAAjC,EAAmCC,UAAnC,EAA+CC,OAA/C,EAAyD;AAE3D,QAAI+C,OAAO,GAAG,IAAIlI,OAAJ,EAAd;AAEA8E,IAAAA,WAAW,CAACC,IAAZ,CAAkBC,GAAlB,EAAuB,UAAWU,KAAX,EAAmB;AAEtCwC,MAAAA,OAAO,CAACxC,KAAR,GAAgBA,KAAhB,CAFsC,CAItC;;AACA,YAAMyC,MAAM,GAAGnD,GAAG,CAACoD,MAAJ,CAAY,eAAZ,IAAgC,CAAhC,IAAqCpD,GAAG,CAACoD,MAAJ,CAAY,oBAAZ,MAAuC,CAA3F;AAEAF,MAAAA,OAAO,CAACG,MAAR,GAAiBF,MAAM,GAAGlI,SAAH,GAAeC,UAAtC;AACAgI,MAAAA,OAAO,CAACI,WAAR,GAAsB,IAAtB;AAEArD,MAAAA,MAAM,CAAEiD,OAAF,CAAN;AAEH,KAZD,EAYGhD,UAZH,EAYeC,OAZf;AAcA,WAAO+C,OAAP;AAEH;AAhCiB,CAAtB;AAoCA;;;;;AAIA,MAAMK,iBAAiB,GAAG;AAEtB;;;;;;;;;;AAUAxD,EAAAA,IAAI,EAAE,UAAWyD,IAAX,EAAiBvD,MAAM,GAAG,MAAM,CAAE,CAAlC,EAAoCC,UAAU,GAAG,MAAM,CAAE,CAAzD,EAA2DC,OAA3D,EAAqE;AAE3E,QAAI+C,OAAJ,EAAa/B,MAAb,EAAqBsC,QAArB,EAA+BC,GAA/B,EAAoCC,QAApC;AAEAT,IAAAA,OAAO,GAAG,IAAI/H,WAAJ,CAAiB,EAAjB,CAAV;AAEAgG,IAAAA,MAAM,GAAG,CAAT;AACAsC,IAAAA,QAAQ,GAAG,EAAX;AACAC,IAAAA,GAAG,GAAG,EAAN;AAEAF,IAAAA,IAAI,CAACI,GAAL,CAAU,UAAW5D,GAAX,EAAgB6D,KAAhB,EAAwB;AAEjC/D,MAAAA,WAAW,CAACC,IAAZ,CAAkBC,GAAlB,EAAuB,UAAWU,KAAX,EAAmB;AAEzCwC,QAAAA,OAAO,CAACY,MAAR,CAAgBD,KAAhB,IAA0BnD,KAA1B;AAEAS,QAAAA,MAAM;;AAEN,YAAKA,MAAM,KAAK,CAAhB,EAAoB;AAEnB+B,UAAAA,OAAO,CAACI,WAAR,GAAsB,IAAtB;AAEArD,UAAAA,MAAM,CAAEiD,OAAF,CAAN;AAEA;AAED,OAdD,EAcG,UAAWT,KAAX,EAAmB;AAErBgB,QAAAA,QAAQ,CAAEI,KAAF,CAAR,GAAoB;AAAE1C,UAAAA,MAAM,EAAEsB,KAAK,CAACtB,MAAhB;AAAwBC,UAAAA,KAAK,EAAEqB,KAAK,CAACrB;AAArC,SAApB;AAEAsC,QAAAA,GAAG,CAACvC,MAAJ,GAAa,CAAb;AACAuC,QAAAA,GAAG,CAACtC,KAAJ,GAAY,CAAZ;AACAuC,QAAAA,QAAQ,GAAG,CAAX;;AAEA,aAAM,IAAII,CAAV,IAAeN,QAAf,EAA0B;AAEzBE,UAAAA,QAAQ;AACRD,UAAAA,GAAG,CAACvC,MAAJ,IAAcsC,QAAQ,CAAEM,CAAF,CAAR,CAAc5C,MAA5B;AACAuC,UAAAA,GAAG,CAACtC,KAAJ,IAAaqC,QAAQ,CAAEM,CAAF,CAAR,CAAc3C,KAA3B;AAEA;;AAED,YAAKuC,QAAQ,GAAG,CAAhB,EAAoB;AAEnBD,UAAAA,GAAG,CAACtC,KAAJ,GAAYsC,GAAG,CAACtC,KAAJ,GAAYuC,QAAZ,GAAuB,CAAnC;AAEA;;AAEDzD,QAAAA,UAAU,CAAEwD,GAAF,CAAV;AAEA,OAtCD,EAsCGvD,OAtCH;AAwCA,KA1CD;AA4CA,WAAO+C,OAAP;AAEC;AApEqB,CAA1B;AAwEA;;;;;;AAKA,SAASc,KAAT,CAAiBC,WAAjB,EAA+B;AAE3B,QAAMC,kBAAkB,GAAG;AAAEC,IAAAA,KAAK,EAAE;AAAEC,MAAAA,KAAK,EAAE;AAAEC,QAAAA,KAAK,EAAE;AAAT,OAAT;AAA0BC,MAAAA,MAAM,EAAE;AAAED,QAAAA,KAAK,EAAE;AAAT,OAAlC;AAAmDE,MAAAA,UAAU,EAAE;AAAEC,QAAAA,KAAK,EAAE;AAAT;AAA/D,KAAT;AAAoGC,IAAAA,KAAK,EAAE;AAA3G,GAA3B;AAEA,OAAKR,WAAL,GAAmBS,MAAM,CAACC,MAAP,CAAeT,kBAAf,EAAmCD,WAAnC,CAAnB;AAEA,OAAKW,SAAL,GAAiB,IAAjB;AACA,OAAKC,KAAL,GAAa,IAAb;AACA,OAAKC,OAAL,GAAe,IAAf;AACA,OAAKC,OAAL,GAAe,EAAf;AACA,OAAKC,MAAL,GAAc,IAAd;AACA,OAAKC,WAAL,GAAmB,CAAnB;AACA,OAAKC,gBAAL,GAAwB,CAAxB;AAEH;;AACDlB,KAAK,CAACmB,SAAN,GAAkBT,MAAM,CAACC,MAAP,CAAeD,MAAM,CAACU,MAAP,CAAehK,eAAe,CAAC+J,SAA/B,CAAf,EAA2D;AAEzEE,EAAAA,YAAY,EAAE,UAAWT,SAAX,EAAuB;AAEjC,SAAKA,SAAL,GAAiBA,SAAjB;AAEH,GANwE;AAQzEU,EAAAA,QAAQ,EAAE,UAAWT,KAAX,EAAmB;AAEzB,SAAKA,KAAL,GAAaA,KAAb;AAEH,GAZwE;;AAczE;;;;;;AAMAU,EAAAA,gBAAgB,EAAE,YAAY;AAE1B,UAAMR,OAAO,GAAG,KAAKA,OAArB;AACA,UAAMS,eAAe,GAAG,IAAIC,OAAJ,CAAaC,OAAO,IAAI;AAAEA,MAAAA,OAAO,CAAEX,OAAF,CAAP;AAAqB,KAA/C,CAAxB;AAEA,WAAOA,OAAO,CAACY,MAAR,GAAiB,CAAjB,GAAqBH,eAArB,GAAuClE,MAAM,CAACsE,SAAP,CAAiBC,YAAjB,CAA8BN,gBAA9B,EAA9C;AAEH,GA3BwE;;AA6BzE;;;;;AAKAO,EAAAA,qBAAqB,EAAE,YAAY;AAE/B,UAAMC,IAAI,GAAG,KAAKA,IAAL,CAAUC,IAAV,CAAgB,IAAhB,CAAb;AACA,UAAMC,KAAK,GAAG,KAAKA,KAAL,CAAWD,IAAX,CAAiB,IAAjB,CAAd;AACA,UAAME,kBAAkB,GAAG,KAAKA,kBAAL,CAAwBF,IAAxB,CAA8B,IAA9B,CAA3B;AAEA,QAAInC,KAAK,GAAG,KAAKqB,gBAAjB;AAEA,SAAKiB,UAAL,CAAiB,OAAjB,EACKC,IADL,CACWrB,OAAO,IAAI;AACdgB,MAAAA,IAAI;AACJlC,MAAAA,KAAK;;AACL,UAAKA,KAAK,IAAIkB,OAAO,CAACY,MAAtB,EAA+B;AAC3BO,QAAAA,kBAAkB,CAAE,CAAF,CAAlB;AACArC,QAAAA,KAAK;AACR,OAHD,MAGO;AACHqC,QAAAA,kBAAkB,CAAErC,KAAF,CAAlB;AACH;;AAEDoC,MAAAA,KAAK,CAAElB,OAAO,CAAElB,KAAF,CAAT,CAAL;AAGH,KAdL;AAgBH,GA1DwE;;AA4DzE;;;;;;AAMAsC,EAAAA,UAAU,EAAE,UAAWE,IAAI,GAAG,OAAlB,EAA4B;AAEpC,UAAMtB,OAAO,GAAG,KAAKA,OAArB;;AACA,UAAMuB,QAAQ,GAAGC,QAAQ,IAAI;AAEzB,aAAOA,QAAQ,CAAC3C,GAAT,CAAc4C,MAAM,IAAI;AAE3B,YAAK,CAACzB,OAAO,CAAC0B,QAAR,CAAkBD,MAAlB,CAAN,EAAmC;AAAEzB,UAAAA,OAAO,CAAC2B,IAAR,CAAcF,MAAd;AAAyB;;AAC9D,eAAOA,MAAP;AAEH,OALM,CAAP;AAOH,KATD;;AAUA,UAAMG,MAAM,GAAGJ,QAAQ,IAAI;AAEvB,YAAMK,GAAG,GAAG,IAAIC,MAAJ,CAAYR,IAAZ,EAAkB,GAAlB,CAAZ;AACA,aAAOE,QAAQ,CAACI,MAAT,CAAiBH,MAAM,IAAII,GAAG,CAACE,IAAJ,CAAUN,MAAM,CAACO,IAAjB,CAA3B,CAAP;AAEH,KALD;;AAOA,WAAO,KAAKxB,gBAAL,GACFa,IADE,CACIE,QADJ,EAEFF,IAFE,CAEIO,MAFJ,CAAP;AAIH,GA1FwE;;AA4FzE;;;;;;AAMAK,EAAAA,YAAY,EAAE,UAAW/C,WAAX,EAAyB;AAEnC,UAAMgD,cAAc,GAAG,KAAKA,cAAL,CAAoBjB,IAApB,CAA0B,IAA1B,CAAvB;AACA,UAAMkB,SAAS,GAAG,KAAKA,SAAL,CAAelB,IAAf,CAAqB,IAArB,CAAlB;;AACA,UAAMmB,YAAY,GAAGC,KAAK,IAAI;AAAEC,MAAAA,OAAO,CAACC,IAAR,CAAe,mBAAkBF,KAAM,EAAvC;AAA6C,KAA7E;;AAEA,WAAO9F,MAAM,CAACsE,SAAP,CAAiBC,YAAjB,CAA8BmB,YAA9B,CAA4C/C,WAA5C,EACFmC,IADE,CACIa,cADJ,EAEFb,IAFE,CAEIc,SAFJ,EAGFK,KAHE,CAGKJ,YAHL,CAAP;AAKH,GA7GwE;;AA+GzE;;;;;;AAMAjB,EAAAA,kBAAkB,EAAE,UAAWrC,KAAX,EAAmB;AAEnC,SAAKqB,gBAAL,GAAwBrB,KAAxB;AAEH,GAzHwE;;AA2HzE;;;;;;AAMAoC,EAAAA,KAAK,EAAE,UAAUuB,YAAV,EAAyB;AAE5B,UAAMvD,WAAW,GAAG,KAAKA,WAAzB;AACA,UAAM+C,YAAY,GAAG,KAAKA,YAAL,CAAkBhB,IAAlB,CAAwB,IAAxB,CAArB;;AACA,UAAMyB,cAAc,GAAG1C,OAAO,IAAI;AAE9B,UAAK,CAACA,OAAD,IAAYA,OAAO,CAACY,MAAR,KAAmB,CAApC,EAAwC;AAEpC,cAAM+B,KAAK,CAAE,uBAAF,CAAX;AAEH;;AAED,YAAMlB,MAAM,GAAGgB,YAAY,IAAIzC,OAAO,CAAE,CAAF,CAAtC;AACAd,MAAAA,WAAW,CAACE,KAAZ,CAAkBwD,QAAlB,GAA6BnB,MAAM,CAACmB,QAApC;AAEA,aAAOX,YAAY,CAAE/C,WAAF,CAAnB;AAEH,KAbD;;AAeA,SAAKa,OAAL,GAAe,KAAK8C,kBAAL,EAAf;AAEA,WAAO,KAAKzB,UAAL,GAAkBC,IAAlB,CAAwBqB,cAAxB,CAAP;AAEH,GAxJwE;;AA0JzE;;;;;AAKA1B,EAAAA,IAAI,EAAE,YAAY;AAEd,UAAMf,MAAM,GAAG,KAAKA,MAApB;;AAEA,QAAKA,MAAM,IAAIA,MAAM,CAAC6C,MAAtB,EAA+B;AAE3B,YAAMC,KAAK,GAAG9C,MAAM,CAAC+C,SAAP,GAAoB,CAApB,CAAd;AAEAD,MAAAA,KAAK,CAAC/B,IAAN;AAEAzE,MAAAA,MAAM,CAAC0G,mBAAP,CAA4B,QAA5B,EAAsC,KAAKC,cAAL,CAAoBjC,IAApB,CAA0B,IAA1B,CAAtC;AAEA,WAAKlB,OAAL,GAAe,IAAf;AACA,WAAKE,MAAL,GAAc,IAAd;AAEH;AAEJ,GAhLwE;;AAkLzE;;;;;;AAMAiC,EAAAA,cAAc,EAAE,UAAWjC,MAAX,EAAoB;AAEhC,SAAKA,MAAL,GAAcA,MAAd;AACA,SAAKF,OAAL,CAAaoD,SAAb,GAAyBlD,MAAzB;;AAEA,QAAK,KAAKH,KAAV,EAAkB;AAEd,WAAKA,KAAL,CAAWsD,UAAX,GAAwB,KAAKC,kBAAL,EAAxB;AAEH;;AAED9G,IAAAA,MAAM,CAACD,gBAAP,CAAyB,QAAzB,EAAmC,KAAK4G,cAAL,CAAoBjC,IAApB,CAA0B,IAA1B,CAAnC;AAEH,GArMwE;;AAuMzE;;;;;AAKAkB,EAAAA,SAAS,EAAE,YAAY;AAEnB,UAAM;AAAEpC,MAAAA;AAAF,QAAc,IAApB;;AAEA,QAAKA,OAAL,EAAe;AAEXA,MAAAA,OAAO,CAACuD,IAAR;AACA,WAAKC,aAAL,CAAoB;AAAEjC,QAAAA,IAAI,EAAE;AAAR,OAApB;AAEH;AAEJ,GAvNwE;;AAyNzE;;;;;AAKAkC,EAAAA,UAAU,EAAE,YAAY;AAEpB,UAAM;AAAEzD,MAAAA;AAAF,QAAc,IAApB;;AAEA,QAAKA,OAAL,EAAe;AAEXA,MAAAA,OAAO,CAAC0D,KAAR;AACA,WAAKF,aAAL,CAAoB;AAAEjC,QAAAA,IAAI,EAAE;AAAR,OAApB;AAEH;AAEJ,GAzOwE;;AA2OzE;;;;;;AAMA+B,EAAAA,kBAAkB,EAAE,YAAY;AAE5B,UAAMjE,KAAK,GAAG,KAAKW,OAAnB;AACA,UAAM5B,OAAO,GAAG,IAAI7H,YAAJ,CAAkB8I,KAAlB,CAAhB;AAEAjB,IAAAA,OAAO,CAACuF,eAAR,GAA0B,KAA1B;AACAvF,IAAAA,OAAO,CAACwF,SAAR,GAAoBpN,YAApB;AACA4H,IAAAA,OAAO,CAACyF,SAAR,GAAoBrN,YAApB;AACA4H,IAAAA,OAAO,CAACG,MAAR,GAAiBpI,SAAjB;AACAiI,IAAAA,OAAO,CAAC0F,MAAR,CAAeC,GAAf,CAAoB,GAApB,EAAyB,GAAzB;AAEA1E,IAAAA,KAAK,CAAC9C,gBAAN,CAAwB,SAAxB,EAAmC,KAAK4G,cAAL,CAAoBjC,IAApB,CAA0B,IAA1B,CAAnC;AAEA,WAAO9C,OAAP;AAEH,GAhQwE;;AAkQzE;;;;;;;AAOA0E,EAAAA,kBAAkB,EAAE,YAAW;AAE3B,UAAMU,aAAa,GAAG,KAAKA,aAAL,CAAmBtC,IAAnB,CAAyB,IAAzB,CAAtB;AACA,UAAM7B,KAAK,GAAG1C,QAAQ,CAACqH,aAAT,CAAwB,OAAxB,CAAd;AAEA;;;;;;AAKA,UAAMC,OAAO,GAAG,MAAMT,aAAa,CAAE;AAAEjC,MAAAA,IAAI,EAAE;AAAR,KAAF,CAAnC;;AAEAlC,IAAAA,KAAK,CAAC6E,YAAN,CAAoB,UAApB,EAAgC,EAAhC;AACA7E,IAAAA,KAAK,CAAC6E,YAAN,CAAoB,OAApB,EAA6B,EAA7B;AACA7E,IAAAA,KAAK,CAAC6E,YAAN,CAAoB,aAApB,EAAmC,EAAnC;AAEA7E,IAAAA,KAAK,CAAC8E,KAAN,CAAYC,QAAZ,GAAuB,UAAvB;AACA/E,IAAAA,KAAK,CAAC8E,KAAN,CAAYE,GAAZ,GAAkB,GAAlB;AACAhF,IAAAA,KAAK,CAAC8E,KAAN,CAAYG,IAAZ,GAAmB,GAAnB;AACAjF,IAAAA,KAAK,CAAC8E,KAAN,CAAY7E,KAAZ,GAAoB,MAApB;AACAD,IAAAA,KAAK,CAAC8E,KAAN,CAAY3E,MAAZ,GAAqB,MAArB;AACAH,IAAAA,KAAK,CAAC8E,KAAN,CAAYI,cAAZ,GAA6B,QAA7B;AACAlF,IAAAA,KAAK,CAAC8E,KAAN,CAAYK,SAAZ,GAAwB,OAAxB;AACAnF,IAAAA,KAAK,CAAC8E,KAAN,CAAYM,OAAZ,GAAsB,KAAK1E,KAAL,GAAa,MAAb,GAAsB,EAA5C;AAEAV,IAAAA,KAAK,CAAC9C,gBAAN,CAAwB,SAAxB,EAAmC0H,OAAnC;AAEA,WAAO5E,KAAP;AAEH,GAtSwE;;AAwSzE;;;;;;AAMA8D,EAAAA,cAAc,EAAE,YAAY;AAExB,QAAK,KAAKnD,OAAL,IAAgB,KAAKA,OAAL,CAAa0E,UAA7B,IAA2C,KAAK1E,OAAL,CAAa2E,WAAxD,IAAuE,KAAK5E,KAAjF,EAAyF;AAErF,YAAM;AAAE6E,QAAAA,WAAW,EAAEtF,KAAf;AAAsBuF,QAAAA,YAAY,EAAErF;AAApC,UAA+C,KAAKM,SAA1D;AACA,YAAM1B,OAAO,GAAG,KAAK2B,KAAL,CAAWsD,UAA3B;AACA,YAAM;AAAEqB,QAAAA,UAAF;AAAcC,QAAAA;AAAd,UAA8B,KAAK3E,OAAzC;AACA,YAAM8E,WAAW,GAAGH,WAAW,GAAGD,UAAlC;AACA,YAAMK,aAAa,GAAG,KAAKjF,SAAL,GAAiBR,KAAK,GAAGE,MAAzB,GAAkC,GAAxD;AACA,YAAMwF,KAAK,GAAGF,WAAW,GAAGC,aAAd,GAA8B,KAAK5E,WAAjD;;AAEA,UAAKb,KAAK,GAAGE,MAAb,EAAsB;AAClBpB,QAAAA,OAAO,CAAC6G,MAAR,CAAelB,GAAf,CAAoBiB,KAApB,EAA2B,CAA3B;AACH,OAFD,MAEO;AACH5G,QAAAA,OAAO,CAAC6G,MAAR,CAAelB,GAAf,CAAoB,CAApB,EAAuB,IAAIiB,KAA3B;AACH;AAEJ;AAEJ;AAjUwE,CAA3D,CAAlB;AAqUA;;;;;;;;AAQA,SAASE,OAAT,CAAmBC,KAAK,GAAG,QAA3B,EAAqCC,UAAU,GAAG,IAAlD,EAAwDC,SAAS,GAAG,IAApE,EAA2E;AAEvE,OAAKC,GAAL,GAAW9I,MAAM,CAAC+I,gBAAlB;AAEA,QAAM;AAAEC,IAAAA,MAAF;AAAUC,IAAAA;AAAV,MAAsB,KAAKC,YAAL,EAA5B;AACA,QAAMC,QAAQ,GAAG,IAAIlP,cAAJ,CAAoB;AAAE0O,IAAAA,KAAF;AAASrG,IAAAA,GAAG,EAAE,KAAK8G,mBAAL,CAA0BJ,MAA1B;AAAd,GAApB,CAAjB;AAEA9O,EAAAA,MAAM,CAACmP,IAAP,CAAa,IAAb,EAAmBF,QAAnB;AAEA,OAAKG,WAAL,GAAmBN,MAAM,CAAClG,KAA1B;AACA,OAAKyG,YAAL,GAAoBP,MAAM,CAAChG,MAA3B;AACA,OAAKiG,OAAL,GAAeA,OAAf;AACA,OAAKN,KAAL,GAAaA,KAAK,YAAYxO,KAAjB,GAAyBwO,KAAzB,GAAiC,IAAIxO,KAAJ,CAAWwO,KAAX,CAA9C;AAEA,OAAKC,UAAL,GAAkBA,UAAlB;AACA,OAAKC,SAAL,GAAiBA,SAAjB;AACA,OAAKW,cAAL,GAAsB,GAAtB;AACA,OAAK5B,QAAL,CAAc6B,CAAd,GAAkB,CAAC,EAAnB;AACA,OAAKnC,MAAL,CAAYC,GAAZ,CAAiB,GAAjB,EAAsB,GAAtB;AACA,OAAKmC,KAAL,CAAWnC,GAAX,CAAgB,GAAhB,EAAqB,GAArB,EAA0B,CAA1B;AAEA,OAAKoC,cAAL,GAAsB,IAAtB;AACA,OAAKC,OAAL,GAAe,IAAf;AACA,OAAKC,QAAL,GAAgB,IAAhB;AAEA,OAAKC,aAAL,GAAqB,KAArB;AAEA,OAAKC,yBAAL,CAAgC,CAAhC;AAEH;;AACDrB,OAAO,CAAC7E,SAAR,GAAoBT,MAAM,CAACC,MAAP,CAAeD,MAAM,CAACU,MAAP,CAAe5J,MAAM,CAAC2J,SAAtB,CAAf,EAAkD;AAElEmG,EAAAA,WAAW,EAAEtB,OAFqD;;AAIlE;;;;;;AAMAuB,EAAAA,QAAQ,EAAE,UAAWtB,KAAX,EAAmB;AAEzB,SAAKQ,QAAL,CAAcR,KAAd,CAAoBuB,IAApB,CAA0BvB,KAAK,YAAYxO,KAAjB,GAAyBwO,KAAzB,GAAiC,IAAIxO,KAAJ,CAAWwO,KAAX,CAA3D;AAEH,GAdiE;;AAgBlE;;;;;;;AAOAS,EAAAA,mBAAmB,EAAE,UAAWJ,MAAX,EAAoB;AAErC,UAAMpH,OAAO,GAAG,IAAIxH,aAAJ,CAAmB4O,MAAnB,CAAhB;AACApH,IAAAA,OAAO,CAACwF,SAAR,GAAoBpN,YAApB;AACA4H,IAAAA,OAAO,CAACyF,SAAR,GAAoBrN,YAApB;AACA4H,IAAAA,OAAO,CAACuF,eAAR,GAA0B,KAA1B;AAEA,WAAOvF,OAAP;AAEH,GAhCiE;;AAkClE;;;;;;;;AAQAsH,EAAAA,YAAY,EAAE,YAAY;AAEtB,UAAMpG,KAAK,GAAG,EAAd;AACA,UAAME,MAAM,GAAG,EAAf;AACA,UAAMgG,MAAM,GAAG7I,QAAQ,CAACqH,aAAT,CAAwB,QAAxB,CAAf;AACA,UAAMyB,OAAO,GAAGD,MAAM,CAACmB,UAAP,CAAmB,IAAnB,CAAhB;AACA,UAAMrB,GAAG,GAAG,KAAKA,GAAjB;AAEAE,IAAAA,MAAM,CAAClG,KAAP,GAAeA,KAAK,GAAGgG,GAAvB;AACAE,IAAAA,MAAM,CAAChG,MAAP,GAAgBA,MAAM,GAAG8F,GAAzB;AACAG,IAAAA,OAAO,CAACS,KAAR,CAAeZ,GAAf,EAAoBA,GAApB;AAEAG,IAAAA,OAAO,CAACmB,UAAR,GAAqB,CAArB;AACAnB,IAAAA,OAAO,CAACoB,WAAR,GAAsB,uBAAtB;AAEA,WAAO;AAAErB,MAAAA,MAAF;AAAUC,MAAAA;AAAV,KAAP;AAEH,GA3DiE;;AA6DlE;;;;;;AAMAc,EAAAA,yBAAyB,EAAE,UAAW5H,QAAX,EAAsB;AAE7C,UAAM8G,OAAO,GAAG,KAAKA,OAArB;AACA,UAAM;AAAEK,MAAAA,WAAF;AAAeC,MAAAA,YAAf;AAA6BJ,MAAAA;AAA7B,QAA0C,IAAhD;AACA,UAAML,GAAG,GAAG,KAAKA,GAAjB;AACA,UAAMwB,MAAM,GAAGnI,QAAQ,GAAG9G,IAAI,CAACkP,EAAhB,GAAqB,CAApC;AACA,UAAM5B,KAAK,GAAG,KAAKA,KAAL,CAAW6B,QAAX,EAAd;AACA,UAAMC,CAAC,GAAGnB,WAAW,GAAG,GAAd,GAAoBR,GAA9B;AACA,UAAM4B,CAAC,GAAGnB,YAAY,GAAG,GAAf,GAAqBT,GAA/B;AACA,UAAM6B,SAAS,GAAG,CAAlB;AAEA1B,IAAAA,OAAO,CAAC2B,SAAR,CAAmB,CAAnB,EAAsB,CAAtB,EAAyBtB,WAAzB,EAAsCC,YAAtC;AACAN,IAAAA,OAAO,CAAC4B,SAAR;;AAEA,QAAK1I,QAAQ,KAAK,CAAlB,EAAsB;AAClB8G,MAAAA,OAAO,CAAC6B,GAAR,CAAaL,CAAb,EAAgBC,CAAhB,EAAmBpB,WAAW,GAAG,EAAjC,EAAqC,CAArC,EAAwC,IAAIjO,IAAI,CAACkP,EAAjD;AACAtB,MAAAA,OAAO,CAAC8B,SAAR,GAAoBpC,KAApB;AACAM,MAAAA,OAAO,CAAC+B,IAAR;AACH,KAJD,MAIO;AACH/B,MAAAA,OAAO,CAAC6B,GAAR,CAAaL,CAAb,EAAgBC,CAAhB,EAAmBpB,WAAW,GAAG,CAAd,GAAkBqB,SAArC,EAAgD,CAACtP,IAAI,CAACkP,EAAN,GAAW,CAA3D,EAA8D,CAAClP,IAAI,CAACkP,EAAN,GAAW,CAAX,GAAeD,MAA7E;AACArB,MAAAA,OAAO,CAACgC,WAAR,GAAsBtC,KAAtB;AACAM,MAAAA,OAAO,CAAC0B,SAAR,GAAoBA,SAApB;AACA1B,MAAAA,OAAO,CAACiC,MAAR;AACH;;AAEDjC,IAAAA,OAAO,CAACkC,SAAR;AAEAhC,IAAAA,QAAQ,CAAC7G,GAAT,CAAaN,WAAb,GAA2B,IAA3B;AAEH,GAhGiE;;AAkGlE;;;;;;;AAOAoJ,EAAAA,MAAM,EAAE,YAAY;AAEhB,UAAMnC,OAAO,GAAG,KAAKA,OAArB;AACA,UAAM;AAAEK,MAAAA,WAAF;AAAeC,MAAAA,YAAf;AAA6BJ,MAAAA;AAA7B,QAA0C,IAAhD;AACA,UAAMkC,QAAQ,GAAG,KAAK7B,cAAtB;AACA,UAAM8B,SAAS,GAAGC,WAAW,CAACC,GAAZ,EAAlB;AACA,UAAM7C,KAAK,GAAG,KAAKA,KAAnB;AACA,UAAMG,GAAG,GAAG,KAAKA,GAAjB;AACA,UAAM2B,CAAC,GAAGnB,WAAW,GAAG,GAAd,GAAoBR,GAA9B;AACA,UAAM4B,CAAC,GAAGnB,YAAY,GAAG,GAAf,GAAqBT,GAA/B;;AAEA,UAAM2C,MAAM,GAAG,MAAM;AAEjB,YAAM7B,OAAO,GAAG5J,MAAM,CAAC0L,qBAAP,CAA8BD,MAA9B,CAAhB;AACA,YAAME,OAAO,GAAGJ,WAAW,CAACC,GAAZ,KAAoBF,SAApC;AACA,YAAMnJ,QAAQ,GAAGwJ,OAAO,GAAGN,QAA3B;AACA,YAAMO,OAAO,GAAG,MAAMzJ,QAAN,GAAiB,CAAjB,GAAqB,MAAMA,QAA3B,GAAsC,CAAtD;AACA,YAAM0J,MAAM,GAAG1J,QAAQ,GAAGmH,WAAX,GAAyB,GAAzB,GAA+BR,GAA9C;AAEAG,MAAAA,OAAO,CAAC2B,SAAR,CAAmB,CAAnB,EAAsB,CAAtB,EAAyBtB,WAAzB,EAAsCC,YAAtC;AACAN,MAAAA,OAAO,CAAC4B,SAAR;AACA5B,MAAAA,OAAO,CAAC6B,GAAR,CAAaL,CAAb,EAAgBC,CAAhB,EAAmBmB,MAAnB,EAA2B,CAA3B,EAA8BxQ,IAAI,CAACkP,EAAL,GAAU,CAAxC;AACAtB,MAAAA,OAAO,CAAC8B,SAAR,GAAqB,QAAOpC,KAAK,CAACmD,CAAN,GAAU,GAAI,KAAInD,KAAK,CAACoD,CAAN,GAAU,GAAI,KAAIpD,KAAK,CAACqD,CAAN,GAAU,GAAI,KAAIJ,OAAQ,GAA1F;AACA3C,MAAAA,OAAO,CAAC+B,IAAR;AACA/B,MAAAA,OAAO,CAACkC,SAAR;;AAEA,UAAKhJ,QAAQ,IAAI,GAAjB,EAAuB;AAEnBnC,QAAAA,MAAM,CAACiM,oBAAP,CAA6BrC,OAA7B;AACA,aAAKG,yBAAL,CAAgC,CAAhC;AAEA;;;;;;AAKA,aAAK/C,aAAL,CAAoB;AAAEjC,UAAAA,IAAI,EAAE;AAAR,SAApB;AAEH;;AAEDoE,MAAAA,QAAQ,CAAC7G,GAAT,CAAaN,WAAb,GAA2B,IAA3B;AAEH,KA/BD;AAiCA;;;;;;;AAKA,SAAKgF,aAAL,CAAoB;AAAEjC,MAAAA,IAAI,EAAE;AAAR,KAApB;AAEA0G,IAAAA,MAAM;AAET,GA9JiE;;AAgKlE;;;;;AAKAS,EAAAA,IAAI,EAAE,YAAY;AAEd,SAAKC,OAAL,GAAe,IAAf;AAEH,GAzKiE;;AA2KlE;;;;;AAKAC,EAAAA,IAAI,EAAE,YAAY;AAEd,SAAKD,OAAL,GAAe,KAAf;AAEH,GApLiE;;AAsLlE;;;;;;;AAOAxH,EAAAA,KAAK,EAAE,UAAWkF,QAAX,EAAsB;AAEzB,QAAK,CAAC,KAAKjB,UAAX,EAAwB;AAEpB;AAEH;AAED;;;;;;;AAKA,SAAK5B,aAAL,CAAoB;AAAEjC,MAAAA,IAAI,EAAE;AAAR,KAApB;AAEA,SAAK4E,cAAL,GAAsB4B,WAAW,CAACC,GAAZ,EAAtB;AACA,SAAK3B,QAAL,GAAgBA,QAAhB;AACA,SAAK4B,MAAL;AAEH,GAhNiE;;AAkNlE;;;;;;AAMAY,EAAAA,GAAG,EAAE,YAAU;AAEX,QAAK,CAAC,KAAK1C,cAAX,EAA4B;AAAE;AAAS;;AAEvC3J,IAAAA,MAAM,CAACiM,oBAAP,CAA6B,KAAKrC,OAAlC;AAEA,SAAKG,yBAAL,CAAgC,CAAhC;AACA,SAAKF,QAAL,GAAgB,IAAhB;AACA,SAAKD,OAAL,GAAe,IAAf;AACA,SAAKD,cAAL,GAAsB,IAAtB;AAEA;;;;;;AAKA,SAAK3C,aAAL,CAAoB;AAAEjC,MAAAA,IAAI,EAAE;AAAR,KAApB;AAEH,GA1OiE;;AA4OlE;;;;;;AAMA0G,EAAAA,MAAM,EAAE,YAAY;AAEhB,SAAK7B,OAAL,GAAe5J,MAAM,CAAC0L,qBAAP,CAA8B,KAAKD,MAAL,CAAY/G,IAAZ,CAAkB,IAAlB,CAA9B,CAAf;AAEA,UAAMiH,OAAO,GAAGJ,WAAW,CAACC,GAAZ,KAAoB,KAAK7B,cAAzC;AACA,UAAMxH,QAAQ,GAAGwJ,OAAO,GAAG,KAAK9C,SAAhC;AAEA,SAAKkB,yBAAL,CAAgC5H,QAAhC;AAEA;;;;;;AAKA,SAAK6E,aAAL,CAAoB;AAAEjC,MAAAA,IAAI,EAAE,gBAAR;AAA0B5C,MAAAA;AAA1B,KAApB;;AAEA,QAAKA,QAAQ,IAAI,GAAjB,EAAuB;AAEnBnC,MAAAA,MAAM,CAACiM,oBAAP,CAA6B,KAAKrC,OAAlC;;AACA,UAAK,KAAKC,QAAV,EAAqB;AAAE,aAAKA,QAAL;AAAkB;;AACzC,WAAKwC,GAAL;AACA,WAAKjB,MAAL;AAEH;AAEJ;AA3QiE,CAAlD,CAApB;;AA+QA,SAASkB,oBAAT,CAA8BC,EAA9B,EAAkCC,MAAlC,EAA0C;AACzC,SAAOA,MAAM,GAAG;AAAEC,IAAAA,OAAO,EAAE;AAAX,GAAT,EAA0BF,EAAE,CAACC,MAAD,EAASA,MAAM,CAACC,OAAhB,CAA5B,EAAsDD,MAAM,CAACC,OAApE;AACA;;AAED,IAAIC,KAAK,GAAGJ,oBAAoB,CAAC,UAAUE,MAAV,EAAkBC,OAAlB,EAA2B;AAC5D;;;;;;;;AAUA,MAAIE,MAAM,GAAG,YAAY;AACxB,SAAKC,OAAL,GAAe,EAAf;AACA,SAAKC,wBAAL,GAAgC,EAAhC;AACA,GAHD;;AAKAF,EAAAA,MAAM,CAAC9I,SAAP,GAAmB;AAClBiJ,IAAAA,MAAM,EAAE,YAAY;AAEnB,aAAO1J,MAAM,CAAC2J,IAAP,CAAY,KAAKH,OAAjB,EAA0BtK,GAA1B,CAA8B,UAAU0K,OAAV,EAAmB;AACvD,eAAO,KAAKJ,OAAL,CAAaI,OAAb,CAAP;AACA,OAFoC,CAEnCtI,IAFmC,CAE9B,IAF8B,CAA9B,CAAP;AAIA,KAPiB;AASlBuI,IAAAA,SAAS,EAAE,YAAY;AAEtB,WAAKL,OAAL,GAAe,EAAf;AAEA,KAbiB;AAelBvM,IAAAA,GAAG,EAAE,UAAU6M,KAAV,EAAiB;AAErB,WAAKN,OAAL,CAAaM,KAAK,CAACC,KAAN,EAAb,IAA8BD,KAA9B;AACA,WAAKL,wBAAL,CAA8BK,KAAK,CAACC,KAAN,EAA9B,IAA+CD,KAA/C;AAEA,KApBiB;AAsBlBE,IAAAA,MAAM,EAAE,UAAUF,KAAV,EAAiB;AAExB,aAAO,KAAKN,OAAL,CAAaM,KAAK,CAACC,KAAN,EAAb,CAAP;AACA,aAAO,KAAKN,wBAAL,CAA8BK,KAAK,CAACC,KAAN,EAA9B,CAAP;AAEA,KA3BiB;AA6BlB1B,IAAAA,MAAM,EAAE,UAAU4B,IAAV,EAAgBC,QAAhB,EAA0B;AAEjC,UAAIC,QAAQ,GAAGnK,MAAM,CAAC2J,IAAP,CAAY,KAAKH,OAAjB,CAAf;;AAEA,UAAIW,QAAQ,CAAClJ,MAAT,KAAoB,CAAxB,EAA2B;AAC1B,eAAO,KAAP;AACA;;AAEDgJ,MAAAA,IAAI,GAAGA,IAAI,KAAK5N,SAAT,GAAqB4N,IAArB,GAA4BG,KAAK,CAAChC,GAAN,EAAnC,CARiC,CAUjC;AACA;AACA;AACA;;AACA,aAAO+B,QAAQ,CAAClJ,MAAT,GAAkB,CAAzB,EAA4B;AAC3B,aAAKwI,wBAAL,GAAgC,EAAhC;;AAEA,aAAK,IAAIpK,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG8K,QAAQ,CAAClJ,MAA7B,EAAqC5B,CAAC,EAAtC,EAA0C;AAEzC,cAAIyK,KAAK,GAAG,KAAKN,OAAL,CAAaW,QAAQ,CAAC9K,CAAD,CAArB,CAAZ;;AAEA,cAAIyK,KAAK,IAAIA,KAAK,CAACzB,MAAN,CAAa4B,IAAb,MAAuB,KAApC,EAA2C;AAC1CH,YAAAA,KAAK,CAACO,UAAN,GAAmB,KAAnB;;AAEA,gBAAI,CAACH,QAAL,EAAe;AACd,qBAAO,KAAKV,OAAL,CAAaW,QAAQ,CAAC9K,CAAD,CAArB,CAAP;AACA;AACD;AACD;;AAED8K,QAAAA,QAAQ,GAAGnK,MAAM,CAAC2J,IAAP,CAAY,KAAKF,wBAAjB,CAAX;AACA;;AAED,aAAO,IAAP;AAEA;AAhEiB,GAAnB;AAmEA,MAAIW,KAAK,GAAG,IAAIb,MAAJ,EAAZ;AAEAa,EAAAA,KAAK,CAACE,KAAN,GAAcf,MAAd;AACAa,EAAAA,KAAK,CAACG,OAAN,GAAgB,CAAhB;;AACAH,EAAAA,KAAK,CAACI,MAAN,GAAe,YAAY;AAC1B,WAAOJ,KAAK,CAACG,OAAN,EAAP;AACA,GAFD,CAvF4D,CA4F5D;AACA;;;AACA,MAAI,OAAQE,IAAR,KAAkB,WAAlB,IAAiC,OAAQjN,OAAR,KAAqB,WAAtD,IAAqEA,OAAO,CAACkN,MAAjF,EAAyF;AACxFN,IAAAA,KAAK,CAAChC,GAAN,GAAY,YAAY;AACvB,UAAI6B,IAAI,GAAGzM,OAAO,CAACkN,MAAR,EAAX,CADuB,CAGvB;;AACA,aAAOT,IAAI,CAAC,CAAD,CAAJ,GAAU,IAAV,GAAiBA,IAAI,CAAC,CAAD,CAAJ,GAAU,OAAlC;AACA,KALD;AAMA,GAPD,CAQA;AARA,OASK,IAAI,OAAQQ,IAAR,KAAkB,WAAlB,IACAA,IAAI,CAACtC,WAAL,KAAqB9L,SADrB,IAENoO,IAAI,CAACtC,WAAL,CAAiBC,GAAjB,KAAyB/L,SAFvB,EAEkC;AACtC;AACA;AACA+N,MAAAA,KAAK,CAAChC,GAAN,GAAYqC,IAAI,CAACtC,WAAL,CAAiBC,GAAjB,CAAqB9G,IAArB,CAA0BmJ,IAAI,CAACtC,WAA/B,CAAZ;AACA,KANI,CAOL;AAPK,SAQA,IAAIwC,IAAI,CAACvC,GAAL,KAAa/L,SAAjB,EAA4B;AAChC+N,QAAAA,KAAK,CAAChC,GAAN,GAAYuC,IAAI,CAACvC,GAAjB;AACA,OAFI,CAGL;AAHK,WAIA;AACJgC,UAAAA,KAAK,CAAChC,GAAN,GAAY,YAAY;AACvB,mBAAO,IAAIuC,IAAJ,GAAWC,OAAX,EAAP;AACA,WAFD;AAGA;;AAGDR,EAAAA,KAAK,CAACd,KAAN,GAAc,UAAUuB,MAAV,EAAkBC,KAAlB,EAAyB;AACtC,SAAKC,OAAL,GAAeF,MAAf;AACA,SAAKG,YAAL,GAAoB,EAApB;AACA,SAAKC,UAAL,GAAkB,EAAlB;AACA,SAAKC,kBAAL,GAA0B,EAA1B;AACA,SAAKC,SAAL,GAAiB,IAAjB;AACA,SAAKC,OAAL,GAAe,CAAf;AACA,SAAKC,gBAAL,GAAwBhP,SAAxB;AACA,SAAKiP,KAAL,GAAa,KAAb;AACA,SAAKjB,UAAL,GAAkB,KAAlB;AACA,SAAKkB,SAAL,GAAiB,KAAjB;AACA,SAAKC,UAAL,GAAkB,CAAlB;AACA,SAAKC,UAAL,GAAkB,IAAlB;AACA,SAAKC,eAAL,GAAuBtB,KAAK,CAACuB,MAAN,CAAaC,MAAb,CAAoBC,IAA3C;AACA,SAAKC,sBAAL,GAA8B1B,KAAK,CAAC2B,aAAN,CAAoBH,MAAlD;AACA,SAAKI,cAAL,GAAsB,EAAtB;AACA,SAAKC,gBAAL,GAAwB,IAAxB;AACA,SAAKC,qBAAL,GAA6B,KAA7B;AACA,SAAKC,iBAAL,GAAyB,IAAzB;AACA,SAAKC,iBAAL,GAAyB,IAAzB;AACA,SAAKC,mBAAL,GAA2B,IAA3B;AACA,SAAKC,eAAL,GAAuB,IAAvB;AACA,SAAKC,MAAL,GAAczB,KAAK,IAAIV,KAAvB;AACA,SAAKoC,GAAL,GAAWpC,KAAK,CAACI,MAAN,EAAX;AAEA,GAzBD;;AA2BAJ,EAAAA,KAAK,CAACd,KAAN,CAAY7I,SAAZ,GAAwB;AACvBsJ,IAAAA,KAAK,EAAE,YAAY;AAClB,aAAO,KAAKyC,GAAZ;AACA,KAHsB;AAKvBC,IAAAA,SAAS,EAAE,YAAY;AACtB,aAAO,KAAKpC,UAAZ;AACA,KAPsB;AASvBqC,IAAAA,EAAE,EAAE,UAAUC,UAAV,EAAsB1E,QAAtB,EAAgC;AAEnC,WAAKgD,UAAL,GAAkBjL,MAAM,CAACU,MAAP,CAAciM,UAAd,CAAlB;;AAEA,UAAI1E,QAAQ,KAAK5L,SAAjB,EAA4B;AAC3B,aAAK8O,SAAL,GAAiBlD,QAAjB;AACA;;AAED,aAAO,IAAP;AAEA,KAnBsB;AAqBvBA,IAAAA,QAAQ,EAAE,SAASA,QAAT,CAAkB2E,CAAlB,EAAqB;AAC9B,WAAKzB,SAAL,GAAiByB,CAAjB;AACA,aAAO,IAAP;AACA,KAxBsB;AA0BvBrL,IAAAA,KAAK,EAAE,UAAU0I,IAAV,EAAgB;AAEtB,WAAKsC,MAAL,CAAYtP,GAAZ,CAAgB,IAAhB;;AAEA,WAAKoN,UAAL,GAAkB,IAAlB;AAEA,WAAK6B,qBAAL,GAA6B,KAA7B;AAEA,WAAKT,UAAL,GAAkBxB,IAAI,KAAK5N,SAAT,GAAqB,OAAO4N,IAAP,KAAgB,QAAhB,GAA2BG,KAAK,CAAChC,GAAN,KAAcyE,UAAU,CAAC5C,IAAD,CAAnD,GAA4DA,IAAjF,GAAwFG,KAAK,CAAChC,GAAN,EAA1G;AACA,WAAKqD,UAAL,IAAmB,KAAKD,UAAxB;;AAEA,WAAK,IAAIsB,QAAT,IAAqB,KAAK7B,UAA1B,EAAsC;AAErC;AACA,YAAI,KAAKA,UAAL,CAAgB6B,QAAhB,aAAqCC,KAAzC,EAAgD;AAE/C,cAAI,KAAK9B,UAAL,CAAgB6B,QAAhB,EAA0B7L,MAA1B,KAAqC,CAAzC,EAA4C;AAC3C;AACA,WAJ8C,CAM/C;;;AACA,eAAKgK,UAAL,CAAgB6B,QAAhB,IAA4B,CAAC,KAAK/B,OAAL,CAAa+B,QAAb,CAAD,EAAyBE,MAAzB,CAAgC,KAAK/B,UAAL,CAAgB6B,QAAhB,CAAhC,CAA5B;AAEA,SAZoC,CAcrC;AACA;;;AACA,YAAI,KAAK/B,OAAL,CAAa+B,QAAb,MAA2BzQ,SAA/B,EAA0C;AACzC;AACA,SAlBoC,CAoBrC;;;AACA,aAAK2O,YAAL,CAAkB8B,QAAlB,IAA8B,KAAK/B,OAAL,CAAa+B,QAAb,CAA9B;;AAEA,YAAK,KAAK9B,YAAL,CAAkB8B,QAAlB,aAAuCC,KAAxC,KAAmD,KAAvD,EAA8D;AAC7D,eAAK/B,YAAL,CAAkB8B,QAAlB,KAA+B,GAA/B,CAD6D,CACzB;AACpC;;AAED,aAAK5B,kBAAL,CAAwB4B,QAAxB,IAAoC,KAAK9B,YAAL,CAAkB8B,QAAlB,KAA+B,CAAnE;AAEA;;AAED,aAAO,IAAP;AAEA,KAtEsB;AAwEvBzL,IAAAA,IAAI,EAAE,YAAY;AAEjB,UAAI,CAAC,KAAKgJ,UAAV,EAAsB;AACrB,eAAO,IAAP;AACA;;AAED,WAAKkC,MAAL,CAAYvC,MAAZ,CAAmB,IAAnB;;AACA,WAAKK,UAAL,GAAkB,KAAlB;;AAEA,UAAI,KAAKiC,eAAL,KAAyB,IAA7B,EAAmC;AAClC,aAAKA,eAAL,CAAqB,KAAKvB,OAA1B;AACA;;AAED,WAAKkC,iBAAL;AACA,aAAO,IAAP;AAEA,KAxFsB;AA0FvBhE,IAAAA,GAAG,EAAE,YAAY;AAEhB,WAAKZ,MAAL,CAAY6E,QAAZ;AACA,aAAO,IAAP;AAEA,KA/FsB;AAiGvBD,IAAAA,iBAAiB,EAAE,YAAY;AAE9B,WAAK,IAAI5N,CAAC,GAAG,CAAR,EAAW8N,gBAAgB,GAAG,KAAKnB,cAAL,CAAoB/K,MAAvD,EAA+D5B,CAAC,GAAG8N,gBAAnE,EAAqF9N,CAAC,EAAtF,EAA0F;AACzF,aAAK2M,cAAL,CAAoB3M,CAApB,EAAuBgC,IAAvB;AACA;AAED,KAvGsB;AAyGvByJ,IAAAA,KAAK,EAAE,UAAUA,KAAV,EAAiB;AACvB,WAAKyB,MAAL,GAAczB,KAAd;AACA,aAAO,IAAP;AACA,KA5GsB;AA8GvBsC,IAAAA,KAAK,EAAE,UAAUC,MAAV,EAAkB;AAExB,WAAK7B,UAAL,GAAkB6B,MAAlB;AACA,aAAO,IAAP;AAEA,KAnHsB;AAqHvBhI,IAAAA,MAAM,EAAE,UAAUiI,KAAV,EAAiB;AAExB,WAAKlC,OAAL,GAAekC,KAAf;AACA,aAAO,IAAP;AAEA,KA1HsB;AA4HvBC,IAAAA,WAAW,EAAE,UAAUF,MAAV,EAAkB;AAE9B,WAAKhC,gBAAL,GAAwBgC,MAAxB;AACA,aAAO,IAAP;AAEA,KAjIsB;AAmIvBG,IAAAA,IAAI,EAAE,UAAUA,IAAV,EAAgB;AAErB,WAAKlC,KAAL,GAAakC,IAAb;AACA,aAAO,IAAP;AAEA,KAxIsB;AA0IvBC,IAAAA,MAAM,EAAE,UAAUC,cAAV,EAA0B;AAEjC,WAAKhC,eAAL,GAAuBgC,cAAvB;AACA,aAAO,IAAP;AAEA,KA/IsB;AAiJvBC,IAAAA,aAAa,EAAE,UAAUC,qBAAV,EAAiC;AAE/C,WAAK9B,sBAAL,GAA8B8B,qBAA9B;AACA,aAAO,IAAP;AAEA,KAtJsB;AAwJvBC,IAAAA,KAAK,EAAE,YAAY;AAElB,WAAK7B,cAAL,GAAsB8B,SAAtB;AACA,aAAO,IAAP;AAEA,KA7JsB;AA+JvBC,IAAAA,OAAO,EAAE,UAAUtH,QAAV,EAAoB;AAE5B,WAAKwF,gBAAL,GAAwBxF,QAAxB;AACA,aAAO,IAAP;AAEA,KApKsB;AAsKvBuH,IAAAA,QAAQ,EAAE,UAAUvH,QAAV,EAAoB;AAE7B,WAAK0F,iBAAL,GAAyB1F,QAAzB;AACA,aAAO,IAAP;AAEA,KA3KsB;AA6KvBwH,IAAAA,QAAQ,EAAE,SAASA,QAAT,CAAkBxH,QAAlB,EAA4B;AAErC,WAAK2F,iBAAL,GAAyB3F,QAAzB;AACA,aAAO,IAAP;AAEA,KAlLsB;AAoLvByH,IAAAA,UAAU,EAAE,UAAUzH,QAAV,EAAoB;AAE/B,WAAK4F,mBAAL,GAA2B5F,QAA3B;AACA,aAAO,IAAP;AAEA,KAzLsB;AA2LvB0H,IAAAA,MAAM,EAAE,UAAU1H,QAAV,EAAoB;AAE3B,WAAK6F,eAAL,GAAuB7F,QAAvB;AACA,aAAO,IAAP;AAEA,KAhMsB;AAkMvB4B,IAAAA,MAAM,EAAE,UAAU4B,IAAV,EAAgB;AAEvB,UAAI6C,QAAJ;AACA,UAAIvE,OAAJ;AACA,UAAI6F,KAAJ;;AAEA,UAAInE,IAAI,GAAG,KAAKwB,UAAhB,EAA4B;AAC3B,eAAO,IAAP;AACA;;AAED,UAAI,KAAKS,qBAAL,KAA+B,KAAnC,EAA0C;AAEzC,YAAI,KAAKD,gBAAL,KAA0B,IAA9B,EAAoC;AACnC,eAAKA,gBAAL,CAAsB,KAAKlB,OAA3B;AACA;;AAED,aAAKmB,qBAAL,GAA6B,IAA7B;AACA;;AAED3D,MAAAA,OAAO,GAAG,CAAC0B,IAAI,GAAG,KAAKwB,UAAb,IAA2B,KAAKN,SAA1C;AACA5C,MAAAA,OAAO,GAAI,KAAK4C,SAAL,KAAmB,CAAnB,IAAwB5C,OAAO,GAAG,CAAnC,GAAwC,CAAxC,GAA4CA,OAAtD;AAEA6F,MAAAA,KAAK,GAAG,KAAK1C,eAAL,CAAqBnD,OAArB,CAAR;;AAEA,WAAKuE,QAAL,IAAiB,KAAK7B,UAAtB,EAAkC;AAEjC;AACA,YAAI,KAAKD,YAAL,CAAkB8B,QAAlB,MAAgCzQ,SAApC,EAA+C;AAC9C;AACA;;AAED,YAAIkF,KAAK,GAAG,KAAKyJ,YAAL,CAAkB8B,QAAlB,KAA+B,CAA3C;AACA,YAAI7D,GAAG,GAAG,KAAKgC,UAAL,CAAgB6B,QAAhB,CAAV;;AAEA,YAAI7D,GAAG,YAAY8D,KAAnB,EAA0B;AAEzB,eAAKhC,OAAL,CAAa+B,QAAb,IAAyB,KAAKhB,sBAAL,CAA4B7C,GAA5B,EAAiCmF,KAAjC,CAAzB;AAEA,SAJD,MAIO;AAEN;AACA,cAAI,OAAQnF,GAAR,KAAiB,QAArB,EAA+B;AAE9B,gBAAIA,GAAG,CAACoF,MAAJ,CAAW,CAAX,MAAkB,GAAlB,IAAyBpF,GAAG,CAACoF,MAAJ,CAAW,CAAX,MAAkB,GAA/C,EAAoD;AACnDpF,cAAAA,GAAG,GAAG1H,KAAK,GAAGsL,UAAU,CAAC5D,GAAD,CAAxB;AACA,aAFD,MAEO;AACNA,cAAAA,GAAG,GAAG4D,UAAU,CAAC5D,GAAD,CAAhB;AACA;AACD,WAVK,CAYN;;;AACA,cAAI,OAAQA,GAAR,KAAiB,QAArB,EAA+B;AAC9B,iBAAK8B,OAAL,CAAa+B,QAAb,IAAyBvL,KAAK,GAAG,CAAC0H,GAAG,GAAG1H,KAAP,IAAgB6M,KAAjD;AACA;AAED;AAED;;AAED,UAAI,KAAKjC,iBAAL,KAA2B,IAA/B,EAAqC;AACpC,aAAKA,iBAAL,CAAuB,KAAKpB,OAA5B,EAAqCxC,OAArC;AACA;;AAED,UAAIA,OAAO,KAAK,CAAhB,EAAmB;AAElB,YAAI,KAAK6C,OAAL,GAAe,CAAnB,EAAsB;AAErB,cAAIkD,QAAQ,CAAC,KAAKlD,OAAN,CAAZ,EAA4B;AAC3B,iBAAKA,OAAL;AACA,WAJoB,CAMrB;;;AACA,eAAK0B,QAAL,IAAiB,KAAK5B,kBAAtB,EAA0C;AAEzC,gBAAI,OAAQ,KAAKD,UAAL,CAAgB6B,QAAhB,CAAR,KAAuC,QAA3C,EAAqD;AACpD,mBAAK5B,kBAAL,CAAwB4B,QAAxB,IAAoC,KAAK5B,kBAAL,CAAwB4B,QAAxB,IAAoCD,UAAU,CAAC,KAAK5B,UAAL,CAAgB6B,QAAhB,CAAD,CAAlF;AACA;;AAED,gBAAI,KAAKxB,KAAT,EAAgB;AACf,kBAAIiD,GAAG,GAAG,KAAKrD,kBAAL,CAAwB4B,QAAxB,CAAV;AAEA,mBAAK5B,kBAAL,CAAwB4B,QAAxB,IAAoC,KAAK7B,UAAL,CAAgB6B,QAAhB,CAApC;AACA,mBAAK7B,UAAL,CAAgB6B,QAAhB,IAA4ByB,GAA5B;AACA;;AAED,iBAAKvD,YAAL,CAAkB8B,QAAlB,IAA8B,KAAK5B,kBAAL,CAAwB4B,QAAxB,CAA9B;AAEA;;AAED,cAAI,KAAKxB,KAAT,EAAgB;AACf,iBAAKC,SAAL,GAAiB,CAAC,KAAKA,SAAvB;AACA;;AAED,cAAI,KAAKF,gBAAL,KAA0BhP,SAA9B,EAAyC;AACxC,iBAAKoP,UAAL,GAAkBxB,IAAI,GAAG,KAAKoB,gBAA9B;AACA,WAFD,MAEO;AACN,iBAAKI,UAAL,GAAkBxB,IAAI,GAAG,KAAKuB,UAA9B;AACA;;AAED,cAAI,KAAKY,iBAAL,KAA2B,IAA/B,EAAqC;AACpC,iBAAKA,iBAAL,CAAuB,KAAKrB,OAA5B;AACA;;AAED,iBAAO,IAAP;AAEA,SAxCD,MAwCO;AAEN,cAAI,KAAKsB,mBAAL,KAA6B,IAAjC,EAAuC;AAEtC,iBAAKA,mBAAL,CAAyB,KAAKtB,OAA9B;AACA;;AAED,eAAK,IAAI1L,CAAC,GAAG,CAAR,EAAW8N,gBAAgB,GAAG,KAAKnB,cAAL,CAAoB/K,MAAvD,EAA+D5B,CAAC,GAAG8N,gBAAnE,EAAqF9N,CAAC,EAAtF,EAA0F;AACzF;AACA;AACA,iBAAK2M,cAAL,CAAoB3M,CAApB,EAAuBkC,KAAvB,CAA6B,KAAKkK,UAAL,GAAkB,KAAKN,SAApD;AACA;;AAED,iBAAO,KAAP;AAEA;AAED;;AAED,aAAO,IAAP;AAEA;AAhUsB,GAAxB;AAoUAf,EAAAA,KAAK,CAACuB,MAAN,GAAe;AAEdC,IAAAA,MAAM,EAAE;AAEPC,MAAAA,IAAI,EAAE,UAAU2C,CAAV,EAAa;AAElB,eAAOA,CAAP;AAEA;AANM,KAFM;AAYdC,IAAAA,SAAS,EAAE;AAEVC,MAAAA,EAAE,EAAE,UAAUF,CAAV,EAAa;AAEhB,eAAOA,CAAC,GAAGA,CAAX;AAEA,OANS;AAQVG,MAAAA,GAAG,EAAE,UAAUH,CAAV,EAAa;AAEjB,eAAOA,CAAC,IAAI,IAAIA,CAAR,CAAR;AAEA,OAZS;AAcVI,MAAAA,KAAK,EAAE,UAAUJ,CAAV,EAAa;AAEnB,YAAI,CAACA,CAAC,IAAI,CAAN,IAAW,CAAf,EAAkB;AACjB,iBAAO,MAAMA,CAAN,GAAUA,CAAjB;AACA;;AAED,eAAO,CAAE,GAAF,IAAS,EAAEA,CAAF,IAAOA,CAAC,GAAG,CAAX,IAAgB,CAAzB,CAAP;AAEA;AAtBS,KAZG;AAsCdK,IAAAA,KAAK,EAAE;AAENH,MAAAA,EAAE,EAAE,UAAUF,CAAV,EAAa;AAEhB,eAAOA,CAAC,GAAGA,CAAJ,GAAQA,CAAf;AAEA,OANK;AAQNG,MAAAA,GAAG,EAAE,UAAUH,CAAV,EAAa;AAEjB,eAAO,EAAEA,CAAF,GAAMA,CAAN,GAAUA,CAAV,GAAc,CAArB;AAEA,OAZK;AAcNI,MAAAA,KAAK,EAAE,UAAUJ,CAAV,EAAa;AAEnB,YAAI,CAACA,CAAC,IAAI,CAAN,IAAW,CAAf,EAAkB;AACjB,iBAAO,MAAMA,CAAN,GAAUA,CAAV,GAAcA,CAArB;AACA;;AAED,eAAO,OAAO,CAACA,CAAC,IAAI,CAAN,IAAWA,CAAX,GAAeA,CAAf,GAAmB,CAA1B,CAAP;AAEA;AAtBK,KAtCO;AAgEdM,IAAAA,OAAO,EAAE;AAERJ,MAAAA,EAAE,EAAE,UAAUF,CAAV,EAAa;AAEhB,eAAOA,CAAC,GAAGA,CAAJ,GAAQA,CAAR,GAAYA,CAAnB;AAEA,OANO;AAQRG,MAAAA,GAAG,EAAE,UAAUH,CAAV,EAAa;AAEjB,eAAO,IAAK,EAAEA,CAAF,GAAMA,CAAN,GAAUA,CAAV,GAAcA,CAA1B;AAEA,OAZO;AAcRI,MAAAA,KAAK,EAAE,UAAUJ,CAAV,EAAa;AAEnB,YAAI,CAACA,CAAC,IAAI,CAAN,IAAW,CAAf,EAAkB;AACjB,iBAAO,MAAMA,CAAN,GAAUA,CAAV,GAAcA,CAAd,GAAkBA,CAAzB;AACA;;AAED,eAAO,CAAE,GAAF,IAAS,CAACA,CAAC,IAAI,CAAN,IAAWA,CAAX,GAAeA,CAAf,GAAmBA,CAAnB,GAAuB,CAAhC,CAAP;AAEA;AAtBO,KAhEK;AA0FdO,IAAAA,OAAO,EAAE;AAERL,MAAAA,EAAE,EAAE,UAAUF,CAAV,EAAa;AAEhB,eAAOA,CAAC,GAAGA,CAAJ,GAAQA,CAAR,GAAYA,CAAZ,GAAgBA,CAAvB;AAEA,OANO;AAQRG,MAAAA,GAAG,EAAE,UAAUH,CAAV,EAAa;AAEjB,eAAO,EAAEA,CAAF,GAAMA,CAAN,GAAUA,CAAV,GAAcA,CAAd,GAAkBA,CAAlB,GAAsB,CAA7B;AAEA,OAZO;AAcRI,MAAAA,KAAK,EAAE,UAAUJ,CAAV,EAAa;AAEnB,YAAI,CAACA,CAAC,IAAI,CAAN,IAAW,CAAf,EAAkB;AACjB,iBAAO,MAAMA,CAAN,GAAUA,CAAV,GAAcA,CAAd,GAAkBA,CAAlB,GAAsBA,CAA7B;AACA;;AAED,eAAO,OAAO,CAACA,CAAC,IAAI,CAAN,IAAWA,CAAX,GAAeA,CAAf,GAAmBA,CAAnB,GAAuBA,CAAvB,GAA2B,CAAlC,CAAP;AAEA;AAtBO,KA1FK;AAoHdQ,IAAAA,UAAU,EAAE;AAEXN,MAAAA,EAAE,EAAE,UAAUF,CAAV,EAAa;AAEhB,eAAO,IAAIvW,IAAI,CAACgX,GAAL,CAAST,CAAC,GAAGvW,IAAI,CAACkP,EAAT,GAAc,CAAvB,CAAX;AAEA,OANU;AAQXwH,MAAAA,GAAG,EAAE,UAAUH,CAAV,EAAa;AAEjB,eAAOvW,IAAI,CAACiX,GAAL,CAASV,CAAC,GAAGvW,IAAI,CAACkP,EAAT,GAAc,CAAvB,CAAP;AAEA,OAZU;AAcXyH,MAAAA,KAAK,EAAE,UAAUJ,CAAV,EAAa;AAEnB,eAAO,OAAO,IAAIvW,IAAI,CAACgX,GAAL,CAAShX,IAAI,CAACkP,EAAL,GAAUqH,CAAnB,CAAX,CAAP;AAEA;AAlBU,KApHE;AA0IdW,IAAAA,WAAW,EAAE;AAEZT,MAAAA,EAAE,EAAE,UAAUF,CAAV,EAAa;AAEhB,eAAOA,CAAC,KAAK,CAAN,GAAU,CAAV,GAAcvW,IAAI,CAACmX,GAAL,CAAS,IAAT,EAAeZ,CAAC,GAAG,CAAnB,CAArB;AAEA,OANW;AAQZG,MAAAA,GAAG,EAAE,UAAUH,CAAV,EAAa;AAEjB,eAAOA,CAAC,KAAK,CAAN,GAAU,CAAV,GAAc,IAAIvW,IAAI,CAACmX,GAAL,CAAS,CAAT,EAAY,CAAE,EAAF,GAAOZ,CAAnB,CAAzB;AAEA,OAZW;AAcZI,MAAAA,KAAK,EAAE,UAAUJ,CAAV,EAAa;AAEnB,YAAIA,CAAC,KAAK,CAAV,EAAa;AACZ,iBAAO,CAAP;AACA;;AAED,YAAIA,CAAC,KAAK,CAAV,EAAa;AACZ,iBAAO,CAAP;AACA;;AAED,YAAI,CAACA,CAAC,IAAI,CAAN,IAAW,CAAf,EAAkB;AACjB,iBAAO,MAAMvW,IAAI,CAACmX,GAAL,CAAS,IAAT,EAAeZ,CAAC,GAAG,CAAnB,CAAb;AACA;;AAED,eAAO,OAAO,CAAEvW,IAAI,CAACmX,GAAL,CAAS,CAAT,EAAY,CAAE,EAAF,IAAQZ,CAAC,GAAG,CAAZ,CAAZ,CAAF,GAAgC,CAAvC,CAAP;AAEA;AA9BW,KA1IC;AA4Kda,IAAAA,QAAQ,EAAE;AAETX,MAAAA,EAAE,EAAE,UAAUF,CAAV,EAAa;AAEhB,eAAO,IAAIvW,IAAI,CAACqX,IAAL,CAAU,IAAId,CAAC,GAAGA,CAAlB,CAAX;AAEA,OANQ;AAQTG,MAAAA,GAAG,EAAE,UAAUH,CAAV,EAAa;AAEjB,eAAOvW,IAAI,CAACqX,IAAL,CAAU,IAAK,EAAEd,CAAF,GAAMA,CAArB,CAAP;AAEA,OAZQ;AAcTI,MAAAA,KAAK,EAAE,UAAUJ,CAAV,EAAa;AAEnB,YAAI,CAACA,CAAC,IAAI,CAAN,IAAW,CAAf,EAAkB;AACjB,iBAAO,CAAE,GAAF,IAASvW,IAAI,CAACqX,IAAL,CAAU,IAAId,CAAC,GAAGA,CAAlB,IAAuB,CAAhC,CAAP;AACA;;AAED,eAAO,OAAOvW,IAAI,CAACqX,IAAL,CAAU,IAAI,CAACd,CAAC,IAAI,CAAN,IAAWA,CAAzB,IAA8B,CAArC,CAAP;AAEA;AAtBQ,KA5KI;AAsMde,IAAAA,OAAO,EAAE;AAERb,MAAAA,EAAE,EAAE,UAAUF,CAAV,EAAa;AAEhB,YAAIA,CAAC,KAAK,CAAV,EAAa;AACZ,iBAAO,CAAP;AACA;;AAED,YAAIA,CAAC,KAAK,CAAV,EAAa;AACZ,iBAAO,CAAP;AACA;;AAED,eAAO,CAACvW,IAAI,CAACmX,GAAL,CAAS,CAAT,EAAY,MAAMZ,CAAC,GAAG,CAAV,CAAZ,CAAD,GAA6BvW,IAAI,CAACiX,GAAL,CAAS,CAACV,CAAC,GAAG,GAAL,IAAY,CAAZ,GAAgBvW,IAAI,CAACkP,EAA9B,CAApC;AAEA,OAdO;AAgBRwH,MAAAA,GAAG,EAAE,UAAUH,CAAV,EAAa;AAEjB,YAAIA,CAAC,KAAK,CAAV,EAAa;AACZ,iBAAO,CAAP;AACA;;AAED,YAAIA,CAAC,KAAK,CAAV,EAAa;AACZ,iBAAO,CAAP;AACA;;AAED,eAAOvW,IAAI,CAACmX,GAAL,CAAS,CAAT,EAAY,CAAC,EAAD,GAAMZ,CAAlB,IAAuBvW,IAAI,CAACiX,GAAL,CAAS,CAACV,CAAC,GAAG,GAAL,IAAY,CAAZ,GAAgBvW,IAAI,CAACkP,EAA9B,CAAvB,GAA2D,CAAlE;AAEA,OA5BO;AA8BRyH,MAAAA,KAAK,EAAE,UAAUJ,CAAV,EAAa;AAEnB,YAAIA,CAAC,KAAK,CAAV,EAAa;AACZ,iBAAO,CAAP;AACA;;AAED,YAAIA,CAAC,KAAK,CAAV,EAAa;AACZ,iBAAO,CAAP;AACA;;AAEDA,QAAAA,CAAC,IAAI,CAAL;;AAEA,YAAIA,CAAC,GAAG,CAAR,EAAW;AACV,iBAAO,CAAC,GAAD,GAAOvW,IAAI,CAACmX,GAAL,CAAS,CAAT,EAAY,MAAMZ,CAAC,GAAG,CAAV,CAAZ,CAAP,GAAmCvW,IAAI,CAACiX,GAAL,CAAS,CAACV,CAAC,GAAG,GAAL,IAAY,CAAZ,GAAgBvW,IAAI,CAACkP,EAA9B,CAA1C;AACA;;AAED,eAAO,MAAMlP,IAAI,CAACmX,GAAL,CAAS,CAAT,EAAY,CAAC,EAAD,IAAOZ,CAAC,GAAG,CAAX,CAAZ,CAAN,GAAmCvW,IAAI,CAACiX,GAAL,CAAS,CAACV,CAAC,GAAG,GAAL,IAAY,CAAZ,GAAgBvW,IAAI,CAACkP,EAA9B,CAAnC,GAAuE,CAA9E;AAEA;AAhDO,KAtMK;AA0PdqI,IAAAA,IAAI,EAAE;AAELd,MAAAA,EAAE,EAAE,UAAUF,CAAV,EAAa;AAEhB,YAAIiB,CAAC,GAAG,OAAR;AAEA,eAAOjB,CAAC,GAAGA,CAAJ,IAAS,CAACiB,CAAC,GAAG,CAAL,IAAUjB,CAAV,GAAciB,CAAvB,CAAP;AAEA,OARI;AAULd,MAAAA,GAAG,EAAE,UAAUH,CAAV,EAAa;AAEjB,YAAIiB,CAAC,GAAG,OAAR;AAEA,eAAO,EAAEjB,CAAF,GAAMA,CAAN,IAAW,CAACiB,CAAC,GAAG,CAAL,IAAUjB,CAAV,GAAciB,CAAzB,IAA8B,CAArC;AAEA,OAhBI;AAkBLb,MAAAA,KAAK,EAAE,UAAUJ,CAAV,EAAa;AAEnB,YAAIiB,CAAC,GAAG,UAAU,KAAlB;;AAEA,YAAI,CAACjB,CAAC,IAAI,CAAN,IAAW,CAAf,EAAkB;AACjB,iBAAO,OAAOA,CAAC,GAAGA,CAAJ,IAAS,CAACiB,CAAC,GAAG,CAAL,IAAUjB,CAAV,GAAciB,CAAvB,CAAP,CAAP;AACA;;AAED,eAAO,OAAO,CAACjB,CAAC,IAAI,CAAN,IAAWA,CAAX,IAAgB,CAACiB,CAAC,GAAG,CAAL,IAAUjB,CAAV,GAAciB,CAA9B,IAAmC,CAA1C,CAAP;AAEA;AA5BI,KA1PQ;AA0RdC,IAAAA,MAAM,EAAE;AAEPhB,MAAAA,EAAE,EAAE,UAAUF,CAAV,EAAa;AAEhB,eAAO,IAAIpE,KAAK,CAACuB,MAAN,CAAa+D,MAAb,CAAoBf,GAApB,CAAwB,IAAIH,CAA5B,CAAX;AAEA,OANM;AAQPG,MAAAA,GAAG,EAAE,UAAUH,CAAV,EAAa;AAEjB,YAAIA,CAAC,GAAI,IAAI,IAAb,EAAoB;AACnB,iBAAO,SAASA,CAAT,GAAaA,CAApB;AACA,SAFD,MAEO,IAAIA,CAAC,GAAI,IAAI,IAAb,EAAoB;AAC1B,iBAAO,UAAUA,CAAC,IAAK,MAAM,IAAtB,IAA+BA,CAA/B,GAAmC,IAA1C;AACA,SAFM,MAEA,IAAIA,CAAC,GAAI,MAAM,IAAf,EAAsB;AAC5B,iBAAO,UAAUA,CAAC,IAAK,OAAO,IAAvB,IAAgCA,CAAhC,GAAoC,MAA3C;AACA,SAFM,MAEA;AACN,iBAAO,UAAUA,CAAC,IAAK,QAAQ,IAAxB,IAAiCA,CAAjC,GAAqC,QAA5C;AACA;AAED,OApBM;AAsBPI,MAAAA,KAAK,EAAE,UAAUJ,CAAV,EAAa;AAEnB,YAAIA,CAAC,GAAG,GAAR,EAAa;AACZ,iBAAOpE,KAAK,CAACuB,MAAN,CAAa+D,MAAb,CAAoBhB,EAApB,CAAuBF,CAAC,GAAG,CAA3B,IAAgC,GAAvC;AACA;;AAED,eAAOpE,KAAK,CAACuB,MAAN,CAAa+D,MAAb,CAAoBf,GAApB,CAAwBH,CAAC,GAAG,CAAJ,GAAQ,CAAhC,IAAqC,GAArC,GAA2C,GAAlD;AAEA;AA9BM;AA1RM,GAAf;AA8TApE,EAAAA,KAAK,CAAC2B,aAAN,GAAsB;AAErBH,IAAAA,MAAM,EAAE,UAAU+D,CAAV,EAAanB,CAAb,EAAgB;AAEvB,UAAIoB,CAAC,GAAGD,CAAC,CAAC1O,MAAF,GAAW,CAAnB;AACA,UAAI4O,CAAC,GAAGD,CAAC,GAAGpB,CAAZ;AACA,UAAInP,CAAC,GAAGpH,IAAI,CAAC6X,KAAL,CAAWD,CAAX,CAAR;AACA,UAAI1G,EAAE,GAAGiB,KAAK,CAAC2B,aAAN,CAAoBgE,KAApB,CAA0BnE,MAAnC;;AAEA,UAAI4C,CAAC,GAAG,CAAR,EAAW;AACV,eAAOrF,EAAE,CAACwG,CAAC,CAAC,CAAD,CAAF,EAAOA,CAAC,CAAC,CAAD,CAAR,EAAaE,CAAb,CAAT;AACA;;AAED,UAAIrB,CAAC,GAAG,CAAR,EAAW;AACV,eAAOrF,EAAE,CAACwG,CAAC,CAACC,CAAD,CAAF,EAAOD,CAAC,CAACC,CAAC,GAAG,CAAL,CAAR,EAAiBA,CAAC,GAAGC,CAArB,CAAT;AACA;;AAED,aAAO1G,EAAE,CAACwG,CAAC,CAACtQ,CAAD,CAAF,EAAOsQ,CAAC,CAACtQ,CAAC,GAAG,CAAJ,GAAQuQ,CAAR,GAAYA,CAAZ,GAAgBvQ,CAAC,GAAG,CAArB,CAAR,EAAiCwQ,CAAC,GAAGxQ,CAArC,CAAT;AAEA,KAnBoB;AAqBrB2Q,IAAAA,MAAM,EAAE,UAAUL,CAAV,EAAanB,CAAb,EAAgB;AAEvB,UAAI5F,CAAC,GAAG,CAAR;AACA,UAAIqH,CAAC,GAAGN,CAAC,CAAC1O,MAAF,GAAW,CAAnB;AACA,UAAIiP,EAAE,GAAGjY,IAAI,CAACmX,GAAd;AACA,UAAIe,EAAE,GAAG/F,KAAK,CAAC2B,aAAN,CAAoBgE,KAApB,CAA0BK,SAAnC;;AAEA,WAAK,IAAI/Q,CAAC,GAAG,CAAb,EAAgBA,CAAC,IAAI4Q,CAArB,EAAwB5Q,CAAC,EAAzB,EAA6B;AAC5BuJ,QAAAA,CAAC,IAAIsH,EAAE,CAAC,IAAI1B,CAAL,EAAQyB,CAAC,GAAG5Q,CAAZ,CAAF,GAAmB6Q,EAAE,CAAC1B,CAAD,EAAInP,CAAJ,CAArB,GAA8BsQ,CAAC,CAACtQ,CAAD,CAA/B,GAAqC8Q,EAAE,CAACF,CAAD,EAAI5Q,CAAJ,CAA5C;AACA;;AAED,aAAOuJ,CAAP;AAEA,KAlCoB;AAoCrByH,IAAAA,UAAU,EAAE,UAAUV,CAAV,EAAanB,CAAb,EAAgB;AAE3B,UAAIoB,CAAC,GAAGD,CAAC,CAAC1O,MAAF,GAAW,CAAnB;AACA,UAAI4O,CAAC,GAAGD,CAAC,GAAGpB,CAAZ;AACA,UAAInP,CAAC,GAAGpH,IAAI,CAAC6X,KAAL,CAAWD,CAAX,CAAR;AACA,UAAI1G,EAAE,GAAGiB,KAAK,CAAC2B,aAAN,CAAoBgE,KAApB,CAA0BM,UAAnC;;AAEA,UAAIV,CAAC,CAAC,CAAD,CAAD,KAASA,CAAC,CAACC,CAAD,CAAd,EAAmB;AAElB,YAAIpB,CAAC,GAAG,CAAR,EAAW;AACVnP,UAAAA,CAAC,GAAGpH,IAAI,CAAC6X,KAAL,CAAWD,CAAC,GAAGD,CAAC,IAAI,IAAIpB,CAAR,CAAhB,CAAJ;AACA;;AAED,eAAOrF,EAAE,CAACwG,CAAC,CAAC,CAACtQ,CAAC,GAAG,CAAJ,GAAQuQ,CAAT,IAAcA,CAAf,CAAF,EAAqBD,CAAC,CAACtQ,CAAD,CAAtB,EAA2BsQ,CAAC,CAAC,CAACtQ,CAAC,GAAG,CAAL,IAAUuQ,CAAX,CAA5B,EAA2CD,CAAC,CAAC,CAACtQ,CAAC,GAAG,CAAL,IAAUuQ,CAAX,CAA5C,EAA2DC,CAAC,GAAGxQ,CAA/D,CAAT;AAEA,OARD,MAQO;AAEN,YAAImP,CAAC,GAAG,CAAR,EAAW;AACV,iBAAOmB,CAAC,CAAC,CAAD,CAAD,IAAQxG,EAAE,CAACwG,CAAC,CAAC,CAAD,CAAF,EAAOA,CAAC,CAAC,CAAD,CAAR,EAAaA,CAAC,CAAC,CAAD,CAAd,EAAmBA,CAAC,CAAC,CAAD,CAApB,EAAyB,CAACE,CAA1B,CAAF,GAAiCF,CAAC,CAAC,CAAD,CAA1C,CAAP;AACA;;AAED,YAAInB,CAAC,GAAG,CAAR,EAAW;AACV,iBAAOmB,CAAC,CAACC,CAAD,CAAD,IAAQzG,EAAE,CAACwG,CAAC,CAACC,CAAD,CAAF,EAAOD,CAAC,CAACC,CAAD,CAAR,EAAaD,CAAC,CAACC,CAAC,GAAG,CAAL,CAAd,EAAuBD,CAAC,CAACC,CAAC,GAAG,CAAL,CAAxB,EAAiCC,CAAC,GAAGD,CAArC,CAAF,GAA4CD,CAAC,CAACC,CAAD,CAArD,CAAP;AACA;;AAED,eAAOzG,EAAE,CAACwG,CAAC,CAACtQ,CAAC,GAAGA,CAAC,GAAG,CAAP,GAAW,CAAb,CAAF,EAAmBsQ,CAAC,CAACtQ,CAAD,CAApB,EAAyBsQ,CAAC,CAACC,CAAC,GAAGvQ,CAAC,GAAG,CAAR,GAAYuQ,CAAZ,GAAgBvQ,CAAC,GAAG,CAArB,CAA1B,EAAmDsQ,CAAC,CAACC,CAAC,GAAGvQ,CAAC,GAAG,CAAR,GAAYuQ,CAAZ,GAAgBvQ,CAAC,GAAG,CAArB,CAApD,EAA6EwQ,CAAC,GAAGxQ,CAAjF,CAAT;AAEA;AAED,KAjEoB;AAmErB0Q,IAAAA,KAAK,EAAE;AAENnE,MAAAA,MAAM,EAAE,UAAU0E,EAAV,EAAcC,EAAd,EAAkBC,CAAlB,EAAqB;AAE5B,eAAO,CAACD,EAAE,GAAGD,EAAN,IAAYE,CAAZ,GAAgBF,EAAvB;AAEA,OANK;AAQNF,MAAAA,SAAS,EAAE,UAAUH,CAAV,EAAa5Q,CAAb,EAAgB;AAE1B,YAAIoR,EAAE,GAAGrG,KAAK,CAAC2B,aAAN,CAAoBgE,KAApB,CAA0BW,SAAnC;AAEA,eAAOD,EAAE,CAACR,CAAD,CAAF,GAAQQ,EAAE,CAACpR,CAAD,CAAV,GAAgBoR,EAAE,CAACR,CAAC,GAAG5Q,CAAL,CAAzB;AAEA,OAdK;AAgBNqR,MAAAA,SAAS,EAAG,YAAY;AAEvB,YAAIC,CAAC,GAAG,CAAC,CAAD,CAAR;AAEA,eAAO,UAAUV,CAAV,EAAa;AAEnB,cAAIR,CAAC,GAAG,CAAR;;AAEA,cAAIkB,CAAC,CAACV,CAAD,CAAL,EAAU;AACT,mBAAOU,CAAC,CAACV,CAAD,CAAR;AACA;;AAED,eAAK,IAAI5Q,CAAC,GAAG4Q,CAAb,EAAgB5Q,CAAC,GAAG,CAApB,EAAuBA,CAAC,EAAxB,EAA4B;AAC3BoQ,YAAAA,CAAC,IAAIpQ,CAAL;AACA;;AAEDsR,UAAAA,CAAC,CAACV,CAAD,CAAD,GAAOR,CAAP;AACA,iBAAOA,CAAP;AAEA,SAfD;AAiBA,OArBU,EAhBL;AAuCNY,MAAAA,UAAU,EAAE,UAAUC,EAAV,EAAcC,EAAd,EAAkBK,EAAlB,EAAsBC,EAAtB,EAA0BL,CAA1B,EAA6B;AAExC,YAAIM,EAAE,GAAG,CAACF,EAAE,GAAGN,EAAN,IAAY,GAArB;AACA,YAAIS,EAAE,GAAG,CAACF,EAAE,GAAGN,EAAN,IAAY,GAArB;AACA,YAAIS,EAAE,GAAGR,CAAC,GAAGA,CAAb;AACA,YAAIS,EAAE,GAAGT,CAAC,GAAGQ,EAAb;AAEA,eAAO,CAAC,IAAIT,EAAJ,GAAS,IAAIK,EAAb,GAAkBE,EAAlB,GAAuBC,EAAxB,IAA8BE,EAA9B,GAAmC,CAAC,CAAE,CAAF,GAAMV,EAAN,GAAW,IAAIK,EAAf,GAAoB,IAAIE,EAAxB,GAA6BC,EAA9B,IAAoCC,EAAvE,GAA4EF,EAAE,GAAGN,CAAjF,GAAqFD,EAA5F;AAEA;AAhDK;AAnEc,GAAtB,CAvxB4D,CAg5B5D;;AACA,GAAC,UAAUW,IAAV,EAAgB;AAEhB;AAEC;AACA9H,MAAAA,MAAM,CAACC,OAAP,GAAiBe,KAAjB;AAEA;AAED,GATD;AAUC,CA35B+B,CAAhC;AA65BA;;;;;;;;AAOA,SAAS+G,QAAT,CAAoB7K,KAAK,GAAG,GAA5B,EAAiC8K,QAAjC,EAA2CC,QAA3C,EAAsD;AAElD,QAAMpJ,QAAQ,GAAG,GAAjB;AAAA,QAAsBqJ,WAAW,GAAG,GAApC;AAEAF,EAAAA,QAAQ,GAAGA,QAAQ,IAAI5W,SAAS,CAACC,IAAjC;AAEA3D,EAAAA,MAAM,CAACmP,IAAP,CAAa,IAAb;AAEA,OAAKtE,IAAL,GAAY,UAAZ;AAEA,OAAK0P,QAAL,GAAgBA,QAAQ,KAAKhV,SAAb,GAAyBgV,QAAzB,GAAoC,IAApD;AACA,OAAKE,UAAL,GAAkB,KAAlB;AAEA;;;;;AAIA,OAAK7K,aAAL,GAAqB,KAArB;AAEA,OAAKtG,OAAL,GAAe,IAAf;AACA,OAAKoR,UAAL,GAAkB,IAAlB;AACA,OAAKC,WAAL,GAAmB,IAAnB;AAEA,OAAKC,IAAL,GAAY/X,KAAK,CAACE,MAAlB;AAEA,OAAKyM,KAAL,CAAWnC,GAAX,CAAgBmC,KAAhB,EAAuBA,KAAvB,EAA8B,CAA9B;AACA,OAAKqL,QAAL,CAAcrK,CAAd,GAAkBrP,IAAI,CAACkP,EAAvB;AAEA,OAAKjH,SAAL,GAAiB,IAAjB;AAEA,OAAK0R,eAAL,GAAuB,KAAKC,OAA5B,CA9BkD,CAgClD;;AACA,OAAKC,aAAL,GAAqB,IAArB;AAEA,OAAK/L,QAAL,CAAcgM,IAAd,GAAqB9a,UAArB;AACA,OAAK8O,QAAL,CAAciM,SAAd,GAA0B,KAA1B;AACA,OAAKjM,QAAL,CAAckM,WAAd,GAA4B,IAA5B;AACA,OAAKlM,QAAL,CAAcyC,OAAd,GAAwB,CAAxB;AAEA,OAAK0J,gBAAL,GAAwB,IAAI5I,KAAK,CAACA,KAAV,EAAxB;AACA,OAAK6I,kBAAL,GAA0B,IAAI7I,KAAK,CAACA,KAAV,EAA1B;;AAGA,QAAM8I,QAAQ,GAAG,UAAW5T,OAAX,EAAqB;AAElC,QAAK,CAAC,KAAKuH,QAAX,EAAsB;AAAE;AAAS;;AAEjC,UAAMX,KAAK,GAAG5G,OAAO,CAACxC,KAAR,CAAc0D,KAAd,GAAsBlB,OAAO,CAACxC,KAAR,CAAc4D,MAAlD;AACA,UAAMyS,YAAY,GAAG,IAAInb,OAAJ,EAArB;AAEAsH,IAAAA,OAAO,CAACxC,KAAR,CAAc0D,KAAd,GAAsBlB,OAAO,CAACxC,KAAR,CAAcsW,YAAd,IAA8B,EAApD;AACA9T,IAAAA,OAAO,CAACxC,KAAR,CAAc4D,MAAd,GAAuBpB,OAAO,CAACxC,KAAR,CAAcuW,aAAd,IAA+B,EAAtD;AAEA,SAAKjM,KAAL,CAAWnC,GAAX,CAAgBiB,KAAK,GAAGkB,KAAxB,EAA+BA,KAA/B,EAAsC,CAAtC;AAEA+L,IAAAA,YAAY,CAACvL,IAAb,CAAmB,KAAKR,KAAxB;AAEA,SAAK4L,gBAAL,GAAwB,IAAI5I,KAAK,CAACA,KAAV,CAAiB,KAAKhD,KAAtB,EACnBoG,EADmB,CACf;AAAErF,MAAAA,CAAC,EAAEgL,YAAY,CAAChL,CAAb,GAAiBiK,WAAtB;AAAmChK,MAAAA,CAAC,EAAE+K,YAAY,CAAC/K,CAAb,GAAiBgK;AAAvD,KADe,EACuDrJ,QADvD,EAEnBwF,MAFmB,CAEXnE,KAAK,CAACqC,MAAN,CAAa4D,OAAb,CAAqBZ,GAFV,CAAxB;AAIA,SAAKwD,kBAAL,GAA0B,IAAI7I,KAAK,CAACA,KAAV,CAAiB,KAAKhD,KAAtB,EACrBoG,EADqB,CACjB;AAAErF,MAAAA,CAAC,EAAEgL,YAAY,CAAChL,CAAlB;AAAqBC,MAAAA,CAAC,EAAE+K,YAAY,CAAC/K;AAArC,KADiB,EACyBW,QADzB,EAErBwF,MAFqB,CAEbnE,KAAK,CAACqC,MAAN,CAAa4D,OAAb,CAAqBZ,GAFR,CAA1B;AAIA,SAAK5I,QAAL,CAAc7G,GAAd,GAAoBV,OAApB;AACA,SAAKuH,QAAL,CAAcnH,WAAd,GAA4B,IAA5B;AAEH,GAzBgB,CAyBf0C,IAzBe,CAyBT,IAzBS,CAAjB,CA5CkD,CAuElD;;;AACA,OAAKkR,aAAL,GAAqB,IAAIlJ,KAAK,CAACA,KAAV,CAAiB,KAAKvD,QAAtB,EAChB2G,EADgB,CACZ;AAAElE,IAAAA,OAAO,EAAE;AAAX,GADY,EACIP,QADJ,EAEhB8F,OAFgB,CAEP,KAAK0E,aAAL,CAAmBnR,IAAnB,CAAyB,IAAzB,EAA+B,IAA/B,CAFO,EAGhBmM,MAHgB,CAGRnE,KAAK,CAACqC,MAAN,CAAamD,OAAb,CAAqBH,GAHb,CAArB;AAKA,OAAK+D,aAAL,GAAqB,IAAIpJ,KAAK,CAACA,KAAV,CAAiB,KAAKvD,QAAtB,EAChB2G,EADgB,CACZ;AAAElE,IAAAA,OAAO,EAAE;AAAX,GADY,EACIP,QADJ,EAEhB8F,OAFgB,CAEP,KAAK0E,aAAL,CAAmBnR,IAAnB,CAAyB,IAAzB,EAA+B,KAA/B,CAFO,EAGhBmM,MAHgB,CAGRnE,KAAK,CAACqC,MAAN,CAAamD,OAAb,CAAqBH,GAHb,CAArB,CA7EkD,CAkFlD;;AACA,OAAKhS,gBAAL,CAAuB,OAAvB,EAAgC,KAAKgW,OAArC;AACA,OAAKhW,gBAAL,CAAuB,OAAvB,EAAgC,KAAKiW,OAArC;AACA,OAAKjW,gBAAL,CAAuB,YAAvB,EAAqC,KAAKkW,YAA1C;AACA,OAAKlW,gBAAL,CAAuB,YAAvB,EAAqC,KAAKmW,UAA1C;AACA,OAAKnW,gBAAL,CAAuB,0BAAvB,EAAmD,KAAKoW,eAAxD;AACA,OAAKpW,gBAAL,CAAuB,oBAAvB,EAA6C,KAAKgE,YAAL,CAAkBW,IAAlB,CAAwB,IAAxB,CAA7C;AACA,OAAK3E,gBAAL,CAAuB,SAAvB,EAAkC,KAAKqW,SAAvC;AACA,OAAKrW,gBAAL,CAAuB,yBAAvB,EAAkD,KAAKsW,cAAvD;AAEA1U,EAAAA,aAAa,CAAClD,IAAd,CAAoB+V,QAApB,EAA8BgB,QAA9B;AAEH;;AACDjB,QAAQ,CAAC1Q,SAAT,GAAqBT,MAAM,CAACC,MAAP,CAAeD,MAAM,CAACU,MAAP,CAAe5J,MAAM,CAAC2J,SAAtB,CAAf,EAAkD;AAEnEmG,EAAAA,WAAW,EAAEuK,QAFsD;;AAInE;;;;;;AAMAxQ,EAAAA,YAAY,EAAE,UAAWuS,IAAX,EAAkB;AAE5B,QAAIhT,SAAJ;;AAEA,QAAKgT,IAAI,YAAYC,WAArB,EAAmC;AAE/BjT,MAAAA,SAAS,GAAGgT,IAAZ;AAEH,KAJD,MAIO,IAAKA,IAAI,IAAIA,IAAI,CAAChT,SAAlB,EAA8B;AAEjCA,MAAAA,SAAS,GAAGgT,IAAI,CAAChT,SAAjB;AAEH,KAZ2B,CAc5B;;;AACA,QAAKA,SAAS,IAAI,KAAKE,OAAvB,EAAiC;AAE7BF,MAAAA,SAAS,CAACkT,WAAV,CAAuB,KAAKhT,OAA5B;AAEH;;AAED,SAAKF,SAAL,GAAiBA,SAAjB;AAEH,GAjCkE;;AAmCnE;;;;;;AAMAmT,EAAAA,YAAY,EAAE,YAAY;AAEtB,WAAO,KAAKnT,SAAZ;AAEH,GA7CkE;;AA+CnE;;;;;;;AAOAyS,EAAAA,OAAO,EAAE,UAAW5U,KAAX,EAAmB;AAExB,QAAK,KAAKqC,OAAL,IAAgB,KAAKiT,YAAL,EAArB,EAA2C;AAEvC,WAAKR,YAAL,CAAmB9U,KAAnB,EAFuC,CAIvC;;AACA,WAAKuV,gBAAL;AAEH;AAEJ,GAjEkE;;AAmEnE;;;;;;AAMAN,EAAAA,SAAS,EAAE,YAAY;AAEnB,QAAK,KAAK5S,OAAV,EAAoB;AAEhB,WAAKmT,kBAAL;AACA,WAAKT,UAAL;AAEH;AAEJ,GAlFkE;;AAoFnE;;;;;;;AAOAF,EAAAA,OAAO,EAAE,YAAY,CAAE,CA3F4C;;AA6FnE;;;;;;;AAOAC,EAAAA,YAAY,EAAE,UAAW9U,KAAX,EAAmB;AAE7B,QAAK,CAAC,KAAKsV,YAAL,EAAN,EAA4B;AAAE;AAAS;;AAEvC,UAAM5B,WAAW,GAAG,KAAKA,WAAL,KAAsB,KAAKC,IAAL,KAAc/X,KAAK,CAACE,MAApB,GAA6B,SAA7B,GAAyC,SAA/D,CAApB;AACA,UAAM;AAAEsY,MAAAA,kBAAF;AAAsBD,MAAAA,gBAAtB;AAAwC9R,MAAAA;AAAxC,QAAoD,IAA1D;AAEA,SAAKmR,UAAL,GAAkB,IAAlB;AACA,SAAKrR,SAAL,CAAeqE,KAAf,CAAqBiP,MAArB,GAA8B/B,WAA9B;;AAEA,QAAK,KAAKJ,QAAV,EAAqB;AAEjBc,MAAAA,kBAAkB,CAAC9Q,IAAnB;AACA6Q,MAAAA,gBAAgB,CAAC3Q,KAAjB;AAEH;;AAED,QAAKnB,OAAO,IAAIrC,KAAK,CAAC0V,UAAN,CAAiBC,OAAjB,IAA4B,CAAvC,IAA4C3V,KAAK,CAAC0V,UAAN,CAAiBE,OAAjB,IAA4B,CAA7E,EAAiF;AAE7E,YAAM;AAAEjP,QAAAA,IAAF;AAAQkP,QAAAA,KAAR;AAAerP,QAAAA;AAAf,UAAyBnE,OAA/B;;AAEA,UAAK,KAAKsR,IAAL,KAAc/X,KAAK,CAACG,SAApB,IAAiC,KAAK4X,IAAL,KAAc/X,KAAK,CAACI,MAA1D,EAAmE;AAE/DwK,QAAAA,KAAK,CAACM,OAAN,GAAgB,MAAhB;AACAH,QAAAA,IAAI,CAACH,KAAL,CAAWM,OAAX,GAAqB,OAArB;AACA+O,QAAAA,KAAK,CAACrP,KAAN,CAAYM,OAAZ,GAAsB,OAAtB,CAJ+D,CAM/D;;AACAzE,QAAAA,OAAO,CAACyT,MAAR,GAAiBnP,IAAI,CAACM,WAAtB;AACA5E,QAAAA,OAAO,CAAC0T,OAAR,GAAkBpP,IAAI,CAACO,YAAvB;AAEH,OAVD,MAUO;AAEHV,QAAAA,KAAK,CAACM,OAAN,GAAgB,OAAhB;;AACA,YAAKH,IAAL,EAAY;AAAEA,UAAAA,IAAI,CAACH,KAAL,CAAWM,OAAX,GAAqB,MAArB;AAA8B;;AAC5C,YAAK+O,KAAL,EAAa;AAAEA,UAAAA,KAAK,CAACrP,KAAN,CAAYM,OAAZ,GAAsB,MAAtB;AAA+B,SAJ3C,CAMH;;;AACAzE,QAAAA,OAAO,CAACyT,MAAR,GAAiBzT,OAAO,CAAC4E,WAAzB;AACA5E,QAAAA,OAAO,CAAC0T,OAAR,GAAkB1T,OAAO,CAAC6E,YAA1B;AAEH;AAEJ;AAEJ,GAjJkE;;AAmJnE;;;;;;AAMA6N,EAAAA,UAAU,EAAE,YAAY;AAEpB,QAAK,CAAC,KAAKO,YAAL,EAAN,EAA4B;AAAE;AAAS;;AAEvC,UAAM;AAAElB,MAAAA,kBAAF;AAAsBD,MAAAA,gBAAtB;AAAwC9R,MAAAA;AAAxC,QAAoD,IAA1D;AAEA,SAAKmR,UAAL,GAAkB,KAAlB;AACA,SAAKrR,SAAL,CAAeqE,KAAf,CAAqBiP,MAArB,GAA8B,SAA9B;;AAEA,QAAK,KAAKnC,QAAV,EAAqB;AAEjBa,MAAAA,gBAAgB,CAAC7Q,IAAjB;AACA8Q,MAAAA,kBAAkB,CAAC5Q,KAAnB;AAEH;;AAED,QAAKnB,OAAO,IAAI,CAAC,KAAKA,OAAL,CAAa2T,MAA9B,EAAuC;AAEnC,YAAM;AAAErP,QAAAA,IAAF;AAAQkP,QAAAA,KAAR;AAAerP,QAAAA;AAAf,UAAyBnE,OAA/B;AAEAmE,MAAAA,KAAK,CAACM,OAAN,GAAgB,MAAhB;;AACA,UAAKH,IAAL,EAAY;AAAEA,QAAAA,IAAI,CAACH,KAAL,CAAWM,OAAX,GAAqB,MAArB;AAA8B;;AAC5C,UAAK+O,KAAL,EAAa;AAAEA,QAAAA,KAAK,CAACrP,KAAN,CAAYM,OAAZ,GAAsB,MAAtB;AAA+B;;AAE9C,WAAK0O,kBAAL;AAEH;AAEJ,GArLkE;;AAuLnE;;;;;;;AAOAR,EAAAA,eAAe,EAAE,UAAWhV,KAAX,EAAmB;AAEhC,QAAK,CAAC,KAAKsV,YAAL,EAAN,EAA4B;AAAE;AAAS;;AAEvC,QAAIjT,OAAJ,EAAa4T,SAAb,EAAwBC,UAAxB;AAEA,SAAKvC,IAAL,GAAY3T,KAAK,CAAC2T,IAAlB;AAEAtR,IAAAA,OAAO,GAAG,KAAKA,OAAf;AAEA4T,IAAAA,SAAS,GAAG,KAAK9T,SAAL,CAAe8E,WAAf,GAA6B,CAAzC;AACAiP,IAAAA,UAAU,GAAG,KAAK/T,SAAL,CAAe+E,YAAf,GAA8B,CAA3C;;AAEA,QAAK,CAAC7E,OAAN,EAAgB;AAEZ;AAEH;;AAED,QAAK,CAACA,OAAO,CAACsE,IAAT,IAAiB,CAACtE,OAAO,CAACwT,KAA/B,EAAuC;AAEnCxT,MAAAA,OAAO,CAACsE,IAAR,GAAetE,OAAO,CAAC8T,SAAR,CAAmB,IAAnB,CAAf;AACA9T,MAAAA,OAAO,CAACwT,KAAR,GAAgBxT,OAAO,CAAC8T,SAAR,CAAmB,IAAnB,CAAhB;AAEH;;AAED,QAAK,KAAKxC,IAAL,KAAc/X,KAAK,CAACG,SAApB,IAAiC,KAAK4X,IAAL,KAAc/X,KAAK,CAACI,MAA1D,EAAmE;AAE/DqG,MAAAA,OAAO,CAACsE,IAAR,CAAaH,KAAb,CAAmBM,OAAnB,GAA6BzE,OAAO,CAACmE,KAAR,CAAcM,OAA3C;AACAzE,MAAAA,OAAO,CAACwT,KAAR,CAAcrP,KAAd,CAAoBM,OAApB,GAA8BzE,OAAO,CAACmE,KAAR,CAAcM,OAA5C;AACAzE,MAAAA,OAAO,CAACmE,KAAR,CAAcM,OAAd,GAAwB,MAAxB;AAEH,KAND,MAMO;AAEHzE,MAAAA,OAAO,CAACmE,KAAR,CAAcM,OAAd,GAAwBzE,OAAO,CAACsE,IAAR,CAAaH,KAAb,CAAmBM,OAA3C;AACAzE,MAAAA,OAAO,CAACsE,IAAR,CAAaH,KAAb,CAAmBM,OAAnB,GAA6B,MAA7B;AACAzE,MAAAA,OAAO,CAACwT,KAAR,CAAcrP,KAAd,CAAoBM,OAApB,GAA8B,MAA9B;AAEH,KAtC+B,CAwChC;;;AACA,SAAKsP,gBAAL,CAAuBH,SAAvB,EAAkCC,UAAlC;AAEA,SAAK/T,SAAL,CAAekT,WAAf,CAA4BhT,OAAO,CAACsE,IAApC;AACA,SAAKxE,SAAL,CAAekT,WAAf,CAA4BhT,OAAO,CAACwT,KAApC;AAEH,GA5OkE;;AA8OnE;;;;;;;AAOAO,EAAAA,gBAAgB,EAAE,UAAW9M,CAAX,EAAcC,CAAd,EAAkB;AAEhC,QAAK,CAAC,KAAKlH,OAAL,CAAayT,MAAd,IAAwB,CAAC,KAAKzT,OAAL,CAAa0T,OAAtC,IAAiD,CAAC,KAAKT,YAAL,EAAvD,EAA6E;AAEzE;AAEH;;AAED,QAAI3O,IAAJ,EAAUD,GAAV,EAAerE,OAAf,EAAwBV,KAAxB,EAA+BE,MAA/B,EAAuCwU,KAAvC,EAA8ClU,SAA9C;AAEAA,IAAAA,SAAS,GAAG,KAAKA,SAAjB;AACAE,IAAAA,OAAO,GAAG,KAAKA,OAAf;AACAV,IAAAA,KAAK,GAAGU,OAAO,CAACyT,MAAR,GAAiB,CAAzB;AACAjU,IAAAA,MAAM,GAAGQ,OAAO,CAAC0T,OAAR,GAAkB,CAA3B;AACAM,IAAAA,KAAK,GAAGhU,OAAO,CAACiU,aAAR,KAA0BhY,SAA1B,GAAsC+D,OAAO,CAACiU,aAA9C,GAA8D,EAAtE;AAEA3P,IAAAA,IAAI,GAAG2C,CAAC,GAAG3H,KAAX;AACA+E,IAAAA,GAAG,GAAG6C,CAAC,GAAG1H,MAAJ,GAAawU,KAAnB;;AAEA,QAAK,CAAE,KAAK1C,IAAL,KAAc/X,KAAK,CAACG,SAApB,IAAiC,KAAK4X,IAAL,KAAc/X,KAAK,CAACI,MAAvD,KACNqG,OAAO,CAACsE,IADF,IACUtE,OAAO,CAACwT,KADlB,IAEN,EAAGvM,CAAC,KAAKnH,SAAS,CAAC8E,WAAV,GAAwB,CAA9B,IAAmCsC,CAAC,KAAKpH,SAAS,CAAC+E,YAAV,GAAyB,CAArE,CAFC,EAE0E;AAEtEP,MAAAA,IAAI,GAAGxE,SAAS,CAAC8E,WAAV,GAAwB,CAAxB,GAA4BtF,KAA5B,IAAsC2H,CAAC,GAAGnH,SAAS,CAAC8E,WAAV,GAAwB,CAAlE,CAAP;AACAP,MAAAA,GAAG,GAAGvE,SAAS,CAAC+E,YAAV,GAAyB,CAAzB,GAA6BrF,MAA7B,GAAsCwU,KAAtC,IAAgD9M,CAAC,GAAGpH,SAAS,CAAC+E,YAAV,GAAyB,CAA7E,CAAN;AAEA,WAAKqP,eAAL,CAAsB,WAAtB,EAAmClU,OAAO,CAACsE,IAA3C,EAAiD,eAAeA,IAAf,GAAsB,MAAtB,GAA+BD,GAA/B,GAAqC,KAAtF;AAEAC,MAAAA,IAAI,IAAIxE,SAAS,CAAC8E,WAAV,GAAwB,CAAhC;AAEA,WAAKsP,eAAL,CAAsB,WAAtB,EAAmClU,OAAO,CAACwT,KAA3C,EAAkD,eAAelP,IAAf,GAAsB,MAAtB,GAA+BD,GAA/B,GAAqC,KAAvF;AAEH,KAbD,MAaO;AAEH,WAAK6P,eAAL,CAAsB,WAAtB,EAAmClU,OAAnC,EAA4C,eAAesE,IAAf,GAAsB,MAAtB,GAA+BD,GAA/B,GAAqC,KAAjF;AAEH;AAEJ,GA3RkE;;AA6RnE;;;;;;;;AAQA6P,EAAAA,eAAe,EAAE,UAAW3S,IAAX,EAAiBvB,OAAjB,EAA0BgO,KAA1B,EAAkC;AAE/C,UAAM7J,KAAK,GAAGnE,OAAO,CAACmE,KAAtB;;AAEA,QAAK5C,IAAI,KAAK,WAAd,EAA4B;AAExB4C,MAAAA,KAAK,CAACgQ,eAAN,GAAwBhQ,KAAK,CAACiQ,WAAN,GAAoBjQ,KAAK,CAACkQ,SAAN,GAAkBrG,KAA9D;AAEH;AAEJ,GA/SkE;;AAiTnE;;;;;;AAMAsG,EAAAA,OAAO,EAAE,UAAWC,IAAX,EAAkB;AAEvB,QAAK,KAAKvU,OAAV,EAAoB;AAEhB,WAAKA,OAAL,CAAawU,WAAb,GAA2BD,IAA3B;AAEH;AAEJ,GA/TkE;;AAiUnE;;;;;AAKAE,EAAAA,mBAAmB,EAAE,UAAWtQ,KAAX,EAAmB;AAEpC,SAAKkN,WAAL,GAAmBlN,KAAnB;AAEH,GA1UkE;;AA4UnE;;;;;;;AAOAuQ,EAAAA,YAAY,EAAE,UAAWH,IAAX,EAAiBP,KAAK,GAAG,EAAzB,EAA8B;AAExC,QAAK,CAAC,KAAKhU,OAAX,EAAqB;AAEjB,WAAKA,OAAL,GAAerD,QAAQ,CAACqH,aAAT,CAAwB,KAAxB,CAAf;AACA,WAAKhE,OAAL,CAAamE,KAAb,CAAmBM,OAAnB,GAA6B,MAA7B;AACA,WAAKzE,OAAL,CAAamE,KAAb,CAAmBgB,KAAnB,GAA2B,MAA3B;AACA,WAAKnF,OAAL,CAAamE,KAAb,CAAmBE,GAAnB,GAAyB,CAAzB;AACA,WAAKrE,OAAL,CAAamE,KAAb,CAAmBwQ,QAAnB,GAA8B,KAA9B;AACA,WAAK3U,OAAL,CAAamE,KAAb,CAAmByQ,SAAnB,GAA+B,KAA/B;AACA,WAAK5U,OAAL,CAAamE,KAAb,CAAmB0Q,UAAnB,GAAgC,iBAAhC;AACA,WAAK7U,OAAL,CAAamE,KAAb,CAAmB2Q,UAAnB,GAAgC,uCAAhC;AACA,WAAK9U,OAAL,CAAamE,KAAb,CAAmBC,QAAnB,GAA8B,UAA9B;AACA,WAAKpE,OAAL,CAAa+U,SAAb,CAAuBlY,GAAvB,CAA4B,mBAA5B;AACA,WAAKmD,OAAL,CAAaiU,aAAb,GAA6BD,KAA7B;AAEH;;AAED,SAAKM,OAAL,CAAcC,IAAd;AAEH,GAvWkE;;AAyWnE;;;;;;;AAOAS,EAAAA,eAAe,EAAE,UAAWC,EAAX,EAAejB,KAAK,GAAG,EAAvB,EAA4B;AAEzC,QAAK,CAAC,KAAKhU,OAAX,EAAqB;AAEjB,WAAKA,OAAL,GAAeiV,EAAE,CAACnB,SAAH,CAAc,IAAd,CAAf;AACA,WAAK9T,OAAL,CAAamE,KAAb,CAAmBM,OAAnB,GAA6B,MAA7B;AACA,WAAKzE,OAAL,CAAamE,KAAb,CAAmBE,GAAnB,GAAyB,CAAzB;AACA,WAAKrE,OAAL,CAAamE,KAAb,CAAmBC,QAAnB,GAA8B,UAA9B;AACA,WAAKpE,OAAL,CAAa+U,SAAb,CAAuBlY,GAAvB,CAA4B,mBAA5B;AACA,WAAKmD,OAAL,CAAaiU,aAAb,GAA6BD,KAA7B;AAEH;AAEJ,GA7XkE;;AA+XnE;;;;;AAKAkB,EAAAA,kBAAkB,EAAE,YAAY;AAE5B,QAAK,KAAKlV,OAAV,EAAoB;AAEhB,UAAK,KAAKA,OAAL,CAAasE,IAAlB,EAAyB;AAErB,aAAKxE,SAAL,CAAeqV,WAAf,CAA4B,KAAKnV,OAAL,CAAasE,IAAzC;AACA,aAAKtE,OAAL,CAAasE,IAAb,GAAoB,IAApB;AAEH;;AAED,UAAK,KAAKtE,OAAL,CAAawT,KAAlB,EAA0B;AAEtB,aAAK1T,SAAL,CAAeqV,WAAf,CAA4B,KAAKnV,OAAL,CAAawT,KAAzC;AACA,aAAKxT,OAAL,CAAawT,KAAb,GAAqB,IAArB;AAEH;;AAED,WAAK1T,SAAL,CAAeqV,WAAf,CAA4B,KAAKnV,OAAjC;AACA,WAAKA,OAAL,GAAe,IAAf;AAEH;AAEJ,GA3ZkE;;AA6ZnE;;;;;AAKAkT,EAAAA,gBAAgB,EAAE,YAAY;AAE1B,QAAK,KAAKlT,OAAV,EAAoB;AAEhB,WAAKA,OAAL,CAAa2T,MAAb,GAAsB,IAAtB;AAEH;AAEJ,GA1akE;;AA4anE;;;;;AAKAR,EAAAA,kBAAkB,EAAE,YAAY;AAE5B,QAAK,KAAKnT,OAAV,EAAoB;AAEhB,WAAKA,OAAL,CAAa2T,MAAb,GAAsB,KAAtB;AAEH;AAEJ,GAzbkE;;AA2bnE;;;;;;AAMAtB,EAAAA,aAAa,EAAE,UAAW/W,OAAO,GAAG,IAArB,EAA4B;AAEvC,QAAKA,OAAL,EAAe;AAEX,WAAKmW,OAAL,GAAe,KAAKD,eAApB;AAEH,KAJD,MAIO;AAEH,WAAKC,OAAL,GAAe,MAAM,CAAE,CAAvB;AAEH;AAEJ,GA7ckE;;AA+cnE;;;;;;AAMA/I,EAAAA,IAAI,EAAE,UAAWsE,KAAK,GAAG,CAAnB,EAAuB;AAEzB,UAAM;AAAEiE,MAAAA,QAAF;AAAYqB,MAAAA,aAAZ;AAA2BF,MAAAA,aAA3B;AAA0CzM,MAAAA;AAA1C,QAAuD,IAA7D;;AAEA,QAAKsL,QAAL,EAAgB;AAEZqB,MAAAA,aAAa,CAACrR,IAAd;AACAmR,MAAAA,aAAa,CAACpF,KAAd,CAAqBA,KAArB,EAA6B7L,KAA7B;AAEH,KALD,MAKO;AAEH,WAAKkR,aAAL,CAAoB,IAApB;AACA1M,MAAAA,QAAQ,CAACyC,OAAT,GAAmB,CAAnB;AAEH;AAEJ,GArekE;;AAuenE;;;;;;AAMAQ,EAAAA,IAAI,EAAE,UAAWoE,KAAK,GAAG,CAAnB,EAAuB;AAEzB,UAAM;AAAEiE,MAAAA,QAAF;AAAYqB,MAAAA,aAAZ;AAA2BF,MAAAA,aAA3B;AAA0CzM,MAAAA,QAA1C;AAAoD3F,MAAAA;AAApD,QAAgE,IAAtE;;AAEA,QAAKA,OAAL,EAAe;AACX,YAAM;AAAEmE,QAAAA;AAAF,UAAYnE,OAAlB;AACAmE,MAAAA,KAAK,CAACM,OAAN,GAAgB,MAAhB;AACH;;AAED,QAAKwM,QAAL,EAAgB;AAEZmB,MAAAA,aAAa,CAACnR,IAAd;AACAqR,MAAAA,aAAa,CAACtF,KAAd,CAAqBA,KAArB,EAA6B7L,KAA7B;AAEH,KALD,MAKO;AAEH,WAAKkR,aAAL,CAAoB,KAApB;AACA1M,MAAAA,QAAQ,CAACyC,OAAT,GAAmB,CAAnB;AAEH;AAEJ,GAlgBkE;;AAogBnE;;;;;AAKAyK,EAAAA,cAAc,EAAE,UAAWlV,KAAX,EAAmB;AAE/B,QAAKA,KAAL,EAAa;AAET,WAAK+T,aAAL,GAAqB/T,KAAK,CAACyX,MAA3B;AAEH;AAEJ,GAjhBkE;;AAmhBnE;;;;;;;AAOAC,EAAAA,KAAK,EAAE,UAAWxN,QAAX,EAAqBwF,MAArB,EAA8B;AAEjC,QAAK,KAAKqE,aAAV,EAA0B;AAEtB,WAAKA,aAAL,CAAoB,KAAKtN,QAAzB,EAAmCyD,QAAnC,EAA6CwF,MAA7C;AACA,WAAKuF,SAAL;AAEH;AAEJ,GAniBkE;;AAqiBnE;;;;;AAKA0C,EAAAA,OAAO,EAAE,YAAY;AAEjB,UAAM;AAAEC,MAAAA,QAAF;AAAY5P,MAAAA;AAAZ,QAAyB,IAA/B;AACA,UAAM;AAAE7G,MAAAA;AAAF,QAAU6G,QAAhB;AAEA,SAAKuP,kBAAL;;AAEA,QAAK,KAAKM,MAAV,EAAmB;AAEf,WAAKA,MAAL,CAAY5L,MAAZ,CAAoB,IAApB;AAEH;;AAED,QAAK9K,GAAL,EAAW;AAAEA,MAAAA,GAAG,CAACwW,OAAJ;AAAe3P,MAAAA,QAAQ,CAAC7G,GAAT,GAAe,IAAf;AAAsB;;AAClD,QAAKyW,QAAL,EAAgB;AAAEA,MAAAA,QAAQ,CAACD,OAAT;AAAoB,WAAKC,QAAL,GAAgB,IAAhB;AAAuB;;AAC7D,QAAK5P,QAAL,EAAgB;AAAEA,MAAAA,QAAQ,CAAC2P,OAAT;AAAoB,WAAK3P,QAAL,GAAgB,IAAhB;AAAuB;AAEhE;AA3jBkE,CAAlD,CAArB;AA+jBA;;;;;;AAKA,SAAS8P,MAAT,CAAkB3V,SAAlB,EAA8B;AAE1B,MAAK,CAACA,SAAN,EAAkB;AAEdyC,IAAAA,OAAO,CAACC,IAAR,CAAc,yCAAd;AAEH;;AAEDlM,EAAAA,eAAe,CAACuP,IAAhB,CAAsB,IAAtB;AAEA,OAAK6P,kBAAL,GAA2B,gBAA3B;AACA,OAAKC,aAAL,GAAqB,CAAC,EAAI,kBAAkBnZ,MAApB,IAAgCA,MAAM,CAACoZ,aAAP,IAAwBjZ,QAAQ,YAAYiZ,aAA9E,CAAtB;;AACA,OAAKC,qBAAL,GAA6B,UAAWlY,KAAX,EAAmB;AAC5CA,IAAAA,KAAK,CAACmY,cAAN;AACAnY,IAAAA,KAAK,CAACoY,eAAN;AACH,GAHD;;AAKA,OAAKjW,SAAL,GAAiBA,SAAjB;AAEA,OAAKkW,UAAL,GAAkB,IAAlB;AACA,OAAKC,iBAAL,GAAyB,IAAzB;AACA,OAAKC,YAAL,GAAoB,IAApB;AACA,OAAKC,cAAL,GAAsB,IAAtB;AAEA,OAAKC,QAAL,GAAgB,IAAhB;AAEA,OAAKC,cAAL,GAAsB,IAAtB;AACA,OAAKC,aAAL,GAAqB,IAArB;AACA,OAAKC,IAAL,GAAY,IAAZ;AAEH;;AAEDd,MAAM,CAACpV,SAAP,GAAmBT,MAAM,CAACC,MAAP,CAAeD,MAAM,CAACU,MAAP,CAAehK,eAAe,CAAC+J,SAA/B,CAAf,EAA2D;AAE1EmG,EAAAA,WAAW,EAAEiP,MAF6D;;AAI1E;;;;;AAKAe,EAAAA,aAAa,EAAE,YAAY;AAEvB,QAAK,CAAC,KAAK1W,SAAX,EAAuB;AAEnByC,MAAAA,OAAO,CAACC,IAAR,CAAc,0BAAd;AACA;AACH;;AAED,QAAIiU,KAAK,GAAG,IAAZ;AAAA,QAAkBC,GAAlB;AAAA,QAAuBC,cAAvB;AAAA,QAAuCC,YAAvC;AAAA,QAAqDC,aAArD;AAEAA,IAAAA,aAAa,GAAG,yDAAhB;AAEAH,IAAAA,GAAG,GAAG/Z,QAAQ,CAACqH,aAAT,CAAwB,KAAxB,CAAN;AACA0S,IAAAA,GAAG,CAACvS,KAAJ,CAAU7E,KAAV,GAAkB,MAAlB;AACAoX,IAAAA,GAAG,CAACvS,KAAJ,CAAU3E,MAAV,GAAmB,MAAnB;AACAkX,IAAAA,GAAG,CAACvS,KAAJ,CAAU2S,KAAV,GAAkB,MAAlB;AACAJ,IAAAA,GAAG,CAACvS,KAAJ,CAAUkQ,SAAV,GAAsBqC,GAAG,CAACvS,KAAJ,CAAUgQ,eAAV,GAA4BuC,GAAG,CAACvS,KAAJ,CAAUiQ,WAAV,GAAwB,mBAA1E;AACAsC,IAAAA,GAAG,CAACvS,KAAJ,CAAUd,UAAV,GAAuB,aAAawT,aAApC;AACAH,IAAAA,GAAG,CAACvS,KAAJ,CAAUd,UAAV,GAAuB,UAAUwT,aAAjC;AACAH,IAAAA,GAAG,CAACvS,KAAJ,CAAUd,UAAV,GAAuB,QAAQwT,aAA/B;AACAH,IAAAA,GAAG,CAACvS,KAAJ,CAAUd,UAAV,GAAuB,SAASwT,aAAhC;AACAH,IAAAA,GAAG,CAACvS,KAAJ,CAAUd,UAAV,GAAuBwT,aAAvB;AACAH,IAAAA,GAAG,CAACvS,KAAJ,CAAU4S,UAAV,GAAuB,KAAKrB,kBAA5B;AACAgB,IAAAA,GAAG,CAACvS,KAAJ,CAAU6S,aAAV,GAA0B,MAA1B;AACAN,IAAAA,GAAG,CAACO,QAAJ,GAAe,KAAf;;AACAP,IAAAA,GAAG,CAACQ,MAAJ,GAAa,YAAY;AACrBR,MAAAA,GAAG,CAACO,QAAJ,GAAe,CAACP,GAAG,CAACO,QAApB;AACAN,MAAAA,cAAc,GAAGD,GAAG,CAACO,QAAJ,GAAe,eAAf,GAAiC,mBAAlD;AACAL,MAAAA,YAAY,GAAGF,GAAG,CAACO,QAAJ,GAAe,CAAf,GAAmB,CAAlC;AACAP,MAAAA,GAAG,CAACvS,KAAJ,CAAUkQ,SAAV,GAAsBqC,GAAG,CAACvS,KAAJ,CAAUgQ,eAAV,GAA4BuC,GAAG,CAACvS,KAAJ,CAAUiQ,WAAV,GAAwBuC,cAA1E;AACAD,MAAAA,GAAG,CAACvS,KAAJ,CAAUiE,OAAV,GAAoBwO,YAApB;AACH,KAND,CAzBuB,CAiCvB;;;AACA,QAAIO,IAAI,GAAG,KAAKC,iBAAL,EAAX;AACA,SAAKhB,QAAL,GAAgB,KAAKiB,cAAL,CAAqBF,IAArB,CAAhB;AACAT,IAAAA,GAAG,CAAC1D,WAAJ,CAAiB,KAAKoD,QAAtB,EApCuB,CAsCvB;;AACA,QAAIG,IAAI,GAAG,KAAKe,UAAL,EAAX;AACA,SAAKf,IAAL,GAAYA,IAAZ;AACA,SAAKzW,SAAL,CAAekT,WAAf,CAA4BuD,IAA5B,EAzCuB,CA2CvB;;AACAG,IAAAA,GAAG,CAACpB,OAAJ,GAAc,YAAY;AAEtB,UAAKmB,KAAK,CAACR,iBAAX,EAA+B;AAE3BS,QAAAA,GAAG,CAACvB,WAAJ,CAAiBsB,KAAK,CAACR,iBAAvB;AACAQ,QAAAA,KAAK,CAACR,iBAAN,CAAwBX,OAAxB;AACAmB,QAAAA,KAAK,CAACR,iBAAN,GAA0B,IAA1B;AAEH;;AAED,UAAKQ,KAAK,CAACN,cAAX,EAA4B;AAExBO,QAAAA,GAAG,CAACvB,WAAJ,CAAiBsB,KAAK,CAACN,cAAvB;AACAM,QAAAA,KAAK,CAACN,cAAN,CAAqBb,OAArB;AACAmB,QAAAA,KAAK,CAACN,cAAN,GAAuB,IAAvB;AAEH;;AAED,UAAKM,KAAK,CAACP,YAAX,EAA0B;AAEtBQ,QAAAA,GAAG,CAACvB,WAAJ,CAAiBsB,KAAK,CAACP,YAAvB;AACAO,QAAAA,KAAK,CAACP,YAAN,CAAmBZ,OAAnB;AACAmB,QAAAA,KAAK,CAACP,YAAN,GAAqB,IAArB;AAEH;AAEJ,KA1BD;;AA4BA,SAAKpW,SAAL,CAAekT,WAAf,CAA4B0D,GAA5B,EAxEuB,CA0EvB;;AACA,SAAKH,IAAL,CAAUha,gBAAV,CAA4B,WAA5B,EAAyC,KAAKsZ,qBAA9C,EAAqE,IAArE;AACA,SAAKU,IAAL,CAAUha,gBAAV,CAA4B,SAA5B,EAAuC,KAAKsZ,qBAA5C,EAAmE,IAAnE;AACA,SAAKU,IAAL,CAAUha,gBAAV,CAA4B,WAA5B,EAAyC,KAAKsZ,qBAA9C,EAAqE,IAArE;AACA,SAAKU,IAAL,CAAUha,gBAAV,CAA4Bka,KAAK,CAACd,aAAN,GAAsB,UAAtB,GAAmC,OAA/D,EAAwE,UAAWhY,KAAX,EAAmB;AAEvFA,MAAAA,KAAK,CAACmY,cAAN;AACAnY,MAAAA,KAAK,CAACoY,eAAN;AAEAU,MAAAA,KAAK,CAACF,IAAN,CAAW3N,IAAX;AACA6N,MAAAA,KAAK,CAACN,cAAN,CAAqBoB,UAArB;AAEH,KARD,EAQG,KARH,EA9EuB,CAwFvB;;AACA,SAAKhb,gBAAL,CAAuB,oBAAvB,EAA6Cma,GAAG,CAACQ,MAAjD;AAEA,SAAKlB,UAAL,GAAkBU,GAAlB;AAEH,GAtGyE;;AAwG1E;;;;;AAKAU,EAAAA,iBAAiB,EAAE,YAAY;AAE3B,QAAIX,KAAK,GAAG,IAAZ;AAAA,QAAkBe,OAAlB;;AAEAA,IAAAA,OAAO,GAAG,UAAWpC,MAAX,EAAmBtC,IAAnB,EAA0B;AAEhC,aAAO,YAAY;AAEf2D,QAAAA,KAAK,CAACjT,aAAN,CAAqB;AAEjBjC,UAAAA,IAAI,EAAE,yBAFW;AAGjB6T,UAAAA,MAAM,EAAEA,MAHS;AAIjBtC,UAAAA,IAAI,EAAEA;AAJW,SAArB;AAQH,OAVD;AAYH,KAdD;;AAgBA,WAAO,CAEH;AACI2E,MAAAA,KAAK,EAAE,SADX;AAEIC,MAAAA,OAAO,EAAE,CACL;AACID,QAAAA,KAAK,EAAE,KAAK9B,aAAL,GAAqB,OAArB,GAA+B,OAD1C;AAEI6B,QAAAA,OAAO,EAAEA,OAAO,CAAE,eAAF,EAAmBpe,QAAQ,CAACC,KAA5B;AAFpB,OADK,EAKL;AACIoe,QAAAA,KAAK,EAAE,QADX;AAEID,QAAAA,OAAO,EAAEA,OAAO,CAAE,eAAF,EAAmBpe,QAAQ,CAACE,iBAA5B;AAFpB,OALK;AAFb,KAFG,EAgBH;AACIme,MAAAA,KAAK,EAAE,MADX;AAEIC,MAAAA,OAAO,EAAE,CACL;AACID,QAAAA,KAAK,EAAE,QADX;AAEID,QAAAA,OAAO,EAAEA,OAAO,CAAE,eAAF;AAFpB,OADK,EAKL;AACIC,QAAAA,KAAK,EAAE,WADX;AAEID,QAAAA,OAAO,EAAEA,OAAO,CAAE,cAAF,EAAkBje,KAAK,CAACG,SAAxB;AAFpB,OALK,EASL;AACI+d,QAAAA,KAAK,EAAE,cADX;AAEID,QAAAA,OAAO,EAAEA,OAAO,CAAE,cAAF,EAAkBje,KAAK,CAACI,MAAxB;AAFpB,OATK;AAFb,KAhBG,CAAP;AAoCH,GArKyE;;AAuK1E;;;;;;AAMAge,EAAAA,gBAAgB,EAAE,UAAWC,IAAX,EAAkB;AAEhC,QAAI5X,OAAJ;;AAEA,YAAQ4X,IAAR;AAEA,WAAK,YAAL;AAEI5X,QAAAA,OAAO,GAAG,KAAK6X,sBAAL,EAAV;AACA,aAAK5B,iBAAL,GAAyBjW,OAAzB;AAEA;;AAEJ,WAAK,SAAL;AAEIA,QAAAA,OAAO,GAAG,KAAK8X,mBAAL,EAAV;AACA,aAAK3B,cAAL,GAAsBnW,OAAtB;AAEA;;AAEJ,WAAK,OAAL;AAEIA,QAAAA,OAAO,GAAG,KAAK+X,kBAAL,EAAV;AACA,aAAK7B,YAAL,GAAoBlW,OAApB;AAEA;;AAEJ;AAEI;AAzBJ;;AA6BA,QAAK,CAACA,OAAN,EAAgB;AAEZ;AAEH;;AAED,SAAKgW,UAAL,CAAgBhD,WAAhB,CAA6BhT,OAA7B;AAEH,GAtNyE;;AAwN1E;;;;;AAKAsX,EAAAA,UAAU,EAAE,YAAY;AAEpB,UAAMtX,OAAO,GAAGrD,QAAQ,CAACqH,aAAT,CAAwB,KAAxB,CAAhB;AACAhE,IAAAA,OAAO,CAACmE,KAAR,CAAcC,QAAd,GAAyB,UAAzB;AACApE,IAAAA,OAAO,CAACmE,KAAR,CAAcE,GAAd,GAAoB,CAApB;AACArE,IAAAA,OAAO,CAACmE,KAAR,CAAcG,IAAd,GAAqB,CAArB;AACAtE,IAAAA,OAAO,CAACmE,KAAR,CAAc7E,KAAd,GAAsB,MAAtB;AACAU,IAAAA,OAAO,CAACmE,KAAR,CAAc3E,MAAd,GAAuB,MAAvB;AACAQ,IAAAA,OAAO,CAACmE,KAAR,CAAcd,UAAd,GAA2B,aAA3B;AACArD,IAAAA,OAAO,CAACmE,KAAR,CAAcM,OAAd,GAAwB,MAAxB;;AAEAzE,IAAAA,OAAO,CAAC0I,IAAR,GAAe,YAAY;AAEvB,WAAKvE,KAAL,CAAWM,OAAX,GAAqB,OAArB;AAEH,KAJD;;AAMAzE,IAAAA,OAAO,CAAC4I,IAAR,GAAe,YAAY;AAEvB,WAAKzE,KAAL,CAAWM,OAAX,GAAqB,MAArB;AAEH,KAJD;;AAMA,WAAOzE,OAAP;AAEH,GAtPyE;;AAwP1E;;;;;AAKA8X,EAAAA,mBAAmB,EAAE,YAAY;AAE7B,QAAIrB,KAAK,GAAG,IAAZ;AAAA,QAAkBuB,IAAlB;;AAEA,aAASC,KAAT,CAAiBta,KAAjB,EAAyB;AAErBA,MAAAA,KAAK,CAACmY,cAAN;AACAnY,MAAAA,KAAK,CAACoY,eAAN;AAEAU,MAAAA,KAAK,CAACL,QAAN,CAAec,MAAf;;AAEA,UAAK,KAAKgB,SAAV,EAAsB;AAElB,aAAKX,UAAL;AAEH,OAJD,MAIO;AAEH,aAAKY,QAAL;AAEH;AAEJ;;AAEDH,IAAAA,IAAI,GAAG,KAAKI,gBAAL,CAAuB;AAE1BjU,MAAAA,KAAK,EAAE;AAEHkU,QAAAA,eAAe,EAAE,UAAUje,SAAS,CAACQ,OAApB,GAA8B,IAF5C;AAGH0d,QAAAA,gBAAgB,EAAE,KAAK5C,kBAHpB;AAIHqB,QAAAA,UAAU,EAAE,KAAKrB;AAJd,OAFmB;AAU1BuC,MAAAA,KAAK,EAAEA;AAVmB,KAAvB,CAAP;;AAcAD,IAAAA,IAAI,CAACG,QAAL,GAAgB,YAAY;AAExB,WAAKhU,KAAL,CAAWkQ,SAAX,GAAuB,uBAAvB;AACA,WAAK6D,SAAL,GAAiB,IAAjB;AACAzB,MAAAA,KAAK,CAACF,IAAN,CAAW7N,IAAX;AAEH,KAND;;AAQAsP,IAAAA,IAAI,CAACT,UAAL,GAAkB,YAAY;AAE1B,WAAKpT,KAAL,CAAWkQ,SAAX,GAAuB,mBAAvB;AACA,WAAK6D,SAAL,GAAiB,KAAjB;AACAzB,MAAAA,KAAK,CAACF,IAAN,CAAW3N,IAAX;;AAEA,UAAK6N,KAAK,CAACL,QAAN,IAAkBK,KAAK,CAACL,QAAN,CAAezN,OAAtC,EAAgD;AAE5C8N,QAAAA,KAAK,CAACL,QAAN,CAAexN,IAAf;AAEH;;AAED,UAAK6N,KAAK,CAACH,aAAN,IAAuBG,KAAK,CAACH,aAAN,CAAoB3N,OAAhD,EAA0D;AAEtD8N,QAAAA,KAAK,CAACH,aAAN,CAAoB1N,IAApB;AAEH;;AAED,UAAK6N,KAAK,CAACL,QAAN,IAAkBK,KAAK,CAACL,QAAN,CAAe3C,MAAtC,EAA+C;AAE3CgD,QAAAA,KAAK,CAACL,QAAN,CAAemC,UAAf,CAA2B9B,KAAK,CAACL,QAAN,CAAe3C,MAA1C;AACAgD,QAAAA,KAAK,CAACL,QAAN,CAAeoC,UAAf;AAEH;AAEJ,KAzBD;;AA2BAR,IAAAA,IAAI,CAACE,SAAL,GAAiB,KAAjB;AAEA,WAAOF,IAAP;AAEH,GAzUyE;;AA2U1E;;;;;;;AAOAH,EAAAA,sBAAsB,EAAE,YAAY;AAEhC,QAAIpB,KAAK,GAAG,IAAZ;AAAA,QAAkBuB,IAAlB;AAAA,QAAwBS,YAAY,GAAG,KAAvC;AAAA,QAA8CC,UAAU,GAAG,IAA3D;AAAA,QAAiEC,YAAjE;AAEA,UAAM;AAAE7Y,MAAAA;AAAF,QAAgB,IAAtB;AAEA6Y,IAAAA,YAAY,GAAG,sBAAf,CANgC,CAQhC;;AACA,QAAK,CAAChc,QAAQ,CAACic,iBAAV,IACV,CAACjc,QAAQ,CAACkc,uBADA,IAEV,CAAClc,QAAQ,CAACmc,oBAFA,IAGV,CAACnc,QAAQ,CAACoc,mBAHL,EAG2B;AACvB;AACH;;AAED,aAASd,KAAT,CAAiBta,KAAjB,EAAyB;AAErBA,MAAAA,KAAK,CAACmY,cAAN;AACAnY,MAAAA,KAAK,CAACoY,eAAN;AAEA2C,MAAAA,UAAU,GAAG,KAAb;;AAEA,UAAK,CAACD,YAAN,EAAqB;AAEjB,YAAK3Y,SAAS,CAACkZ,iBAAf,EAAmC;AAAElZ,UAAAA,SAAS,CAACkZ,iBAAV;AAAgC;;AACrE,YAAKlZ,SAAS,CAACmZ,mBAAf,EAAqC;AAAEnZ,UAAAA,SAAS,CAACmZ,mBAAV;AAAkC;;AACzE,YAAKnZ,SAAS,CAACoZ,oBAAf,EAAsC;AAAEpZ,UAAAA,SAAS,CAACoZ,oBAAV;AAAmC;;AAC3E,YAAKpZ,SAAS,CAACqZ,uBAAf,EAAyC;AAAErZ,UAAAA,SAAS,CAACqZ,uBAAV,CAAmCC,OAAO,CAACC,oBAA3C;AAAoE;;AAE/GZ,QAAAA,YAAY,GAAG,IAAf;AAEH,OATD,MASO;AAEH,YAAK9b,QAAQ,CAAC2c,cAAd,EAA+B;AAAE3c,UAAAA,QAAQ,CAAC2c,cAAT;AAA4B;;AAC7D,YAAK3c,QAAQ,CAAC4c,gBAAd,EAAiC;AAAE5c,UAAAA,QAAQ,CAAC4c,gBAAT;AAA8B;;AACjE,YAAK5c,QAAQ,CAAC6c,mBAAd,EAAoC;AAAE7c,UAAAA,QAAQ,CAAC6c,mBAAT;AAAiC;;AACvE,YAAK7c,QAAQ,CAAC8c,oBAAd,EAAqC;AAAE9c,UAAAA,QAAQ,CAAC8c,oBAAT;AAAmC;;AAE1EhB,QAAAA,YAAY,GAAG,KAAf;AAEH;;AAED,WAAKtU,KAAL,CAAWkU,eAAX,GAA+BI,YAAF,GACvB,UAAUre,SAAS,CAACI,eAApB,GAAsC,IADf,GAEvB,UAAUJ,SAAS,CAACG,eAApB,GAAsC,IAF5C;AAIH;;AAED,aAASmf,kBAAT,GAA+B;AAE3B,UAAKhB,UAAL,EAAkB;AAEdD,QAAAA,YAAY,GAAG,CAACA,YAAhB;AAEAT,QAAAA,IAAI,CAAC7T,KAAL,CAAWkU,eAAX,GAA+BI,YAAF,GACvB,UAAUre,SAAS,CAACI,eAApB,GAAsC,IADf,GAEvB,UAAUJ,SAAS,CAACG,eAApB,GAAsC,IAF5C;AAIH;AAED;;;;;;;;AAMAkc,MAAAA,KAAK,CAACjT,aAAN,CAAqB;AAAEjC,QAAAA,IAAI,EAAE,yBAAR;AAAmC6T,QAAAA,MAAM,EAAE;AAA3C,OAArB;AAEAsD,MAAAA,UAAU,GAAG,IAAb;AAEH;;AAED/b,IAAAA,QAAQ,CAACJ,gBAAT,CAA2B,kBAA3B,EAA+Cmd,kBAA/C,EAAmE,KAAnE;AACA/c,IAAAA,QAAQ,CAACJ,gBAAT,CAA2B,wBAA3B,EAAqDmd,kBAArD,EAAyE,KAAzE;AACA/c,IAAAA,QAAQ,CAACJ,gBAAT,CAA2B,qBAA3B,EAAkDmd,kBAAlD,EAAsE,KAAtE;AACA/c,IAAAA,QAAQ,CAACJ,gBAAT,CAA2B,oBAA3B,EAAiDmd,kBAAjD,EAAqE,KAArE;AAEA1B,IAAAA,IAAI,GAAG,KAAKI,gBAAL,CAAuB;AAE1BjU,MAAAA,KAAK,EAAE;AAEHkU,QAAAA,eAAe,EAAE,UAAUje,SAAS,CAACG,eAApB,GAAsC;AAFpD,OAFmB;AAQ1B0d,MAAAA,KAAK,EAAEA;AARmB,KAAvB,CAAP,CA9EgC,CA0FhC;;AACA,QAAK,CAACtb,QAAQ,CAACgd,aAAT,CAAwBhB,YAAxB,CAAN,EAA+C;AAC3C,YAAMiB,KAAK,GAAGjd,QAAQ,CAACqH,aAAT,CAAwB,OAAxB,CAAd;AACA4V,MAAAA,KAAK,CAACC,EAAN,GAAWlB,YAAX;AACAiB,MAAAA,KAAK,CAACE,SAAN,GAAkB,0EAAlB;AACAnd,MAAAA,QAAQ,CAACod,IAAT,CAAc/G,WAAd,CAA2B4G,KAA3B;AACH;;AAED,WAAO5B,IAAP;AAEH,GAtbyE;;AAwb1E;;;;;;AAMAD,EAAAA,kBAAkB,EAAE,YAAY;AAE5B,UAAMC,IAAI,GAAGrb,QAAQ,CAACqH,aAAT,CAAwB,MAAxB,CAAb;AACAgU,IAAAA,IAAI,CAAC7T,KAAL,CAAWM,OAAX,GAAqB,MAArB;;AACAuT,IAAAA,IAAI,CAACtP,IAAL,GAAY,YAAY;AAEpBsP,MAAAA,IAAI,CAAC7T,KAAL,CAAWM,OAAX,GAAqB,EAArB;AAEH,KAJD;;AAMAuT,IAAAA,IAAI,CAACpP,IAAL,GAAY,YAAY;AAEpBoP,MAAAA,IAAI,CAAC7T,KAAL,CAAWM,OAAX,GAAqB,MAArB;AACAuT,MAAAA,IAAI,CAACgC,aAAL,CAAmBC,MAAnB,GAA4B,IAA5B;AACAjC,MAAAA,IAAI,CAACgC,aAAL,CAAmB/R,MAAnB;AAEH,KAND;;AAQA+P,IAAAA,IAAI,CAACgC,aAAL,GAAqB,KAAKE,wBAAL,EAArB;AACAlC,IAAAA,IAAI,CAACmC,OAAL,GAAe,KAAKC,yBAAL,EAAf;AAEApC,IAAAA,IAAI,CAAChF,WAAL,CAAkBgF,IAAI,CAACgC,aAAvB;AACAhC,IAAAA,IAAI,CAAChF,WAAL,CAAkBgF,IAAI,CAACmC,OAAvB;;AAEAnC,IAAAA,IAAI,CAAC1C,OAAL,GAAe,YAAY;AAEvB0C,MAAAA,IAAI,CAAC7C,WAAL,CAAkB6C,IAAI,CAACgC,aAAvB;AACAhC,MAAAA,IAAI,CAAC7C,WAAL,CAAkB6C,IAAI,CAACmC,OAAvB;AAEAnC,MAAAA,IAAI,CAACgC,aAAL,CAAmB1E,OAAnB;AACA0C,MAAAA,IAAI,CAACgC,aAAL,GAAqB,IAArB;AAEAhC,MAAAA,IAAI,CAACmC,OAAL,CAAa7E,OAAb;AACA0C,MAAAA,IAAI,CAACmC,OAAL,GAAe,IAAf;AAEH,KAXD;;AAaA,SAAK5d,gBAAL,CAAuB,oBAAvB,EAA6Cyb,IAAI,CAACtP,IAAlD;AACA,SAAKnM,gBAAL,CAAuB,oBAAvB,EAA6Cyb,IAAI,CAACpP,IAAlD;AAEA,WAAOoP,IAAP;AAEH,GAxeyE;;AA0e1E;;;;;;;AAOAkC,EAAAA,wBAAwB,EAAE,YAAY;AAElC,UAAMzD,KAAK,GAAG,IAAd;;AAEA,aAASwB,KAAT,CAAiBta,KAAjB,EAAyB;AAErBA,MAAAA,KAAK,CAACmY,cAAN;AACAnY,MAAAA,KAAK,CAACoY,eAAN;AAEA;;;;;;;AAMAU,MAAAA,KAAK,CAACjT,aAAN,CAAqB;AAAEjC,QAAAA,IAAI,EAAE,yBAAR;AAAmC6T,QAAAA,MAAM,EAAE,iBAA3C;AAA8DtC,QAAAA,IAAI,EAAE,CAAC,KAAKmH;AAA1E,OAArB;AAEA,WAAKA,MAAL,GAAc,CAAC,KAAKA,MAApB;AAEAjC,MAAAA,IAAI,CAAC/P,MAAL;AAEH;;AACD,UAAM+P,IAAI,GAAG,KAAKI,gBAAL,CAAuB;AAEhCjU,MAAAA,KAAK,EAAE;AAEH2S,QAAAA,KAAK,EAAE,MAFJ;AAGHuB,QAAAA,eAAe,EAAE,UAAUje,SAAS,CAACK,SAApB,GAAgC;AAH9C,OAFyB;AAShCwd,MAAAA,KAAK,EAAEA;AATyB,KAAvB,CAAb;AAaAD,IAAAA,IAAI,CAACiC,MAAL,GAAc,IAAd;;AAEAjC,IAAAA,IAAI,CAAC/P,MAAL,GAAc,UAAWgS,MAAX,EAAoB;AAE9B,WAAKA,MAAL,GAAcA,MAAM,KAAKhe,SAAX,GAAuBge,MAAvB,GAAgC,KAAKA,MAAnD;AAEA,WAAK9V,KAAL,CAAWkU,eAAX,GAA6B,WAAY,KAAK4B,MAAL,GACnC7f,SAAS,CAACK,SADyB,GAEnCL,SAAS,CAACM,UAFa,IAEE,IAF/B;AAIH,KARD;;AAUA,WAAOsd,IAAP;AAEH,GAliByE;;AAoiB1E;;;;;;;AAOAoC,EAAAA,yBAAyB,EAAE,YAAY;AAEnC,QAAI3D,KAAK,GAAG,IAAZ;AAAA,QAAkBuB,IAAlB;AAAA,QAAwBqC,eAAxB;AAAA,QAAyCC,sBAAzC;AAAA,QACIC,UAAU,GAAG,KADjB;AAAA,QACwBC,MADxB;AAAA,QACgCC,aADhC;AAAA,QAC+CC,cAD/C;AAGAL,IAAAA,eAAe,GAAG1d,QAAQ,CAACqH,aAAT,CAAwB,KAAxB,CAAlB;AACAqW,IAAAA,eAAe,CAAClW,KAAhB,CAAsB7E,KAAtB,GAA8B,IAA9B;AACA+a,IAAAA,eAAe,CAAClW,KAAhB,CAAsB3E,MAAtB,GAA+B,MAA/B;AACA6a,IAAAA,eAAe,CAAClW,KAAhB,CAAsBwW,eAAtB,GAAwC,MAAxC;AAEAL,IAAAA,sBAAsB,GAAG3d,QAAQ,CAACqH,aAAT,CAAwB,KAAxB,CAAzB;AACAsW,IAAAA,sBAAsB,CAACnW,KAAvB,CAA6B2S,KAA7B,GAAqC,OAArC;AACAwD,IAAAA,sBAAsB,CAACnW,KAAvB,CAA6B7E,KAA7B,GAAqC,MAArC;AACAgb,IAAAA,sBAAsB,CAACnW,KAAvB,CAA6B3E,MAA7B,GAAsC,MAAtC;AACA8a,IAAAA,sBAAsB,CAACnW,KAAvB,CAA6BkQ,SAA7B,GAAyC,sBAAzC;AACAiG,IAAAA,sBAAsB,CAACnW,KAAvB,CAA6ByW,YAA7B,GAA4C,KAA5C;AACAN,IAAAA,sBAAsB,CAACnW,KAAvB,CAA6BwW,eAA7B,GAA+C,MAA/C;AAEAL,IAAAA,sBAAsB,CAAC/d,gBAAvB,CAAyC,WAAzC,EAAsDse,WAAtD,EAAmE;AAAEC,MAAAA,OAAO,EAAE;AAAX,KAAnE;AACAR,IAAAA,sBAAsB,CAAC/d,gBAAvB,CAAyC,YAAzC,EAAuDse,WAAvD,EAAqE;AAAEC,MAAAA,OAAO,EAAE;AAAX,KAArE;;AAEA,aAASD,WAAT,CAAuBld,KAAvB,EAA+B;AAE3BA,MAAAA,KAAK,CAACoY,eAAN;AAEAwE,MAAAA,UAAU,GAAG,IAAb;AAEAC,MAAAA,MAAM,GAAG7c,KAAK,CAAC2V,OAAN,IAAmB3V,KAAK,CAACod,cAAN,IAAwBpd,KAAK,CAACod,cAAN,CAAqB,CAArB,EAAwBzH,OAA5E;AAEAmH,MAAAA,aAAa,GAAGO,QAAQ,CAAEX,eAAe,CAAClW,KAAhB,CAAsB7E,KAAxB,CAAR,GAA0C,GAA1D;AAEA2b,MAAAA,mBAAmB;AACtB;;AAED,aAASC,kBAAT,CAA8Bvd,KAA9B,EAAsC;AAElC,UAAI4c,UAAJ,EAAgB;AAEZ,cAAMjH,OAAO,GAAG3V,KAAK,CAAC2V,OAAN,IAAmB3V,KAAK,CAACod,cAAN,IAAwBpd,KAAK,CAACod,cAAN,CAAqB,CAArB,EAAwBzH,OAAnF;AAEAoH,QAAAA,cAAc,GAAG,CAAEpH,OAAO,GAAGkH,MAAZ,IAAuBxC,IAAI,CAACpT,WAA7C;AAEA8V,QAAAA,cAAc,GAAGD,aAAa,GAAGC,cAAjC;AAEAA,QAAAA,cAAc,GAAGA,cAAc,GAAG,CAAjB,GAAqB,CAArB,GAA6BA,cAAc,GAAG,CAAnB,GAAyB,CAAzB,GAA6BA,cAAzE;AAEA1C,QAAAA,IAAI,CAACmD,WAAL,CAAmBT,cAAnB;AAEA;;;;;;;;AAOAjE,QAAAA,KAAK,CAACjT,aAAN,CAAqB;AAAEjC,UAAAA,IAAI,EAAE,yBAAR;AAAmC6T,UAAAA,MAAM,EAAE,qBAA3C;AAAkEtC,UAAAA,IAAI,EAAE4H;AAAxE,SAArB;AAEH;AAEJ;;AAED,aAASU,kBAAT,CAA8Bzd,KAA9B,EAAsC;AAElCA,MAAAA,KAAK,CAACoY,eAAN;AAEAwE,MAAAA,UAAU,GAAG,KAAb;AAEAc,MAAAA,sBAAsB;AAEzB;;AAED,aAASJ,mBAAT,GAAgC;AAE5BxE,MAAAA,KAAK,CAAC3W,SAAN,CAAgBvD,gBAAhB,CAAkC,WAAlC,EAA+C2e,kBAA/C,EAAmE;AAAEJ,QAAAA,OAAO,EAAE;AAAX,OAAnE;AACArE,MAAAA,KAAK,CAAC3W,SAAN,CAAgBvD,gBAAhB,CAAkC,SAAlC,EAA6C6e,kBAA7C,EAAiE;AAAEN,QAAAA,OAAO,EAAE;AAAX,OAAjE;AACArE,MAAAA,KAAK,CAAC3W,SAAN,CAAgBvD,gBAAhB,CAAkC,WAAlC,EAA+C2e,kBAA/C,EAAmE;AAAEJ,QAAAA,OAAO,EAAE;AAAX,OAAnE;AACArE,MAAAA,KAAK,CAAC3W,SAAN,CAAgBvD,gBAAhB,CAAkC,UAAlC,EAA8C6e,kBAA9C,EAAkE;AAAEN,QAAAA,OAAO,EAAE;AAAX,OAAlE;AAGH;;AAED,aAASO,sBAAT,GAAmC;AAE/B5E,MAAAA,KAAK,CAAC3W,SAAN,CAAgBoD,mBAAhB,CAAqC,WAArC,EAAkDgY,kBAAlD,EAAsE,KAAtE;AACAzE,MAAAA,KAAK,CAAC3W,SAAN,CAAgBoD,mBAAhB,CAAqC,SAArC,EAAgDkY,kBAAhD,EAAoE,KAApE;AACA3E,MAAAA,KAAK,CAAC3W,SAAN,CAAgBoD,mBAAhB,CAAqC,WAArC,EAAkDgY,kBAAlD,EAAsE,KAAtE;AACAzE,MAAAA,KAAK,CAAC3W,SAAN,CAAgBoD,mBAAhB,CAAqC,UAArC,EAAiDkY,kBAAjD,EAAqE,KAArE;AAEH;;AAED,aAASnD,KAAT,CAAiBta,KAAjB,EAAyB;AAErBA,MAAAA,KAAK,CAACmY,cAAN;AACAnY,MAAAA,KAAK,CAACoY,eAAN;;AAEA,UAAKpY,KAAK,CAAC2d,MAAN,KAAiBhB,sBAAtB,EAA+C;AAAE;AAAS;;AAE1D,YAAMiB,UAAU,GAAK5d,KAAK,CAACod,cAAN,IAAwBpd,KAAK,CAACod,cAAN,CAAqBla,MAArB,GAA8B,CAAxD,GACb,CAAElD,KAAK,CAACod,cAAN,CAAqB,CAArB,EAAwBS,KAAxB,GAAgC7d,KAAK,CAAC2d,MAAN,CAAaG,qBAAb,GAAqCnX,IAAvE,IAAgF,KAAKM,WADxE,GAEbjH,KAAK,CAAC+d,OAAN,GAAgB,KAAK9W,WAF3B;AAIA;;;;;;;AAMA6R,MAAAA,KAAK,CAACjT,aAAN,CAAqB;AAAEjC,QAAAA,IAAI,EAAE,yBAAR;AAAmC6T,QAAAA,MAAM,EAAE,qBAA3C;AAAkEtC,QAAAA,IAAI,EAAEyI;AAAxE,OAArB;AAEAvD,MAAAA,IAAI,CAACmD,WAAL,CAAkBxd,KAAK,CAAC+d,OAAN,GAAgB,KAAK9W,WAAvC;AAEH;;AACD,aAAS+W,SAAT,GAAsB;AAElBN,MAAAA,sBAAsB;AACtBhB,MAAAA,eAAe,GAAG,IAAlB;AACAC,MAAAA,sBAAsB,GAAG,IAAzB;AAEH;;AAEDD,IAAAA,eAAe,CAACrH,WAAhB,CAA6BsH,sBAA7B;AAEAtC,IAAAA,IAAI,GAAG,KAAKI,gBAAL,CAAuB;AAE1BjU,MAAAA,KAAK,EAAE;AAEH2S,QAAAA,KAAK,EAAE,MAFJ;AAGHxX,QAAAA,KAAK,EAAE,KAHJ;AAIHE,QAAAA,MAAM,EAAE,KAJL;AAKHoc,QAAAA,SAAS,EAAE,MALR;AAMHjB,QAAAA,eAAe,EAAE;AANd,OAFmB;AAY1B1C,MAAAA,KAAK,EAAEA,KAZmB;AAa1B0D,MAAAA,SAAS,EAAEA;AAbe,KAAvB,CAAP;AAiBA3D,IAAAA,IAAI,CAAChF,WAAL,CAAkBqH,eAAlB;;AAEArC,IAAAA,IAAI,CAACmD,WAAL,GAAmB,UAAUI,UAAV,EAAuB;AAEtClB,MAAAA,eAAe,CAAClW,KAAhB,CAAsB7E,KAAtB,GAA8Bic,UAAU,GAAG,GAAb,GAAmB,GAAjD;AAEH,KAJD;;AAMA,SAAKhf,gBAAL,CAAuB,cAAvB,EAAuC,UAAWoB,KAAX,EAAmB;AAEtDqa,MAAAA,IAAI,CAACmD,WAAL,CAAkBxd,KAAK,CAAC4d,UAAxB;AAEH,KAJD;AAMAvD,IAAAA,IAAI,CAACqC,eAAL,GAAuBA,eAAvB;AACArC,IAAAA,IAAI,CAACsC,sBAAL,GAA8BA,sBAA9B;AAEA,WAAOtC,IAAP;AAEH,GAzsByE;;AA2sB1E;;;;;;;AAOA6D,EAAAA,cAAc,EAAE,UAAWpE,KAAX,EAAmB;AAE/B,UAAMhB,KAAK,GAAG,IAAd;AACA,UAAMuB,IAAI,GAAGrb,QAAQ,CAACqH,aAAT,CAAwB,GAAxB,CAAb;AACAgU,IAAAA,IAAI,CAACxD,WAAL,GAAmBiD,KAAnB;AACAO,IAAAA,IAAI,CAAC7T,KAAL,CAAWM,OAAX,GAAqB,OAArB;AACAuT,IAAAA,IAAI,CAAC7T,KAAL,CAAW2X,OAAX,GAAqB,MAArB;AACA9D,IAAAA,IAAI,CAAC7T,KAAL,CAAW4X,cAAX,GAA4B,MAA5B;AACA/D,IAAAA,IAAI,CAAC7T,KAAL,CAAWiP,MAAX,GAAoB,SAApB;AACA4E,IAAAA,IAAI,CAAC7T,KAAL,CAAW6S,aAAX,GAA2B,MAA3B;AACAgB,IAAAA,IAAI,CAAC7T,KAAL,CAAW4S,UAAX,GAAwB,KAAKrB,kBAA7B;;AAEAsC,IAAAA,IAAI,CAACgE,KAAL,GAAa,UAAWxI,KAAX,EAAmB;AAE5B,WAAKrP,KAAL,CAAWkQ,SAAX,GAAuB,iBAAkBb,KAAK,GAAG,EAAH,GAAQ,GAA/B,IAAuC,OAA9D;AAEH,KAJD;;AAMAwE,IAAAA,IAAI,CAACiE,OAAL,GAAe,YAAY;AAEvB,WAAK9X,KAAL,CAAWkQ,SAAX,GAAuB,eAAvB;AAEH,KAJD;;AAMA2D,IAAAA,IAAI,CAACkE,OAAL,GAAe,UAAWhhB,GAAX,EAAiB;AAE5B,UAAK,KAAKihB,IAAV,EAAiB;AAEb,aAAKA,IAAL,CAAUhY,KAAV,CAAgBkU,eAAhB,GAAkC,SAASnd,GAAT,GAAe,GAAjD;AAEH;AAEJ,KARD;;AAUA8c,IAAAA,IAAI,CAACoE,iBAAL,GAAyB,UAAW3E,KAAX,EAAmB;AAExC,UAAK,KAAK4E,SAAV,EAAsB;AAElB,aAAKA,SAAL,CAAe7H,WAAf,GAA6BiD,KAA7B;AAEH;AAEJ,KARD;;AAUAO,IAAAA,IAAI,CAACsE,YAAL,GAAoB,UAAW1E,IAAX,EAAkB;AAElC,YAAMyE,SAAS,GAAG1f,QAAQ,CAACqH,aAAT,CAAwB,MAAxB,CAAlB;AACAqY,MAAAA,SAAS,CAAClY,KAAV,CAAgBoY,QAAhB,GAA2B,MAA3B;AACAF,MAAAA,SAAS,CAAClY,KAAV,CAAgBqY,UAAhB,GAA6B,KAA7B;AACAH,MAAAA,SAAS,CAAClY,KAAV,CAAgB2S,KAAhB,GAAwB,OAAxB;AAEA,WAAKuF,SAAL,GAAiBA,SAAjB;AACA,WAAKD,iBAAL,CAAwBxE,IAAxB;AACA,WAAK5E,WAAL,CAAkBqJ,SAAlB;AAEA,aAAO,IAAP;AAEH,KAbD;;AAeArE,IAAAA,IAAI,CAACyE,OAAL,GAAe,UAAWvhB,GAAG,GAAGd,SAAS,CAACS,YAA3B,EAAyCyJ,IAAI,GAAG,KAAhD,EAAuDoY,IAAI,GAAG,KAA9D,EAAsE;AAEjF,YAAM1c,OAAO,GAAGrD,QAAQ,CAACqH,aAAT,CAAwB,MAAxB,CAAhB;AACAhE,MAAAA,OAAO,CAACmE,KAAR,CAAc2S,KAAd,GAAsBxS,IAAI,GAAG,MAAH,GAAY,OAAtC;AACAtE,MAAAA,OAAO,CAACmE,KAAR,CAAc7E,KAAd,GAAsB,MAAtB;AACAU,MAAAA,OAAO,CAACmE,KAAR,CAAc3E,MAAd,GAAuB,MAAvB;AACAQ,MAAAA,OAAO,CAACmE,KAAR,CAAe,YAAaG,IAAI,GAAG,OAAH,GAAa,MAA9B,CAAf,IAA0D,MAA1D;AACAtE,MAAAA,OAAO,CAACmE,KAAR,CAAcwY,cAAd,GAA+B,OAA/B;;AAEA,UAAKD,IAAL,EAAY;AAER1c,QAAAA,OAAO,CAACmE,KAAR,CAAckQ,SAAd,GAA0B,iBAA1B;AAEH;;AAED,WAAK8H,IAAL,GAAYnc,OAAZ;AACA,WAAKkc,OAAL,CAAchhB,GAAd;AACA,WAAK8X,WAAL,CAAkBhT,OAAlB;AAEA,aAAO,IAAP;AAEH,KArBD;;AAuBAgY,IAAAA,IAAI,CAAC4E,UAAL,GAAkB,UAAWnF,KAAX,EAAkBoF,KAAlB,EAA0B;AAExC,WAAKnF,OAAL,GAAejB,KAAK,CAACqG,aAAN,CAAqBrF,KAArB,EAA4BoF,KAA5B,CAAf;AAEA,aAAO,IAAP;AAEH,KAND;;AAQA7E,IAAAA,IAAI,CAACzb,gBAAL,CAAuB,YAAvB,EAAqC,YAAY;AAE7C,WAAK4H,KAAL,CAAWwW,eAAX,GAA6B,SAA7B;AAEH,KAJD,EAIG,KAJH;AAMA3C,IAAAA,IAAI,CAACzb,gBAAL,CAAuB,YAAvB,EAAqC,YAAY;AAE7C,WAAK4H,KAAL,CAAWwW,eAAX,GAA6B,SAA7B;AAEH,KAJD,EAIG,KAJH;AAMA,WAAO3C,IAAP;AAEH,GA1zByE;;AA4zB1E;;;;;;;AAOA+E,EAAAA,oBAAoB,EAAE,UAAWtF,KAAX,EAAmB;AAErC,UAAMuF,MAAM,GAAG,KAAKnB,cAAL,CAAqBpE,KAArB,CAAf;AAEAuF,IAAAA,MAAM,CAAC7Y,KAAP,CAAa8Y,YAAb,GAA4B,gBAA5B;AACAD,IAAAA,MAAM,CAAC7Y,KAAP,CAAa+Y,aAAb,GAA6B,MAA7B;AAEA,WAAOF,MAAP;AAEH,GA50ByE;;AA80B1E;;;;;;;AAOA3F,EAAAA,cAAc,EAAE,UAAW8F,KAAX,EAAmB;AAE/B,QAAI1G,KAAK,GAAG,IAAZ;AAAA,QAAkBU,IAAI,GAAG,KAAKiG,UAAL,EAAzB;AAEAjG,IAAAA,IAAI,CAAC1D,MAAL,GAAc,GAAd;AACA0D,IAAAA,IAAI,CAACoB,UAAL,CAAiBpB,IAAI,CAAC1D,MAAtB;;AAEA,aAASwE,KAAT,CAAiBta,KAAjB,EAAyB;AAErBA,MAAAA,KAAK,CAACmY,cAAN;AACAnY,MAAAA,KAAK,CAACoY,eAAN;AAEA,UAAIK,QAAQ,GAAGK,KAAK,CAACL,QAArB;AAAA,UAA+BsB,OAAO,GAAG,KAAKA,OAA9C;;AAEA,eAAS2F,UAAT,GAAuB;AAEnBjH,QAAAA,QAAQ,CAACmC,UAAT,CAAqBb,OAAO,CAAC9S,WAA7B;AACA8S,QAAAA,OAAO,CAAChP,IAAR;AACAgP,QAAAA,OAAO,CAACc,UAAR;AAEH;;AAEDpC,MAAAA,QAAQ,CAACxN,IAAT;AACAwN,MAAAA,QAAQ,CAACkH,QAAT;AACAlH,MAAAA,QAAQ,CAACmH,aAAT,CAAuBvK,WAAvB,CAAoC0E,OAApC;AAEAjB,MAAAA,KAAK,CAACJ,cAAN,GAAuB,IAAvB;AACAI,MAAAA,KAAK,CAACH,aAAN,GAAsBoB,OAAtB;AAEAlb,MAAAA,MAAM,CAAC0L,qBAAP,CAA8BmV,UAA9B;AAEH;;AACD,SAAM,IAAIpe,CAAC,GAAG,CAAd,EAAiBA,CAAC,GAAGke,KAAK,CAACtc,MAA3B,EAAmC5B,CAAC,EAApC,EAAyC;AAErC,UAAI+Y,IAAI,GAAGb,IAAI,CAACqG,OAAL,CAAcL,KAAK,CAAEle,CAAF,CAAL,CAAWwY,KAAzB,CAAX;AAEAO,MAAAA,IAAI,CAAC7T,KAAL,CAAWsZ,WAAX,GAAyB,MAAzB;AAEAzF,MAAAA,IAAI,CAACyE,OAAL,GACKlgB,gBADL,CACuBka,KAAK,CAACd,aAAN,GAAsB,UAAtB,GAAmC,OAD1D,EACmEsC,KADnE,EAC0E,KAD1E;;AAGA,UAAKkF,KAAK,CAAEle,CAAF,CAAL,CAAWyY,OAAX,IAAsByF,KAAK,CAAEle,CAAF,CAAL,CAAWyY,OAAX,CAAmB7W,MAAnB,GAA4B,CAAvD,EAA2D;AAEvD,YAAI4W,KAAK,GAAG0F,KAAK,CAAEle,CAAF,CAAL,CAAWyY,OAAX,CAAoB,CAApB,EAAwBD,KAApC;AAEAO,QAAAA,IAAI,CAACsE,YAAL,CAAmB7E,KAAnB,EACKmF,UADL,CACiBO,KAAK,CAAEle,CAAF,CAAL,CAAWwY,KAD5B,EACmC0F,KAAK,CAAEle,CAAF,CAAL,CAAWyY,OAD9C;AAGH;AAEJ;;AAED,WAAOP,IAAP;AAEH,GA34ByE;;AA64B1E;;;;;;;;AAQA2F,EAAAA,aAAa,EAAE,UAAWrF,KAAX,EAAkBoF,KAAlB,EAA0B;AAErC,QAAIpG,KAAK,GAAG,IAAZ;AAAA,QAAkBU,IAAlB;AAAA,QAAwBO,OAAO,GAAG,KAAK0F,UAAL,EAAlC;AAEA1F,IAAAA,OAAO,CAACmF,KAAR,GAAgBA,KAAhB;AACAnF,IAAAA,OAAO,CAACgG,UAAR,GAAqB,IAArB;;AAEA,aAASzF,KAAT,CAAiBta,KAAjB,EAAyB;AAErBA,MAAAA,KAAK,CAACmY,cAAN;AACAnY,MAAAA,KAAK,CAACoY,eAAN;AAEAoB,MAAAA,IAAI,GAAGV,KAAK,CAACL,QAAb;AACAe,MAAAA,IAAI,CAACoB,UAAL,CAAiBpB,IAAI,CAAC1D,MAAtB;AACA0D,MAAAA,IAAI,CAACqB,UAAL;AACArB,MAAAA,IAAI,CAACzO,IAAL;AACAgP,MAAAA,OAAO,CAAC4F,QAAR,CAAkB,IAAlB;AACA5F,MAAAA,OAAO,CAAC9O,IAAR;;AAEA,UAAK,KAAKrH,IAAL,KAAc,QAAnB,EAA8B;AAE1BmW,QAAAA,OAAO,CAACiG,aAAR,CAAuB,IAAvB;AACAlH,QAAAA,KAAK,CAACJ,cAAN,CAAqB+F,iBAArB,CAAwC,KAAK5H,WAA7C;;AAEA,YAAK,KAAKgD,OAAV,EAAoB;AAAE,eAAKA,OAAL;AAAiB;AAE1C;AAEJ;;AAEDE,IAAAA,OAAO,CAACkG,SAAR,CAAmBnG,KAAnB,EAA2BgF,OAA3B,CAAoCxgB,SAApC,EAA+C,IAA/C,EAAqD,IAArD,EAA4DM,gBAA5D,CAA8Eka,KAAK,CAACd,aAAN,GAAsB,UAAtB,GAAmC,OAAjH,EAA0HsC,KAA1H,EAAiI,KAAjI;;AAEA,SAAM,IAAIhZ,CAAC,GAAG,CAAd,EAAiBA,CAAC,GAAG4d,KAAK,CAAChc,MAA3B,EAAmC5B,CAAC,EAApC,EAAyC;AAErC,YAAM+Y,IAAI,GAAGN,OAAO,CAAC8F,OAAR,CAAiBX,KAAK,CAAE5d,CAAF,CAAL,CAAWwY,KAA5B,CAAb;AAEAO,MAAAA,IAAI,CAAC7T,KAAL,CAAWqY,UAAX,GAAwB,GAAxB;AACAxE,MAAAA,IAAI,CAACR,OAAL,GAAeqF,KAAK,CAAE5d,CAAF,CAAL,CAAWuY,OAA1B;AACAQ,MAAAA,IAAI,CAACyE,OAAL,CAAc,GAAd,EAAmB,IAAnB;AACAzE,MAAAA,IAAI,CAACzb,gBAAL,CAAuBka,KAAK,CAACd,aAAN,GAAsB,UAAtB,GAAmC,OAA1D,EAAmEsC,KAAnE,EAA0E,KAA1E;;AAEA,UAAK,CAACP,OAAO,CAACgG,UAAd,EAA2B;AAEvBhG,QAAAA,OAAO,CAACiG,aAAR,CAAuB3F,IAAvB;AAEH;AAEJ;;AAEDN,IAAAA,OAAO,CAAC4F,QAAR,CAAkB,IAAlB;AAEA,WAAO5F,OAAP;AAEH,GA18ByE;;AA48B1E;;;;;;AAMA0F,EAAAA,UAAU,EAAE,YAAY;AAEpB,UAAM3G,KAAK,GAAG,IAAd;AACA,UAAMU,IAAI,GAAGxa,QAAQ,CAACqH,aAAT,CAAwB,MAAxB,CAAb;AACA,UAAMG,KAAK,GAAGgT,IAAI,CAAChT,KAAnB;AAEAA,IAAAA,KAAK,CAAC2X,OAAN,GAAgB,OAAhB;AACA3X,IAAAA,KAAK,CAACC,QAAN,GAAiB,OAAjB;AACAD,IAAAA,KAAK,CAAC0Z,MAAN,GAAe,MAAf;AACA1Z,IAAAA,KAAK,CAACqP,KAAN,GAAc,MAAd;AACArP,IAAAA,KAAK,CAACwW,eAAN,GAAwB,SAAxB;AACAxW,IAAAA,KAAK,CAAC2Q,UAAN,GAAmB,gBAAnB;AACA3Q,IAAAA,KAAK,CAACoY,QAAN,GAAiB,MAAjB;AACApY,IAAAA,KAAK,CAAC2Z,UAAN,GAAmB,QAAnB;AACA3Z,IAAAA,KAAK,CAACiE,OAAN,GAAgB,CAAhB;AACAjE,IAAAA,KAAK,CAAC4Z,SAAN,GAAkB,2BAAlB;AACA5Z,IAAAA,KAAK,CAACyW,YAAN,GAAqB,KAArB;AACAzW,IAAAA,KAAK,CAAC6Z,QAAN,GAAiB,QAAjB;AACA7Z,IAAAA,KAAK,CAAC8Z,UAAN,GAAmB,wBAAnB;AACA9Z,IAAAA,KAAK,CAAC6S,aAAN,GAAsB,MAAtB;AACA7S,IAAAA,KAAK,CAAC4S,UAAN,GAAmB,KAAKrB,kBAAxB;AAEAyB,IAAAA,IAAI,CAACxO,OAAL,GAAe,KAAf;;AAEAwO,IAAAA,IAAI,CAACoB,UAAL,GAAkB,UAAWjZ,KAAX,EAAkBE,MAAlB,EAA2B;AAEzC,UAAKF,KAAL,EAAa;AAET,aAAK6E,KAAL,CAAW7E,KAAX,GAAmBA,KAAK,GAAG,IAA3B;AAEH;;AAED,UAAKE,MAAL,EAAc;AAEV,aAAK2E,KAAL,CAAW3E,MAAX,GAAoBA,MAAM,GAAG,IAA7B;AAEH;AAEJ,KAdD;;AAgBA2X,IAAAA,IAAI,CAACzO,IAAL,GAAY,YAAY;AAEpB,WAAKvE,KAAL,CAAWiE,OAAX,GAAqB,CAArB;AACA,WAAKjE,KAAL,CAAW2Z,UAAX,GAAwB,SAAxB;AACA,WAAKnV,OAAL,GAAe,IAAf;AAEH,KAND;;AAQAwO,IAAAA,IAAI,CAACvO,IAAL,GAAY,YAAY;AAEpB,WAAKzE,KAAL,CAAWiE,OAAX,GAAqB,CAArB;AACA,WAAKjE,KAAL,CAAW2Z,UAAX,GAAwB,QAAxB;AACA,WAAKnV,OAAL,GAAe,KAAf;AAEH,KAND;;AAQAwO,IAAAA,IAAI,CAACD,MAAL,GAAc,YAAY;AAEtB,UAAK,KAAKvO,OAAV,EAAoB;AAEhB,aAAKC,IAAL;AAEH,OAJD,MAIO;AAEH,aAAKF,IAAL;AAEH;AAEJ,KAZD;;AAcAyO,IAAAA,IAAI,CAACmG,QAAL,GAAgB,UAAW9J,KAAX,EAAmB;AAE/B,WAAM,IAAIvU,CAAC,GAAG,CAAd,EAAiBA,CAAC,GAAGkY,IAAI,CAAC+G,QAAL,CAAcrd,MAAnC,EAA2C5B,CAAC,EAA5C,EAAgD;AAE5C,YAAKkY,IAAI,CAAC+G,QAAL,CAAejf,CAAf,EAAmB+c,KAAxB,EAAgC;AAE5B7E,UAAAA,IAAI,CAAC+G,QAAL,CAAejf,CAAf,EAAmB+c,KAAnB,CAA0BxI,KAA1B;AAEH;AAEJ;AAEJ,KAZD;;AAcA2D,IAAAA,IAAI,CAACqB,UAAL,GAAkB,YAAY;AAE1B,WAAM,IAAIvZ,CAAC,GAAG,CAAd,EAAiBA,CAAC,GAAGkY,IAAI,CAAC+G,QAAL,CAAcrd,MAAnC,EAA2C5B,CAAC,EAA5C,EAAgD;AAE5C,YAAKkY,IAAI,CAAC+G,QAAL,CAAejf,CAAf,EAAmBgd,OAAxB,EAAkC;AAE9B9E,UAAAA,IAAI,CAAC+G,QAAL,CAAejf,CAAf,EAAmBgd,OAAnB;AAEH;AAEJ;AAEJ,KAZD;;AAcA9E,IAAAA,IAAI,CAACyG,SAAL,GAAiB,UAAWnG,KAAX,EAAmB;AAEhC,YAAMuF,MAAM,GAAGvG,KAAK,CAACsG,oBAAN,CAA4BtF,KAA5B,CAAf;AACAuF,MAAAA,MAAM,CAACzb,IAAP,GAAc,QAAd;AAEA,WAAKyR,WAAL,CAAkBgK,MAAlB;AAEA,aAAOA,MAAP;AAEH,KATD;;AAWA7F,IAAAA,IAAI,CAACqG,OAAL,GAAe,UAAW/F,KAAX,EAAmB;AAE9B,YAAMO,IAAI,GAAGvB,KAAK,CAACoF,cAAN,CAAsBpE,KAAtB,CAAb;AACAO,MAAAA,IAAI,CAACzW,IAAL,GAAY,MAAZ;AAEA,WAAKyR,WAAL,CAAkBgF,IAAlB;AAEA,aAAOA,IAAP;AAEH,KATD;;AAWAb,IAAAA,IAAI,CAACwG,aAAL,GAAqB,UAAW3F,IAAX,EAAkB;AAEnC,UAAK,KAAK0F,UAAV,EAAuB;AAEnB,aAAKA,UAAL,CAAgBxB,OAAhB,CAAyB,GAAzB;AAEH;;AAEDlE,MAAAA,IAAI,CAACkE,OAAL,CAAc9hB,SAAS,CAACU,KAAxB;AAEA,WAAK4iB,UAAL,GAAkB1F,IAAlB;AAEH,KAZD;;AAcAb,IAAAA,IAAI,CAAC5a,gBAAL,CAAuB,WAAvB,EAAoC,KAAKsZ,qBAAzC,EAAgE,IAAhE;AACAsB,IAAAA,IAAI,CAAC5a,gBAAL,CAAuB,SAAvB,EAAkC,KAAKsZ,qBAAvC,EAA8D,IAA9D;AACAsB,IAAAA,IAAI,CAAC5a,gBAAL,CAAuB,WAAvB,EAAoC,KAAKsZ,qBAAzC,EAAgE,IAAhE;AAEA,WAAOsB,IAAP;AAEH,GA9lCyE;;AAgmC1E;;;;;;AAMAiB,EAAAA,gBAAgB,EAAE,UAAW+F,OAAO,GAAG,EAArB,EAA0B;AAExC,UAAM1H,KAAK,GAAG,IAAd;AACA,UAAMuB,IAAI,GAAGmG,OAAO,CAACne,OAAR,IAAmBrD,QAAQ,CAACqH,aAAT,CAAwB,MAAxB,CAAhC;AACA,UAAM;AAAE2X,MAAAA;AAAF,QAAgBwC,OAAtB;AAEAnG,IAAAA,IAAI,CAAC7T,KAAL,CAAWiP,MAAX,GAAoB,SAApB;AACA4E,IAAAA,IAAI,CAAC7T,KAAL,CAAW2S,KAAX,GAAmB,OAAnB;AACAkB,IAAAA,IAAI,CAAC7T,KAAL,CAAW7E,KAAX,GAAmB,MAAnB;AACA0Y,IAAAA,IAAI,CAAC7T,KAAL,CAAW3E,MAAX,GAAoB,MAApB;AACAwY,IAAAA,IAAI,CAAC7T,KAAL,CAAWwY,cAAX,GAA4B,KAA5B;AACA3E,IAAAA,IAAI,CAAC7T,KAAL,CAAWia,gBAAX,GAA8B,WAA9B;AACApG,IAAAA,IAAI,CAAC7T,KAAL,CAAWka,kBAAX,GAAgC,QAAhC;AACArG,IAAAA,IAAI,CAAC7T,KAAL,CAAWma,gBAAX,GACNtG,IAAI,CAAC7T,KAAL,CAAWoa,aAAX,GACAvG,IAAI,CAAC7T,KAAL,CAAWqa,UAAX,GAAwB,MAFlB;AAGAxG,IAAAA,IAAI,CAAC7T,KAAL,CAAWC,QAAX,GAAsB,UAAtB;AACA4T,IAAAA,IAAI,CAAC7T,KAAL,CAAW6S,aAAX,GAA2B,MAA3B,CAjBwC,CAmBxC;;AACAgB,IAAAA,IAAI,CAACzb,gBAAL,CAAuBka,KAAK,CAACd,aAAN,GAAsB,YAAtB,GAAqC,YAA5D,EAA0E,YAAW;AACjFqC,MAAAA,IAAI,CAAC7T,KAAL,CAAWtC,MAAX,GACTmW,IAAI,CAAC7T,KAAL,CAAWsa,YAAX,GAA0B,0CADjB;AAEH,KAHD,EAGG;AAAE3D,MAAAA,OAAO,EAAE;AAAX,KAHH;AAIA9C,IAAAA,IAAI,CAACzb,gBAAL,CAAuBka,KAAK,CAACd,aAAN,GAAsB,UAAtB,GAAmC,YAA1D,EAAwE,YAAW;AAC/EqC,MAAAA,IAAI,CAAC7T,KAAL,CAAWtC,MAAX,GACTmW,IAAI,CAAC7T,KAAL,CAAWsa,YAAX,GAA0B,EADjB;AAEH,KAHD,EAGG;AAAE3D,MAAAA,OAAO,EAAE;AAAX,KAHH;AAKA,SAAK4D,iBAAL,CAAwB1G,IAAxB,EAA8BmG,OAAO,CAACha,KAAtC;;AAEA,QAAKga,OAAO,CAAClG,KAAb,EAAqB;AAEjBD,MAAAA,IAAI,CAACzb,gBAAL,CAAuBka,KAAK,CAACd,aAAN,GAAsB,UAAtB,GAAmC,OAA1D,EAAmEwI,OAAO,CAAClG,KAA3E,EAAkF,KAAlF;AAEH;;AAEDD,IAAAA,IAAI,CAAC1C,OAAL,GAAe,YAAY;AAEvB0C,MAAAA,IAAI,CAAC9U,mBAAL,CAA0BuT,KAAK,CAACd,aAAN,GAAsB,UAAtB,GAAmC,OAA7D,EAAsEwI,OAAO,CAAClG,KAA9E,EAAqF,KAArF;;AAEA,UAAK0D,SAAL,EAAiB;AAAEwC,QAAAA,OAAO,CAACxC,SAAR;AAAsB;AAE5C,KAND;;AAQA,WAAO3D,IAAP;AAEH,GArpCyE;;AAupC1E;;;;;;;;AAQA0G,EAAAA,iBAAiB,EAAE,UAAW1e,OAAX,EAAoBme,OAAO,GAAG,EAA9B,EAAmC;AAElD,SAAM,IAAIzR,QAAV,IAAsByR,OAAtB,EAA+B;AAE3B,UAAKA,OAAO,CAACpiB,cAAR,CAAwB2Q,QAAxB,CAAL,EAA0C;AAEtC1M,QAAAA,OAAO,CAACmE,KAAR,CAAeuI,QAAf,IAA4ByR,OAAO,CAAEzR,QAAF,CAAnC;AAEH;AAEJ;;AAED,WAAO1M,OAAP;AAEH,GA7qCyE;;AA+qC1E;;;;;AAKAsV,EAAAA,OAAO,EAAE,YAAY;AAEjB,QAAK,KAAKU,UAAV,EAAuB;AACnB,WAAKlW,SAAL,CAAeqV,WAAf,CAA4B,KAAKa,UAAjC;AACA,WAAKA,UAAL,CAAgBV,OAAhB;AACA,WAAKU,UAAL,GAAkB,IAAlB;AAEH;AAEJ;AA7rCyE,CAA3D,CAAnB;AAisCA;;;;;;;AAMA,SAAS2I,QAAT,CAAoBpJ,QAApB,EAA8B5P,QAA9B,EAAyC;AAErC5O,EAAAA,IAAI,CAAC8O,IAAL,CAAW,IAAX,EAAiB0P,QAAjB,EAA2B5P,QAA3B;AAEA,OAAKpE,IAAL,GAAY,UAAZ;AAEA,OAAKqd,eAAL,GAAuB,CAAvB;AACA,OAAKC,gBAAL,GAAwB,CAAxB;AACA,OAAKC,kBAAL,GAA0B,CAA1B;AACA,OAAKC,gBAAL,GAAwB,CAAxB;AACA,OAAKC,qBAAL,GAA6B,CAA7B;AAEA,OAAKC,iBAAL,GAAyB,IAAzB;AAEA,OAAKC,mBAAL,GAA2B,GAA3B;AAEA,OAAKpf,SAAL,GAAiB7D,SAAjB;AAEA,OAAKI,MAAL,GAAc,KAAd;AAEA,OAAK8iB,WAAL,GAAmB,EAAnB;AAEA,OAAKC,iBAAL,GAAyB,KAAzB;AAEA,OAAKC,eAAL,GAAuBpjB,SAAvB;AACA,OAAKqjB,iBAAL,GAAyBrjB,SAAzB;AAEA,OAAK0J,QAAL,CAAcgM,IAAd,GAAqB3a,QAArB;AACA,OAAK2O,QAAL,CAAcyC,OAAd,GAAwB,CAAxB;AAEA,OAAKlC,KAAL,CAAWe,CAAX,IAAgB,CAAC,CAAjB;AACA,OAAKsY,WAAL,GAAmB,CAAC,CAApB;AAEA,OAAKxc,MAAL,GAAc,KAAd;AAEA,OAAKyc,iBAAL,GAAyB,IAAItW,KAAK,CAACA,KAAV,CAAiB,IAAjB,EAAwBoD,EAAxB,CAA4B,EAA5B,EAAgC,KAAK2S,iBAAL,GAAyB,CAAzD,CAAzB;AAEA,OAAK1iB,gBAAL,CAAuB,MAAvB,EAA+B,KAAKkjB,MAAL,CAAYve,IAAZ,CAAkB,IAAlB,CAA/B;AACA,OAAK3E,gBAAL,CAAuB,oBAAvB,EAA6C,KAAKgE,YAAL,CAAkBW,IAAlB,CAAwB,IAAxB,CAA7C;AACA,OAAK3E,gBAAL,CAAuB,OAAvB,EAAgC,KAAKgW,OAAL,CAAarR,IAAb,CAAmB,IAAnB,CAAhC;AAEA,OAAKwe,gBAAL;AAEH;;AAEDf,QAAQ,CAACte,SAAT,GAAqBT,MAAM,CAACC,MAAP,CAAeD,MAAM,CAACU,MAAP,CAAevJ,IAAI,CAACsJ,SAApB,CAAf,EAAgD;AAEjEmG,EAAAA,WAAW,EAAEmY,QAFoD;;AAIjE;;;;;;;;AAQA9hB,EAAAA,GAAG,EAAE,UAAW4N,MAAX,EAAoB;AAErB,QAAIkV,cAAJ;;AAEA,QAAKjS,SAAS,CAAC7M,MAAV,GAAmB,CAAxB,EAA4B;AAExB,WAAM,IAAI5B,CAAC,GAAG,CAAd,EAAiBA,CAAC,GAAGyO,SAAS,CAAC7M,MAA/B,EAAuC5B,CAAC,EAAxC,EAA8C;AAE1C,aAAKpC,GAAL,CAAU6Q,SAAS,CAAEzO,CAAF,CAAnB;AAEH;;AAED,aAAO,IAAP;AAEH,KAdoB,CAgBrB;;;AACA,QAAKwL,MAAM,YAAYsG,QAAvB,EAAkC;AAE9B4O,MAAAA,cAAc,GAAGlV,MAAjB;;AAEA,UAAKA,MAAM,CAACjH,aAAZ,EAA4B;AAExB,cAAM;AAAE1D,UAAAA;AAAF,YAAgB,IAAtB;;AAEA,YAAKA,SAAL,EAAiB;AAAE2K,UAAAA,MAAM,CAACjH,aAAP,CAAsB;AAAEjC,YAAAA,IAAI,EAAE,oBAAR;AAA8BzB,YAAAA;AAA9B,WAAtB;AAAoE;;AAEvF2K,QAAAA,MAAM,CAACjH,aAAP,CAAsB;AAAEjC,UAAAA,IAAI,EAAE,yBAAR;AAAmC6T,UAAAA,MAAM,EAAE,UAAWwK,MAAX,EAAmB/X,QAAnB,EAA6BwF,MAA7B,EAAsC;AAEnG;;;;;;;AAOA,iBAAK7J,aAAL,CAAoB;AAAEjC,cAAAA,IAAI,EAAE,yBAAR;AAAmC6T,cAAAA,MAAM,EAAE,oBAA3C;AAAiEtC,cAAAA,IAAI,EAAE,CAAE8M,MAAF,EAAU/X,QAAV,EAAoBwF,MAApB;AAAvE,aAApB;AAGH,WAZgE,CAY/DnM,IAZ+D,CAYzD,IAZyD;AAA3C,SAAtB;AAaH;AAEJ,KAzBD,MAyBO;AAEH;AACAye,MAAAA,cAAc,GAAG,IAAI1oB,QAAJ,EAAjB;AACA0oB,MAAAA,cAAc,CAACzZ,KAAf,CAAqBe,CAArB,GAAyB,CAAC,CAA1B;AACA0Y,MAAAA,cAAc,CAACE,gBAAf,GAAkC,IAAlC;AACAF,MAAAA,cAAc,CAAC9iB,GAAf,CAAoB4N,MAApB;AAEH;;AAEDxT,IAAAA,QAAQ,CAACoJ,SAAT,CAAmBxD,GAAnB,CAAuBgJ,IAAvB,CAA6B,IAA7B,EAAmC8Z,cAAnC;AAEH,GAlEgE;AAoEjE1kB,EAAAA,IAAI,EAAE,YAAY;AAEd,SAAKE,MAAL;AAEH,GAxEgE;;AA0EjE;;;;;;;AAOAoX,EAAAA,OAAO,EAAE,UAAW5U,KAAX,EAAmB;AAExB,QAAKA,KAAK,CAACmiB,UAAN,IAAoBniB,KAAK,CAACmiB,UAAN,CAAiBjf,MAAjB,KAA4B,CAArD,EAAyD;AAErD,WAAKkf,QAAL,CAAe,UAAWtV,MAAX,EAAoB;AAE/B;;;;;AAKAA,QAAAA,MAAM,CAACjH,aAAP,CAAsB;AAAEjC,UAAAA,IAAI,EAAE;AAAR,SAAtB;AAEH,OATD;AAWH;AAEJ,GAlGgE;;AAoGjE;;;;;;;AAOAhB,EAAAA,YAAY,EAAE,UAAWuS,IAAX,EAAkB;AAE5B,QAAIhT,SAAJ;;AAEA,QAAKgT,IAAI,YAAYC,WAArB,EAAmC;AAE/BjT,MAAAA,SAAS,GAAGgT,IAAZ;AAEH,KAJD,MAIO,IAAKA,IAAI,IAAIA,IAAI,CAAChT,SAAlB,EAA8B;AAEjCA,MAAAA,SAAS,GAAGgT,IAAI,CAAChT,SAAjB;AAEH;;AAED,QAAKA,SAAL,EAAiB;AAEb,WAAKoe,QAAL,CAAc8B,OAAd,CAAuB,UAAWC,KAAX,EAAmB;AAEtC,YAAKA,KAAK,YAAYlP,QAAjB,IAA6BkP,KAAK,CAACzc,aAAxC,EAAwD;AAEpD;;;;;;AAMAyc,UAAAA,KAAK,CAACzc,aAAN,CAAqB;AAAEjC,YAAAA,IAAI,EAAE,oBAAR;AAA8BzB,YAAAA,SAAS,EAAEA;AAAzC,WAArB;AAEH;AAEJ,OAdD;AAgBA,WAAKA,SAAL,GAAiBA,SAAjB;AAEH;AAEJ,GA/IgE;;AAiJjE;;;;;;AAMA3E,EAAAA,MAAM,EAAE,YAAY;AAEhB,SAAKkB,MAAL,GAAc,IAAd;AAEA;;;;;;AAKA,SAAKmH,aAAL,CAAoB;AAAEjC,MAAAA,IAAI,EAAE;AAAR,KAApB;AAEH,GAlKgE;;AAoKjE;;;;;;AAMAnG,EAAAA,UAAU,EAAE,UAAWuD,QAAX,EAAsB;AAE9B;;;;;;AAMA,SAAK6E,aAAL,CAAoB;AAAEjC,MAAAA,IAAI,EAAE,UAAR;AAAoB5C,MAAAA,QAAQ,EAAEA;AAA9B,KAApB;AAEH,GApLgE;;AAsLjE;;;;;;AAMAtD,EAAAA,OAAO,EAAE,YAAY;AAEjB;;;;;AAKA,SAAKmI,aAAL,CAAoB;AAAEjC,MAAAA,IAAI,EAAE;AAAR,KAApB;AAEH,GArMgE;;AAuMjE;;;;;;AAMA2e,EAAAA,YAAY,EAAE,YAAY;AAEtB,QAAIC,SAAJ;;AAEA,QAAK3jB,MAAM,CAAC4jB,UAAP,IAAqB,GAA1B,EAAgC;AAE5BD,MAAAA,SAAS,GAAG,KAAKtB,gBAAjB;AAEH,KAJD,MAIO,IAAKriB,MAAM,CAAC4jB,UAAP,GAAoB,GAApB,IAA4B5jB,MAAM,CAAC4jB,UAAP,IAAqB,IAAtD,EAA6D;AAEhED,MAAAA,SAAS,GAAG,KAAKrB,kBAAjB;AAEH,KAJM,MAIA,IAAKtiB,MAAM,CAAC4jB,UAAP,GAAoB,IAApB,IAA4B5jB,MAAM,CAAC4jB,UAAP,IAAqB,IAAtD,EAA6D;AAEhED,MAAAA,SAAS,GAAG,KAAKpB,gBAAjB;AAEH,KAJM,MAIA,IAAKviB,MAAM,CAAC4jB,UAAP,GAAoB,IAAzB,EAAgC;AAEnCD,MAAAA,SAAS,GAAG,KAAKnB,qBAAjB;AAEH,KAJM,MAIA;AAEHmB,MAAAA,SAAS,GAAG,KAAKvB,eAAjB;AAEH;;AAED,WAAOuB,SAAP;AAEH,GAzOgE;;AA2OjE;;;;;;AAMAE,EAAAA,aAAa,EAAE,UAAWjiB,OAAX,EAAqB;AAEhC,SAAKuH,QAAL,CAAc7G,GAAd,GAAoBV,OAApB;AACA,SAAKuH,QAAL,CAAcnH,WAAd,GAA4B,IAA5B;AAEH,GAtPgE;;AAwPjE;;;;;;;;AAQA8hB,EAAAA,wBAAwB,EAAE,UAAWC,SAAX,EAAsBvT,KAAtB,EAA8B;AAEpDA,IAAAA,KAAK,GAAKA,KAAK,KAAK/Q,SAAZ,GAA0B+Q,KAA1B,GAAkC,CAA1C;AAEA,UAAMrE,OAAO,GAAK4X,SAAS,KAAKtkB,SAAhB,GAA8BskB,SAA9B,GAA4C,KAAKnB,iBAAL,GAAyB,KAAzB,GAAiC,IAA7F;AAEA,SAAKW,QAAL,CAAe,UAAWtV,MAAX,EAAoB;AAE/B,UAAKA,MAAM,YAAYsG,QAAvB,EAAkC;AAE9B,YAAKpI,OAAL,EAAe;AAEX8B,UAAAA,MAAM,CAAC/B,IAAP,CAAasE,KAAb;AAEH,SAJD,MAIO;AAEHvC,UAAAA,MAAM,CAAC7B,IAAP,CAAaoE,KAAb;AAEH;AAEJ;AAEJ,KAhBD;AAkBA,SAAKoS,iBAAL,GAAyBzW,OAAzB,CAxBoD,CA0BpD;;AACA,SAAK6W,iBAAL,CAAuB1R,UAAvB,CAAmC,YAAY;AAE3C;;;;;AAKA,WAAKtK,aAAL,CAAoB;AAAEjC,QAAAA,IAAI,EAAE,6BAAR;AAAuCoH,QAAAA,OAAO,EAAEA;AAAhD,OAApB;AAEH,KATkC,CASjCzH,IATiC,CAS3B,IAT2B,CAAnC,EASiB8L,KATjB,CASwBA,KATxB,EASgC7L,KAThC;AAWH,GAtSgE;;AAwSjE;;;;;;;AAOAqf,EAAAA,eAAe,EAAE,UAAWtlB,GAAX,EAAgBgL,KAAhB,EAAwB;AAErC,SAAKmZ,eAAL,GAAuBnkB,GAAvB;AACA,SAAKokB,iBAAL,GAAyBpZ,KAAzB;AAEH,GApTgE;;AAsTjE;;;;;;;;;AASAua,EAAAA,IAAI,EAAE,UAAWC,IAAX,EAAiBtc,QAAjB,EAA2Buc,UAA3B,EAAuC3P,QAAvC,EAAkD;AAEpD,QAAI9K,KAAJ,EAAW0a,GAAX;AAEA,SAAKjY,OAAL,GAAe,IAAf;;AAEA,QAAK,CAACvE,QAAN,EAAiB;AAEb7B,MAAAA,OAAO,CAACC,IAAR,CAAc,8CAAd;AAEA;AAEH,KAZmD,CAcpD;;;AACA,QAAKme,UAAU,KAAK1kB,SAApB,EAAgC;AAE5BiK,MAAAA,KAAK,GAAGya,UAAR;AAEH,KAJD,MAIO,IAAKD,IAAI,CAACpB,iBAAL,KAA2BrjB,SAAhC,EAA4C;AAE/CiK,MAAAA,KAAK,GAAGwa,IAAI,CAACpB,iBAAb;AAEH,KAJM,MAIA;AAEHpZ,MAAAA,KAAK,GAAG,GAAR;AAEH,KA3BmD,CA8BpD;;;AACA,QAAK8K,QAAL,EAAgB;AAEZ4P,MAAAA,GAAG,GAAG5P,QAAN;AAEH,KAJD,MAIO,IAAK0P,IAAI,CAACrB,eAAV,EAA4B;AAE/BuB,MAAAA,GAAG,GAAGF,IAAI,CAACrB,eAAX;AAEH,KAJM,MAIA;AAEHuB,MAAAA,GAAG,GAAGxmB,SAAS,CAACE,KAAhB;AAEH,KA3CmD,CA6CpD;;;AACA,UAAMumB,IAAI,GAAG,IAAI9P,QAAJ,CAAc7K,KAAd,EAAqB0a,GAArB,CAAb;AACAC,IAAAA,IAAI,CAACzc,QAAL,CAAcsC,IAAd,CAAoBtC,QAApB;AACAyc,IAAAA,IAAI,CAACzP,UAAL,GAAkBsP,IAAlB;AACAG,IAAAA,IAAI,CAACtkB,gBAAL,CAAuB,OAAvB,EAAgC,YAAY;AAExC;;;;;;;AAOA,WAAKiH,aAAL,CAAoB;AAAEjC,QAAAA,IAAI,EAAE,yBAAR;AAAmC6T,QAAAA,MAAM,EAAE,aAA3C;AAA0DtC,QAAAA,IAAI,EAAE4N;AAAhE,OAApB;AAEH,KAX+B,CAW9Bxf,IAX8B,CAWxB,IAXwB,CAAhC;AAaA,SAAKie,WAAL,CAAiBvd,IAAjB,CAAuBif,IAAvB;AAEA,SAAKhkB,GAAL,CAAUgkB,IAAV;AAEA,SAAKlY,OAAL,GAAe,KAAf;AAEH,GAnYgE;AAqYjEmY,EAAAA,KAAK,EAAE,YAAY;AAEf,SAAK5C,QAAL,CAAcrd,MAAd,GAAuB,CAAvB;AAEH,GAzYgE;AA2YjE6e,EAAAA,gBAAgB,EAAE,YAAY;AAE1B,SAAKqB,eAAL,GAAuB,IAAI7X,KAAK,CAACA,KAAV,CAAiB,KAAKvD,QAAtB,EAClB0H,MADkB,CACVnE,KAAK,CAACqC,MAAN,CAAamD,OAAb,CAAqBH,GADX,EAElBZ,OAFkB,CAET,YAAY;AAElB,WAAKhF,OAAL,GAAe,IAAf,CAFkB,CAGlB;;AAEA;;;;;;AAKA,WAAKnF,aAAL,CAAoB;AAAEjC,QAAAA,IAAI,EAAE;AAAR,OAApB;AAEH,KAZS,CAYRL,IAZQ,CAYF,IAZE,CAFS,CAAvB;AAgBA,SAAK8f,gBAAL,GAAwB,IAAI9X,KAAK,CAACA,KAAV,CAAiB,KAAKvD,QAAtB,EACnB0H,MADmB,CACXnE,KAAK,CAACqC,MAAN,CAAamD,OAAb,CAAqBH,GADV,EAEnBT,UAFmB,CAEP,YAAY;AAErB,WAAKnF,OAAL,GAAe,KAAf,CAFqB,CAGrB;;AAEA;;;;;;AAKA,WAAKnF,aAAL,CAAoB;AAAEjC,QAAAA,IAAI,EAAE;AAAR,OAApB;AAEH,KAZY,CAYXL,IAZW,CAYL,IAZK,CAFO,CAAxB;AAgBA,SAAK+f,eAAL,GAAuB,IAAI/X,KAAK,CAACA,KAAV,CAAiB,IAAjB,EAClBmE,MADkB,CACVnE,KAAK,CAACqC,MAAN,CAAamD,OAAb,CAAqBH,GADX,EAElBT,UAFkB,CAEN,YAAY;AAErB;;;;;AAKA,WAAKtK,aAAL,CAAoB;AAAEjC,QAAAA,IAAI,EAAE;AAAR,OAApB;AAEH,KATY,CASXL,IATW,CASJ,IATI,CAFM,EAYlBC,KAZkB,EAAvB;AAcA,SAAK+f,eAAL,GAAuB,IAAIhY,KAAK,CAACA,KAAV,CAAiB,IAAjB,EAClBmE,MADkB,CACVnE,KAAK,CAACqC,MAAN,CAAamD,OAAb,CAAqBH,GADX,CAAvB;AAGH,GA9bgE;AAgcjE4S,EAAAA,qBAAqB,EAAE,YAAY;AAE/B,UAAMC,KAAK,GAAG,KAAKzb,QAAL,CAAcyC,OAA5B;AACA,UAAM;AAAEiZ,MAAAA;AAAF,QAAe,KAAK1b,QAA1B;;AAEA,QAAK0b,QAAQ,IAAIA,QAAQ,CAACjZ,OAA1B,EAAoC;AAChCiZ,MAAAA,QAAQ,CAACjZ,OAAT,CAAiB4F,KAAjB,GAAyBoT,KAAzB;AACH;AAEJ,GAzcgE;;AA2cjE;;;;;;AAMA3B,EAAAA,MAAM,EAAE,UAAW5X,QAAX,EAAsB;AAE1BA,IAAAA,QAAQ,GAAGA,QAAQ,IAAI,CAAZ,GAAgBA,QAAhB,GAA2B,KAAKoX,iBAA3C;AAEA,SAAK+B,gBAAL,CAAsB/f,IAAtB;AACA,SAAK8f,eAAL,CACKzU,EADL,CACS;AAAElE,MAAAA,OAAO,EAAE;AAAX,KADT,EACyBP,QADzB,EAEK+F,QAFL,CAEe,KAAKuT,qBAAL,CAA2BjgB,IAA3B,CAAiC,IAAjC,CAFf,EAGK4M,UAHL,CAGiB,YAAY;AAErB,WAAKwS,wBAAL,CAA+B,IAA/B,EAAqCzY,QAAQ,GAAG,CAAhD;AAEA;;;;;;AAKA,WAAKrE,aAAL,CAAoB;AAAEjC,QAAAA,IAAI,EAAE;AAAR,OAApB;AAEH,KAXY,CAWXL,IAXW,CAWL,IAXK,CAHjB,EAeKC,KAfL;AAiBH,GAvegE;;AAyejE;;;;;AAKAmgB,EAAAA,OAAO,EAAE,UAAWzZ,QAAX,EAAsB;AAE3BA,IAAAA,QAAQ,GAAGA,QAAQ,IAAI,CAAZ,GAAgBA,QAAhB,GAA2B,KAAKoX,iBAA3C;AAEA,SAAK8B,eAAL,CAAqB9f,IAArB;AACA,SAAK+f,gBAAL,CACK1U,EADL,CACS;AAAElE,MAAAA,OAAO,EAAE;AAAX,KADT,EACyBP,QADzB,EAEK+F,QAFL,CAEe,KAAKuT,qBAAL,CAA2BjgB,IAA3B,CAAiC,IAAjC,CAFf,EAGKC,KAHL;AAKH,GAxfgE;;AA0fjE;;;;;;;AAOAogB,EAAAA,OAAO,EAAE,YAAY;AAEjB,UAAM1Z,QAAQ,GAAG,KAAKoX,iBAAtB;AAEA,SAAKiC,eAAL,CAAqBjgB,IAArB;AACA,SAAKggB,eAAL,CACK3U,EADL,CACS,EADT,EACazE,QADb,EAEK8F,OAFL,CAEc,YAAY;AAElB;;;;;AAKA,WAAKnK,aAAL,CAAoB;AAAEjC,QAAAA,IAAI,EAAE;AAAR,OAApB;;AAEA,UAAK,KAAKlF,MAAV,EAAmB;AAEf,aAAKojB,MAAL,CAAa5X,QAAb;AAEH,OAJD,MAIO;AAEH,aAAK5M,IAAL;AAEH;AAEJ,KAnBS,CAmBRiG,IAnBQ,CAmBF,IAnBE,CAFd,EAsBKC,KAtBL;AAwBA;;;;;;AAKA,SAAKqC,aAAL,CAAoB;AAAEjC,MAAAA,IAAI,EAAE;AAAR,KAApB;AAEA,SAAK2c,QAAL,CAAc8B,OAAd,CAAuBC,KAAK,IAAI;AAE5BA,MAAAA,KAAK,CAACzc,aAAN,CAAqB;AAAEjC,QAAAA,IAAI,EAAE;AAAR,OAArB;AAEH,KAJD;AAMA,SAAKwB,MAAL,GAAc,IAAd;AAEH,GA7iBgE;;AA+iBjE;;;;;;AAMAye,EAAAA,OAAO,EAAE,YAAY;AAEjB,UAAM3Z,QAAQ,GAAG,KAAKoX,iBAAtB;AAEA,SAAKgC,eAAL,CAAqBhgB,IAArB;AACA,SAAKigB,eAAL,CACK5U,EADL,CACS,EADT,EACazE,QADb,EAEK8F,OAFL,CAEc,YAAY;AAElB;;;;;AAKA,WAAKnK,aAAL,CAAoB;AAAEjC,QAAAA,IAAI,EAAE;AAAR,OAApB;AAEA,WAAK+f,OAAL,CAAczZ,QAAd;AACA,WAAKyY,wBAAL,CAA+B,KAA/B;AAEH,KAZS,CAYRpf,IAZQ,CAYF,IAZE,CAFd,EAeKC,KAfL;AAiBA;;;;;;AAKA,SAAKqC,aAAL,CAAoB;AAAEjC,MAAAA,IAAI,EAAE;AAAR,KAApB;AAEA,SAAK2c,QAAL,CAAc8B,OAAd,CAAuBC,KAAK,IAAI;AAE5BA,MAAAA,KAAK,CAACzc,aAAN,CAAqB;AAAEjC,QAAAA,IAAI,EAAE;AAAR,OAArB;AAEH,KAJD;AAMA,SAAKwB,MAAL,GAAc,KAAd;AAEH,GA1lBgE;;AA4lBjE;;;;;AAKAuS,EAAAA,OAAO,EAAE,YAAY;AAEjB,SAAKkK,iBAAL,CAAuBve,IAAvB;AACA,SAAK8f,eAAL,CAAqB9f,IAArB;AACA,SAAK+f,gBAAL,CAAsB/f,IAAtB;AACA,SAAKggB,eAAL,CAAqBhgB,IAArB;AACA,SAAKigB,eAAL,CAAqBjgB,IAArB;AAEA;;;;;;;;AAOA,SAAKuC,aAAL,CAAoB;AAAEjC,MAAAA,IAAI,EAAE,yBAAR;AAAmC6T,MAAAA,MAAM,EAAE,mBAA3C;AAAgEtC,MAAAA,IAAI,EAAE;AAAtE,KAApB,EAfiB,CAiBjB;;AACA,aAAS2O,gBAAT,CAA4BhX,MAA5B,EAAqC;AAEjC,YAAM;AAAE8K,QAAAA,QAAF;AAAY5P,QAAAA;AAAZ,UAAyB8E,MAA/B;;AAEA,WAAM,IAAIxL,CAAC,GAAGwL,MAAM,CAACyT,QAAP,CAAgBrd,MAAhB,GAAyB,CAAvC,EAA0C5B,CAAC,IAAI,CAA/C,EAAkDA,CAAC,EAAnD,EAAwD;AAEpDwiB,QAAAA,gBAAgB,CAAEhX,MAAM,CAACyT,QAAP,CAAgBjf,CAAhB,CAAF,CAAhB;AACAwL,QAAAA,MAAM,CAACb,MAAP,CAAea,MAAM,CAACyT,QAAP,CAAgBjf,CAAhB,CAAf;AAEH;;AAED,UAAKwL,MAAM,YAAYsG,QAAvB,EAAkC;AAE9BtG,QAAAA,MAAM,CAAC6K,OAAP;AAEH;;AAED,UAAKC,QAAL,EAAgB;AAAEA,QAAAA,QAAQ,CAACD,OAAT;AAAoB7K,QAAAA,MAAM,CAAC8K,QAAP,GAAkB,IAAlB;AAAyB;;AAC/D,UAAK5P,QAAL,EAAgB;AAAEA,QAAAA,QAAQ,CAAC2P,OAAT;AAAoB7K,QAAAA,MAAM,CAAC9E,QAAP,GAAkB,IAAlB;AAAyB;AAElE;;AAED8b,IAAAA,gBAAgB,CAAE,IAAF,CAAhB;;AAEA,QAAK,KAAKjM,MAAV,EAAmB;AAEf,WAAKA,MAAL,CAAY5L,MAAZ,CAAoB,IAApB;AAEH;AAEJ;AAjpBgE,CAAhD,CAArB;AAqpBA;;;;;;AAKA,SAAS8X,aAAT,CAAyB9lB,KAAzB,EAAgC+lB,SAAhC,EAA2CC,SAA3C,EAAuD;AAEnD,QAAMvZ,MAAM,GAAG,IAAf;AACA,QAAMkN,QAAQ,GAAGoM,SAAS,IAAI,IAAIzqB,oBAAJ,CAA0BmR,MAA1B,EAAkC,EAAlC,EAAsC,EAAtC,CAA9B;AACA,QAAM1C,QAAQ,GAAGic,SAAS,IAAI,IAAIzqB,iBAAJ,CAAuB;AAAEiR,IAAAA,OAAO,EAAE,CAAX;AAAcyJ,IAAAA,WAAW,EAAE;AAA3B,GAAvB,CAA9B;AAEA8M,EAAAA,QAAQ,CAAC9Y,IAAT,CAAe,IAAf,EAAqB0P,QAArB,EAA+B5P,QAA/B;AAEA,OAAKxJ,GAAL,GAAWP,KAAX;AACA,OAAKyM,MAAL,GAAcA,MAAd;AAEH;;AAEDqZ,aAAa,CAACrhB,SAAd,GAA0BT,MAAM,CAACC,MAAP,CAAeD,MAAM,CAACU,MAAP,CAAeqe,QAAQ,CAACte,SAAxB,CAAf,EAAoD;AAE1EmG,EAAAA,WAAW,EAAEkb,aAF6D;;AAI1E;;;;;;AAMAzmB,EAAAA,IAAI,EAAE,UAAWkB,GAAX,EAAiB;AAEnBA,IAAAA,GAAG,GAAGA,GAAG,IAAI,KAAKA,GAAlB;;AAEA,QAAK,CAACA,GAAN,EAAY;AAERoG,MAAAA,OAAO,CAACC,IAAR,CAAc,wBAAd;AAEA;AAEH,KAND,MAMO,IAAK,OAAOrG,GAAP,KAAe,QAApB,EAA+B;AAElCgC,MAAAA,aAAa,CAAClD,IAAd,CAAoBkB,GAApB,EAAyB,KAAKhB,MAAL,CAAY+F,IAAZ,CAAkB,IAAlB,CAAzB,EAAmD,KAAK9F,UAAL,CAAgB8F,IAAhB,CAAsB,IAAtB,CAAnD,EAAiF,KAAK7F,OAAL,CAAa6F,IAAb,CAAmB,IAAnB,CAAjF;AAEH,KAJM,MAIA,IAAK/E,GAAG,YAAY0lB,gBAApB,EAAuC;AAE1C,WAAK1mB,MAAL,CAAa,IAAIjF,OAAJ,CAAaiG,GAAb,CAAb;AAEH;AAEJ,GA9ByE;;AAgC1E;;;;;;AAMAhB,EAAAA,MAAM,EAAE,UAAWiD,OAAX,EAAqB;AAEzBA,IAAAA,OAAO,CAACwF,SAAR,GAAoBxF,OAAO,CAACyF,SAAR,GAAoBrN,YAAxC;AACA4H,IAAAA,OAAO,CAACI,WAAR,GAAsB,IAAtB;AAEA,SAAK6hB,aAAL,CAAoBjiB,OAApB;AAEA5B,IAAAA,MAAM,CAAC0L,qBAAP,CAA8ByW,QAAQ,CAACte,SAAT,CAAmBlF,MAAnB,CAA0B+F,IAA1B,CAAgC,IAAhC,CAA9B;AAEH,GA/CyE;;AAiD1E;;;;;AAKA4f,EAAAA,KAAK,EAAE,YAAY;AAEfnC,IAAAA,QAAQ,CAACte,SAAT,CAAmBygB,KAAnB,CAAyBjb,IAAzB,CAA+B,IAA/B;AAEH,GA1DyE;;AA4D1E;;;;;AAKAyP,EAAAA,OAAO,EAAE,YAAY;AAEjB,UAAM;AAAE3P,MAAAA,QAAQ,EAAE;AAAE7G,QAAAA;AAAF;AAAZ,QAAwB,IAA9B,CAFiB,CAIjB;;AACA7I,IAAAA,KAAK,CAAC2T,MAAN,CAAc,KAAKzN,GAAnB;;AAEA,QAAK2C,GAAL,EAAW;AAAEA,MAAAA,GAAG,CAACwW,OAAJ;AAAgB;;AAE7BqJ,IAAAA,QAAQ,CAACte,SAAT,CAAmBiV,OAAnB,CAA2BzP,IAA3B,CAAiC,IAAjC;AAEH;AA5EyE,CAApD,CAA1B;AAgFA;;;;;AAIA,SAASic,aAAT,GAA0B;AAEtB,QAAMvM,QAAQ,GAAG,IAAIne,cAAJ,EAAjB;AACA,QAAMuO,QAAQ,GAAG,IAAIxO,iBAAJ,CAAuB;AAAEgO,IAAAA,KAAK,EAAE,QAAT;AAAmBiD,IAAAA,OAAO,EAAE,CAA5B;AAA+ByJ,IAAAA,WAAW,EAAE;AAA5C,GAAvB,CAAjB;AAEA0D,EAAAA,QAAQ,CAACwM,YAAT,CAAuB,UAAvB,EAAmC,IAAI1qB,eAAJ,CAAqB,IAAI2qB,YAAJ,EAArB,EAAyC,CAAzC,CAAnC;AAEArD,EAAAA,QAAQ,CAAC9Y,IAAT,CAAe,IAAf,EAAqB0P,QAArB,EAA+B5P,QAA/B;AAEH;;AAEDmc,aAAa,CAACzhB,SAAd,GAA0BT,MAAM,CAACC,MAAP,CAAeD,MAAM,CAACU,MAAP,CAAeqe,QAAQ,CAACte,SAAxB,CAAf,EAAoD;AAE1EmG,EAAAA,WAAW,EAAEsb;AAF6D,CAApD,CAA1B;AAMA;;;;;;AAKA,SAASG,YAAT,CAAwBjjB,MAAM,GAAG,EAAjC,EAAqC;AAEjC,QAAMkjB,UAAU,GAAG,KAAnB;AACA,QAAMC,MAAM,GAAGviB,MAAM,CAACC,MAAP,CAAe,EAAf,EAAmBvI,SAAS,CAAE,MAAF,CAA5B,CAAf;AACA,QAAMie,QAAQ,GAAG,IAAIhe,iBAAJ,CAAuB2qB,UAAvB,EAAmCA,UAAnC,EAA+CA,UAA/C,CAAjB;AACA,QAAMvc,QAAQ,GAAG,IAAInO,cAAJ,CAAoB;AAEjC4qB,IAAAA,cAAc,EAAED,MAAM,CAACC,cAFU;AAGjCC,IAAAA,YAAY,EAAEF,MAAM,CAACE,YAHY;AAIjChB,IAAAA,QAAQ,EAAEc,MAAM,CAACd,QAJgB;AAKjC1P,IAAAA,IAAI,EAAE3a,QAL2B;AAMjC6a,IAAAA,WAAW,EAAE;AANoB,GAApB,CAAjB;AAUA8M,EAAAA,QAAQ,CAAC9Y,IAAT,CAAe,IAAf,EAAqB0P,QAArB,EAA+B5P,QAA/B;AAEA,OAAK3G,MAAL,GAAcA,MAAd;AACA,OAAKkjB,UAAL,GAAkBA,UAAlB;AACA,OAAKvc,QAAL,CAAc0b,QAAd,CAAuBjZ,OAAvB,CAA+B4F,KAA/B,GAAuC,CAAvC;AAEH;;AAEDiU,YAAY,CAAC5hB,SAAb,GAAyBT,MAAM,CAACC,MAAP,CAAeD,MAAM,CAACU,MAAP,CAAeqe,QAAQ,CAACte,SAAxB,CAAf,EAAoD;AAEzEmG,EAAAA,WAAW,EAAEyb,YAF4D;;AAIzE;;;;;AAKAhnB,EAAAA,IAAI,EAAE,YAAY;AAEdwD,IAAAA,iBAAiB,CAACxD,IAAlB,CAEI,KAAK+D,MAFT,EAII,KAAK7D,MAAL,CAAY+F,IAAZ,CAAkB,IAAlB,CAJJ,EAKI,KAAK9F,UAAL,CAAgB8F,IAAhB,CAAsB,IAAtB,CALJ,EAMI,KAAK7F,OAAL,CAAa6F,IAAb,CAAmB,IAAnB,CANJ;AAUH,GArBwE;;AAuBzE;;;;;;AAMA/F,EAAAA,MAAM,EAAE,UAAWiD,OAAX,EAAqB;AAEzB,SAAKuH,QAAL,CAAc0b,QAAd,CAAwB,OAAxB,EAAkCrT,KAAlC,GAA0C5P,OAA1C;AAEAugB,IAAAA,QAAQ,CAACte,SAAT,CAAmBlF,MAAnB,CAA0B0K,IAA1B,CAAgC,IAAhC;AAEH,GAnCwE;;AAqCzE;;;;;AAKAyP,EAAAA,OAAO,EAAE,YAAY;AAEjB,UAAM;AAAEtH,MAAAA;AAAF,QAAY,KAAKrI,QAAL,CAAc0b,QAAd,CAAuBiB,KAAzC;AAEA,SAAKtjB,MAAL,CAAYghB,OAAZ,CAAuBpkB,KAAF,IAAa;AAAE3F,MAAAA,KAAK,CAAC2T,MAAN,CAAchO,KAAd;AAAwB,KAA5D;;AAEA,QAAKoS,KAAK,YAAY3X,WAAtB,EAAoC;AAEhC2X,MAAAA,KAAK,CAACsH,OAAN;AAEH;;AAEDqJ,IAAAA,QAAQ,CAACte,SAAT,CAAmBiV,OAAnB,CAA2BzP,IAA3B,CAAiC,IAAjC;AAEH;AAxDwE,CAApD,CAAzB;AA4DA;;;;;AAIA,SAAS0c,aAAT,GAA0B;AAEtB,QAAMvjB,MAAM,GAAG,EAAf;;AAEA,OAAM,IAAIC,CAAC,GAAG,CAAd,EAAiBA,CAAC,GAAG,CAArB,EAAwBA,CAAC,EAAzB,EAA8B;AAE1BD,IAAAA,MAAM,CAAC4C,IAAP,CAAaxH,SAAS,CAACO,SAAvB;AAEH;;AAEDsnB,EAAAA,YAAY,CAACpc,IAAb,CAAmB,IAAnB,EAAyB7G,MAAzB;AAEH;;AAEDujB,aAAa,CAACliB,SAAd,GAA0BT,MAAM,CAACC,MAAP,CAAeD,MAAM,CAACU,MAAP,CAAe2hB,YAAY,CAAC5hB,SAA5B,CAAf,EAAwD;AAE9EmG,EAAAA,WAAW,EAAE+b;AAFiE,CAAxD,CAA1B;AAMA;;;;;;;;;;;;;;AAaA,SAASC,aAAT,CAAyBrmB,GAAzB,EAA8BgiB,OAAO,GAAG,EAAxC,EAA6C;AAEzC,QAAM9V,MAAM,GAAG,IAAf;AACA,QAAMkN,QAAQ,GAAG,IAAIre,oBAAJ,CAA0BmR,MAA1B,EAAkC,EAAlC,EAAsC,EAAtC,CAAjB;AACA,QAAM1C,QAAQ,GAAG,IAAIxO,iBAAJ,CAAuB;AAAEiR,IAAAA,OAAO,EAAE,CAAX;AAAcyJ,IAAAA,WAAW,EAAE;AAA3B,GAAvB,CAAjB;AAEA8M,EAAAA,QAAQ,CAAC9Y,IAAT,CAAe,IAAf,EAAqB0P,QAArB,EAA+B5P,QAA/B;AAEA,OAAKxJ,GAAL,GAAWA,GAAX;AAEA,OAAKgiB,OAAL,GAAe;AAEXjI,IAAAA,YAAY,EAAEvZ,QAAQ,CAACqH,aAAT,CAAwB,OAAxB,CAFH;AAGXye,IAAAA,IAAI,EAAE,IAHK;AAIXC,IAAAA,KAAK,EAAE,IAJI;AAKXC,IAAAA,QAAQ,EAAE,KALC;AAMXC,IAAAA,WAAW,EAAE,IANF;AAOX3lB,IAAAA,WAAW,EAAE;AAPF,GAAf;AAWA2C,EAAAA,MAAM,CAACC,MAAP,CAAe,KAAKse,OAApB,EAA6BA,OAA7B;AAEA,OAAKjI,YAAL,GAAoB,KAAKiI,OAAL,CAAajI,YAAjC;AACA,OAAK2M,aAAL,GAAqB,CAArB;AACA,OAAKxa,MAAL,GAAcA,MAAd;AAEA,OAAK9L,gBAAL,CAAuB,OAAvB,EAAgC,KAAKkH,UAAL,CAAgBvC,IAAhB,CAAsB,IAAtB,CAAhC;AACA,OAAK3E,gBAAL,CAAuB,kBAAvB,EAA2C,KAAKumB,mBAAL,CAAyB5hB,IAAzB,CAA+B,IAA/B,CAA3C;AACA,OAAK3E,gBAAL,CAAuB,cAAvB,EAAuC,KAAKwmB,WAAL,CAAiB7hB,IAAjB,CAAuB,IAAvB,CAAvC;AACA,OAAK3E,gBAAL,CAAuB,YAAvB,EAAqC,KAAKymB,mBAAL,CAAyB9hB,IAAzB,CAA+B,IAA/B,CAArC;AAEH;;AACDshB,aAAa,CAACniB,SAAd,GAA0BT,MAAM,CAACC,MAAP,CAAeD,MAAM,CAACU,MAAP,CAAeqe,QAAQ,CAACte,SAAxB,CAAf,EAAoD;AAE1EmG,EAAAA,WAAW,EAAEgc,aAF6D;AAI1ES,EAAAA,QAAQ,EAAE,YAAY;AAElB,QAAIC,KAAK,GAAG,KAAZ;;AACA,KAAC,UAAS3S,CAAT,EAAW;AAAC,UAAG,2TAA2TvO,IAA3T,CAAgUuO,CAAhU,KAAoU,0kDAA0kDvO,IAA1kD,CAA+kDuO,CAAC,CAAC4S,MAAF,CAAS,CAAT,EAAW,CAAX,CAA/kD,CAAvU,EAAs6DD,KAAK,GAAG,IAAR;AAAc,KAAj8D,EAAo8D1mB,MAAM,CAACsE,SAAP,CAAiBsiB,SAAjB,IAA8B5mB,MAAM,CAACsE,SAAP,CAAiBuiB,MAA/C,IAAyD7mB,MAAM,CAAC8mB,KAApgE;;AACA,WAAOJ,KAAP;AAEH,GAVyE;;AAY1E;;;;;;AAMAjoB,EAAAA,IAAI,EAAE,YAAY;AAEd,UAAM;AAAEynB,MAAAA,KAAF;AAASD,MAAAA,IAAT;AAAeE,MAAAA,QAAf;AAAyBC,MAAAA,WAAzB;AAAsC3lB,MAAAA;AAAtC,QAAsD,KAAKkhB,OAAjE;AACA,UAAM9e,KAAK,GAAG,KAAK6W,YAAnB;AACA,UAAMvQ,QAAQ,GAAG,KAAKA,QAAtB;AACA,UAAMvK,UAAU,GAAG,KAAKA,UAAL,CAAgB8F,IAAhB,CAAsB,IAAtB,CAAnB;AACA,UAAM/F,MAAM,GAAG,KAAKA,MAAL,CAAY+F,IAAZ,CAAkB,IAAlB,CAAf;AAEA7B,IAAAA,KAAK,CAACojB,IAAN,GAAaA,IAAb;AACApjB,IAAAA,KAAK,CAACsjB,QAAN,GAAiBA,QAAjB;AACAtjB,IAAAA,KAAK,CAACujB,WAAN,GAAoBA,WAApB;AACAvjB,IAAAA,KAAK,CAACpC,WAAN,GAAoBA,WAApB;AACAoC,IAAAA,KAAK,CAACqjB,KAAN,GAAcA,KAAd;;AAEA,QAAKE,WAAL,EAAmB;AAEfvjB,MAAAA,KAAK,CAAC6E,YAAN,CAAoB,aAApB,EAAmC,EAAnC;AACA7E,MAAAA,KAAK,CAAC6E,YAAN,CAAoB,oBAApB,EAA0C,EAA1C;AAEH;;AAED,UAAMqf,YAAY,GAAG,YAAW;AAE5B,WAAKC,eAAL,CAAsBnkB,KAAtB;;AAEA,UAAKsjB,QAAL,EAAgB;AAEZ;;;;;;AAMA,aAAKnf,aAAL,CAAoB;AAAEjC,UAAAA,IAAI,EAAE,yBAAR;AAAmC6T,UAAAA,MAAM,EAAE,uBAA3C;AAAoEtC,UAAAA,IAAI,EAAE;AAA1E,SAApB;AAEH,OAd2B,CAgB5B;;;AACA,UAAK,KAAKmQ,QAAL,EAAL,EAAuB;AAEnB5jB,QAAAA,KAAK,CAACqE,KAAN;;AAEA,YAAKif,QAAQ,IAAID,KAAjB,EAAyB;AAErB;;;;;;AAMA,eAAKlf,aAAL,CAAoB;AAAEjC,YAAAA,IAAI,EAAE,yBAAR;AAAmC6T,YAAAA,MAAM,EAAE,uBAA3C;AAAoEtC,YAAAA,IAAI,EAAE;AAA1E,WAApB;AAEH,SAVD,MAUO;AAEH;;;;;;AAMA,eAAKtP,aAAL,CAAoB;AAAEjC,YAAAA,IAAI,EAAE,yBAAR;AAAmC6T,YAAAA,MAAM,EAAE,uBAA3C;AAAoEtC,YAAAA,IAAI,EAAE;AAA1E,WAApB;AAEH;AAEJ;;AAED,YAAMzW,MAAM,GAAG,MAAM;AAEjB;AACAsJ,QAAAA,QAAQ,CAAC7G,GAAT,CAAaN,WAAb,GAA2B,IAA3B;AAEApD,QAAAA,UAAU,CAAE;AAAEiB,UAAAA,MAAM,EAAE,CAAV;AAAaC,UAAAA,KAAK,EAAE;AAApB,SAAF,CAAV;AACAnB,QAAAA,MAAM;AAET,OARD;;AAUAqB,MAAAA,MAAM,CAAC0L,qBAAP,CAA8B7L,MAA9B;AAEH,KAzDD;AA2DA;;;;;;;;;;AAQA,QAAKgD,KAAK,CAAC7B,UAAN,GAAmB,CAAxB,EAA4B;AAExB+lB,MAAAA,YAAY,CAAC1d,IAAb,CAAmB,IAAnB;AAEH,KAJD,MAIO;AAEH,UAAKxG,KAAK,CAACokB,gBAAN,CAAwB,QAAxB,EAAmC5iB,MAAnC,KAA8C,CAAnD,EAAuD;AAEnD,cAAM6iB,MAAM,GAAG/mB,QAAQ,CAACqH,aAAT,CAAwB,QAAxB,CAAf;AACA0f,QAAAA,MAAM,CAACvnB,GAAP,GAAa,KAAKA,GAAlB;AACAkD,QAAAA,KAAK,CAAC2T,WAAN,CAAmB0Q,MAAnB;AAEH;;AAEDrkB,MAAAA,KAAK,CAACpE,IAAN;AACH;;AAEDoE,IAAAA,KAAK,CAAC9C,gBAAN,CAAwB,YAAxB,EAAsCgnB,YAAY,CAACriB,IAAb,CAAmB,IAAnB,CAAtC;AAEA7B,IAAAA,KAAK,CAAC9C,gBAAN,CAAwB,YAAxB,EAAsC,YAAY;AAE9C,WAAKsmB,aAAL,GAAqBxjB,KAAK,CAACwI,QAAN,IAAkB,CAAlB,GAAsBxI,KAAK,CAACskB,WAAN,GAAoBtkB,KAAK,CAACwI,QAAhD,GAA2D,CAAhF;AAEA;;;;;;;AAMA,WAAKrE,aAAL,CAAoB;AAAEjC,QAAAA,IAAI,EAAE,yBAAR;AAAmC6T,QAAAA,MAAM,EAAE,eAA3C;AAA4DtC,QAAAA,IAAI,EAAE,KAAK+P;AAAvE,OAApB;AAEH,KAZqC,CAYpC3hB,IAZoC,CAY9B,IAZ8B,CAAtC;AAcA7B,IAAAA,KAAK,CAAC9C,gBAAN,CAAwB,OAAxB,EAAiC,YAAY;AAEzC,UAAK,CAACkmB,IAAN,EAAa;AAET,aAAKmB,UAAL;AACA,aAAKpgB,aAAL,CAAoB;AAAEjC,UAAAA,IAAI,EAAE,yBAAR;AAAmC6T,UAAAA,MAAM,EAAE,uBAA3C;AAAoEtC,UAAAA,IAAI,EAAE;AAA1E,SAApB;AAEH;AAEJ,KATgC,CAS/B5R,IAT+B,CASzB,IATyB,CAAjC,EASgB,KAThB;AAWH,GAtJyE;;AAwJ1E;;;;;;;AAOAsiB,EAAAA,eAAe,EAAE,UAAWnkB,KAAX,EAAmB;AAEhC,QAAK,CAACA,KAAN,EAAc;AAEd,UAAMwkB,YAAY,GAAG,IAAIttB,YAAJ,CAAkB8I,KAAlB,CAArB;AACAwkB,IAAAA,YAAY,CAACjgB,SAAb,GAAyBpN,YAAzB;AACAqtB,IAAAA,YAAY,CAAChgB,SAAb,GAAyBrN,YAAzB;AACAqtB,IAAAA,YAAY,CAACtlB,MAAb,GAAsBpI,SAAtB;AAEA,SAAKkqB,aAAL,CAAoBwD,YAApB;AAEH,GA1KyE;;AA4K1E;;;;;AAKA/C,EAAAA,KAAK,EAAE,YAAY;AAEf,SAAK5K,YAAL,GAAoBja,SAApB;AAEA0iB,IAAAA,QAAQ,CAACte,SAAT,CAAmBygB,KAAnB,CAAyBjb,IAAzB,CAA+B,IAA/B;AAEH,GAvLyE;;AAyL1E;;;;;;AAMAie,EAAAA,aAAa,EAAE,YAAY;AAEvB,WAAO,KAAK5N,YAAL,CAAkB+D,MAAzB;AAEH,GAnMyE;;AAqM1E;;;;;AAKA8I,EAAAA,WAAW,EAAE,YAAY;AAErB,UAAM1jB,KAAK,GAAG,KAAK6W,YAAnB;;AAEA,QAAK,CAAC7W,KAAN,EAAc;AAAE;AAAS;;AAEzBA,IAAAA,KAAK,CAAEA,KAAK,CAAC4a,MAAN,GAAe,MAAf,GAAwB,OAA1B,CAAL;AAEH,GAlNyE;;AAoN1E;;;;;;AAMA+I,EAAAA,mBAAmB,EAAE,UAAW;AAAEzH,IAAAA;AAAF,GAAX,EAA4B;AAE7C,UAAMlc,KAAK,GAAG,KAAK6W,YAAnB;;AAEA,QAAK7W,KAAK,IAAI,CAAC0kB,MAAM,CAACC,KAAP,CAAczI,UAAd,CAAV,IAAwCA,UAAU,KAAK,CAA5D,EAAgE;AAE5Dlc,MAAAA,KAAK,CAACskB,WAAN,GAAoBtkB,KAAK,CAACwI,QAAN,GAAiB0T,UAArC;AAEA,WAAK/X,aAAL,CAAoB;AAAEjC,QAAAA,IAAI,EAAE,yBAAR;AAAmC6T,QAAAA,MAAM,EAAE,eAA3C;AAA4DtC,QAAAA,IAAI,EAAEyI;AAAlE,OAApB;AAEH;AAEJ,GAtOyE;;AAwO1E;;;;;;;AAOAnZ,EAAAA,SAAS,EAAE,YAAY;AAEnB,UAAM/C,KAAK,GAAG,KAAK6W,YAAnB;AACA,UAAM9T,SAAS,GAAG,KAAKA,SAAL,CAAelB,IAAf,CAAqB,IAArB,CAAlB;AACA,UAAMsC,aAAa,GAAG,KAAKA,aAAL,CAAmBtC,IAAnB,CAAyB,IAAzB,CAAtB;;AACA,UAAM+iB,SAAS,GAAG,MAAM;AAEpB;;;;;;AAMAzgB,MAAAA,aAAa,CAAE;AAAEjC,QAAAA,IAAI,EAAE;AAAR,OAAF,CAAb;AAEH,KAVD;;AAWA,UAAMlG,OAAO,GAAKiH,KAAF,IAAa;AAEzB;AACA9F,MAAAA,MAAM,CAAC0L,qBAAP,CAA8B9F,SAA9B;AAEA;;;;;;;AAMAoB,MAAAA,aAAa,CAAE;AAAEjC,QAAAA,IAAI,EAAE,YAAR;AAAsBe,QAAAA;AAAtB,OAAF,CAAb;AAEH,KAbD;;AAeA,QAAKjD,KAAK,IAAIA,KAAK,CAAC4a,MAApB,EAA6B;AAEzB5a,MAAAA,KAAK,CAACkE,IAAN,GAAajC,IAAb,CAAmB2iB,SAAnB,EAA+BxhB,KAA/B,CAAsCpH,OAAtC;AAEH;AAEJ,GApRyE;;AAsR1E;;;;;;AAMAoI,EAAAA,UAAU,EAAE,YAAY;AAEpB,UAAMpE,KAAK,GAAG,KAAK6W,YAAnB;;AAEA,QAAK7W,KAAK,IAAI,CAACA,KAAK,CAAC4a,MAArB,EAA8B;AAE1B5a,MAAAA,KAAK,CAACqE,KAAN;AAEH;AAED;;;;;;;;AAMA,SAAKF,aAAL,CAAoB;AAAEjC,MAAAA,IAAI,EAAE;AAAR,KAApB;AAEH,GA9SyE;;AAgT1E;;;;;AAKAuhB,EAAAA,mBAAmB,EAAE,YAAY;AAE7B,UAAMzjB,KAAK,GAAG,KAAK6W,YAAnB;;AAEA,QAAK7W,KAAK,CAAC7B,UAAN,IAAoB,CAApB,IAAyB6B,KAAK,CAACsjB,QAA/B,IAA2C,CAAC,KAAKM,QAAL,EAAjD,EAAmE;AAE/D,WAAK7gB,SAAL;AAEA;;;;;;;AAMA,WAAKoB,aAAL,CAAoB;AAAEjC,QAAAA,IAAI,EAAE,yBAAR;AAAmC6T,QAAAA,MAAM,EAAE,uBAA3C;AAAoEtC,QAAAA,IAAI,EAAE;AAA1E,OAApB;AAEH,KAZD,MAYO;AAEH,WAAKrP,UAAL;AAEA;;;;;;;AAMA,WAAKD,aAAL,CAAoB;AAAEjC,QAAAA,IAAI,EAAE,yBAAR;AAAmC6T,QAAAA,MAAM,EAAE,uBAA3C;AAAoEtC,QAAAA,IAAI,EAAE;AAA1E,OAApB;AAEH;;AAED,SAAKkQ,mBAAL,CAA0B;AAAEzH,MAAAA,UAAU,EAAE,KAAKsH;AAAnB,KAA1B;AAEH,GArVyE;;AAuV1E;;;;;AAKAe,EAAAA,UAAU,EAAE,YAAY;AAEpB,UAAMvkB,KAAK,GAAG,KAAK6W,YAAnB;;AAEA,QAAK7W,KAAL,EAAa;AAET,WAAK2jB,mBAAL,CAA0B;AAAEzH,QAAAA,UAAU,EAAE;AAAd,OAA1B;AAEH;AAEJ,GAtWyE;;AAwW1E;;;;;;AAMA2I,EAAAA,YAAY,EAAE,YAAY;AAEtB,WAAO,KAAKhO,YAAL,CAAkBwM,KAAzB;AAEH,GAlXyE;;AAoX1E;;;;;AAKAyB,EAAAA,SAAS,EAAE,YAAY;AAEnB,UAAM9kB,KAAK,GAAG,KAAK6W,YAAnB;;AAEA,QAAK7W,KAAK,IAAI,CAACA,KAAK,CAACqjB,KAArB,EAA6B;AAEzBrjB,MAAAA,KAAK,CAACqjB,KAAN,GAAc,IAAd;AAEH;;AAED,SAAKlf,aAAL,CAAoB;AAAEjC,MAAAA,IAAI,EAAE;AAAR,KAApB;AAEH,GArYyE;;AAuY1E;;;;;AAKA6iB,EAAAA,WAAW,EAAE,YAAY;AAErB,UAAM/kB,KAAK,GAAG,KAAK6W,YAAnB;;AAEA,QAAK7W,KAAK,IAAI,KAAK6kB,YAAL,EAAd,EAAoC;AAEhC7kB,MAAAA,KAAK,CAACqjB,KAAN,GAAc,KAAd;AAEH;;AAED,SAAKlf,aAAL,CAAoB;AAAEjC,MAAAA,IAAI,EAAE;AAAR,KAApB;AAEH,GAxZyE;;AA0Z1E;;;;;;AAMA8iB,EAAAA,eAAe,EAAE,YAAY;AAEzB,WAAO,KAAKnO,YAAZ;AAEH,GApayE;;AAsa1E;;;;;AAKAZ,EAAAA,OAAO,EAAE,YAAY;AAEjB,UAAM;AAAE3P,MAAAA,QAAQ,EAAE;AAAE7G,QAAAA;AAAF;AAAZ,QAAwB,IAA9B;AAEA,SAAK2E,UAAL;AAEA,SAAKP,mBAAL,CAA0B,OAA1B,EAAmC,KAAKO,UAAL,CAAgBvC,IAAhB,CAAsB,IAAtB,CAAnC;AACA,SAAKgC,mBAAL,CAA0B,kBAA1B,EAA8C,KAAK4f,mBAAL,CAAyB5hB,IAAzB,CAA+B,IAA/B,CAA9C;AACA,SAAKgC,mBAAL,CAA0B,cAA1B,EAA0C,KAAK6f,WAAL,CAAiB7hB,IAAjB,CAAuB,IAAvB,CAA1C;AACA,SAAKgC,mBAAL,CAA0B,YAA1B,EAAwC,KAAK8f,mBAAL,CAAyB9hB,IAAzB,CAA+B,IAA/B,CAAxC;;AAEA,QAAKpC,GAAL,EAAW;AAAEA,MAAAA,GAAG,CAACwW,OAAJ;AAAgB;;AAE7BqJ,IAAAA,QAAQ,CAACte,SAAT,CAAmBiV,OAAnB,CAA2BzP,IAA3B,CAAiC,IAAjC;AAEH;AA1byE,CAApD,CAA1B;AA8bA;;;;;;AAKA,SAASye,sBAAT,CAAkCC,UAAU,GAAG,EAA/C,EAAoD;AAEhD,OAAKC,WAAL,GAAmBD,UAAnB;AACA,OAAKE,KAAL,GAAa,IAAb;AACA,OAAKC,OAAL,GAAe,IAAf;AACA,OAAKC,WAAL,GAAmB,IAAIC,MAAM,CAACC,IAAP,CAAYC,iBAAhB,EAAnB;AACA,OAAKC,MAAL,GAAc,CAAd;AACA,OAAKC,MAAL,GAAc,CAAd;AACA,OAAKC,OAAL,GAAe,EAAf;AACA,OAAKC,IAAL,GAAY,EAAZ;AACA,OAAKC,GAAL,GAAW,CAAX;AACA,OAAKC,GAAL,GAAW,CAAX;AACA,OAAKC,MAAL,GAAc,IAAd;AACA,OAAK9T,QAAL,GAAgB,CAAhB;AACA,OAAK+T,SAAL,GAAiB,EAAjB;AACA,OAAKC,YAAL,GAAoB,IAApB;AACA,OAAKC,cAAL,GAAsB,IAAtB;AAEA,OAAKC,OAAL,GAAe,CAAE,CAAF,EAAK,CAAL,EAAQ,CAAR,EAAW,CAAX,EAAc,EAAd,EAAkB,EAAlB,CAAf;AACA,OAAKC,OAAL,GAAe,CAAE,CAAF,EAAK,CAAL,EAAQ,CAAR,EAAW,CAAX,EAAc,CAAd,EAAiB,EAAjB,CAAf;AAEA,OAAKC,MAAL,GAAc,CAAE,GAAF,EAAO,GAAP,EAAY,IAAZ,EAAkB,IAAlB,EAAwB,IAAxB,EAA8B,KAA9B,CAAd;AACA,OAAKC,OAAL,GAAe,CAAE,GAAF,EAAO,GAAP,EAAY,GAAZ,EAAiB,IAAjB,EAAuB,IAAvB,EAA6B,IAA7B,CAAf;AAEA,OAAKC,IAAL,GAAY,IAAZ;AACA,OAAKC,IAAL,GAAY,IAAZ;AAEA,MAAIC,EAAJ;;AAEA,MAAI;AAEA,UAAMvgB,MAAM,GAAG7I,QAAQ,CAACqH,aAAT,CAAwB,QAAxB,CAAf;AAEA+hB,IAAAA,EAAE,GAAGvgB,MAAM,CAACmB,UAAP,CAAmB,oBAAnB,CAAL;;AAEA,QAAI,CAACof,EAAL,EAAU;AAENA,MAAAA,EAAE,GAAGvgB,MAAM,CAACmB,UAAP,CAAmB,OAAnB,CAAL;AAEH;AAEJ,GAZD,CAaA,OAAQrE,KAAR,EAAgB,CAEf;;AAED,OAAKujB,IAAL,GAAYhuB,IAAI,CAACmuB,GAAL,CAAUD,EAAE,CAACE,YAAH,CAAiBF,EAAE,CAACG,gBAApB,CAAV,EAAkD,KAAKL,IAAvD,CAAZ;AACA,OAAKC,IAAL,GAAYjuB,IAAI,CAACmuB,GAAL,CAAUD,EAAE,CAACE,YAAH,CAAiBF,EAAE,CAACG,gBAApB,CAAV,EAAkD,KAAKJ,IAAvD,CAAZ;AAEH;;AAEDlmB,MAAM,CAACC,MAAP,CAAeykB,sBAAsB,CAACjkB,SAAtC,EAAiD;AAE7CmG,EAAAA,WAAW,EAAE8d,sBAFgC;;AAI7C;;;;;;;AAOAnJ,EAAAA,WAAW,EAAE,UAAW9e,MAAX,EAAmBC,KAAnB,EAA2B;AAEpC,QAAK,KAAKlB,UAAV,EAAuB;AAEnB,WAAKA,UAAL,CAAiB;AAAEiB,QAAAA,MAAM,EAAEA,MAAV;AAAkBC,QAAAA,KAAK,EAAEA;AAAzB,OAAjB;AAEH;AAEJ,GAnB4C;;AAqB7C;;;;;AAKA6pB,EAAAA,kBAAkB,EAAE,YAAY;AAE5B,UAAMC,CAAC,GAAG,KAAKT,MAAL,CAAc,KAAKlB,KAAnB,CAAV;AACA,UAAM4B,CAAC,GAAG,KAAKT,OAAL,CAAc,KAAKnB,KAAnB,CAAV;AAEA,UAAMoB,IAAI,GAAG,KAAKA,IAAlB;AACA,UAAMC,IAAI,GAAG,KAAKA,IAAlB;AAEA,SAAKX,GAAL,GAAWttB,IAAI,CAACyuB,IAAL,CAAWF,CAAC,GAAGP,IAAf,CAAX;AACA,SAAKT,GAAL,GAAWvtB,IAAI,CAACyuB,IAAL,CAAWD,CAAC,GAAGP,IAAf,CAAX;;AAEA,SAAK,IAAI5e,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKke,GAAzB,EAA8Ble,CAAC,EAA/B,EAAoC;AAChC,WAAK,IAAID,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKke,GAAzB,EAA8Ble,CAAC,EAA/B,EAAoC;AAChC,cAAMsf,CAAC,GAAG5pB,QAAQ,CAACqH,aAAT,CAAwB,QAAxB,CAAV;AACA,YAAIiD,CAAC,GAAK,KAAKke,GAAL,GAAW,CAArB,EAA2BoB,CAAC,CAACjnB,KAAF,GAAUumB,IAAV,CAA3B,KAAgDU,CAAC,CAACjnB,KAAF,GAAU8mB,CAAC,GAAKP,IAAI,GAAG5e,CAAvB;AAChD,YAAIC,CAAC,GAAK,KAAKke,GAAL,GAAW,CAArB,EAA2BmB,CAAC,CAAC/mB,MAAF,GAAWsmB,IAAX,CAA3B,KAAiDS,CAAC,CAAC/mB,MAAF,GAAW6mB,CAAC,GAAKP,IAAI,GAAG5e,CAAxB;;AACjD,aAAK+d,OAAL,CAAarjB,IAAb,CAAmB2kB,CAAnB;;AACA,aAAKrB,IAAL,CAAUtjB,IAAV,CAAgB2kB,CAAC,CAAC5f,UAAF,CAAc,IAAd,CAAhB;AACH;AACJ;AAEJ,GA/C4C;;AAiD7C;;;;;;;;AAQA6f,EAAAA,eAAe,EAAE,UAAWvf,CAAX,EAAcC,CAAd,EAAiB9I,OAAjB,EAA2B;AAExC,UAAMynB,IAAI,GAAG,KAAKA,IAAlB;AACA,UAAMC,IAAI,GAAG,KAAKA,IAAlB;AAEA7e,IAAAA,CAAC,IAAI,GAAL;AACAC,IAAAA,CAAC,IAAI,GAAL;AAEA,UAAMuf,EAAE,GAAG5uB,IAAI,CAAC6X,KAAL,CAAYzI,CAAC,GAAG4e,IAAhB,CAAX;AACA,UAAMa,EAAE,GAAG7uB,IAAI,CAAC6X,KAAL,CAAYxI,CAAC,GAAG4e,IAAhB,CAAX;AAEA7e,IAAAA,CAAC,IAAIwf,EAAE,GAAGZ,IAAV;AACA3e,IAAAA,CAAC,IAAIwf,EAAE,GAAGZ,IAAV;;AAEA,SAAKZ,IAAL,CAAWwB,EAAE,GAAG,KAAKvB,GAAV,GAAgBsB,EAA3B,EAAgCE,SAAhC,CAA2CvoB,OAA3C,EAAoD,CAApD,EAAuD,CAAvD,EAA0DA,OAAO,CAACkB,KAAlE,EAAyElB,OAAO,CAACoB,MAAjF,EAAyFyH,CAAzF,EAA4FC,CAA5F,EAA+F,GAA/F,EAAoG,GAApG;;AAEA,SAAKvI,QAAL;AAEH,GA3E4C;;AA6E7C;;;;;AAKAA,EAAAA,QAAQ,EAAE,YAAW;AAEjB,SAAKomB,MAAL;AAEA,SAAK5J,WAAL,CAAkB,KAAK4J,MAAvB,EAA+B,KAAKC,MAApC;;AAEA,QAAK,KAAKD,MAAL,KAAgB,KAAKC,MAA1B,EAAkC;AAE9B,WAAKxf,MAAL,GAAc,KAAKyf,OAAnB;AACA,WAAK2B,MAAL,GAAc,KAAKlC,OAAnB;AACA,WAAKmC,IAAL,GAAY,KAAKpC,KAAjB;;AAEA,UAAK,KAAKe,cAAV,EAA2B;AAEvB,aAAKA,cAAL,CAAqB,KAAKP,OAAL,CAAc,CAAd,CAArB;AAEH;AAEJ;AACJ,GArG4C;;AAuG7C;;;;;AAKA6B,EAAAA,eAAe,EAAE,YAAY;AAEzB,SAAK3L,WAAL,CAAkB,CAAlB,EAAqB,CAArB;AAEA,UAAMiL,CAAC,GAAG,KAAKX,OAAL,CAAc,KAAKhB,KAAnB,CAAV;AACA,UAAM4B,CAAC,GAAG,KAAKX,OAAL,CAAc,KAAKjB,KAAnB,CAAV;AACA,UAAMpa,IAAI,GAAG,IAAb;AAEA,SAAK0a,MAAL,GAAc,CAAd;AACA,SAAKC,MAAL,GAAcoB,CAAC,GAAGC,CAAlB;AAEA,UAAM;AAAEU,MAAAA;AAAF,QAAe,KAAKvC,WAA1B;;AAEA,SAAK,IAAItd,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGmf,CAApB,EAAuBnf,CAAC,EAAxB,EAA6B;AACzB,WAAK,IAAID,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGmf,CAApB,EAAuBnf,CAAC,EAAxB,EAA6B;AACzB,cAAM/L,GAAG,GAAG,4FAA4F,KAAKupB,KAAjG,GAAyG,KAAzG,GAAiHxd,CAAjH,GAAqH,KAArH,GAA6HC,CAA7H,GAAiI,UAAjI,GAA8I,KAAKwd,OAAnJ,GAA6J,cAAzK;;AACA,SAAE,UAAUzd,CAAV,EAAaC,CAAb,EAAiB;AACf,cAAI6f,QAAJ,EAAe;AACX,kBAAM3oB,OAAO,GAAGD,aAAa,CAAClD,IAAd,CAAoBC,GAApB,EAAyB,IAAzB,EAA+B,YAAW;AACtDmP,cAAAA,IAAI,CAACmc,eAAL,CAAsBvf,CAAtB,EAAyBC,CAAzB,EAA4B9I,OAA5B;AACH,aAFe,CAAhB;AAGH,WAJD,MAIO;AACH,kBAAMwiB,GAAG,GAAG,IAAIoG,KAAJ,EAAZ;AACApG,YAAAA,GAAG,CAACrkB,gBAAJ,CAAsB,MAAtB,EAA8B,YAAW;AACrC8N,cAAAA,IAAI,CAACmc,eAAL,CAAsBvf,CAAtB,EAAyBC,CAAzB,EAA4B,IAA5B;AACH,aAFD;AAGA0Z,YAAAA,GAAG,CAAC3jB,WAAJ,GAAkB,EAAlB;AACA2jB,YAAAA,GAAG,CAACzkB,GAAJ,GAAUjB,GAAV;AACH;AACJ,SAbD,EAaK+L,CAbL,EAaQC,CAbR;AAcH;AACJ;AAEJ,GA7I4C;;AA+I7C;;;;;;AAMAjM,EAAAA,IAAI,EAAE,UAAWgsB,MAAX,EAAoB;AAEtB,SAAKC,QAAL,CAAeD,MAAf;AAEH,GAzJ4C;;AA2J7C;;;;;;AAMAC,EAAAA,QAAQ,EAAE,UAAUrN,EAAV,EAAe;AAErB,UAAMxP,IAAI,GAAG,IAAb;;AACA,SAAKsa,WAAL,CAAiBwC,eAAjB,CAAkCtN,EAAlC,EAAsC,UAAUwL,MAAV,EAAkB5nB,MAAlB,EAA0B;AAC5D,UAAIA,MAAM,KAAKmnB,MAAM,CAACC,IAAP,CAAYuC,gBAAZ,CAA6BC,EAA5C,EAAgD;AAC5Chd,QAAAA,IAAI,CAACgb,MAAL,GAAcA,MAAd;AACAhb,QAAAA,IAAI,CAACib,SAAL,GAAiBD,MAAM,CAACC,SAAxB;AACAjb,QAAAA,IAAI,CAACqa,OAAL,GAAeW,MAAM,CAACiC,QAAP,CAAgB5G,IAA/B;AACArW,QAAAA,IAAI,CAACyc,eAAL;AACH;AACJ,KAPD;AASH,GA7K4C;;AA+K7C;;;;;;AAMAS,EAAAA,OAAO,EAAE,UAAUthB,CAAV,EAAc;AAEnB,SAAKwe,KAAL,GAAaxe,CAAb;AACA,SAAKkgB,kBAAL;AACH;AAzL4C,CAAjD;AA6LA;;;;;;;;AAOA,SAASqB,wBAAT,CAAoCZ,MAApC,EAA4Ca,MAA5C,EAAqD;AAEjD/F,EAAAA,aAAa,CAAC7b,IAAd,CAAoB,IAApB;AAEA,OAAK+gB,MAAL,GAAcA,MAAd;AAEA,OAAKc,SAAL,GAAiB,IAAjB;AAEA,OAAKC,aAAL,GAAqB,KAArB;AAEA,OAAKC,iBAAL,CAAwBH,MAAxB;AAEH;;AAEDD,wBAAwB,CAACnnB,SAAzB,GAAqCT,MAAM,CAACC,MAAP,CAAeD,MAAM,CAACU,MAAP,CAAeohB,aAAa,CAACrhB,SAA7B,CAAf,EAAyD;AAE1FmG,EAAAA,WAAW,EAAEghB,wBAF6E;;AAI1F;;;;;;AAMAvsB,EAAAA,IAAI,EAAE,UAAW2rB,MAAX,EAAoB;AAEtB,SAAKe,aAAL,GAAqB,IAArB;AAEAf,IAAAA,MAAM,GAAKA,MAAM,IAAI,KAAKA,MAAjB,IAA6B,EAAtC;;AAEA,QAAKA,MAAM,IAAI,KAAKc,SAApB,EAAgC;AAE5B,WAAKG,aAAL,CAAoBjB,MAApB;AAEH;AAEJ,GAtByF;;AAwB1F;;;;;;AAMAgB,EAAAA,iBAAiB,EAAE,UAAWH,MAAX,EAAoB;AAEnC,UAAMK,MAAM,GAAGnrB,QAAQ,CAACqH,aAAT,CAAwB,QAAxB,CAAf;AACA8jB,IAAAA,MAAM,CAAC3rB,GAAP,GAAa,0CAAb;AACA2rB,IAAAA,MAAM,CAAC3rB,GAAP,IAAcsrB,MAAM,GAAG,SAASA,MAAZ,GAAqB,EAAzC;AACAK,IAAAA,MAAM,CAACvqB,kBAAP,GAA4B,KAAKwqB,YAAL,CAAkB7mB,IAAlB,CAAwB,IAAxB,CAA5B;AACA4mB,IAAAA,MAAM,CAACE,MAAP,GAAgB,KAAKD,YAAL,CAAkB7mB,IAAlB,CAAwB,IAAxB,CAAhB;AAEAvE,IAAAA,QAAQ,CAACgd,aAAT,CAAwB,MAAxB,EAAiC3G,WAAjC,CAA8C8U,MAA9C;AAEH,GAxCyF;;AA0C1F;;;;;AAKAC,EAAAA,YAAY,EAAE,YAAY;AAEtB,SAAKL,SAAL,GAAiB,IAAIpD,sBAAJ,EAAjB;;AAEA,QAAK,KAAKqD,aAAV,EAA0B;AAEtB,WAAK1sB,IAAL;AAEH;AAEJ,GAzDyF;;AA2D1F;;;;;;AAMAgtB,EAAAA,YAAY,EAAE,YAAY;AAEtB,WAAO,KAAKP,SAAZ;AAEH,GArEyF;;AAuE1F;;;;;;AAMAG,EAAAA,aAAa,EAAE,UAAWjB,MAAX,EAAoB;AAE/B,SAAKe,aAAL,GAAqB,KAArB;AAEA,SAAKD,SAAL,CAAetsB,UAAf,GAA4B,KAAKA,UAAL,CAAgB8F,IAAhB,CAAsB,IAAtB,CAA5B;AAEA,SAAKwmB,SAAL,CAAelC,cAAf,GAAgC,KAAKrqB,MAAL,CAAY+F,IAAZ,CAAkB,IAAlB,CAAhC;AAEA,SAAKwmB,SAAL,CAAeH,OAAf,CAAwB,KAAKrH,YAAL,EAAxB;AAEA,SAAKwH,SAAL,CAAezsB,IAAf,CAAqB2rB,MAArB;AAEA,SAAKc,SAAL,CAAerrB,MAAf,GAAwB,IAAxB;AACH,GA1FyF;;AA4F1F;;;;;;AAMAlB,EAAAA,MAAM,EAAE,UAAWqK,MAAX,EAAoB;AAExBkc,IAAAA,aAAa,CAACrhB,SAAd,CAAwBlF,MAAxB,CAA+B0K,IAA/B,CAAqC,IAArC,EAA2C,IAAI3P,OAAJ,CAAasP,MAAb,CAA3C;AAEH,GAtGyF;;AAwG1F;;;;;AAKAsb,EAAAA,KAAK,EAAE,YAAY;AAEf,SAAK4G,SAAL,GAAiBzrB,SAAjB;AAEAylB,IAAAA,aAAa,CAACrhB,SAAd,CAAwBygB,KAAxB,CAA8Bjb,IAA9B,CAAoC,IAApC;AAEH;AAnHyF,CAAzD,CAArC;AAuHA;;;;;;AAMA;;;;;;;;;;;;;AAYA,MAAMqiB,mBAAmB,GAAG;AAExB7G,EAAAA,QAAQ,EAAE;AAEN,gBAAY;AAAErT,MAAAA,KAAK,EAAE,IAAI9X,OAAJ;AAAT,KAFN;AAGN,kBAAc;AAAE8X,MAAAA,KAAK,EAAE;AAAT,KAHR;AAIN,iBAAa;AAAEA,MAAAA,KAAK,EAAE,IAAIvW,OAAJ;AAAT,KAJP;AAKN,YAAQ;AAAEuW,MAAAA,KAAK,EAAE;AAAT,KALF;AAMN,eAAW;AAAEA,MAAAA,KAAK,EAAE;AAAT;AANL,GAFc;AAYxBqU,EAAAA,YAAY,EAAE,CAEV,mBAFU,EAIV,eAJU,EAMV,WANU,EAOV,sCAPU,EASV,GATU,EAWZ8F,IAXY,CAWN,IAXM,CAZU;AAyBxB/F,EAAAA,cAAc,EAAE,CAEZ,6BAFY,EAGZ,2BAHY,EAIZ,yBAJY,EAKZ,qBALY,EAMZ,wBANY,EAQZ,mBARY,EAUZ,qCAVY,EAYZ,cAZY,EAcZ,oCAdY,EAgBZ,oDAhBY,EAkBZ,iEAlBY,EAmBZ,qEAnBY,EAqBZ,2DArBY,EAuBZ,uBAvBY,EAwBZ,sDAxBY,EAyBZ,iCAzBY,EA0BZ,IA1BY,EA4BZ,iDA5BY,EA8BZ,4BA9BY,EAgCZ,GAhCY,EAkCd+F,IAlCc,CAkCR,IAlCQ;AAzBQ,CAA5B;AA+DA;;;;;;;;;AAQA,SAASC,YAAT,CAAwB7mB,IAAI,GAAG,OAA/B,EAAwCmiB,MAAxC,EAAgD2E,IAAI,GAAG,KAAvD,EAA8DrjB,KAAK,GAAG,GAAtE,EAA4E;AAExE,MAAKzD,IAAI,KAAK,OAAd,EAAwB;AAEpBmgB,IAAAA,aAAa,CAAC7b,IAAd,CAAoB,IAApB,EAA0B6d,MAA1B,EAAkC,KAAK4E,cAAL,CAAqBD,IAArB,EAA2BrjB,KAA3B,CAAlC,EAAsE,KAAKujB,cAAL,CAAqBF,IAArB,CAAtE;AAEH;;AAED,OAAKA,IAAL,GAAYA,IAAZ;AACA,OAAKrjB,KAAL,GAAaA,KAAb;AACA,OAAKwjB,GAAL,GAAW,QAAX;AACA,OAAKC,OAAL,GAAe,IAAf;AAEA,OAAKC,QAAL,GAAgB,KAAhB;AACA,OAAKC,SAAL,GAAiB,IAAIjxB,OAAJ,EAAjB;AAEA,OAAKkxB,KAAL,GAAa,IAAIjxB,UAAJ,EAAb;AACA,OAAKkxB,KAAL,GAAa,IAAIlxB,UAAJ,EAAb;AACA,OAAKmxB,OAAL,GAAe,IAAInxB,UAAJ,EAAf;AACA,OAAKoxB,SAAL,GAAiB,IAAIpxB,UAAJ,EAAjB;AAEA,OAAKqxB,OAAL,GAAe,IAAIlyB,OAAJ,CAAa,CAAb,EAAgB,CAAhB,EAAmB,CAAnB,CAAf;AACA,OAAKmyB,OAAL,GAAe,IAAInyB,OAAJ,CAAa,CAAb,EAAgB,CAAhB,EAAmB,CAAnB,CAAf;AAEA,OAAKyF,gBAAL,CAAuB,eAAvB,EAAwC,KAAK4G,cAA7C;AAEH;;AAEDilB,YAAY,CAAC/nB,SAAb,GAAyBT,MAAM,CAACC,MAAP,CAAeD,MAAM,CAACU,MAAP,CAAeohB,aAAa,CAACrhB,SAA7B,CAAf,EAAyD;AAE9EmG,EAAAA,WAAW,EAAE4hB,YAFiE;AAI9EvrB,EAAAA,GAAG,EAAE,UAAW4N,MAAX,EAAoB;AAErB,QAAKiD,SAAS,CAAC7M,MAAV,GAAmB,CAAxB,EAA4B;AAExB,WAAM,IAAI5B,CAAC,GAAG,CAAd,EAAiBA,CAAC,GAAGyO,SAAS,CAAC7M,MAA/B,EAAuC5B,CAAC,EAAxC,EAA8C;AAE1C,aAAKpC,GAAL,CAAU6Q,SAAS,CAAEzO,CAAF,CAAnB;AAEH;;AAED,aAAO,IAAP;AAEH;;AAED,QAAKwL,MAAM,YAAYsG,QAAvB,EAAkC;AAE9BtG,MAAAA,MAAM,CAAC9E,QAAP,CAAgBiM,SAAhB,GAA4B,KAA5B;AAEH;;AAED8P,IAAAA,aAAa,CAACrhB,SAAd,CAAwBxD,GAAxB,CAA4BgJ,IAA5B,CAAkC,IAAlC,EAAwC4E,MAAxC;AAEH,GA1B6E;AA4B9E6d,EAAAA,cAAc,EAAE,UAAWD,IAAX,EAAiBrjB,KAAjB,EAAyB;AAErC,WAAO,IAAIpN,mBAAJ,CAAyBywB,IAAzB,EAA+BA,IAAI,GAAGrjB,KAAtC,CAAP;AAEH,GAhC6E;AAkC9EujB,EAAAA,cAAc,EAAE,UAAWF,IAAX,EAAkB;AAE9B,UAAMlG,MAAM,GAAGviB,MAAM,CAACC,MAAP,CAAe,EAAf,EAAmBqoB,mBAAnB,CAAf;AAAA,UAAyD7G,QAAQ,GAAGc,MAAM,CAACd,QAA3E;AAEAA,IAAAA,QAAQ,CAACwF,IAAT,CAAc7Y,KAAd,GAAsBqa,IAAtB;AACAhH,IAAAA,QAAQ,CAACjZ,OAAT,CAAiB4F,KAAjB,GAAyB,GAAzB;AAEA,WAAO,IAAIxW,cAAJ,CAAoB;AAEvB6pB,MAAAA,QAAQ,EAAEA,QAFa;AAGvBgB,MAAAA,YAAY,EAAEF,MAAM,CAACE,YAHE;AAIvBD,MAAAA,cAAc,EAAED,MAAM,CAACC,cAJA;AAKvBzQ,MAAAA,IAAI,EAAE3a,QALiB;AAMvB6a,MAAAA,WAAW,EAAE;AANU,KAApB,CAAP;AAUH,GAnD6E;AAqD9EqX,EAAAA,mBAAmB,EAAE,YAAY;AAE7B,SAAKppB,SAAL,CAAevD,gBAAf,CAAiC,WAAjC,EAA8C,KAAKse,WAAL,CAAiB3Z,IAAjB,CAAuB,IAAvB,CAA9C,EAA6E;AAAE4Z,MAAAA,OAAO,EAAE;AAAX,KAA7E;AACA,SAAKhb,SAAL,CAAevD,gBAAf,CAAiC,WAAjC,EAA8C,KAAK4sB,WAAL,CAAiBjoB,IAAjB,CAAuB,IAAvB,CAA9C,EAA6E;AAAE4Z,MAAAA,OAAO,EAAE;AAAX,KAA7E;AACA,SAAKhb,SAAL,CAAevD,gBAAf,CAAiC,SAAjC,EAA4C,KAAK6sB,SAAL,CAAeloB,IAAf,CAAqB,IAArB,CAA5C,EAAyE;AAAE4Z,MAAAA,OAAO,EAAE;AAAX,KAAzE;AACA,SAAKhb,SAAL,CAAevD,gBAAf,CAAiC,YAAjC,EAA+C,KAAKse,WAAL,CAAiB3Z,IAAjB,CAAuB,IAAvB,CAA/C,EAA8E;AAAE4Z,MAAAA,OAAO,EAAE;AAAX,KAA9E;AACA,SAAKhb,SAAL,CAAevD,gBAAf,CAAiC,WAAjC,EAA8C,KAAK4sB,WAAL,CAAiBjoB,IAAjB,CAAuB,IAAvB,CAA9C,EAA6E;AAAE4Z,MAAAA,OAAO,EAAE;AAAX,KAA7E;AACA,SAAKhb,SAAL,CAAevD,gBAAf,CAAiC,UAAjC,EAA6C,KAAK6sB,SAAL,CAAeloB,IAAf,CAAqB,IAArB,CAA7C,EAA0E;AAAE4Z,MAAAA,OAAO,EAAE;AAAX,KAA1E;AACA,SAAKhb,SAAL,CAAevD,gBAAf,CAAiC,YAAjC,EAA+C,KAAK8sB,YAAL,CAAkBnoB,IAAlB,CAAwB,IAAxB,CAA/C,EAA+E;AAAE4Z,MAAAA,OAAO,EAAE;AAAX,KAA/E;AACA,SAAKhb,SAAL,CAAevD,gBAAf,CAAiC,gBAAjC,EAAmD,KAAK8sB,YAAL,CAAkBnoB,IAAlB,CAAwB,IAAxB,CAAnD,EAAmF;AAAE4Z,MAAAA,OAAO,EAAE;AAAX,KAAnF;AACA,SAAKhb,SAAL,CAAevD,gBAAf,CAAiC,aAAjC,EAAgD,KAAK+sB,aAAL,CAAmBpoB,IAAnB,CAAyB,IAAzB,CAAhD,EAAiF;AAAE4Z,MAAAA,OAAO,EAAE;AAAX,KAAjF;AAEH,GAjE6E;AAmE9EyO,EAAAA,qBAAqB,EAAE,YAAY;AAE/B,SAAKzpB,SAAL,CAAeoD,mBAAf,CAAoC,WAApC,EAAiD,KAAK2X,WAAL,CAAiB3Z,IAAjB,CAAuB,IAAvB,CAAjD,EAAgF,KAAhF;AACA,SAAKpB,SAAL,CAAeoD,mBAAf,CAAoC,WAApC,EAAiD,KAAKimB,WAAL,CAAiBjoB,IAAjB,CAAuB,IAAvB,CAAjD,EAAgF,KAAhF;AACA,SAAKpB,SAAL,CAAeoD,mBAAf,CAAoC,SAApC,EAA+C,KAAKkmB,SAAL,CAAeloB,IAAf,CAAqB,IAArB,CAA/C,EAA4E,KAA5E;AACA,SAAKpB,SAAL,CAAeoD,mBAAf,CAAoC,YAApC,EAAkD,KAAK2X,WAAL,CAAiB3Z,IAAjB,CAAuB,IAAvB,CAAlD,EAAiF,KAAjF;AACA,SAAKpB,SAAL,CAAeoD,mBAAf,CAAoC,WAApC,EAAiD,KAAKimB,WAAL,CAAiBjoB,IAAjB,CAAuB,IAAvB,CAAjD,EAAgF,KAAhF;AACA,SAAKpB,SAAL,CAAeoD,mBAAf,CAAoC,UAApC,EAAgD,KAAKkmB,SAAL,CAAeloB,IAAf,CAAqB,IAArB,CAAhD,EAA6E,KAA7E;AACA,SAAKpB,SAAL,CAAeoD,mBAAf,CAAoC,YAApC,EAAkD,KAAKmmB,YAAL,CAAkBnoB,IAAlB,CAAwB,IAAxB,CAAlD,EAAkF,KAAlF;AACA,SAAKpB,SAAL,CAAeoD,mBAAf,CAAoC,gBAApC,EAAsD,KAAKmmB,YAAL,CAAkBnoB,IAAlB,CAAwB,IAAxB,CAAtD,EAAsF,KAAtF;AACA,SAAKpB,SAAL,CAAeoD,mBAAf,CAAoC,aAApC,EAAmD,KAAKomB,aAAL,CAAmBpoB,IAAnB,CAAyB,IAAzB,CAAnD,EAAoF,KAApF;AAEH,GA/E6E;AAiF9E2Z,EAAAA,WAAW,EAAE,UAAWld,KAAX,EAAmB;AAE5B,UAAM6rB,UAAU,GAAK7rB,KAAK,CAAC8rB,OAAN,IAAiB9rB,KAAK,CAAC8rB,OAAN,CAAc5oB,MAAjC,IAA6C,CAAhE;;AAEA,YAAS2oB,UAAT;AAEA,WAAK,CAAL;AAEI,cAAMviB,CAAC,GAAKtJ,KAAK,CAAC2V,OAAN,IAAiB,CAAnB,GAAyB3V,KAAK,CAAC2V,OAA/B,GAAyC3V,KAAK,CAAC8rB,OAAN,CAAe,CAAf,EAAmBnW,OAAtE;AACA,cAAMpM,CAAC,GAAKvJ,KAAK,CAAC4V,OAAN,IAAiB,CAAnB,GAAyB5V,KAAK,CAAC4V,OAA/B,GAAyC5V,KAAK,CAAC8rB,OAAN,CAAe,CAAf,EAAmBlW,OAAtE;AAEA,aAAKmV,QAAL,GAAgB,IAAhB;AACA,aAAKC,SAAL,CAAe5kB,GAAf,CAAoBkD,CAApB,EAAuBC,CAAvB;AAEA;;AAEJ,WAAK,CAAL;AAEI,cAAMwiB,EAAE,GAAG/rB,KAAK,CAAC8rB,OAAN,CAAe,CAAf,EAAmBjO,KAAnB,GAA2B7d,KAAK,CAAC8rB,OAAN,CAAe,CAAf,EAAmBjO,KAAzD;AACA,cAAMmO,EAAE,GAAGhsB,KAAK,CAAC8rB,OAAN,CAAe,CAAf,EAAmBG,KAAnB,GAA2BjsB,KAAK,CAAC8rB,OAAN,CAAe,CAAf,EAAmBG,KAAzD;AACA,cAAMC,QAAQ,GAAGhyB,IAAI,CAACqX,IAAL,CAAWwa,EAAE,GAAGA,EAAL,GAAUC,EAAE,GAAGA,EAA1B,CAAjB;AACA,aAAKhB,SAAL,CAAemB,aAAf,GAA+BD,QAA/B;AAEA;;AAEJ;AAEI;AAvBJ;;AA2BA,SAAKE,gBAAL;AAEH,GAlH6E;AAoH9EZ,EAAAA,WAAW,EAAE,UAAWxrB,KAAX,EAAmB;AAE5B,UAAM6rB,UAAU,GAAK7rB,KAAK,CAAC8rB,OAAN,IAAiB9rB,KAAK,CAAC8rB,OAAN,CAAc5oB,MAAjC,IAA6C,CAAhE;;AAEA,YAAS2oB,UAAT;AAEA,WAAK,CAAL;AAEI,cAAMviB,CAAC,GAAKtJ,KAAK,CAAC2V,OAAN,IAAiB,CAAnB,GAAyB3V,KAAK,CAAC2V,OAA/B,GAAyC3V,KAAK,CAAC8rB,OAAN,CAAe,CAAf,EAAmBnW,OAAtE;AACA,cAAMpM,CAAC,GAAKvJ,KAAK,CAAC4V,OAAN,IAAiB,CAAnB,GAAyB5V,KAAK,CAAC4V,OAA/B,GAAyC5V,KAAK,CAAC8rB,OAAN,CAAe,CAAf,EAAmBlW,OAAtE;AAEA,cAAMyW,MAAM,GAAGlyB,MAAM,CAACmyB,QAAP,CAAiBhjB,CAAC,GAAG,KAAK0hB,SAAL,CAAe1hB,CAApC,IAA0C,GAAzD;AACA,cAAMijB,MAAM,GAAGpyB,MAAM,CAACmyB,QAAP,CAAiB/iB,CAAC,GAAG,KAAKyhB,SAAL,CAAezhB,CAApC,IAA0C,GAAzD;;AAEA,YAAK,KAAKwhB,QAAV,EAAqB;AACjB,eAAKE,KAAL,CAAWuB,gBAAX,CAA6B,KAAKlB,OAAlC,EAA2Ce,MAA3C;AACA,eAAKnB,KAAL,CAAWsB,gBAAX,CAA6B,KAAKnB,OAAlC,EAA2CkB,MAA3C;AACA,eAAKpB,OAAL,CAAasB,QAAb,CAAuB,KAAKxB,KAA5B,EAAoCwB,QAApC,CAA8C,KAAKvB,KAAnD;AACA,eAAKF,SAAL,CAAe5kB,GAAf,CAAoBkD,CAApB,EAAuBC,CAAvB;AACH;;AAED;;AAEJ,WAAK,CAAL;AAEI,cAAMwiB,EAAE,GAAG/rB,KAAK,CAAC8rB,OAAN,CAAe,CAAf,EAAmBjO,KAAnB,GAA2B7d,KAAK,CAAC8rB,OAAN,CAAe,CAAf,EAAmBjO,KAAzD;AACA,cAAMmO,EAAE,GAAGhsB,KAAK,CAAC8rB,OAAN,CAAe,CAAf,EAAmBG,KAAnB,GAA2BjsB,KAAK,CAAC8rB,OAAN,CAAe,CAAf,EAAmBG,KAAzD;AACA,cAAMC,QAAQ,GAAGhyB,IAAI,CAACqX,IAAL,CAAWwa,EAAE,GAAGA,EAAL,GAAUC,EAAE,GAAGA,EAA1B,CAAjB;AAEA,aAAKU,YAAL,CAAmB,KAAK1B,SAAL,CAAemB,aAAf,GAA+BD,QAAlD;AAEA;;AAEJ;AAEI;AA/BJ;AAmCH,GA3J6E;AA6J9ET,EAAAA,SAAS,EAAE,YAAY;AAEnB,SAAKV,QAAL,GAAgB,KAAhB;AAEH,GAjK6E;AAmK9EW,EAAAA,YAAY,EAAE,UAAW1rB,KAAX,EAAmB;AAE7BA,IAAAA,KAAK,CAACmY,cAAN;AACAnY,IAAAA,KAAK,CAACoY,eAAN;AAEA,QAAI/B,KAAK,GAAG,CAAZ;;AAEA,QAAKrW,KAAK,CAAC2sB,UAAN,KAAqBruB,SAA1B,EAAsC;AAAE;AAEpC+X,MAAAA,KAAK,GAAGrW,KAAK,CAAC2sB,UAAd;AAEH,KAJD,MAIO,IAAK3sB,KAAK,CAAC4sB,MAAN,KAAiBtuB,SAAtB,EAAkC;AAAE;AAEvC+X,MAAAA,KAAK,GAAG,CAAErW,KAAK,CAAC4sB,MAAhB;AAEH;;AAED,SAAKF,YAAL,CAAmBrW,KAAnB;AACA,SAAK+V,gBAAL;AAEH,GAvL6E;AAyL9EM,EAAAA,YAAY,EAAE,UAAWrW,KAAX,EAAmB;AAE7B,UAAMqN,QAAQ,GAAG,KAAK1b,QAAL,CAAc0b,QAA/B;AACA,UAAMmJ,UAAU,GAAG,KAAKnC,IAAL,GAAY,GAA/B;AACA,UAAMoC,UAAU,GAAG,KAAKpC,IAAL,GAAY,EAA/B;AAEAhH,IAAAA,QAAQ,CAACwF,IAAT,CAAc7Y,KAAd,IAAuBgG,KAAvB;;AAEA,QAAKqN,QAAQ,CAACwF,IAAT,CAAc7Y,KAAd,IAAuBwc,UAA5B,EAAyC;AAErCnJ,MAAAA,QAAQ,CAACwF,IAAT,CAAc7Y,KAAd,GAAsBwc,UAAtB;AAEH,KAJD,MAIO,IAAKnJ,QAAQ,CAACwF,IAAT,CAAc7Y,KAAd,IAAuByc,UAA5B,EAAyC;AAE5CpJ,MAAAA,QAAQ,CAACwF,IAAT,CAAc7Y,KAAd,GAAsByc,UAAtB;AAEH;AAEJ,GA3M6E;AA6M9EV,EAAAA,gBAAgB,EAAE,YAAY;AAE1B,SAAKtB,OAAL,GAAejsB,MAAM,CAAC0L,qBAAP,CAA8B,KAAK6hB,gBAAL,CAAsB7oB,IAAtB,CAA4B,IAA5B,CAA9B,CAAf;AAEA,SAAK6nB,SAAL,CAAe2B,KAAf,CAAsB,KAAK5B,OAA3B,EAAoC,GAApC;;AAEA,QAAK,KAAKnjB,QAAV,EAAqB;AAEjB,WAAKA,QAAL,CAAc0b,QAAd,CAAuBhN,SAAvB,CAAiCrG,KAAjC,CAAuC2c,0BAAvC,CAAmE,KAAK5B,SAAxE;AAEH;;AAED,QAAK,CAAC,KAAKL,QAAN,IAAkB,MAAM,KAAKK,SAAL,CAAe6B,KAAf,GAAuBC,GAAvB,CAA4B,KAAK/B,OAAjC,CAAN,GAAmD,KAAKN,GAA/E,EAAqF;AAEjFhsB,MAAAA,MAAM,CAACiM,oBAAP,CAA6B,KAAKggB,OAAlC;AAEH;AAEJ,GA/N6E;AAiO9E3H,EAAAA,KAAK,EAAE,YAAY;AAEf,SAAKgI,OAAL,CAAa/kB,GAAb,CAAkB,CAAlB,EAAqB,CAArB,EAAwB,CAAxB,EAA2B,CAA3B;AACA,SAAKglB,SAAL,CAAehlB,GAAf,CAAoB,CAApB,EAAuB,CAAvB,EAA0B,CAA1B,EAA6B,CAA7B;AACA,SAAKgmB,gBAAL;AAEH,GAvO6E;AAyO9E5uB,EAAAA,MAAM,EAAE,UAAWiD,OAAX,EAAqB;AAEzB,SAAKuH,QAAL,CAAc0b,QAAd,CAAuByJ,UAAvB,CAAkC9c,KAAlC,GAA0C,KAAKlO,SAAL,CAAe8E,WAAf,GAA6B,KAAK9E,SAAL,CAAe+E,YAAtF;AAEA,SAAKqkB,mBAAL;AACA,SAAKa,gBAAL;AAEA,SAAKvmB,aAAL,CAAoB;AAAEjC,MAAAA,IAAI,EAAE,yBAAR;AAAmC6T,MAAAA,MAAM,EAAE;AAA3C,KAApB;AAEAsM,IAAAA,aAAa,CAACrhB,SAAd,CAAwBlF,MAAxB,CAA+B0K,IAA/B,CAAqC,IAArC,EAA2CzH,OAA3C;AAEH,GApP6E;AAsP9EojB,EAAAA,OAAO,EAAE,YAAY;AAEjB,SAAK+H,qBAAL;AAEA,SAAK/lB,aAAL,CAAoB;AAAEjC,MAAAA,IAAI,EAAE,yBAAR;AAAmC6T,MAAAA,MAAM,EAAE,eAA3C;AAA4DtC,MAAAA,IAAI,EAAE1Z,QAAQ,CAACC;AAA3E,KAApB;AAEAmD,IAAAA,MAAM,CAACiM,oBAAP,CAA6B,KAAKggB,OAAlC;AAEA/G,IAAAA,aAAa,CAACrhB,SAAd,CAAwBmhB,OAAxB,CAAgC3b,IAAhC,CAAsC,IAAtC;AAEH,GAhQ6E;AAkQ9E1C,EAAAA,cAAc,EAAE,YAAY;AAExB,SAAKwC,QAAL,CAAc0b,QAAd,CAAuByJ,UAAvB,CAAkC9c,KAAlC,GAA0C,KAAKlO,SAAL,CAAe8E,WAAf,GAA6B,KAAK9E,SAAL,CAAe+E,YAAtF;AAEH,GAtQ6E;AAwQ9EykB,EAAAA,aAAa,EAAE,YAAY;AAEvB,SAAKZ,QAAL,GAAgB,KAAhB;AAEH,GA5Q6E;AA8Q9EpT,EAAAA,OAAO,EAAE,YAAY;AAEjB,SAAKiU,qBAAL;AAEA7H,IAAAA,aAAa,CAACrhB,SAAd,CAAwBiV,OAAxB,CAAgCzP,IAAhC,CAAsC,IAAtC;AAEH;AApR6E,CAAzD,CAAzB;AAwRA;;;;;;;;AAOA,SAASklB,iBAAT,CAA6BrH,MAA7B,EAAqC2E,IAArC,EAA2CrjB,KAA3C,EAAmD;AAE/CojB,EAAAA,YAAY,CAACviB,IAAb,CAAmB,IAAnB,EAAyB,OAAzB,EAAkC6d,MAAlC,EAA0C2E,IAA1C,EAAgDrjB,KAAhD;AAEH;;AAED+lB,iBAAiB,CAAC1qB,SAAlB,GAA8BT,MAAM,CAACC,MAAP,CAAeD,MAAM,CAACU,MAAP,CAAe8nB,YAAY,CAAC/nB,SAA5B,CAAf,EAAwD;AAElFmG,EAAAA,WAAW,EAAEukB,iBAFqE;;AAIlF;;;;;;AAMA5vB,EAAAA,MAAM,EAAE,UAAWiD,OAAX,EAAqB;AAEzB,SAAKiiB,aAAL,CAAoBjiB,OAApB;AAEAgqB,IAAAA,YAAY,CAAC/nB,SAAb,CAAuBlF,MAAvB,CAA8B0K,IAA9B,CAAoC,IAApC,EAA0CzH,OAA1C;AAEH,GAhBiF;;AAkBlF;;;;;;AAMAiiB,EAAAA,aAAa,EAAE,UAAWjiB,OAAX,EAAqB;AAEhCA,IAAAA,OAAO,CAACwF,SAAR,GAAoBxF,OAAO,CAACyF,SAAR,GAAoBrN,YAAxC;AAEA,SAAKmP,QAAL,CAAc0b,QAAd,CAAwB,UAAxB,EAAqCrT,KAArC,GAA6C5P,OAA7C;AAEH,GA9BiF;;AAgClF;;;;;AAKAkX,EAAAA,OAAO,EAAE,YAAY;AAEjB,UAAM0V,QAAQ,GAAG,KAAKrlB,QAAL,CAAc0b,QAAd,CAAwB,UAAxB,CAAjB;;AAEA,QAAK2J,QAAQ,IAAIA,QAAQ,CAAChd,KAA1B,EAAkC;AAE9Bgd,MAAAA,QAAQ,CAAChd,KAAT,CAAesH,OAAf;AAEH;;AAED8S,IAAAA,YAAY,CAAC/nB,SAAb,CAAuBiV,OAAvB,CAA+BzP,IAA/B,CAAqC,IAArC;AAEH;AAjDiF,CAAxD,CAA9B;AAqDA;;;;;;;AAMA,SAASolB,cAAT,CAA0B9rB,WAA1B,EAAwC;AAEpC,QAAMkJ,MAAM,GAAG,IAAf;AACA,QAAMkN,QAAQ,GAAG,IAAIre,oBAAJ,CAA0BmR,MAA1B,EAAkC,EAAlC,EAAsC,EAAtC,CAAjB;AACA,QAAM1C,QAAQ,GAAG,IAAIxO,iBAAJ,CAAuB;AAAEwR,IAAAA,OAAO,EAAE;AAAX,GAAvB,CAAjB;AAEAgW,EAAAA,QAAQ,CAAC9Y,IAAT,CAAe,IAAf,EAAqB0P,QAArB,EAA+B5P,QAA/B;AAEA,OAAKulB,KAAL,GAAa,IAAIhsB,KAAJ,CAAWC,WAAX,CAAb;AACA,OAAKkJ,MAAL,GAAcA,MAAd;AAEA,OAAK9L,gBAAL,CAAuB,OAAvB,EAAgC,KAAK4E,KAAL,CAAWD,IAAX,CAAiB,IAAjB,CAAhC;AACA,OAAK3E,gBAAL,CAAuB,OAAvB,EAAgC,KAAK0E,IAAL,CAAUC,IAAV,CAAgB,IAAhB,CAAhC;AACA,OAAK3E,gBAAL,CAAuB,oBAAvB,EAA6C,KAAK4uB,mBAAL,CAAyBjqB,IAAzB,CAA+B,IAA/B,CAA7C;AACA,OAAK3E,gBAAL,CAAuB,gBAAvB,EAAyC,KAAK6uB,eAAL,CAAqBlqB,IAArB,CAA2B,IAA3B,CAAzC;AAEH;;AAED+pB,cAAc,CAAC5qB,SAAf,GAA2BT,MAAM,CAACC,MAAP,CAAeD,MAAM,CAACU,MAAP,CAAeqe,QAAQ,CAACte,SAAxB,CAAf,EAAoD;AAE3EmG,EAAAA,WAAW,EAAEykB,cAF8D;;AAI3E;;;;;;AAMAE,EAAAA,mBAAmB,EAAE,UAAW;AAAErrB,IAAAA;AAAF,GAAX,EAA2B;AAE5C,SAAKorB,KAAL,CAAW3qB,YAAX,CAAyBT,SAAzB;AAEH,GAd0E;;AAgB3E;;;;;;AAMAsrB,EAAAA,eAAe,EAAE,UAAW;AAAErrB,IAAAA;AAAF,GAAX,EAAuB;AAEpC,SAAKmrB,KAAL,CAAW1qB,QAAX,CAAqBT,KAArB;AAEH,GA1B0E;;AA4B3E;;;;;;AAMAoB,EAAAA,KAAK,EAAE,YAAY;AAEf,WAAO,KAAK+pB,KAAL,CAAW/pB,KAAX,EAAP;AAEH,GAtC0E;;AAwC3E;;;;;AAKAF,EAAAA,IAAI,EAAE,YAAY;AAEd,SAAKiqB,KAAL,CAAWjqB,IAAX;AAEH;AAjD0E,CAApD,CAA3B;AAqDA;;;;;;;;AAOA,SAASoqB,aAAT,CAAyB5gB,MAAzB,EAAiC6gB,UAAjC,EAA8C;AAE1C,OAAK7gB,MAAL,GAAcA,MAAd;AACA,OAAK6gB,UAAL,GAAoBA,UAAU,KAAKrvB,SAAjB,GAA+BqvB,UAA/B,GAA4C3uB,QAA9D;AACA,OAAKA,QAAL,GAAkB2uB,UAAU,KAAKrvB,SAAjB,GAA+BqvB,UAAU,CAACC,aAA1C,GAA0D5uB,QAA1E;AACA,OAAK8rB,OAAL,GAAe,IAAf,CAL0C,CAO1C;AAEA;;AACA,OAAKntB,OAAL,GAAe,IAAf;AAEA;;;;;AAIA,OAAKggB,MAAL,GAAc,IAAIxkB,OAAJ,EAAd,CAhB0C,CAkB1C;;AACA,OAAKgN,MAAL,GAAc,KAAKwX,MAAnB;AAEA;;;;;AAIA,OAAKkQ,MAAL,GAAc,KAAd;AACA,OAAKC,SAAL,GAAiB,GAAjB,CA1B0C,CA4B1C;;AACA,OAAKC,WAAL,GAAmB,CAAnB;AACA,OAAKC,WAAL,GAAmB7e,QAAnB,CA9B0C,CAgC1C;;AACA,OAAK8e,OAAL,GAAe,CAAf;AACA,OAAKC,OAAL,GAAe/e,QAAf,CAlC0C,CAoC1C;;AACA,OAAKgf,QAAL,GAAgB,KAAhB;AACA,OAAKC,WAAL,GAAmB,CAAC,IAApB,CAtC0C,CAwC1C;;AACA,OAAKC,KAAL,GAAa,IAAb;AACA,OAAKC,WAAL,GAAmB,GAAnB,CA1C0C,CA0ClB;AAExB;;AACA,OAAKC,UAAL,GAAkB,KAAlB;AACA,OAAKC,eAAL,GAAuB,GAAvB,CA9C0C,CA8Cd;;AAE5B;;;;;AAIA,OAAKC,aAAL,GAAqB,CAArB,CApD0C,CAoDlB;;AACxB,OAAKC,aAAL,GAAqBx0B,IAAI,CAACkP,EAA1B,CArD0C,CAqDZ;AAE9B;;AACD,OAAKulB,qBAAL,GAA6B,IAA7B;AACA,OAAKC,qBAAL,GAA6B,CAAC,KAA9B;AACA,OAAKC,qBAAL,GAA6B,EAA7B,CA1D2C,CA4D3C;;AACA,OAAKC,MAAL,GAAc,EAAd;AACA,OAAKC,MAAL,GAAc,GAAd;AAEC;;;;;AAIA,OAAKC,eAAL,GAAuB,CAAE7f,QAAzB,CApE0C,CAoEP;;AACnC,OAAK8f,eAAL,GAAuB9f,QAAvB,CArE0C,CAqET;AAEjC;;AACA,OAAK+f,MAAL,GAAc,KAAd,CAxE0C,CA0E1C;;AACA,OAAKtjB,IAAL,GAAY;AAAEujB,IAAAA,IAAI,EAAE,EAAR;AAAYC,IAAAA,EAAE,EAAE,EAAhB;AAAoBC,IAAAA,KAAK,EAAE,EAA3B;AAA+BC,IAAAA,MAAM,EAAE;AAAvC,GAAZ,CA3E0C,CA6E1C;;AACA,OAAKC,YAAL,GAAoB;AAAE7zB,IAAAA,KAAK,EAAEtB,KAAK,CAAC+0B,IAAf;AAAqBK,IAAAA,IAAI,EAAEp1B,KAAK,CAACq1B,MAAjC;AAAyCC,IAAAA,GAAG,EAAEt1B,KAAK,CAACi1B;AAApD,GAApB;AAEA;;;;;AAKA,MAAIvW,KAAK,GAAG,IAAZ;AAEA,MAAI+R,GAAG,GAAG,KAAV;AACA,MAAI8E,IAAI,GAAG,KAAX;AAEA,MAAIC,WAAW,GAAG,IAAI71B,OAAJ,EAAlB;AACA,MAAI81B,SAAS,GAAG,IAAI91B,OAAJ,EAAhB;AACA,MAAI+1B,WAAW,GAAG,IAAI/1B,OAAJ,EAAlB;AAEA,MAAIg2B,QAAQ,GAAG,IAAIh2B,OAAJ,EAAf;AACA,MAAIi2B,MAAM,GAAG,IAAIj2B,OAAJ,EAAb;AACA,MAAIk2B,QAAQ,GAAG,IAAIl2B,OAAJ,EAAf;AACA,MAAIm2B,SAAS,GAAG,IAAI/2B,OAAJ,EAAhB;AAEA,MAAIg3B,MAAM,GAAG,IAAIh3B,OAAJ,EAAb;AAEA,MAAIi3B,UAAU,GAAG,IAAIr2B,OAAJ,EAAjB;AACA,MAAIs2B,QAAQ,GAAG,IAAIt2B,OAAJ,EAAf;AACA,MAAIu2B,UAAU,GAAG,IAAIv2B,OAAJ,EAAjB;AAEA,MAAIw2B,KAAK,GAAG,CAAZ;AACA,MAAIC,GAAG,GAAG,CAAV;AACA,MAAIC,QAAQ,GAAG,CAAf;AACA,MAAIC,UAAU,GAAG,CAAjB;AACA,MAAInoB,KAAK,GAAG,CAAZ;AACA,MAAIooB,GAAG,GAAG,IAAIx3B,OAAJ,EAAV;AAEA,MAAIy3B,YAAY,GAAG,IAAIz3B,OAAJ,EAAnB;AACA,MAAI03B,cAAc,GAAG,IAAI72B,UAAJ,EAArB;AAEA,MAAI82B,YAAY,GAAG,CAAnB;AAAA,MAAsBC,UAAU,GAAG,CAAnC;AACA,MAAIC,aAAJ;AACA,MAAIC,UAAU,GAAG,KAAjB;AAEA,MAAIC,KAAJ,EAAWC,SAAX,EAAsBC,OAAtB,EAA+BC,QAA/B;AAEA,MAAIC,KAAK,GAAG;AAAEh1B,IAAAA,IAAI,EAAE,CAAC,CAAT;AAAYi1B,IAAAA,MAAM,EAAE,CAApB;AAAuBC,IAAAA,KAAK,EAAE,CAA9B;AAAiC9B,IAAAA,GAAG,EAAE,CAAtC;AAAyC+B,IAAAA,YAAY,EAAE,CAAvD;AAA0DC,IAAAA,WAAW,EAAE,CAAvE;AAA0EC,IAAAA,SAAS,EAAE;AAArF,GAAZ;AAEA,MAAIC,KAAK,GAAGN,KAAK,CAACh1B,IAAlB,CA3H0C,CA6H1C;;AAEA,OAAKu1B,OAAL,GAAe,KAAKlU,MAAL,CAAYsP,KAAZ,EAAf;AACA,OAAK6E,SAAL,GAAiB,KAAKhlB,MAAL,CAAYrG,QAAZ,CAAqBwmB,KAArB,EAAjB;AACA,OAAK8E,KAAL,GAAa,KAAKjlB,MAAL,CAAYoc,IAAzB,CAjI0C,CAmI1C;;AAEA,MAAI8I,IAAI,GAAG,IAAIh4B,UAAJ,GAAiBi4B,kBAAjB,CAAqCnlB,MAAM,CAAColB,EAA5C,EAAgD,IAAI/4B,OAAJ,CAAa,CAAb,EAAgB,CAAhB,EAAmB,CAAnB,CAAhD,CAAX;AACA,MAAIg5B,WAAW,GAAGH,IAAI,CAAC/E,KAAL,GAAamF,OAAb,EAAlB,CAtI0C,CAwI1C;;AAEA,MAAIC,WAAW,GAAG;AAAEzuB,IAAAA,IAAI,EAAE;AAAR,GAAlB;AACA,MAAI0uB,UAAU,GAAG;AAAE1uB,IAAAA,IAAI,EAAE;AAAR,GAAjB;AACA,MAAI2uB,QAAQ,GAAG;AAAE3uB,IAAAA,IAAI,EAAE;AAAR,GAAf;;AAEA,OAAK4uB,iBAAL,GAAyB,UAAWC,UAAX,EAAwB;AAC7C5B,IAAAA,cAAc,CAAC9nB,IAAf,CAAqB0pB,UAArB;AACA3Z,IAAAA,KAAK,CAAChM,MAAN,CAAa2lB,UAAb,CAAwB1pB,IAAxB,CAA8B0pB,UAA9B;AACH,GAHD;;AAKA,OAAKC,eAAL,GAAuB,YAAY;AAC/B,WAAO9B,YAAP;AACH,GAFD;;AAIA,OAAK+B,UAAL,GAAkB,UAAWC,KAAX,EAAmB;AAEjC,QAAKA,KAAK,KAAKt0B,SAAf,EAA2B;AAEvBs0B,MAAAA,KAAK,GAAGC,oBAAoB,EAA5B;AAEH;;AAEDnC,IAAAA,UAAU,IAAIkC,KAAd;AAGH,GAXD;;AAaA,OAAKE,QAAL,GAAgB,UAAWF,KAAX,EAAmB;AAE/B,QAAKA,KAAK,KAAKt0B,SAAf,EAA2B;AAEvBs0B,MAAAA,KAAK,GAAGC,oBAAoB,EAA5B;AAEH;;AAEDpC,IAAAA,QAAQ,IAAImC,KAAZ;AAEH,GAVD,CApK0C,CAgL1C;;;AACA,OAAKG,OAAL,GAAe,UAAW7G,QAAX,EAAsB;AAEjC,QAAI8G,EAAE,GAAG,KAAKlmB,MAAL,CAAYmmB,MAAZ,CAAmBC,QAA5B,CAFiC,CAIjC;;AACAhD,IAAAA,SAAS,CAAC9pB,GAAV,CAAe4sB,EAAE,CAAE,CAAF,CAAjB,EAAwBA,EAAE,CAAE,CAAF,CAA1B,EAAiCA,EAAE,CAAE,CAAF,CAAnC;AACA9C,IAAAA,SAAS,CAACiD,cAAV,CAA0B,CAAEjH,QAA5B;AAEAyE,IAAAA,GAAG,CAACzxB,GAAJ,CAASgxB,SAAT;AAEH,GAVD,CAjL0C,CA6L1C;;;AACA,OAAKkD,KAAL,GAAa,UAAWlH,QAAX,EAAsB;AAE/B,QAAI8G,EAAE,GAAG,KAAKlmB,MAAL,CAAYmmB,MAAZ,CAAmBC,QAA5B,CAF+B,CAI/B;;AACAhD,IAAAA,SAAS,CAAC9pB,GAAV,CAAe4sB,EAAE,CAAE,CAAF,CAAjB,EAAwBA,EAAE,CAAE,CAAF,CAA1B,EAAiCA,EAAE,CAAE,CAAF,CAAnC;AACA9C,IAAAA,SAAS,CAACiD,cAAV,CAA0BjH,QAA1B;AAEAyE,IAAAA,GAAG,CAACzxB,GAAJ,CAASgxB,SAAT;AAEH,GAVD;AAYA;;;;;;AAIA,OAAKS,GAAL,GAAW,UAAW0C,MAAX,EAAmBC,MAAnB,EAA4B;AAEnC,QAAIjxB,OAAO,GAAGyW,KAAK,CAAC6U,UAAN,KAAqB3uB,QAArB,GAAgC8Z,KAAK,CAAC6U,UAAN,CAAiBvR,IAAjD,GAAwDtD,KAAK,CAAC6U,UAA5E;;AAEA,QAAK7U,KAAK,CAAChM,MAAN,YAAwBzS,iBAA7B,EAAiD;AAE7C;AACA,UAAIoM,QAAQ,GAAGqS,KAAK,CAAChM,MAAN,CAAarG,QAA5B;AACA,UAAI0pB,MAAM,GAAG1pB,QAAQ,CAACwmB,KAAT,GAAiBsG,GAAjB,CAAsBza,KAAK,CAAC6E,MAA5B,CAAb;AACA,UAAI6V,cAAc,GAAGrD,MAAM,CAACjtB,MAAP,EAArB,CAL6C,CAO7C;;AACAswB,MAAAA,cAAc,IAAIt5B,IAAI,CAACu5B,GAAL,CAAY3a,KAAK,CAAChM,MAAN,CAAa4mB,GAAb,GAAmB,CAArB,GAA2Bx5B,IAAI,CAACkP,EAAhC,GAAqC,KAA/C,CAAlB,CAR6C,CAU7C;;AACA0P,MAAAA,KAAK,CAACia,OAAN,CAAe,IAAIM,MAAJ,GAAaG,cAAb,GAA8BnxB,OAAO,CAAC6E,YAArD;AACA4R,MAAAA,KAAK,CAACsa,KAAN,CAAa,IAAIE,MAAJ,GAAaE,cAAb,GAA8BnxB,OAAO,CAAC6E,YAAnD;AAEH,KAdD,MAcO,IAAK4R,KAAK,CAAChM,MAAN,YAAwBxS,kBAA7B,EAAkD;AAErD;AACAwe,MAAAA,KAAK,CAACia,OAAN,CAAeM,MAAM,IAAIva,KAAK,CAAChM,MAAN,CAAa+I,KAAb,GAAqBiD,KAAK,CAAChM,MAAN,CAAanG,IAAtC,CAAN,GAAoDtE,OAAO,CAAC4E,WAA3E;AACA6R,MAAAA,KAAK,CAACsa,KAAN,CAAaE,MAAM,IAAIxa,KAAK,CAAChM,MAAN,CAAapG,GAAb,GAAmBoS,KAAK,CAAChM,MAAN,CAAaoT,MAApC,CAAN,GAAoD7d,OAAO,CAAC6E,YAAzE;AAEH,KANM,MAMA;AAEH;AACAtC,MAAAA,OAAO,CAACC,IAAR,CAAc,8EAAd;AAEH;AAEJ,GA/BD;;AAiCA,OAAK8uB,QAAL,GAAgB,YAAU;AAEtB,QAAK,CAAC1C,UAAN,EAAmB;;AAEnB,QAAK/2B,IAAI,CAAC05B,GAAL,CAAU9C,YAAV,IAA2BnB,IAA3B,IAAmCz1B,IAAI,CAAC05B,GAAL,CAAU7C,UAAV,IAAyBpB,IAAjE,EAAwE;AAEpEsB,MAAAA,UAAU,GAAG,KAAb;AACA;AACH;;AAEDF,IAAAA,UAAU,IAAM,KAAKpC,qBAArB;AACAmC,IAAAA,YAAY,IAAI,KAAKnC,qBAArB;AAEA+B,IAAAA,UAAU,IAAI,KAAK9B,qBAAL,GAA6BkC,YAA3C;AACAL,IAAAA,QAAQ,IAAM,KAAK7B,qBAAL,GAA6BmC,UAA3C;AAEH,GAhBD;;AAkBA,OAAK8C,OAAL,GAAe,UAAWC,UAAX,EAAwB;AAEnC,QAAKA,UAAU,KAAKx1B,SAApB,EAAgC;AAE5Bw1B,MAAAA,UAAU,GAAGC,YAAY,EAAzB;AAEH;;AAED,QAAKjb,KAAK,CAAChM,MAAN,YAAwBzS,iBAA7B,EAAiD;AAE7CkO,MAAAA,KAAK,IAAIurB,UAAT;AAEH,KAJD,MAIO,IAAKhb,KAAK,CAAChM,MAAN,YAAwBxS,kBAA7B,EAAkD;AAErDwe,MAAAA,KAAK,CAAChM,MAAN,CAAaoc,IAAb,GAAoBhvB,IAAI,CAACmuB,GAAL,CAAU,KAAK4F,OAAf,EAAwB/zB,IAAI,CAAC85B,GAAL,CAAU,KAAK9F,OAAf,EAAwB,KAAKphB,MAAL,CAAYoc,IAAZ,GAAmB4K,UAA3C,CAAxB,CAApB;AACAhb,MAAAA,KAAK,CAAChM,MAAN,CAAamnB,sBAAb;AACAnb,MAAAA,KAAK,CAACjT,aAAN,CAAqBwsB,WAArB;AAEH,KANM,MAMA;AAEHztB,MAAAA,OAAO,CAACC,IAAR,CAAc,qFAAd;AAEH;AAEJ,GAxBD;;AA0BA,OAAKqvB,QAAL,GAAgB,UAAWJ,UAAX,EAAwB;AAEpC,QAAKA,UAAU,KAAKx1B,SAApB,EAAgC;AAE5Bw1B,MAAAA,UAAU,GAAGC,YAAY,EAAzB;AAEH;;AAED,QAAKjb,KAAK,CAAChM,MAAN,YAAwBzS,iBAA7B,EAAiD;AAE7CkO,MAAAA,KAAK,IAAIurB,UAAT;AAEH,KAJD,MAIO,IAAKhb,KAAK,CAAChM,MAAN,YAAwBxS,kBAA7B,EAAkD;AAErDwe,MAAAA,KAAK,CAAChM,MAAN,CAAaoc,IAAb,GAAoBhvB,IAAI,CAACmuB,GAAL,CAAU,KAAK4F,OAAf,EAAwB/zB,IAAI,CAAC85B,GAAL,CAAU,KAAK9F,OAAf,EAAwB,KAAKphB,MAAL,CAAYoc,IAAZ,GAAmB4K,UAA3C,CAAxB,CAApB;AACAhb,MAAAA,KAAK,CAAChM,MAAN,CAAamnB,sBAAb;AACAnb,MAAAA,KAAK,CAACjT,aAAN,CAAqBwsB,WAArB;AAEH,KANM,MAMA;AAEHztB,MAAAA,OAAO,CAACC,IAAR,CAAc,qFAAd;AAEH;AAEJ,GAxBD;;AA0BA,OAAKyF,MAAL,GAAc,UAAW6pB,YAAX,EAA0B;AAEpC,QAAI1tB,QAAQ,GAAG,KAAKqG,MAAL,CAAYrG,QAA3B;AAEA0pB,IAAAA,MAAM,CAACpnB,IAAP,CAAatC,QAAb,EAAwB8sB,GAAxB,CAA6B,KAAK5V,MAAlC,EAJoC,CAMpC;;AACAwS,IAAAA,MAAM,CAACiE,eAAP,CAAwBpC,IAAxB,EAPoC,CASpC;;AAEAzB,IAAAA,KAAK,GAAGr2B,IAAI,CAACm6B,KAAL,CAAYlE,MAAM,CAAC7mB,CAAnB,EAAsB6mB,MAAM,CAAC7nB,CAA7B,CAAR,CAXoC,CAapC;;AAEAkoB,IAAAA,GAAG,GAAGt2B,IAAI,CAACm6B,KAAL,CAAYn6B,IAAI,CAACqX,IAAL,CAAW4e,MAAM,CAAC7mB,CAAP,GAAW6mB,MAAM,CAAC7mB,CAAlB,GAAsB6mB,MAAM,CAAC7nB,CAAP,GAAW6nB,MAAM,CAAC7nB,CAAnD,CAAZ,EAAoE6nB,MAAM,CAAC5mB,CAA3E,CAAN;;AAEA,QAAK,KAAKglB,UAAL,IAAmBqD,KAAK,KAAKN,KAAK,CAACh1B,IAAxC,EAA+C;AAE3C,WAAKq2B,UAAL,CAAiBE,oBAAoB,EAArC;AAEH;;AAED,SAAKc,QAAL;AAEApD,IAAAA,KAAK,IAAIG,UAAT;AACAF,IAAAA,GAAG,IAAIC,QAAP,CA1BoC,CA4BpC;;AACAF,IAAAA,KAAK,GAAGr2B,IAAI,CAACmuB,GAAL,CAAU,KAAK2G,eAAf,EAAgC90B,IAAI,CAAC85B,GAAL,CAAU,KAAK/E,eAAf,EAAgCsB,KAAhC,CAAhC,CAAR,CA7BoC,CA+BpC;;AACAC,IAAAA,GAAG,GAAGt2B,IAAI,CAACmuB,GAAL,CAAU,KAAKoG,aAAf,EAA8Bv0B,IAAI,CAAC85B,GAAL,CAAU,KAAKtF,aAAf,EAA8B8B,GAA9B,CAA9B,CAAN,CAhCoC,CAkCpC;;AACAA,IAAAA,GAAG,GAAGt2B,IAAI,CAACmuB,GAAL,CAAUwC,GAAV,EAAe3wB,IAAI,CAAC85B,GAAL,CAAU95B,IAAI,CAACkP,EAAL,GAAUyhB,GAApB,EAAyB2F,GAAzB,CAAf,CAAN;AAEA,QAAI9lB,MAAM,GAAGylB,MAAM,CAACjtB,MAAP,KAAkBqF,KAA/B,CArCoC,CAuCpC;;AACAmC,IAAAA,MAAM,GAAGxQ,IAAI,CAACmuB,GAAL,CAAU,KAAK0F,WAAf,EAA4B7zB,IAAI,CAAC85B,GAAL,CAAU,KAAKhG,WAAf,EAA4BtjB,MAA5B,CAA5B,CAAT,CAxCoC,CA0CpC;;AACA,SAAKiT,MAAL,CAAYze,GAAZ,CAAiByxB,GAAjB;AAEAR,IAAAA,MAAM,CAAC7mB,CAAP,GAAWoB,MAAM,GAAGxQ,IAAI,CAACiX,GAAL,CAAUqf,GAAV,CAAT,GAA2Bt2B,IAAI,CAACiX,GAAL,CAAUof,KAAV,CAAtC;AACAJ,IAAAA,MAAM,CAAC5mB,CAAP,GAAWmB,MAAM,GAAGxQ,IAAI,CAACgX,GAAL,CAAUsf,GAAV,CAApB;AACAL,IAAAA,MAAM,CAAC7nB,CAAP,GAAWoC,MAAM,GAAGxQ,IAAI,CAACiX,GAAL,CAAUqf,GAAV,CAAT,GAA2Bt2B,IAAI,CAACgX,GAAL,CAAUqf,KAAV,CAAtC,CA/CoC,CAiDpC;;AACAJ,IAAAA,MAAM,CAACiE,eAAP,CAAwBjC,WAAxB;AAEA1rB,IAAAA,QAAQ,CAACsC,IAAT,CAAe,KAAK4U,MAApB,EAA6Bze,GAA7B,CAAkCixB,MAAlC;AAEA,SAAKrjB,MAAL,CAAYwnB,MAAZ,CAAoB,KAAK3W,MAAzB;AAEA+S,IAAAA,UAAU,GAAG,CAAb;AACAD,IAAAA,QAAQ,GAAG,CAAX;AACAloB,IAAAA,KAAK,GAAG,CAAR;AACAooB,IAAAA,GAAG,CAACvqB,GAAJ,CAAS,CAAT,EAAY,CAAZ,EAAe,CAAf;AAEA;;;;;;AAKA,QAAKwqB,YAAY,CAAC2D,iBAAb,CAAgC,KAAKznB,MAAL,CAAYrG,QAA5C,IAAyDokB,GAAzD,IACJ,KAAK,IAAIgG,cAAc,CAAC3D,GAAf,CAAmB,KAAKpgB,MAAL,CAAY2lB,UAA/B,CAAT,IAAuD5H,GADxD,EAC8D;AAE1D,UAAKsJ,YAAY,KAAK,IAAtB,EAA6B;AAAE,aAAKtuB,aAAL,CAAoBwsB,WAApB;AAAoC;;AAEnEzB,MAAAA,YAAY,CAAC7nB,IAAb,CAAmB,KAAK+D,MAAL,CAAYrG,QAA/B;AACAoqB,MAAAA,cAAc,CAAC9nB,IAAf,CAAqB,KAAK+D,MAAL,CAAY2lB,UAAjC;AAEH;AAEJ,GA5ED;;AA+EA,OAAKtP,KAAL,GAAa,YAAY;AAErByO,IAAAA,KAAK,GAAGN,KAAK,CAACh1B,IAAd;AAEA,SAAKqhB,MAAL,CAAY5U,IAAZ,CAAkB,KAAK8oB,OAAvB;AACA,SAAK/kB,MAAL,CAAYrG,QAAZ,CAAqBsC,IAArB,CAA2B,KAAK+oB,SAAhC;AACA,SAAKhlB,MAAL,CAAYoc,IAAZ,GAAmB,KAAK6I,KAAxB;AAEA,SAAKjlB,MAAL,CAAYmnB,sBAAZ;AACA,SAAKpuB,aAAL,CAAoBwsB,WAApB;AAEA,SAAK/nB,MAAL;AAEH,GAbD;;AAeA,OAAKkqB,aAAL,GAAqB,YAAY;AAE7B,WAAOhE,GAAP;AAEH,GAJD;;AAMA,OAAKiE,iBAAL,GAAyB,YAAY;AAEjC,WAAOlE,KAAP;AAEH,GAJD;;AAMA,WAASsC,oBAAT,GAAgC;AAE5B,WAAO,IAAI34B,IAAI,CAACkP,EAAT,GAAc,EAAd,GAAmB,EAAnB,GAAwB0P,KAAK,CAAC0V,eAArC;AAEH;;AAED,WAASuF,YAAT,GAAwB;AAEpB,WAAO75B,IAAI,CAACmX,GAAL,CAAU,IAAV,EAAgByH,KAAK,CAACgV,SAAtB,CAAP;AAEH;;AAED,WAAS5Q,WAAT,CAAsBld,KAAtB,EAA8B;AAE1BixB,IAAAA,UAAU,GAAG,KAAb;AAEHH,IAAAA,YAAY,GAAGC,UAAU,GAAG,CAA5B;AAEG,QAAKjY,KAAK,CAACnb,OAAN,KAAkB,KAAvB,EAA+B;AAC/BqC,IAAAA,KAAK,CAACmY,cAAN;;AAEA,QAAKnY,KAAK,CAAC00B,MAAN,KAAiB5b,KAAK,CAACyW,YAAN,CAAmB7zB,KAAzC,EAAiD;AAC7C,UAAKod,KAAK,CAACqV,QAAN,KAAmB,IAAxB,EAA+B;AAE/ByD,MAAAA,KAAK,GAAGN,KAAK,CAACC,MAAd;AAEA3B,MAAAA,WAAW,CAACxpB,GAAZ,CAAiBpG,KAAK,CAAC2V,OAAvB,EAAgC3V,KAAK,CAAC4V,OAAtC;AAEH,KAPD,MAOO,IAAK5V,KAAK,CAAC00B,MAAN,KAAiB5b,KAAK,CAACyW,YAAN,CAAmBC,IAAzC,EAAgD;AACnD,UAAK1W,KAAK,CAAC+U,MAAN,KAAiB,IAAtB,EAA6B;AAE7B+D,MAAAA,KAAK,GAAGN,KAAK,CAACE,KAAd;AAEApB,MAAAA,UAAU,CAAChqB,GAAX,CAAgBpG,KAAK,CAAC2V,OAAtB,EAA+B3V,KAAK,CAAC4V,OAArC;AAEH,KAPM,MAOA,IAAK5V,KAAK,CAAC00B,MAAN,KAAiB5b,KAAK,CAACyW,YAAN,CAAmBG,GAAzC,EAA+C;AAClD,UAAK5W,KAAK,CAACuV,KAAN,KAAgB,IAArB,EAA4B;AAE5BuD,MAAAA,KAAK,GAAGN,KAAK,CAAC5B,GAAd;AAEAK,MAAAA,QAAQ,CAAC3pB,GAAT,CAAcpG,KAAK,CAAC2V,OAApB,EAA6B3V,KAAK,CAAC4V,OAAnC;AAEH;;AAED,QAAKgc,KAAK,KAAKN,KAAK,CAACh1B,IAArB,EAA4B;AACxBwc,MAAAA,KAAK,CAAC9Z,QAAN,CAAeJ,gBAAf,CAAiC,WAAjC,EAA8C4sB,WAA9C,EAA2D,KAA3D;AACA1S,MAAAA,KAAK,CAAC9Z,QAAN,CAAeJ,gBAAf,CAAiC,SAAjC,EAA4C6sB,SAA5C,EAAuD,KAAvD;AACA3S,MAAAA,KAAK,CAACjT,aAAN,CAAqBysB,UAArB;AACH;;AAEDxZ,IAAAA,KAAK,CAACxO,MAAN;AAEH;;AAED,WAASkhB,WAAT,CAAsBxrB,KAAtB,EAA8B;AAE1B,QAAK8Y,KAAK,CAACnb,OAAN,KAAkB,KAAvB,EAA+B;AAE/BqC,IAAAA,KAAK,CAACmY,cAAN;AAEA,QAAI9V,OAAO,GAAGyW,KAAK,CAAC6U,UAAN,KAAqB3uB,QAArB,GAAgC8Z,KAAK,CAAC6U,UAAN,CAAiBvR,IAAjD,GAAwDtD,KAAK,CAAC6U,UAA5E;;AAEA,QAAKiE,KAAK,KAAKN,KAAK,CAACC,MAArB,EAA8B;AAE1B,UAAKzY,KAAK,CAACqV,QAAN,KAAmB,IAAxB,EAA+B;AAE/B0B,MAAAA,SAAS,CAACzpB,GAAV,CAAepG,KAAK,CAAC2V,OAArB,EAA8B3V,KAAK,CAAC4V,OAApC;AACAka,MAAAA,WAAW,CAAC6E,UAAZ,CAAwB9E,SAAxB,EAAmCD,WAAnC,EAL0B,CAO1B;;AACA9W,MAAAA,KAAK,CAAC6Z,UAAN,CAAkB,IAAIz4B,IAAI,CAACkP,EAAT,GAAc0mB,WAAW,CAACxmB,CAA1B,GAA8BjH,OAAO,CAAC4E,WAAtC,GAAoD6R,KAAK,CAACsV,WAA5E,EAR0B,CAU1B;;AACAtV,MAAAA,KAAK,CAACga,QAAN,CAAgB,IAAI54B,IAAI,CAACkP,EAAT,GAAc0mB,WAAW,CAACvmB,CAA1B,GAA8BlH,OAAO,CAAC6E,YAAtC,GAAqD4R,KAAK,CAACsV,WAA3E;AAEAwB,MAAAA,WAAW,CAAC7mB,IAAZ,CAAkB8mB,SAAlB;;AAEA,UAAImB,aAAJ,EAAmB;AACfF,QAAAA,YAAY,GAAG9wB,KAAK,CAAC2V,OAAN,GAAgBqb,aAAa,CAACrb,OAA7C;AACAob,QAAAA,UAAU,GAAG/wB,KAAK,CAAC4V,OAAN,GAAgBob,aAAa,CAACpb,OAA3C;AACH;;AAEDob,MAAAA,aAAa,GAAGhxB,KAAhB;AAEH,KAtBD,MAsBO,IAAK4xB,KAAK,KAAKN,KAAK,CAACE,KAArB,EAA6B;AAEhC,UAAK1Y,KAAK,CAAC+U,MAAN,KAAiB,IAAtB,EAA6B;AAE7BwC,MAAAA,QAAQ,CAACjqB,GAAT,CAAcpG,KAAK,CAAC2V,OAApB,EAA6B3V,KAAK,CAAC4V,OAAnC;AACA0a,MAAAA,UAAU,CAACqE,UAAX,CAAuBtE,QAAvB,EAAiCD,UAAjC;;AAEA,UAAKE,UAAU,CAAC/mB,CAAX,GAAe,CAApB,EAAwB;AAEpBuP,QAAAA,KAAK,CAAC+a,OAAN;AAEH,OAJD,MAIO,IAAKvD,UAAU,CAAC/mB,CAAX,GAAe,CAApB,EAAwB;AAE3BuP,QAAAA,KAAK,CAACob,QAAN;AAEH;;AAED9D,MAAAA,UAAU,CAACrnB,IAAX,CAAiBsnB,QAAjB;AAEH,KAnBM,MAmBA,IAAKuB,KAAK,KAAKN,KAAK,CAAC5B,GAArB,EAA2B;AAE9B,UAAK5W,KAAK,CAACuV,KAAN,KAAgB,IAArB,EAA4B;AAE5B2B,MAAAA,MAAM,CAAC5pB,GAAP,CAAYpG,KAAK,CAAC2V,OAAlB,EAA2B3V,KAAK,CAAC4V,OAAjC;AACAqa,MAAAA,QAAQ,CAAC0E,UAAT,CAAqB3E,MAArB,EAA6BD,QAA7B;AAEAjX,MAAAA,KAAK,CAAC6X,GAAN,CAAWV,QAAQ,CAAC3mB,CAApB,EAAuB2mB,QAAQ,CAAC1mB,CAAhC;AAEAwmB,MAAAA,QAAQ,CAAChnB,IAAT,CAAeinB,MAAf;AAEH;;AAED,QAAK4B,KAAK,KAAKN,KAAK,CAACh1B,IAArB,EAA4Bwc,KAAK,CAACxO,MAAN;AAE/B;;AAED,WAASmhB,SAAT;AAAoB;AAAc;AAE9BwF,IAAAA,UAAU,GAAG,IAAb;AAEAD,IAAAA,aAAa,GAAG1yB,SAAhB;AAEA,QAAKwa,KAAK,CAACnb,OAAN,KAAkB,KAAvB,EAA+B;AAE/Bmb,IAAAA,KAAK,CAAC9Z,QAAN,CAAeuG,mBAAf,CAAoC,WAApC,EAAiDimB,WAAjD,EAA8D,KAA9D;AACA1S,IAAAA,KAAK,CAAC9Z,QAAN,CAAeuG,mBAAf,CAAoC,SAApC,EAA+CkmB,SAA/C,EAA0D,KAA1D;AACA3S,IAAAA,KAAK,CAACjT,aAAN,CAAqB0sB,QAArB;AACAX,IAAAA,KAAK,GAAGN,KAAK,CAACh1B,IAAd;AAEH;;AAED,WAASovB,YAAT,CAAuB1rB,KAAvB,EAA+B;AAE3B,QAAK8Y,KAAK,CAACnb,OAAN,KAAkB,KAAlB,IAA2Bmb,KAAK,CAAC+U,MAAN,KAAiB,IAA5C,IAAoD+D,KAAK,KAAKN,KAAK,CAACh1B,IAAzE,EAAgF;AAEhF0D,IAAAA,KAAK,CAACmY,cAAN;AACAnY,IAAAA,KAAK,CAACoY,eAAN;AAEA,QAAI/B,KAAK,GAAG,CAAZ;;AAEA,QAAKrW,KAAK,CAAC2sB,UAAN,KAAqBruB,SAA1B,EAAsC;AAAE;AAEpC+X,MAAAA,KAAK,GAAGrW,KAAK,CAAC2sB,UAAd;AAEH,KAJD,MAIO,IAAK3sB,KAAK,CAAC4sB,MAAN,KAAiBtuB,SAAtB,EAAkC;AAAE;AAEvC+X,MAAAA,KAAK,GAAG,CAAErW,KAAK,CAAC4sB,MAAhB;AAEH;;AAED,QAAKvW,KAAK,GAAG,CAAb,EAAiB;AAEb;AACAyC,MAAAA,KAAK,CAAChM,MAAN,CAAa4mB,GAAb,GAAqB5a,KAAK,CAAChM,MAAN,CAAa4mB,GAAb,GAAmB5a,KAAK,CAACiW,MAA3B,GACbjW,KAAK,CAAChM,MAAN,CAAa4mB,GAAb,GAAmB,CADN,GAEb5a,KAAK,CAACiW,MAFZ;AAGAjW,MAAAA,KAAK,CAAChM,MAAN,CAAamnB,sBAAb;AAEH,KARD,MAQO,IAAK5d,KAAK,GAAG,CAAb,EAAiB;AAEpB;AACAyC,MAAAA,KAAK,CAAChM,MAAN,CAAa4mB,GAAb,GAAqB5a,KAAK,CAAChM,MAAN,CAAa4mB,GAAb,GAAmB5a,KAAK,CAACgW,MAA3B,GACbhW,KAAK,CAAChM,MAAN,CAAa4mB,GAAb,GAAmB,CADN,GAEb5a,KAAK,CAACgW,MAFZ;AAGAhW,MAAAA,KAAK,CAAChM,MAAN,CAAamnB,sBAAb;AAEH;;AAEDnb,IAAAA,KAAK,CAACxO,MAAN;AACAwO,IAAAA,KAAK,CAACjT,aAAN,CAAqBwsB,WAArB;AACAvZ,IAAAA,KAAK,CAACjT,aAAN,CAAqBysB,UAArB;AACAxZ,IAAAA,KAAK,CAACjT,aAAN,CAAqB0sB,QAArB;AAEH;;AAED,WAASqC,OAAT,CAAmB50B,KAAnB,EAA2B;AAEvB,YAASA,KAAK,CAAC60B,OAAf;AAEA,WAAK/b,KAAK,CAAClN,IAAN,CAAWwjB,EAAhB;AACI8B,QAAAA,KAAK,GAAG,KAAR;AACA;;AAEJ,WAAKpY,KAAK,CAAClN,IAAN,CAAW0jB,MAAhB;AACI6B,QAAAA,SAAS,GAAG,KAAZ;AACA;;AAEJ,WAAKrY,KAAK,CAAClN,IAAN,CAAWujB,IAAhB;AACIiC,QAAAA,OAAO,GAAG,KAAV;AACA;;AAEJ,WAAKtY,KAAK,CAAClN,IAAN,CAAWyjB,KAAhB;AACIgC,QAAAA,QAAQ,GAAG,KAAX;AACA;AAhBJ;AAoBH;;AAED,WAASyD,SAAT,CAAoB90B,KAApB,EAA4B;AAExB,QAAK8Y,KAAK,CAACnb,OAAN,KAAkB,KAAlB,IAA2Bmb,KAAK,CAACoW,MAAN,KAAiB,IAA5C,IAAoDpW,KAAK,CAACqV,QAAN,KAAmB,IAA5E,EAAmF;;AAEnF,YAASnuB,KAAK,CAAC60B,OAAf;AAEA,WAAK/b,KAAK,CAAClN,IAAN,CAAWwjB,EAAhB;AACI8B,QAAAA,KAAK,GAAG,IAAR;AACA;;AAEJ,WAAKpY,KAAK,CAAClN,IAAN,CAAW0jB,MAAhB;AACI6B,QAAAA,SAAS,GAAG,IAAZ;AACA;;AAEJ,WAAKrY,KAAK,CAAClN,IAAN,CAAWujB,IAAhB;AACIiC,QAAAA,OAAO,GAAG,IAAV;AACA;;AAEJ,WAAKtY,KAAK,CAAClN,IAAN,CAAWyjB,KAAhB;AACIgC,QAAAA,QAAQ,GAAG,IAAX;AACA;AAhBJ;;AAoBA,QAAIH,KAAK,IAAIC,SAAT,IAAsBC,OAAtB,IAAiCC,QAArC,EAA+C;AAE3CJ,MAAAA,UAAU,GAAG,IAAb;AAEA,UAAIC,KAAJ,EAAWH,UAAU,GAAG,CAAEjY,KAAK,CAACsV,WAAR,GAAsBtV,KAAK,CAAC+V,qBAAzC;AACX,UAAIsC,SAAJ,EAAeJ,UAAU,GAAGjY,KAAK,CAACsV,WAAN,GAAoBtV,KAAK,CAAC+V,qBAAvC;AACf,UAAIuC,OAAJ,EAAaN,YAAY,GAAG,CAAEhY,KAAK,CAACsV,WAAR,GAAsBtV,KAAK,CAAC+V,qBAA3C;AACb,UAAIwC,QAAJ,EAAcP,YAAY,GAAGhY,KAAK,CAACsV,WAAN,GAAoBtV,KAAK,CAAC+V,qBAAzC;AAEjB;AAEJ;;AAED,WAASkG,UAAT,CAAqB/0B,KAArB,EAA6B;AAEzBixB,IAAAA,UAAU,GAAG,KAAb;AAEAH,IAAAA,YAAY,GAAGC,UAAU,GAAG,CAA5B;AAEA,QAAKjY,KAAK,CAACnb,OAAN,KAAkB,KAAvB,EAA+B;;AAE/B,YAASqC,KAAK,CAAC8rB,OAAN,CAAc5oB,MAAvB;AAEA,WAAK,CAAL;AAAQ;AAEJ,YAAK4V,KAAK,CAACqV,QAAN,KAAmB,IAAxB,EAA+B;AAE/ByD,QAAAA,KAAK,GAAGN,KAAK,CAACG,YAAd;AAEA7B,QAAAA,WAAW,CAACxpB,GAAZ,CAAiBpG,KAAK,CAAC8rB,OAAN,CAAe,CAAf,EAAmBjO,KAApC,EAA2C7d,KAAK,CAAC8rB,OAAN,CAAe,CAAf,EAAmBG,KAA9D;AACA;;AAEJ,WAAK,CAAL;AAAQ;AAEJ,YAAKnT,KAAK,CAAC+U,MAAN,KAAiB,IAAtB,EAA6B;AAE7B+D,QAAAA,KAAK,GAAGN,KAAK,CAACI,WAAd;AAEA,YAAI3F,EAAE,GAAG/rB,KAAK,CAAC8rB,OAAN,CAAe,CAAf,EAAmBjO,KAAnB,GAA2B7d,KAAK,CAAC8rB,OAAN,CAAe,CAAf,EAAmBjO,KAAvD;AACA,YAAImO,EAAE,GAAGhsB,KAAK,CAAC8rB,OAAN,CAAe,CAAf,EAAmBG,KAAnB,GAA2BjsB,KAAK,CAAC8rB,OAAN,CAAe,CAAf,EAAmBG,KAAvD;AACA,YAAIC,QAAQ,GAAGhyB,IAAI,CAACqX,IAAL,CAAWwa,EAAE,GAAGA,EAAL,GAAUC,EAAE,GAAGA,EAA1B,CAAf;AAEAoE,QAAAA,UAAU,CAAChqB,GAAX,CAAgB,CAAhB,EAAmB8lB,QAAnB;AAEA;;AAEJ,WAAK,CAAL;AAAQ;AAEJ,YAAKpT,KAAK,CAACuV,KAAN,KAAgB,IAArB,EAA4B;AAE5BuD,QAAAA,KAAK,GAAGN,KAAK,CAACK,SAAd;AAEA5B,QAAAA,QAAQ,CAAC3pB,GAAT,CAAcpG,KAAK,CAAC8rB,OAAN,CAAe,CAAf,EAAmBjO,KAAjC,EAAwC7d,KAAK,CAAC8rB,OAAN,CAAe,CAAf,EAAmBG,KAA3D;AACA;;AAEJ;AAEI2F,QAAAA,KAAK,GAAGN,KAAK,CAACh1B,IAAd;AApCJ;;AAwCA,QAAKs1B,KAAK,KAAKN,KAAK,CAACh1B,IAArB,EAA4Bwc,KAAK,CAACjT,aAAN,CAAqBysB,UAArB;AAE/B;;AAED,WAAS0C,SAAT,CAAoBh1B,KAApB,EAA4B;AAExB,QAAK8Y,KAAK,CAACnb,OAAN,KAAkB,KAAvB,EAA+B;AAE/BqC,IAAAA,KAAK,CAACmY,cAAN;AACAnY,IAAAA,KAAK,CAACoY,eAAN;AAEA,QAAI/V,OAAO,GAAGyW,KAAK,CAAC6U,UAAN,KAAqB3uB,QAArB,GAAgC8Z,KAAK,CAAC6U,UAAN,CAAiBvR,IAAjD,GAAwDtD,KAAK,CAAC6U,UAA5E;;AAEA,YAAS3tB,KAAK,CAAC8rB,OAAN,CAAc5oB,MAAvB;AAEA,WAAK,CAAL;AAAQ;AAEJ,YAAK4V,KAAK,CAACqV,QAAN,KAAmB,IAAxB,EAA+B;AAC/B,YAAKyD,KAAK,KAAKN,KAAK,CAACG,YAArB,EAAoC;AAEpC5B,QAAAA,SAAS,CAACzpB,GAAV,CAAepG,KAAK,CAAC8rB,OAAN,CAAe,CAAf,EAAmBjO,KAAlC,EAAyC7d,KAAK,CAAC8rB,OAAN,CAAe,CAAf,EAAmBG,KAA5D;AACA6D,QAAAA,WAAW,CAAC6E,UAAZ,CAAwB9E,SAAxB,EAAmCD,WAAnC,EANJ,CAQI;;AACA9W,QAAAA,KAAK,CAAC6Z,UAAN,CAAkB,IAAIz4B,IAAI,CAACkP,EAAT,GAAc0mB,WAAW,CAACxmB,CAA1B,GAA8BjH,OAAO,CAAC4E,WAAtC,GAAoD6R,KAAK,CAACsV,WAA5E,EATJ,CAUI;;AACAtV,QAAAA,KAAK,CAACga,QAAN,CAAgB,IAAI54B,IAAI,CAACkP,EAAT,GAAc0mB,WAAW,CAACvmB,CAA1B,GAA8BlH,OAAO,CAAC6E,YAAtC,GAAqD4R,KAAK,CAACsV,WAA3E;AAEAwB,QAAAA,WAAW,CAAC7mB,IAAZ,CAAkB8mB,SAAlB;;AAEA,YAAImB,aAAJ,EAAmB;AACfF,UAAAA,YAAY,GAAG9wB,KAAK,CAAC8rB,OAAN,CAAe,CAAf,EAAmBjO,KAAnB,GAA2BmT,aAAa,CAACnT,KAAxD;AACAkT,UAAAA,UAAU,GAAG/wB,KAAK,CAAC8rB,OAAN,CAAe,CAAf,EAAmBG,KAAnB,GAA2B+E,aAAa,CAAC/E,KAAtD;AACH;;AAED+E,QAAAA,aAAa,GAAG;AACZnT,UAAAA,KAAK,EAAE7d,KAAK,CAAC8rB,OAAN,CAAe,CAAf,EAAmBjO,KADd;AAEZoO,UAAAA,KAAK,EAAEjsB,KAAK,CAAC8rB,OAAN,CAAe,CAAf,EAAmBG;AAFd,SAAhB;AAKAnT,QAAAA,KAAK,CAACxO,MAAN;AACA;;AAEJ,WAAK,CAAL;AAAQ;AAEJ,YAAKwO,KAAK,CAAC+U,MAAN,KAAiB,IAAtB,EAA6B;AAC7B,YAAK+D,KAAK,KAAKN,KAAK,CAACI,WAArB,EAAmC;AAEnC,YAAI3F,EAAE,GAAG/rB,KAAK,CAAC8rB,OAAN,CAAe,CAAf,EAAmBjO,KAAnB,GAA2B7d,KAAK,CAAC8rB,OAAN,CAAe,CAAf,EAAmBjO,KAAvD;AACA,YAAImO,EAAE,GAAGhsB,KAAK,CAAC8rB,OAAN,CAAe,CAAf,EAAmBG,KAAnB,GAA2BjsB,KAAK,CAAC8rB,OAAN,CAAe,CAAf,EAAmBG,KAAvD;AACA,YAAIC,QAAQ,GAAGhyB,IAAI,CAACqX,IAAL,CAAWwa,EAAE,GAAGA,EAAL,GAAUC,EAAE,GAAGA,EAA1B,CAAf;AAEAqE,QAAAA,QAAQ,CAACjqB,GAAT,CAAc,CAAd,EAAiB8lB,QAAjB;AACAoE,QAAAA,UAAU,CAACqE,UAAX,CAAuBtE,QAAvB,EAAiCD,UAAjC;;AAEA,YAAKE,UAAU,CAAC/mB,CAAX,GAAe,CAApB,EAAwB;AAEpBuP,UAAAA,KAAK,CAAChM,MAAN,CAAa4mB,GAAb,GAAqB5a,KAAK,CAAChM,MAAN,CAAa4mB,GAAb,GAAmB5a,KAAK,CAACiW,MAA3B,GACbjW,KAAK,CAAChM,MAAN,CAAa4mB,GAAb,GAAmB,CADN,GAEb5a,KAAK,CAACiW,MAFZ;AAGAjW,UAAAA,KAAK,CAAChM,MAAN,CAAamnB,sBAAb;AAEH,SAPD,MAOO,IAAK3D,UAAU,CAAC/mB,CAAX,GAAe,CAApB,EAAwB;AAE3BuP,UAAAA,KAAK,CAAChM,MAAN,CAAa4mB,GAAb,GAAqB5a,KAAK,CAAChM,MAAN,CAAa4mB,GAAb,GAAmB5a,KAAK,CAACgW,MAA3B,GACbhW,KAAK,CAAChM,MAAN,CAAa4mB,GAAb,GAAmB,CADN,GAEb5a,KAAK,CAACgW,MAFZ;AAGAhW,UAAAA,KAAK,CAAChM,MAAN,CAAamnB,sBAAb;AAEH;;AAED7D,QAAAA,UAAU,CAACrnB,IAAX,CAAiBsnB,QAAjB;AAEAvX,QAAAA,KAAK,CAACxO,MAAN;AACAwO,QAAAA,KAAK,CAACjT,aAAN,CAAqBwsB,WAArB;AACA;;AAEJ,WAAK,CAAL;AAAQ;AAEJ,YAAKvZ,KAAK,CAACuV,KAAN,KAAgB,IAArB,EAA4B;AAC5B,YAAKuD,KAAK,KAAKN,KAAK,CAACK,SAArB,EAAiC;AAEjC3B,QAAAA,MAAM,CAAC5pB,GAAP,CAAYpG,KAAK,CAAC8rB,OAAN,CAAe,CAAf,EAAmBjO,KAA/B,EAAsC7d,KAAK,CAAC8rB,OAAN,CAAe,CAAf,EAAmBG,KAAzD;AACAgE,QAAAA,QAAQ,CAAC0E,UAAT,CAAqB3E,MAArB,EAA6BD,QAA7B;AAEAjX,QAAAA,KAAK,CAAC6X,GAAN,CAAWV,QAAQ,CAAC3mB,CAApB,EAAuB2mB,QAAQ,CAAC1mB,CAAhC;AAEAwmB,QAAAA,QAAQ,CAAChnB,IAAT,CAAeinB,MAAf;AAEAlX,QAAAA,KAAK,CAACxO,MAAN;AACA;;AAEJ;AAEIsnB,QAAAA,KAAK,GAAGN,KAAK,CAACh1B,IAAd;AAjFJ;AAqFH;;AAED,WAAS24B,QAAT;AAAmB;AAAc;AAE7BhE,IAAAA,UAAU,GAAG,IAAb;AAEAD,IAAAA,aAAa,GAAG1yB,SAAhB;AAEA,QAAKwa,KAAK,CAACnb,OAAN,KAAkB,KAAvB,EAA+B;AAE/Bmb,IAAAA,KAAK,CAACjT,aAAN,CAAqB0sB,QAArB;AACAX,IAAAA,KAAK,GAAGN,KAAK,CAACh1B,IAAd;AAEH;;AAED,OAAKqb,OAAL,GAAe,YAAW;AAEtB,SAAKgW,UAAL,CAAgBpoB,mBAAhB,CAAqC,WAArC,EAAkD2X,WAAlD;AACA,SAAKyQ,UAAL,CAAgBpoB,mBAAhB,CAAqC,YAArC,EAAmDmmB,YAAnD;AACA,SAAKiC,UAAL,CAAgBpoB,mBAAhB,CAAqC,gBAArC,EAAuDmmB,YAAvD;AAEA,SAAKiC,UAAL,CAAgBpoB,mBAAhB,CAAqC,YAArC,EAAmDwvB,UAAnD;AACA,SAAKpH,UAAL,CAAgBpoB,mBAAhB,CAAqC,UAArC,EAAiD0vB,QAAjD;AACA,SAAKtH,UAAL,CAAgBpoB,mBAAhB,CAAqC,WAArC,EAAkDyvB,SAAlD;AAEAn2B,IAAAA,MAAM,CAAC0G,mBAAP,CAA4B,OAA5B,EAAqCqvB,OAArC;AACA/1B,IAAAA,MAAM,CAAC0G,mBAAP,CAA4B,SAA5B,EAAuCuvB,SAAvC;AAEH,GAbD,CAhzB0C,CA+zB1C;;;AACA,OAAKnH,UAAL,CAAgB/uB,gBAAhB,CAAkC,WAAlC,EAA+Cse,WAA/C,EAA4D;AAAEC,IAAAA,OAAO,EAAE;AAAX,GAA5D;AACA,OAAKwQ,UAAL,CAAgB/uB,gBAAhB,CAAkC,YAAlC,EAAgD8sB,YAAhD,EAA8D;AAAEvO,IAAAA,OAAO,EAAE;AAAX,GAA9D;AACA,OAAKwQ,UAAL,CAAgB/uB,gBAAhB,CAAkC,gBAAlC,EAAoD8sB,YAApD,EAAkE;AAAEvO,IAAAA,OAAO,EAAE;AAAX,GAAlE,EAl0B0C,CAk0B8C;;AAExF,OAAKwQ,UAAL,CAAgB/uB,gBAAhB,CAAkC,YAAlC,EAAgDm2B,UAAhD,EAA4D;AAAE5X,IAAAA,OAAO,EAAE;AAAX,GAA5D;AACA,OAAKwQ,UAAL,CAAgB/uB,gBAAhB,CAAkC,UAAlC,EAA8Cq2B,QAA9C,EAAwD;AAAE9X,IAAAA,OAAO,EAAE;AAAX,GAAxD;AACA,OAAKwQ,UAAL,CAAgB/uB,gBAAhB,CAAkC,WAAlC,EAA+Co2B,SAA/C,EAA0D;AAAE7X,IAAAA,OAAO,EAAE;AAAX,GAA1D;AAEAte,EAAAA,MAAM,CAACD,gBAAP,CAAyB,OAAzB,EAAkCg2B,OAAlC,EAA2C;AAAEzX,IAAAA,OAAO,EAAE;AAAX,GAA3C;AACAte,EAAAA,MAAM,CAACD,gBAAP,CAAyB,SAAzB,EAAoCk2B,SAApC,EAA+C;AAAE3X,IAAAA,OAAO,EAAE;AAAX,GAA/C,EAz0B0C,CA20B1C;;AACA,OAAK7S,MAAL;AAEH;;AACDojB,aAAa,CAAChrB,SAAd,GAA0BT,MAAM,CAACC,MAAP,CAAeD,MAAM,CAACU,MAAP,CAAehK,eAAe,CAAC+J,SAA/B,CAAf,EAA2D;AAEjFmG,EAAAA,WAAW,EAAE6kB;AAFoE,CAA3D,CAA1B;AAMA;;;;;;;;AAOA,SAASwH,yBAAT,CAAqCC,MAArC,EAA6CxH,UAA7C,EAA0D;AAEtD,MAAI7U,KAAK,GAAG,IAAZ;AACA,MAAIuZ,WAAW,GAAG;AAAEzuB,IAAAA,IAAI,EAAE;AAAR,GAAlB;AAEA,MAAIwxB,IAAI,GAAG,CAAX;AACA,MAAIC,IAAI,GAAG,CAAX;AACA,MAAIC,KAAK,GAAG,CAAZ;AACA,MAAIC,KAAK,GAAG,CAAZ;AAEA,OAAKJ,MAAL,GAAcA,MAAd;AACA,OAAKA,MAAL,CAAYvhB,QAAZ,CAAqB4hB,OAArB,CAA8B,KAA9B;AACA,OAAK7H,UAAL,GAAoBA,UAAU,KAAKrvB,SAAjB,GAA+BqvB,UAA/B,GAA4C3uB,QAA9D;AAEA,OAAKrB,OAAL,GAAe,IAAf;AAEA,OAAK83B,iBAAL,GAAyB,EAAzB;AACA,OAAKC,iBAAL,GAAyB,CAAzB;AAEA,OAAKjS,KAAL,GAAa,CAAb;AACA,OAAKkS,gBAAL,GAAwB,CAAxB;;AAGA,MAAIC,8BAA8B,GAAG,UAAU51B,KAAV,EAAkB;AAEnD8Y,IAAAA,KAAK,CAAC2c,iBAAN,GAA0Bz1B,KAA1B;AAEH,GAJD;;AAMA,MAAI61B,8BAA8B,GAAG,YAAW;AAE5C/c,IAAAA,KAAK,CAAC4c,iBAAN,GAA0B72B,MAAM,CAACi3B,WAAP,IAAsB,CAAhD;AAEH,GAJD;;AAMA,MAAIC,iBAAiB,GAAG,UAAU/1B,KAAV,EAAiB;AAErCA,IAAAA,KAAK,CAACmY,cAAN;AACAnY,IAAAA,KAAK,CAACoY,eAAN;AAEAkd,IAAAA,KAAK,GAAGt1B,KAAK,CAAC8rB,OAAN,CAAe,CAAf,EAAmBjO,KAA3B;AACA0X,IAAAA,KAAK,GAAGv1B,KAAK,CAAC8rB,OAAN,CAAe,CAAf,EAAmBG,KAA3B;AAEH,GARD;;AAUA,MAAI+J,gBAAgB,GAAG,UAAUh2B,KAAV,EAAiB;AAEpCA,IAAAA,KAAK,CAACmY,cAAN;AACAnY,IAAAA,KAAK,CAACoY,eAAN;AAEAgd,IAAAA,IAAI,IAAIj7B,MAAM,CAACmyB,QAAP,CAAiB,CAAEtsB,KAAK,CAAC8rB,OAAN,CAAe,CAAf,EAAmBjO,KAAnB,GAA2ByX,KAA7B,IAAuC,CAAxD,CAAR;AACAD,IAAAA,IAAI,IAAIl7B,MAAM,CAACmyB,QAAP,CAAiB,CAAEiJ,KAAK,GAAGv1B,KAAK,CAAC8rB,OAAN,CAAe,CAAf,EAAmBG,KAA7B,IAAuC,CAAxD,CAAR;AAEAnT,IAAAA,KAAK,CAACmd,sBAAN,CAA8Bb,IAA9B;AAEAE,IAAAA,KAAK,GAAGt1B,KAAK,CAAC8rB,OAAN,CAAe,CAAf,EAAmBjO,KAA3B;AACA0X,IAAAA,KAAK,GAAGv1B,KAAK,CAAC8rB,OAAN,CAAe,CAAf,EAAmBG,KAA3B;AAEH,GAbD,CA7CsD,CA4DtD;;;AAEA,MAAIiK,mBAAmB,GAAG,UAAUzD,UAAV,EAAsBhP,KAAtB,EAA6B0S,IAA7B,EAAmCC,KAAnC,EAA0CC,MAA1C,EAAmD;AAEzE,QAAIC,GAAG,GAAG,IAAIn9B,OAAJ,CAAa,CAAb,EAAgB,CAAhB,EAAmB,CAAnB,CAAV;AAEA,QAAIo9B,KAAK,GAAG,IAAIh8B,KAAJ,EAAZ;AAEA,QAAIi8B,EAAE,GAAG,IAAIx8B,UAAJ,EAAT;AAEA,QAAIy8B,EAAE,GAAG,IAAIz8B,UAAJ,CAAgB,CAAEE,IAAI,CAACqX,IAAL,CAAW,GAAX,CAAlB,EAAoC,CAApC,EAAuC,CAAvC,EAA0CrX,IAAI,CAACqX,IAAL,CAAW,GAAX,CAA1C,CAAT,CARyE,CAQF;;AAEvE,QAAImlB,aAAJ;AACA,QAAIC,QAAQ,GAAG,IAAI38B,UAAJ,EAAf;AACA,QAAI48B,QAAQ,GAAG,IAAI58B,UAAJ,EAAf;;AAEA,QAAK8e,KAAK,CAAC4c,iBAAN,IAA2B,CAAhC,EAAoC;AAEhCgB,MAAAA,aAAa,GAAG,IAAIv9B,OAAJ,CAAa,CAAb,EAAgB,CAAhB,EAAmB,CAAnB,CAAhB;AACAw9B,MAAAA,QAAQ,CAACnK,gBAAT,CAA2BkK,aAA3B,EAA0C,CAACrB,IAA3C;AAEH,KALD,MAKO,IAAKvc,KAAK,CAAC4c,iBAAN,IAA2B,GAAhC,EAAsC;AAEzCgB,MAAAA,aAAa,GAAG,IAAIv9B,OAAJ,CAAa,CAAb,EAAgB,CAAhB,EAAmB,CAAnB,CAAhB;AACAw9B,MAAAA,QAAQ,CAACnK,gBAAT,CAA2BkK,aAA3B,EAA0CrB,IAA1C;AAEH,KALM,MAKA,IAAKvc,KAAK,CAAC4c,iBAAN,IAA2B,EAAhC,EAAqC;AAExCgB,MAAAA,aAAa,GAAG,IAAIv9B,OAAJ,CAAa,CAAb,EAAgB,CAAhB,EAAmB,CAAnB,CAAhB;AACAw9B,MAAAA,QAAQ,CAACnK,gBAAT,CAA2BkK,aAA3B,EAA0CrB,IAA1C;AAEH,KALM,MAKA,IAAKvc,KAAK,CAAC4c,iBAAN,IAA2B,CAAE,EAAlC,EAAsC;AAEzCgB,MAAAA,aAAa,GAAG,IAAIv9B,OAAJ,CAAa,CAAb,EAAgB,CAAhB,EAAmB,CAAnB,CAAhB;AACAw9B,MAAAA,QAAQ,CAACnK,gBAAT,CAA2BkK,aAA3B,EAA0C,CAACrB,IAA3C;AAEH;;AAEDoB,IAAAA,EAAE,CAAChK,QAAH,CAAakK,QAAb;AACAF,IAAAA,EAAE,CAAChK,QAAH,CAAamK,QAAb;AAEAL,IAAAA,KAAK,CAACnwB,GAAN,CAAW+vB,IAAX,EAAiB1S,KAAjB,EAAwB,CAAE2S,KAA1B,EAAiC,KAAjC,EAvCyE,CAuC/B;;AAE1C3D,IAAAA,UAAU,CAACoE,YAAX,CAAyBN,KAAzB,EAzCyE,CAyCvC;;AAElC9D,IAAAA,UAAU,CAAChG,QAAX,CAAqBgK,EAArB,EA3CyE,CA2C9C;;AAE3BhE,IAAAA,UAAU,CAAChG,QAAX,CAAqB+J,EAAE,CAAChK,gBAAH,CAAqB8J,GAArB,EAA0B,CAAED,MAA5B,CAArB,EA7CyE,CA6CZ;AAEhE,GA/CD;;AAiDA,OAAKS,OAAL,GAAe,YAAW;AAEtBjB,IAAAA,8BAA8B,GAFR,CAEY;;AAElCh3B,IAAAA,MAAM,CAACD,gBAAP,CAAyB,mBAAzB,EAA8Ci3B,8BAA9C,EAA8E;AAAE1Y,MAAAA,OAAO,EAAE;AAAX,KAA9E;AACAte,IAAAA,MAAM,CAACD,gBAAP,CAAyB,mBAAzB,EAA8Cg3B,8BAA9C,EAA8E;AAAEzY,MAAAA,OAAO,EAAE;AAAX,KAA9E;AACAte,IAAAA,MAAM,CAACD,gBAAP,CAAyB,mBAAzB,EAA8C,KAAK0L,MAAL,CAAY/G,IAAZ,CAAkB,IAAlB,CAA9C,EAAwE;AAAE4Z,MAAAA,OAAO,EAAE;AAAX,KAAxE;AAEArE,IAAAA,KAAK,CAAC6U,UAAN,CAAiB/uB,gBAAjB,CAAmC,YAAnC,EAAiDm3B,iBAAjD,EAAoE;AAAE5Y,MAAAA,OAAO,EAAE;AAAX,KAApE;AACArE,IAAAA,KAAK,CAAC6U,UAAN,CAAiB/uB,gBAAjB,CAAmC,WAAnC,EAAgDo3B,gBAAhD,EAAkE;AAAE7Y,MAAAA,OAAO,EAAE;AAAX,KAAlE;AAEArE,IAAAA,KAAK,CAACnb,OAAN,GAAgB,IAAhB;AAEH,GAbD;;AAeA,OAAKo5B,UAAL,GAAkB,YAAW;AAEzBl4B,IAAAA,MAAM,CAAC0G,mBAAP,CAA4B,mBAA5B,EAAiDswB,8BAAjD,EAAiF,KAAjF;AACAh3B,IAAAA,MAAM,CAAC0G,mBAAP,CAA4B,mBAA5B,EAAiDqwB,8BAAjD,EAAiF,KAAjF;AACA/2B,IAAAA,MAAM,CAAC0G,mBAAP,CAA4B,mBAA5B,EAAiD,KAAK+E,MAAL,CAAY/G,IAAZ,CAAkB,IAAlB,CAAjD,EAA2E,KAA3E;AAEAuV,IAAAA,KAAK,CAAC6U,UAAN,CAAiBpoB,mBAAjB,CAAsC,YAAtC,EAAoDwwB,iBAApD,EAAuE,KAAvE;AACAjd,IAAAA,KAAK,CAAC6U,UAAN,CAAiBpoB,mBAAjB,CAAsC,WAAtC,EAAmDywB,gBAAnD,EAAqE,KAArE;AAEAld,IAAAA,KAAK,CAACnb,OAAN,GAAgB,KAAhB;AAEH,GAXD;;AAaA,OAAK2M,MAAL,GAAc,UAAU6pB,YAAV,EAAyB;AAEnC,QAAKrb,KAAK,CAACnb,OAAN,KAAkB,KAAvB,EAA+B;AAE/B,QAAI8lB,KAAK,GAAG3K,KAAK,CAAC2c,iBAAN,CAAwBhS,KAAxB,GAAgCtpB,MAAM,CAACmyB,QAAP,CAAiBxT,KAAK,CAAC2c,iBAAN,CAAwBhS,KAAzC,IAAmD3K,KAAK,CAAC6c,gBAAzF,GAA4G,CAAxH,CAJmC,CAIwF;;AAC3H,QAAIQ,IAAI,GAAGrd,KAAK,CAAC2c,iBAAN,CAAwBU,IAAxB,GAA+Bh8B,MAAM,CAACmyB,QAAP,CAAiBxT,KAAK,CAAC2c,iBAAN,CAAwBU,IAAzC,CAA/B,GAAiF,CAA5F,CALmC,CAK4D;;AAC/F,QAAIC,KAAK,GAAGtd,KAAK,CAAC2c,iBAAN,CAAwBW,KAAxB,GAAgCj8B,MAAM,CAACmyB,QAAP,CAAiBxT,KAAK,CAAC2c,iBAAN,CAAwBW,KAAzC,CAAhC,GAAmF,CAA/F,CANmC,CAM+D;;AAClG,QAAIC,MAAM,GAAGvd,KAAK,CAAC4c,iBAAN,GAA0Bv7B,MAAM,CAACmyB,QAAP,CAAiBxT,KAAK,CAAC4c,iBAAvB,CAA1B,GAAuE,CAApF,CAPmC,CAOoD;;AAEvFQ,IAAAA,mBAAmB,CAAEpd,KAAK,CAACqc,MAAN,CAAa1C,UAAf,EAA2BhP,KAA3B,EAAkC0S,IAAlC,EAAwCC,KAAxC,EAA+CC,MAA/C,CAAnB;AACAvd,IAAAA,KAAK,CAAC2K,KAAN,GAAcA,KAAd;;AAEA,QAAK0Q,YAAY,KAAK,IAAtB,EAA6B;AAAErb,MAAAA,KAAK,CAACjT,aAAN,CAAqBwsB,WAArB;AAAqC;AAEvE,GAdD;;AAgBA,OAAK4D,sBAAL,GAA8B,UAAUrD,KAAV,EAAkB;AAE5C,SAAK+C,gBAAL,GAAwB/C,KAAxB;AACA,SAAKtoB,MAAL;AAEH,GALD;;AAOA,OAAKqN,OAAL,GAAe,YAAW;AAEtB,SAAKof,UAAL;AAEH,GAJD;;AAMA,OAAKD,OAAL;AAEH;;AACD5B,yBAAyB,CAACxyB,SAA1B,GAAsCT,MAAM,CAACC,MAAP,CAAeD,MAAM,CAACU,MAAP,CAAehK,eAAe,CAAC+J,SAA/B,CAAf,EAA0D;AAE5FmG,EAAAA,WAAW,EAAEqsB;AAF+E,CAA1D,CAAtC;AAMA;;;;;;;AAMA,SAAS8B,eAAT,CAA2BC,QAA3B,EAAsC;AAElC,MAAIC,OAAO,GAAG,IAAI58B,kBAAJ,CAAwB,CAAE,CAA1B,EAA6B,CAA7B,EAAgC,CAAhC,EAAmC,CAAE,CAArC,EAAwC,CAAxC,EAA2C,CAA3C,CAAd;;AAEA,MAAI68B,MAAM,GAAG,IAAI38B,KAAJ,EAAb;;AAEA,MAAI48B,OAAO,GAAG,IAAI38B,YAAJ,EAAd;;AACA28B,EAAAA,OAAO,CAACC,MAAR,GAAiB,GAAjB;AAEA,MAAIC,OAAO,GAAG;AAAErxB,IAAAA,SAAS,EAAEpN,YAAb;AAA2BqN,IAAAA,SAAS,EAAEvL,aAAtC;AAAqDiG,IAAAA,MAAM,EAAEnI;AAA7D,GAAd;;AAEA,MAAI8+B,aAAa,GAAG,IAAI78B,iBAAJ,CAAuB,GAAvB,EAA4B,GAA5B,EAAiC48B,OAAjC,CAApB;;AACAC,EAAAA,aAAa,CAACC,WAAd,GAA4B,IAA5B;AACAD,EAAAA,aAAa,CAAC92B,OAAd,CAAsBuF,eAAtB,GAAwC,KAAxC;AAEA;;;;;AAKA,MAAIyxB,UAAU,GAAG,IAAI19B,OAAJ,CAAa,KAAb,EAAoB,KAApB,CAAjB;AAEA,MAAI6d,QAAQ,GAAG,IAAI3d,mBAAJ,CAAyB,CAAzB,EAA4B,CAA5B,EAA+B,EAA/B,EAAmC,EAAnC,EAAwCy9B,eAAxC,CAAyD,QAAzD,EAAoEC,YAApE,EAAf;AAEA,MAAIC,SAAS,GAAGhgB,QAAQ,CAACigB,UAAT,CAAoBpxB,QAApB,CAA6BqxB,KAA7C;AACA,MAAIC,GAAG,GAAGngB,QAAQ,CAACigB,UAAT,CAAoBG,EAApB,CAAuBF,KAAjC,CAzBkC,CA2BlC;;AACAlgB,EAAAA,QAAQ,CAACigB,UAAT,CAAoBpxB,QAApB,CAA6BwxB,KAA7B,IAAsC,CAAtC;AACArgB,EAAAA,QAAQ,CAACigB,UAAT,CAAoBG,EAApB,CAAuBC,KAAvB,IAAgC,CAAhC;AAEA,MAAIC,UAAU,GAAG,IAAI7T,YAAJ,CAAkBuT,SAAS,CAAC10B,MAAV,GAAmB,CAArC,CAAjB;AACAg1B,EAAAA,UAAU,CAAC9xB,GAAX,CAAgBwxB,SAAhB;AACAM,EAAAA,UAAU,CAAC9xB,GAAX,CAAgBwxB,SAAhB,EAA2BA,SAAS,CAAC10B,MAArC;AAEA,MAAIi1B,IAAI,GAAG,IAAI9T,YAAJ,CAAkB0T,GAAG,CAAC70B,MAAJ,GAAa,CAA/B,CAAX;AACAi1B,EAAAA,IAAI,CAAC/xB,GAAL,CAAU2xB,GAAV;AACAI,EAAAA,IAAI,CAAC/xB,GAAL,CAAU2xB,GAAV,EAAeA,GAAG,CAAC70B,MAAnB;AAEA,MAAI+e,MAAM,GAAG,IAAIloB,OAAJ,EAAb;AACA,MAAImJ,MAAM,GAAG00B,SAAS,CAAC10B,MAAV,GAAmB,CAAhC;;AAEA,OAAM,IAAI5B,CAAC,GAAG,CAAR,EAAW82B,CAAC,GAAGF,UAAU,CAACh1B,MAAX,GAAoB,CAAzC,EAA4C5B,CAAC,GAAG82B,CAAhD,EAAmD92B,CAAC,EAApD,EAA0D;AAEtD2gB,IAAAA,MAAM,CAAC3Y,CAAP,GAAW4uB,UAAU,CAAE52B,CAAC,GAAG,CAAJ,GAAQ,CAAV,CAArB;AACA2gB,IAAAA,MAAM,CAAC1Y,CAAP,GAAW2uB,UAAU,CAAE52B,CAAC,GAAG,CAAJ,GAAQ,CAAV,CAArB;AAEA,QAAI4rB,GAAG,GAAGjL,MAAM,CAACiL,GAAP,CAAYjL,MAAZ,CAAV;AACA,QAAIoW,MAAM,GAAG,MAAM,CAAEZ,UAAU,CAACnuB,CAAX,GAAemuB,UAAU,CAACluB,CAAX,GAAe2jB,GAAhC,IAAwCA,GAA3D;AAEA,QAAIiD,MAAM,GAAG7uB,CAAC,GAAG4B,MAAJ,GAAa,CAAb,GAAiB,CAA9B;AAEAg1B,IAAAA,UAAU,CAAE52B,CAAC,GAAG,CAAJ,GAAQ,CAAV,CAAV,GAA4B2gB,MAAM,CAAC3Y,CAAP,GAAW+uB,MAAb,GAAwB,GAAxB,GAA8B,GAA9B,GAAoClI,MAA9D;AACA+H,IAAAA,UAAU,CAAE52B,CAAC,GAAG,CAAJ,GAAQ,CAAV,CAAV,GAA4B2gB,MAAM,CAAC1Y,CAAP,GAAW8uB,MAAb,GAAwB,GAAlD;AAEAF,IAAAA,IAAI,CAAE72B,CAAC,GAAG,CAAN,CAAJ,GAAgB,CAAE62B,IAAI,CAAE72B,CAAC,GAAG,CAAN,CAAJ,GAAgB6uB,MAAlB,IAA6B,GAA7C;AAEH;;AAEDvY,EAAAA,QAAQ,CAACigB,UAAT,CAAoBpxB,QAApB,CAA6BqxB,KAA7B,GAAqCI,UAArC;AACAtgB,EAAAA,QAAQ,CAACigB,UAAT,CAAoBG,EAApB,CAAuBF,KAAvB,GAA+BK,IAA/B,CA5DkC,CA8DlC;;AAEA,MAAInwB,QAAQ,GAAG,IAAIxO,iBAAJ,CAAuB;AAAE2H,IAAAA,GAAG,EAAEo2B,aAAa,CAAC92B;AAArB,GAAvB,CAAf;AACA,MAAI63B,IAAI,GAAG,IAAIl/B,IAAJ,CAAUwe,QAAV,EAAoB5P,QAApB,CAAX;;AACAmvB,EAAAA,MAAM,CAACj4B,GAAP,CAAYo5B,IAAZ,EAlEkC,CAoElC;;;AAEA,OAAKC,OAAL,GAAe,UAAW52B,KAAX,EAAkBE,MAAlB,EAA2B;AAEtCo1B,IAAAA,QAAQ,CAACsB,OAAT,CAAkB52B,KAAlB,EAAyBE,MAAzB;AAEA,QAAI22B,UAAU,GAAGvB,QAAQ,CAACwB,aAAT,EAAjB;;AAEAlB,IAAAA,aAAa,CAACgB,OAAd,CAAuB52B,KAAK,GAAG62B,UAA/B,EAA2C32B,MAAM,GAAG22B,UAApD;AAEH,GARD;;AAUA,OAAKE,MAAL,GAAc,UAAWt2B,KAAX,EAAkB+yB,MAAlB,EAA2B;AAErC/yB,IAAAA,KAAK,CAACu2B,iBAAN;AAEA,QAAKxD,MAAM,CAACtd,MAAP,KAAkB,IAAvB,EAA8Bsd,MAAM,CAACwD,iBAAP;;AAE9BvB,IAAAA,OAAO,CAAC9sB,MAAR,CAAgB6qB,MAAhB;;AAEA,QAAIxzB,KAAK,GAAG41B,aAAa,CAAC51B,KAAd,GAAsB,CAAlC;AACA,QAAIE,MAAM,GAAG01B,aAAa,CAAC11B,MAA3B;AAEA,QAAKo1B,QAAQ,CAAC2B,SAAd,EAA0B3B,QAAQ,CAAC4B,KAAT;;AAE1BtB,IAAAA,aAAa,CAACuB,OAAd,CAAsB1yB,GAAtB,CAA2B,CAA3B,EAA8B,CAA9B,EAAiCzE,KAAjC,EAAwCE,MAAxC;;AACA01B,IAAAA,aAAa,CAACwB,QAAd,CAAuB3yB,GAAvB,CAA4B,CAA5B,EAA+B,CAA/B,EAAkCzE,KAAlC,EAAyCE,MAAzC;;AACAo1B,IAAAA,QAAQ,CAAC+B,eAAT,CAA0BzB,aAA1B;AACAN,IAAAA,QAAQ,CAACyB,MAAT,CAAiBt2B,KAAjB,EAAwBg1B,OAAO,CAAC6B,OAAhC;AAEAhC,IAAAA,QAAQ,CAACiC,UAAT;;AAEA3B,IAAAA,aAAa,CAACuB,OAAd,CAAsB1yB,GAAtB,CAA2BzE,KAA3B,EAAkC,CAAlC,EAAqCA,KAArC,EAA4CE,MAA5C;;AACA01B,IAAAA,aAAa,CAACwB,QAAd,CAAuB3yB,GAAvB,CAA4BzE,KAA5B,EAAmC,CAAnC,EAAsCA,KAAtC,EAA6CE,MAA7C;;AACAo1B,IAAAA,QAAQ,CAAC+B,eAAT,CAA0BzB,aAA1B;AACAN,IAAAA,QAAQ,CAACyB,MAAT,CAAiBt2B,KAAjB,EAAwBg1B,OAAO,CAAC+B,OAAhC;AAEAlC,IAAAA,QAAQ,CAACiC,UAAT;AAEAjC,IAAAA,QAAQ,CAAC+B,eAAT,CAA0B,IAA1B;AACA/B,IAAAA,QAAQ,CAACyB,MAAT,CAAiBvB,MAAjB,EAAyBD,OAAzB;AACH,GA7BD;AA+BH;AAED;;;;;;;;AAMA,MAAMkC,YAAY,GAAG,UAAWnC,QAAX,EAAsB;AAEvC,MAAIG,OAAO,GAAG,IAAI38B,YAAJ,EAAd;;AACA28B,EAAAA,OAAO,CAACC,MAAR,GAAiB,GAAjB;AACA,MAAI3M,IAAI,GAAG,IAAI3wB,OAAJ,EAAX;;AAEA,OAAKs/B,gBAAL,GAAwB,UAAWC,MAAX,EAAoB;AAExClC,IAAAA,OAAO,CAACkC,MAAR,GAAiBA,MAAjB;AAEH,GAJD;;AAMA,OAAKf,OAAL,GAAe,UAAW52B,KAAX,EAAkBE,MAAlB,EAA2B;AAEtCo1B,IAAAA,QAAQ,CAACsB,OAAT,CAAkB52B,KAAlB,EAAyBE,MAAzB;AAEH,GAJD;;AAMA,OAAK62B,MAAL,GAAc,UAAWt2B,KAAX,EAAkB+yB,MAAlB,EAA2B;AAErC/yB,IAAAA,KAAK,CAACu2B,iBAAN;AAEA,QAAKxD,MAAM,CAACtd,MAAP,KAAkB,IAAvB,EAA8Bsd,MAAM,CAACwD,iBAAP;;AAE9BvB,IAAAA,OAAO,CAAC9sB,MAAR,CAAgB6qB,MAAhB;;AAEA8B,IAAAA,QAAQ,CAACsC,OAAT,CAAkB7O,IAAlB;AAEA,QAAKuM,QAAQ,CAAC2B,SAAd,EAA0B3B,QAAQ,CAAC4B,KAAT;AAC1B5B,IAAAA,QAAQ,CAACuC,cAAT,CAAyB,IAAzB;AAEAvC,IAAAA,QAAQ,CAACwC,UAAT,CAAqB,CAArB,EAAwB,CAAxB,EAA2B/O,IAAI,CAAC/oB,KAAL,GAAa,CAAxC,EAA2C+oB,IAAI,CAAC7oB,MAAhD;AACAo1B,IAAAA,QAAQ,CAACyC,WAAT,CAAsB,CAAtB,EAAyB,CAAzB,EAA4BhP,IAAI,CAAC/oB,KAAL,GAAa,CAAzC,EAA4C+oB,IAAI,CAAC7oB,MAAjD;AACAo1B,IAAAA,QAAQ,CAACyB,MAAT,CAAiBt2B,KAAjB,EAAwBg1B,OAAO,CAAC6B,OAAhC;AAEAhC,IAAAA,QAAQ,CAACwC,UAAT,CAAqB/O,IAAI,CAAC/oB,KAAL,GAAa,CAAlC,EAAqC,CAArC,EAAwC+oB,IAAI,CAAC/oB,KAAL,GAAa,CAArD,EAAwD+oB,IAAI,CAAC7oB,MAA7D;AACAo1B,IAAAA,QAAQ,CAACyC,WAAT,CAAsBhP,IAAI,CAAC/oB,KAAL,GAAa,CAAnC,EAAsC,CAAtC,EAAyC+oB,IAAI,CAAC/oB,KAAL,GAAa,CAAtD,EAAyD+oB,IAAI,CAAC7oB,MAA9D;AACAo1B,IAAAA,QAAQ,CAACyB,MAAT,CAAiBt2B,KAAjB,EAAwBg1B,OAAO,CAAC+B,OAAhC;AAEAlC,IAAAA,QAAQ,CAACuC,cAAT,CAAyB,KAAzB;AAEH,GAvBD;AAyBH,CA3CD;AA6CA;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA0BA,SAASG,MAAT,CAAkBnZ,OAAlB,EAA4B;AAExB,MAAIre,SAAJ;AAEAqe,EAAAA,OAAO,GAAGA,OAAO,IAAI,EAArB;AACAA,EAAAA,OAAO,CAACoZ,UAAR,GAAqBpZ,OAAO,CAACoZ,UAAR,KAAuBt7B,SAAvB,GAAmCkiB,OAAO,CAACoZ,UAA3C,GAAwD,IAA7E;AACApZ,EAAAA,OAAO,CAACqZ,cAAR,GAAyBrZ,OAAO,CAACqZ,cAAR,IAA0B,CAAE,YAAF,EAAgB,SAAhB,EAA2B,OAA3B,CAAnD;AACArZ,EAAAA,OAAO,CAACsZ,kBAAR,GAA6BtZ,OAAO,CAACsZ,kBAAR,KAA+Bx7B,SAA/B,GAA2CkiB,OAAO,CAACsZ,kBAAnD,GAAwE,KAArG;AACAtZ,EAAAA,OAAO,CAACuZ,gBAAR,GAA2BvZ,OAAO,CAACuZ,gBAAR,KAA6Bz7B,SAA7B,GAAyCkiB,OAAO,CAACuZ,gBAAjD,GAAoE,IAA/F;AACAvZ,EAAAA,OAAO,CAACwZ,cAAR,GAAyBxZ,OAAO,CAACwZ,cAAR,KAA2B17B,SAA3B,GAAuCkiB,OAAO,CAACwZ,cAA/C,GAAgE,KAAzF;AACAxZ,EAAAA,OAAO,CAACyZ,cAAR,GAAyBzZ,OAAO,CAACyZ,cAAR,IAA0B,EAAnD;AACAzZ,EAAAA,OAAO,CAAC0Z,SAAR,GAAoB1Z,OAAO,CAAC0Z,SAAR,IAAqB,EAAzC;AACA1Z,EAAAA,OAAO,CAAC2Z,eAAR,GAA0B3Z,OAAO,CAAC2Z,eAAR,IAA2B,KAArD;AACA3Z,EAAAA,OAAO,CAAC4Z,aAAR,GAAwB5Z,OAAO,CAAC4Z,aAAR,IAAyB,KAAjD;AACA5Z,EAAAA,OAAO,CAAC9Y,SAAR,GAAoB8Y,OAAO,CAAC9Y,SAAR,IAAqB,IAAzC;AACA8Y,EAAAA,OAAO,CAAC6Z,iBAAR,GAA4B7Z,OAAO,CAAC6Z,iBAAR,KAA8B/7B,SAA9B,GAA0CkiB,OAAO,CAAC6Z,iBAAlD,GAAsE,IAAlG;AACA7Z,EAAAA,OAAO,CAAC8Z,aAAR,GAAwB9Z,OAAO,CAAC8Z,aAAR,KAA0Bh8B,SAA1B,GAAsCkiB,OAAO,CAAC8Z,aAA9C,GAA8D,KAAtF;AACA9Z,EAAAA,OAAO,CAAC+Z,aAAR,GAAwB/Z,OAAO,CAAC+Z,aAAR,IAAyB,EAAjD;AACA/Z,EAAAA,OAAO,CAACga,MAAR,GAAiBha,OAAO,CAACga,MAAR,GAAiBha,OAAO,CAACga,MAAzB,GAAkC,MAAnD;AACAha,EAAAA,OAAO,CAAC+N,UAAR,GAAqB/N,OAAO,CAAC+N,UAAR,IAAsB,KAA3C;AACA/N,EAAAA,OAAO,CAACgO,eAAR,GAA0BhO,OAAO,CAACgO,eAAR,IAA2B,GAArD;AACAhO,EAAAA,OAAO,CAACia,4BAAR,GAAuCja,OAAO,CAACia,4BAAR,IAAwC,IAA/E;AAEA,OAAKja,OAAL,GAAeA,OAAf;AAEA;;;;;AAMA;;AACA,MAAKA,OAAO,CAACre,SAAb,EAAyB;AAErBA,IAAAA,SAAS,GAAGqe,OAAO,CAACre,SAApB;AACAA,IAAAA,SAAS,CAAC2T,MAAV,GAAmB3T,SAAS,CAAC8E,WAA7B;AACA9E,IAAAA,SAAS,CAAC4T,OAAV,GAAoB5T,SAAS,CAAC+E,YAA9B;AAEH,GAND,MAMO;AAEH/E,IAAAA,SAAS,GAAGnD,QAAQ,CAACqH,aAAT,CAAwB,KAAxB,CAAZ;AACAlE,IAAAA,SAAS,CAACiV,SAAV,CAAoBlY,GAApB,CAAyB,oBAAzB;AACAiD,IAAAA,SAAS,CAACqE,KAAV,CAAgB7E,KAAhB,GAAwB,MAAxB;AACAQ,IAAAA,SAAS,CAACqE,KAAV,CAAgB3E,MAAhB,GAAyB,MAAzB;AACAM,IAAAA,SAAS,CAAC2T,MAAV,GAAmBjX,MAAM,CAAC4jB,UAA1B;AACAtgB,IAAAA,SAAS,CAAC4T,OAAV,GAAoBlX,MAAM,CAAC67B,WAA3B;AACA17B,IAAAA,QAAQ,CAACod,IAAT,CAAc/G,WAAd,CAA2BlT,SAA3B;AAEH;;AAED,OAAKA,SAAL,GAAiBA,SAAjB;AAEA,OAAKgzB,MAAL,GAAc3U,OAAO,CAAC2U,MAAR,IAAkB,IAAI96B,iBAAJ,CAAuB,KAAKmmB,OAAL,CAAa0Z,SAApC,EAA+C,KAAK/3B,SAAL,CAAe8E,WAAf,GAA6B,KAAK9E,SAAL,CAAe+E,YAA3F,EAAyG,CAAzG,EAA4G,KAA5G,CAAhC;AACA,OAAK9E,KAAL,GAAaoe,OAAO,CAACpe,KAAR,IAAiB,IAAI5H,KAAJ,EAA9B;AACA,OAAKy8B,QAAL,GAAgBzW,OAAO,CAACyW,QAAR,IAAoB,IAAIr8B,aAAJ,CAAmB;AAAE6oB,IAAAA,KAAK,EAAE,IAAT;AAAekX,IAAAA,SAAS,EAAE;AAA1B,GAAnB,CAApC;AACA,OAAKC,YAAL,GAAoB,IAAIpgC,KAAJ,EAApB;AAEA,OAAKqgC,iBAAL,GAAyB,KAAKra,OAAL,CAAa+Z,aAAtC;AAEA,OAAKO,OAAL,GAAe,EAAf;AACA,OAAKC,iBAAL,GAAyB,KAAKva,OAAL,CAAa4Z,aAAtC;AAEA,OAAKzmB,IAAL,GAAY/X,KAAK,CAACE,MAAlB;AAEA,OAAKk/B,QAAL,GAAgB,IAAhB;AACA,OAAKC,MAAL,GAAc,IAAd;AAEA,OAAKC,WAAL,GAAmB,IAAnB;AACA,OAAKC,QAAL,GAAgB,IAAhB;AACA,OAAKC,iBAAL,GAAyB,IAAzB;AACA,OAAKC,WAAL,GAAmB,IAAnB;AAEA,OAAKC,SAAL,GAAiB,IAAIzgC,SAAJ,EAAjB;AACA,OAAK0gC,cAAL,GAAsB,IAAIxhC,OAAJ,EAAtB;AACA,OAAKixB,SAAL,GAAiB,IAAIjxB,OAAJ,EAAjB;AACA,OAAKyhC,eAAL,GAAuB,EAAvB;AACA,OAAKC,kBAAL,GAA0B,IAA1B;AAEA,OAAKC,aAAL,GAAqB,IAAI5gC,OAAJ,EAArB;AACA,OAAK6gC,0BAAL,GAAkC,IAAI7hC,OAAJ,EAAlC;AAEA,OAAK8hC,mBAAL,GAA2B,IAA3B;AAEA,OAAKC,gBAAL,GAAwB,IAAxB;AAEA,OAAKC,cAAL,GAAsB,kBAAkBj9B,MAAlB,IAA4BA,MAAM,CAACoZ,aAAP,IAAwBjZ,QAAQ,YAAYiZ,aAA9F,CArFwB,CAuFxB;;AACA,OAAK8jB,kBAAL,GAA0B,KAAK7e,WAAL,CAAiB3Z,IAAjB,CAAuB,IAAvB,CAA1B;AACA,OAAKy4B,gBAAL,GAAwB,KAAKvQ,SAAL,CAAeloB,IAAf,CAAqB,IAArB,CAAxB;AACA,OAAK04B,kBAAL,GAA0B,KAAKzQ,WAAL,CAAiBjoB,IAAjB,CAAuB,IAAvB,CAA1B;AACA,OAAK24B,qBAAL,GAA6B,KAAK12B,cAAL,CAAoBjC,IAApB,CAA0B,IAA1B,CAA7B;AACA,OAAK44B,gBAAL,GAAwB,KAAKrH,SAAL,CAAevxB,IAAf,CAAqB,IAArB,CAAxB;AACA,OAAK64B,cAAL,GAAsB,KAAKxH,OAAL,CAAarxB,IAAb,CAAmB,IAAnB,CAAtB;AACA,OAAK84B,WAAL,GAAmB,KAAK/hB,KAAL,CAAW/W,IAAX,CAAiB,IAAjB,EAAuB;AACtCoS,IAAAA,OAAO,EAAE,KAAKxT,SAAL,CAAe8E,WAAf,GAA6B,CADA;AAEtC2O,IAAAA,OAAO,EAAE,KAAKzT,SAAL,CAAe+E,YAAf,GAA8B;AAFD,GAAvB,CAAnB,CA9FwB,CAmGxB;;AACA,OAAKo1B,eAAL,GAAuB,KAAvB,CApGwB,CAsGxB;;AACA,OAAKC,kBAAL,GAA0B,IAAIhxB,KAAK,CAACA,KAAV,EAA1B;AACA,OAAKixB,gBAAL,GAAwB,IAAIjxB,KAAK,CAACA,KAAV,EAAxB,CAxGwB,CA0GxB;;AACA,OAAK0rB,QAAL,CAAcwF,aAAd,CAA6B59B,MAAM,CAAC+I,gBAApC;AACA,OAAKqvB,QAAL,CAAcsB,OAAd,CAAuB,KAAKp2B,SAAL,CAAe8E,WAAtC,EAAmD,KAAK9E,SAAL,CAAe+E,YAAlE;AACA,OAAK+vB,QAAL,CAAcyF,aAAd,CAA6B,QAA7B,EAAuC,CAAvC;AACA,OAAKzF,QAAL,CAAc2B,SAAd,GAA0B,KAA1B,CA9GwB,CAgHxB;;AACA,OAAK3B,QAAL,CAActJ,UAAd,CAAyBvW,SAAzB,CAAmClY,GAAnC,CAAwC,iBAAxC;AACA,OAAK+3B,QAAL,CAActJ,UAAd,CAAyBnnB,KAAzB,CAA+BM,OAA/B,GAAyC,OAAzC;AACA,OAAK3E,SAAL,CAAeqE,KAAf,CAAqBwW,eAArB,GAAuC,MAAvC;AACA,OAAK7a,SAAL,CAAekT,WAAf,CAA4B,KAAK4hB,QAAL,CAActJ,UAA1C,EApHwB,CAsHxB;;AACA,OAAKD,aAAL,GAAqB,IAAIA,aAAJ,CAAmB,KAAKyH,MAAxB,EAAgC,KAAKhzB,SAArC,CAArB;AACA,OAAKurB,aAAL,CAAmBxR,EAAnB,GAAwB,OAAxB;AACA,OAAKwR,aAAL,CAAmBK,WAAnB,GAAiC,CAAjC;AACA,OAAKL,aAAL,CAAmBW,KAAnB,GAA2B,IAA3B;AACA,OAAKX,aAAL,CAAmBa,UAAnB,GAAgC,KAAK/N,OAAL,CAAa+N,UAA7C;AACA,OAAKb,aAAL,CAAmBc,eAAnB,GAAqC,KAAKhO,OAAL,CAAagO,eAAlD;AAEA,OAAK0G,yBAAL,GAAiC,IAAIA,yBAAJ,CAA+B,KAAKC,MAApC,EAA4C,KAAKhzB,SAAjD,CAAjC;AACA,OAAK+yB,yBAAL,CAA+BhZ,EAA/B,GAAoC,oBAApC;AACA,OAAKgZ,yBAAL,CAA+Bv3B,OAA/B,GAAyC,KAAzC;AACA,OAAKw3B,MAAL,CAAY1uB,QAAZ,CAAqB6B,CAArB,GAAyB,CAAzB,CAjIwB,CAmIxB;;AACA,MAAK,KAAKkY,OAAL,CAAamc,gBAAlB,EAAqC;AAEjC/3B,IAAAA,OAAO,CAACC,IAAR,CAAc,oCAAd;AAEH,GAxIuB,CA0IxB;;;AACA,OAAK+3B,QAAL,GAAgB,CAAE,KAAKlP,aAAP,EAAsB,KAAKwH,yBAA3B,CAAhB;AACA,OAAK2H,OAAL,GAAe,KAAKnP,aAApB,CA5IwB,CA8IxB;;AACA,OAAKsJ,eAAL,GAAuB,IAAIA,eAAJ,CAAqB,KAAKC,QAA1B,CAAvB;AACA,OAAKD,eAAL,CAAqBuB,OAArB,CAA8B,KAAKp2B,SAAL,CAAe8E,WAA7C,EAA0D,KAAK9E,SAAL,CAAe+E,YAAzE,EAhJwB,CAkJxB;;AACA,OAAKkyB,YAAL,GAAoB,IAAIA,YAAJ,CAAkB,KAAKnC,QAAvB,CAApB;AACA,OAAKmC,YAAL,CAAkBb,OAAlB,CAA2B,KAAKp2B,SAAL,CAAe8E,WAA1C,EAAuD,KAAK9E,SAAL,CAAe+E,YAAtE;AAEA,OAAK41B,MAAL,GAAc,KAAK9F,eAAnB,CAtJwB,CAwJxB;;AACA,OAAK+F,UAAL,GAzJwB,CA2JxB;;AACA,MAAK,KAAKvc,OAAL,CAAawZ,cAAlB,EAAmC;AAC/B,SAAKtM,aAAL,CAAmBe,aAAnB,GAAmCv0B,IAAI,CAACkP,EAAL,GAAU,CAA7C;AACA,SAAKskB,aAAL,CAAmBgB,aAAnB,GAAmCx0B,IAAI,CAACkP,EAAL,GAAU,CAA7C;AACH,GA/JuB,CAiKxB;;;AACA,MAAK,KAAKoX,OAAL,CAAaoZ,UAAb,KAA4B,KAAjC,EAAyC;AACrC,SAAKoD,oBAAL,CAA2B,KAAKxc,OAAL,CAAaqZ,cAAxC;AACH,GApKuB,CAsKxB;;;AACA,MAAK,KAAKrZ,OAAL,CAAa8Z,aAAlB,EAAkC;AAC9B,SAAK2C,gBAAL;AACH,GAzKuB,CA2KxB;;;AACA,MAAK,KAAKzc,OAAL,CAAa2Z,eAAlB,EAAoC;AAChC,SAAK+C,wBAAL;AACH,GA9KuB,CAgLxB;;;AACA,MAAK,KAAK1c,OAAL,CAAa4Z,aAAlB,EAAkC;AAC9B,SAAK+C,oBAAL;AACH,GAFD,MAEO;AACH,SAAKC,2BAAL;AACH,GArLuB,CAuLxB;;;AACA,MAAK,KAAK5c,OAAL,CAAaga,MAAb,KAAwB,SAA7B,EAAyC;AACrC,SAAK6C,gBAAL;AACH,GA1LuB,CA4LxB;;;AACA,OAAKC,sBAAL,GA7LwB,CA+LxB;;AACA,OAAKC,OAAL,CAAar1B,IAAb,CAAmB,IAAnB;AAEH;;AACDyxB,MAAM,CAACj3B,SAAP,GAAmBT,MAAM,CAACC,MAAP,CAAeD,MAAM,CAACU,MAAP,CAAehK,eAAe,CAAC+J,SAA/B,CAAf,EAA2D;AAE1EmG,EAAAA,WAAW,EAAE8wB,MAF6D;;AAI1E;;;;;;;;AAQAz6B,EAAAA,GAAG,EAAE,UAAW4N,MAAX,EAAoB;AAErB,QAAKiD,SAAS,CAAC7M,MAAV,GAAmB,CAAxB,EAA4B;AAExB,WAAM,IAAI5B,CAAC,GAAG,CAAd,EAAiBA,CAAC,GAAGyO,SAAS,CAAC7M,MAA/B,EAAuC5B,CAAC,EAAxC,EAA8C;AAE1C,aAAKpC,GAAL,CAAU6Q,SAAS,CAAEzO,CAAF,CAAnB;AAEH;;AAED,aAAO,IAAP;AAEH;;AAED,SAAKc,KAAL,CAAWlD,GAAX,CAAgB4N,MAAhB,EAdqB,CAgBrB;;AACA,QAAKA,MAAM,CAAClO,gBAAZ,EAA+B;AAE3BkO,MAAAA,MAAM,CAAClO,gBAAP,CAAyB,yBAAzB,EAAoD,KAAK4+B,YAAL,CAAkBj6B,IAAlB,CAAwB,IAAxB,CAApD;AAEH,KArBoB,CAuBrB;;;AACA,QAAKuJ,MAAM,YAAYkU,QAAlB,IAA8BlU,MAAM,CAACjH,aAA1C,EAA0D;AAEtDiH,MAAAA,MAAM,CAACjH,aAAP,CAAsB;AAAEjC,QAAAA,IAAI,EAAE,oBAAR;AAA8BzB,QAAAA,SAAS,EAAE,KAAKA;AAA9C,OAAtB;AAEH;;AAED,QAAK2K,MAAM,YAAYwgB,cAAvB,EAAwC;AAEpCxgB,MAAAA,MAAM,CAACjH,aAAP,CAAsB;AAAEjC,QAAAA,IAAI,EAAE,gBAAR;AAA0BxB,QAAAA,KAAK,EAAE,KAAKA;AAAtC,OAAtB;AAEH,KAlCoB,CAoCrB;;;AACA,QAAK0K,MAAM,CAAClJ,IAAP,KAAgB,UAArB,EAAkC;AAE9B,WAAK65B,wBAAL,CAA+B3wB,MAA/B;;AAEA,UAAK,CAAC,KAAKkuB,QAAX,EAAsB;AAElB,aAAK0C,WAAL,CAAkB5wB,MAAlB;AAEH;AAEJ;AAEJ,GA7DyE;;AA+D1E;;;;;;AAMAb,EAAAA,MAAM,EAAE,UAAWa,MAAX,EAAoB;AAExB,QAAKA,MAAM,CAACvH,mBAAZ,EAAkC;AAE9BuH,MAAAA,MAAM,CAACvH,mBAAP,CAA4B,yBAA5B,EAAuD,KAAKi4B,YAAL,CAAkBj6B,IAAlB,CAAwB,IAAxB,CAAvD;AAEH;;AAED,SAAKnB,KAAL,CAAW6J,MAAX,CAAmBa,MAAnB;AAEH,GA/EyE;;AAiF1E;;;;;;AAMAkwB,EAAAA,oBAAoB,EAAE,UAAWlF,KAAX,EAAmB;AAErC,QAAK,KAAKmD,MAAV,EAAmB;AAEfr2B,MAAAA,OAAO,CAACC,IAAR,CAAc,4BAAd;AACA;AAEH;;AAED,UAAMo2B,MAAM,GAAG,IAAInjB,MAAJ,CAAY,KAAK3V,SAAjB,CAAf;AACA84B,IAAAA,MAAM,CAACr8B,gBAAP,CAAyB,yBAAzB,EAAoD,KAAK4+B,YAAL,CAAkBj6B,IAAlB,CAAwB,IAAxB,CAApD;AACA03B,IAAAA,MAAM,CAACpiB,aAAP;AACAif,IAAAA,KAAK,CAACzV,OAAN,CAAesb,UAAU,IAAI;AAEzB1C,MAAAA,MAAM,CAACjhB,gBAAP,CAAyB2jB,UAAzB;AAEH,KAJD;AAMA,SAAK1C,MAAL,GAAcA,MAAd;AAEH,GA3GyE;;AA6G1E;;;;;;AAMAyC,EAAAA,WAAW,EAAE,UAAW3a,IAAX,EAAkB;AAE3B,UAAM6a,eAAe,GAAG,KAAK5C,QAA7B;;AAEA,QAAKjY,IAAI,CAACnf,IAAL,KAAc,UAAd,IAA4Bg6B,eAAe,KAAK7a,IAArD,EAA4D;AAExD;AACA,WAAK8a,YAAL;;AAEA,YAAMC,kBAAkB,GAAG,YAAY;AAEnC,YAAKF,eAAL,EAAuB;AAAEA,UAAAA,eAAe,CAAC/Z,OAAhB;AAA4B;;AACrDd,QAAAA,IAAI,CAACxd,mBAAL,CAA0B,kBAA1B,EAA8Cu4B,kBAA9C;AAEH,OALD;;AAOA/a,MAAAA,IAAI,CAACnkB,gBAAL,CAAuB,kBAAvB,EAA2Ck/B,kBAA3C,EAZwD,CAcxD;;AACA,OAAC,KAAK9C,QAAL,GAAgBjY,IAAjB,EAAuBa,OAAvB;AAEH;AAEJ,GA1IyE;;AA4I1E;;;;;;AAMA4Z,EAAAA,YAAY,EAAE,UAAWx9B,KAAX,EAAmB;AAE7B,QAAKA,KAAK,CAACyX,MAAN,IAAgB,KAAMzX,KAAK,CAACyX,MAAZ,CAArB,EAA4C;AAExC,WAAMzX,KAAK,CAACyX,MAAZ,EAAsBzX,KAAK,CAACmV,IAA5B;AAEH;AAEJ,GA1JyE;;AA4J1E;;;;;;AAMA4oB,EAAAA,uBAAuB,EAAE,UAAW/9B,KAAX,EAAmB;AAExC,SAAKoC,KAAL,CAAWggB,QAAX,CAAqB,UAAWtV,MAAX,EAAoB;AAErC,UAAKA,MAAM,CAACjH,aAAZ,EAA4B;AAExBiH,QAAAA,MAAM,CAACjH,aAAP,CAAsB7F,KAAtB;AAEH;AAEJ,KARD;AAUH,GA9KyE;;AAgL1E;;;;;;;;AAQAg+B,EAAAA,kBAAkB,EAAE,UAAWC,YAAX,EAAyBtqB,IAAzB,EAAgC;AAEhD,UAAM8E,QAAQ,GAAG,KAAKwiB,MAAL,CAAYxiB,QAA7B;AACA,UAAMylB,eAAe,GAAGzlB,QAAQ,CAAC8H,QAAT,CAAmB,CAAnB,CAAxB;AACA,UAAM4d,YAAY,GAAG1lB,QAAQ,CAAC8H,QAAT,CAAmB,CAAnB,CAArB;AAEA,QAAIlG,IAAJ;;AAEA,QAAK4jB,YAAY,KAAK3/B,SAAtB,EAAkC;AAE9B,cAAS2/B,YAAT;AAEA,aAAK,CAAL;AAEI5jB,UAAAA,IAAI,GAAG6jB,eAAe,CAACnkB,OAAhB,CAAwBwG,QAAxB,CAAkC,CAAlC,CAAP;AAEA;;AAEJ,aAAK,CAAL;AAEIlG,UAAAA,IAAI,GAAG6jB,eAAe,CAACnkB,OAAhB,CAAwBwG,QAAxB,CAAkC,CAAlC,CAAP;AAEA;;AAEJ;AAEIlG,UAAAA,IAAI,GAAG6jB,eAAe,CAACnkB,OAAhB,CAAwBwG,QAAxB,CAAkC,CAAlC,CAAP;AAEA;AAlBJ;;AAsBA2d,MAAAA,eAAe,CAACnkB,OAAhB,CAAwBiG,aAAxB,CAAuC3F,IAAvC;AACA6jB,MAAAA,eAAe,CAACzf,iBAAhB,CAAmCpE,IAAI,CAACxD,WAAxC;AAEH;;AAED,QAAKlD,IAAI,KAAKrV,SAAd,EAA0B;AAEtB,cAAQqV,IAAR;AAEA,aAAK/X,KAAK,CAACG,SAAX;AAEIse,UAAAA,IAAI,GAAG8jB,YAAY,CAACpkB,OAAb,CAAqBwG,QAArB,CAA+B,CAA/B,CAAP;AAEA;;AAEJ,aAAK3kB,KAAK,CAACI,MAAX;AAEIqe,UAAAA,IAAI,GAAG8jB,YAAY,CAACpkB,OAAb,CAAqBwG,QAArB,CAA+B,CAA/B,CAAP;AAEA;;AAEJ;AAEIlG,UAAAA,IAAI,GAAG8jB,YAAY,CAACpkB,OAAb,CAAqBwG,QAArB,CAA+B,CAA/B,CAAP;AAEA;AAlBJ;;AAqBA4d,MAAAA,YAAY,CAACpkB,OAAb,CAAqBiG,aAArB,CAAoC3F,IAApC;AACA8jB,MAAAA,YAAY,CAAC1f,iBAAb,CAAgCpE,IAAI,CAACxD,WAArC;AAEH;AAEJ,GAzPyE;;AA2P1E;;;;;;AAMAunB,EAAAA,YAAY,EAAE,UAAWzqB,IAAX,EAAkB;AAE5B,QAAK,KAAKA,IAAL,KAAcA,IAAnB,EAA0B;AAAE;AAAS;;AACrC,QAAKA,IAAI,KAAK/X,KAAK,CAACE,MAApB,EAA6B;AAAE,WAAKuiC,aAAL;AAAsB;AAAS,KAA9D,MACK;AAAE,WAAK1qB,IAAL,GAAYA,IAAZ;AAAmB;;AAE1B,UAAM+f,GAAG,GAAG,KAAKyB,MAAL,CAAYzB,GAAxB;;AAEA,YAAQ/f,IAAR;AAEA,WAAK/X,KAAK,CAACG,SAAX;AAEI,aAAK+gC,MAAL,GAAc,KAAK9F,eAAnB;AACA,aAAKmG,oBAAL;AAEA;;AAEJ,WAAKvhC,KAAK,CAACI,MAAX;AAEI,aAAK8gC,MAAL,GAAc,KAAK1D,YAAnB;AACA,aAAK+D,oBAAL;AAEA;;AAEJ;AAEI,aAAKL,MAAL,GAAc,IAAd;AACA,aAAKwB,qBAAL;AAEA;AArBJ;;AAyBA,SAAKN,kBAAL,CAAyB1/B,SAAzB,EAAoC,KAAKqV,IAAzC;AAEA;;;;;;;AAMA,SAAKoqB,uBAAL,CAA8B;AAAEn6B,MAAAA,IAAI,EAAE,0BAAR;AAAoC+P,MAAAA,IAAI,EAAE,KAAKA;AAA/C,KAA9B,EAzC4B,CA2C5B;;AACA,SAAKwhB,MAAL,CAAYzB,GAAZ,GAAkBA,GAAG,GAAG,KAAxB;AACA,SAAKoJ,MAAL,CAAYvE,OAAZ,CAAqB,KAAKp2B,SAAL,CAAe8E,WAApC,EAAiD,KAAK9E,SAAL,CAAe+E,YAAhE;AACA,SAAKwxB,MAAL;AACA,SAAKvD,MAAL,CAAYzB,GAAZ,GAAkBA,GAAlB;AAEA;;;;;;;AAMA,SAAK7tB,aAAL,CAAoB;AAAEjC,MAAAA,IAAI,EAAE,aAAR;AAAuB+P,MAAAA,IAAI,EAAE,KAAKA;AAAlC,KAApB;AAEH,GA1TyE;;AA4T1E;;;;;AAKA0qB,EAAAA,aAAa,EAAE,YAAY;AAEvB,QAAK,KAAK1qB,IAAL,KAAc/X,KAAK,CAACE,MAAzB,EAAkC;AAAE;AAAS;;AAE7C,SAAK6X,IAAL,GAAY/X,KAAK,CAACE,MAAlB;AACA,SAAKwiC,qBAAL;AAEA,SAAKN,kBAAL,CAAyB1/B,SAAzB,EAAoC,KAAKqV,IAAzC;AAEA;;;;;;;AAMA,SAAKoqB,uBAAL,CAA8B;AAAEn6B,MAAAA,IAAI,EAAE,0BAAR;AAAoC+P,MAAAA,IAAI,EAAE,KAAKA;AAA/C,KAA9B;AAEA,SAAKsjB,QAAL,CAAcsB,OAAd,CAAuB,KAAKp2B,SAAL,CAAe8E,WAAtC,EAAmD,KAAK9E,SAAL,CAAe+E,YAAlE;AACA,SAAKwxB,MAAL;AAEA;;;;;;;AAMA,SAAK7yB,aAAL,CAAoB;AAAEjC,MAAAA,IAAI,EAAE,aAAR;AAAuB+P,MAAAA,IAAI,EAAE,KAAKA;AAAlC,KAApB;AACH,GA5VyE;;AA8V1E;;;;;AAKAwpB,EAAAA,oBAAoB,EAAE,YAAY;AAE9B,QAAK,KAAKrC,OAAL,CAAa9vB,OAAlB,EAA4B;AAAE;AAAS;;AAEvC,SAAK+vB,iBAAL,GAAyB,IAAzB,CAJ8B,CAM9B;;AACA,SAAKwD,6BAAL;AACA,SAAKzD,OAAL,CAAa/vB,IAAb;AACA,SAAKyzB,oBAAL;AACA,SAAKC,kBAAL;AAEH,GA/WyE;;AAiX1E;;;;;AAKAH,EAAAA,qBAAqB,EAAE,YAAY;AAE/B,SAAKvD,iBAAL,GAAyB,KAAzB,CAF+B,CAI/B;;AACA,QAAK,CAAC,KAAKva,OAAL,CAAa4Z,aAAnB,EAAmC;AAE/B,WAAKU,OAAL,CAAa7vB,IAAb;AACA,WAAKyzB,sBAAL;AACA,WAAKtB,2BAAL;AAEH,KAND,MAMO;AAEH,WAAKqB,kBAAL;AAEH;AAEJ,GAvYyE;;AAyY1E;;;;;AAKAE,EAAAA,cAAc,EAAE,YAAY;AAExB,SAAKne,OAAL,CAAa+N,UAAb,GAA0B,IAA1B;AACA,SAAKb,aAAL,CAAmBa,UAAnB,GAAgC,IAAhC;AAEH,GAnZyE;;AAqZ1E;;;;;AAKAqQ,EAAAA,eAAe,EAAE,YAAY;AAEzBC,IAAAA,YAAY,CAAE,KAAKjD,mBAAP,CAAZ;AACA,SAAKpb,OAAL,CAAa+N,UAAb,GAA0B,KAA1B;AACA,SAAKb,aAAL,CAAmBa,UAAnB,GAAgC,KAAhC;AAEH,GAhayE;;AAka1E;;;;;;;AAOAuQ,EAAAA,eAAe,EAAE,UAAW/4B,KAAX,EAAmB;AAEhC,QAAK,KAAKi1B,QAAL,YAAyBnW,aAA9B,EAA8C;AAE1C;;;;;AAKA,WAAKmW,QAAL,CAAcn1B,aAAd,CAA6B;AAAEjC,QAAAA,IAAI,EAAE,cAAR;AAAwBmC,QAAAA,KAAK,EAAEA;AAA/B,OAA7B;AAEH;AAEJ,GAtbyE;;AAwb1E;;;;;;;AAOAsf,EAAAA,mBAAmB,EAAE,UAAWzH,UAAX,EAAwB;AAEzC,QAAK,KAAKod,QAAL,YAAyBnW,aAA9B,EAA8C;AAE1C;;;;;;AAMA,WAAKmW,QAAL,CAAcn1B,aAAd,CAA6B;AAAEjC,QAAAA,IAAI,EAAE,YAAR;AAAsBga,QAAAA,UAAU,EAAEA;AAAlC,OAA7B;AAEH;AAEJ,GA7cyE;;AA+c1E;;;;;;;AAOAmhB,EAAAA,aAAa,EAAE,UAAWnhB,UAAX,EAAwB;AAEnC,UAAM;AAAEqd,MAAAA;AAAF,QAAa,IAAnB;AAEA;;;;;;;AAMA,QAAIA,MAAJ,EAAa;AAAEA,MAAAA,MAAM,CAACp1B,aAAP,CAAsB;AAAEjC,QAAAA,IAAI,EAAE,cAAR;AAAwBga,QAAAA,UAAU,EAAEA;AAApC,OAAtB;AAA2E;AAE7F,GAleyE;;AAoe1E;;;;;;AAMAohB,EAAAA,iBAAiB,EAAE,UAAW5zB,EAAX,EAAgB;AAE/B,QAAKA,EAAL,EAAU;AAEN,WAAKowB,eAAL,CAAqBv3B,IAArB,CAA2BmH,EAA3B;AAEH;AAEJ,GAlfyE;;AAof1E;;;;;;AAMA6zB,EAAAA,oBAAoB,EAAE,UAAW7zB,EAAX,EAAgB;AAElC,UAAMhK,KAAK,GAAG,KAAKo6B,eAAL,CAAqBn8B,OAArB,CAA8B+L,EAA9B,CAAd;;AAEA,QAAKA,EAAE,IAAIhK,KAAK,IAAI,CAApB,EAAwB;AAEpB,WAAKo6B,eAAL,CAAqB0D,MAArB,CAA6B99B,KAA7B,EAAoC,CAApC;AAEH;AAEJ,GApgByE;;AAsgB1E;;;;;AAKA+9B,EAAAA,eAAe,EAAE,YAAY;AAEzB,UAAM;AAAElE,MAAAA;AAAF,QAAa,IAAnB;AAEA;;;;;;AAKA,QAAIA,MAAJ,EAAa;AAAEA,MAAAA,MAAM,CAACp1B,aAAP,CAAsB;AAAEjC,QAAAA,IAAI,EAAE;AAAR,OAAtB;AAAyD;AAE3E,GAthByE;;AAwhB1E;;;;;AAKAw7B,EAAAA,eAAe,EAAE,YAAY;AAEzB,UAAM;AAAEnE,MAAAA;AAAF,QAAa,IAAnB;AAEA;;;;;;AAKA,QAAIA,MAAJ,EAAa;AAAEA,MAAAA,MAAM,CAACp1B,aAAP,CAAsB;AAAEjC,QAAAA,IAAI,EAAE;AAAR,OAAtB;AAAyD;AAE3E,GAxiByE;;AA0iB1E;;;;;;AAMAy7B,EAAAA,qBAAqB,EAAE,UAAW/iB,MAAX,EAAoB;AAEvC,UAAM;AAAE2e,MAAAA;AAAF,QAAa,IAAnB;;AAEA,QAAKA,MAAM,IAAIA,MAAM,CAAC1iB,YAAjB,IAAiC0iB,MAAM,CAAC1iB,YAAP,CAAoB8D,aAA1D,EAA0E;AAEtE4e,MAAAA,MAAM,CAAC1iB,YAAP,CAAoB8D,aAApB,CAAkC/R,MAAlC,CAA0CgS,MAA1C;AAEH;AAEJ,GA1jByE;;AA4jB1E;;;;;;AAMAmhB,EAAAA,wBAAwB,EAAE,UAAW1a,IAAX,EAAkB;AAExC;AACAA,IAAAA,IAAI,CAACnkB,gBAAL,CAAuB,kBAAvB,EAA2C,KAAK0gC,gBAAL,CAAsB/7B,IAAtB,CAA4B,IAA5B,CAA3C,EAHwC,CAKxC;;AACA,QAAKwf,IAAI,YAAY8B,aAArB,EAAqC;AAEjC9B,MAAAA,IAAI,CAACnkB,gBAAL,CAAuB,kBAAvB,EAA2C,KAAKugC,eAAL,CAAqB57B,IAArB,CAA2B,IAA3B,CAA3C;AACAwf,MAAAA,IAAI,CAACnkB,gBAAL,CAAuB,OAAvB,EAAgC,YAAY;AAExC,YAAK,EAAE,KAAKo8B,QAAL,YAAyBnW,aAA3B,CAAL,EAAiD;AAE7C,eAAKua,eAAL,CAAqBl3B,IAArB,CAA2B,IAA3B;AAEH;AAEJ,OAR+B,CAQ9B3E,IAR8B,CAQxB,IARwB,CAAhC;AAUH;AAEJ,GAvlByE;;AAylB1E;;;;;AAKA+7B,EAAAA,gBAAgB,EAAE,YAAY;AAE1B,SAAK5R,aAAL,CAAmB/P,MAAnB,CAA0B5U,IAA1B,CAAgC,KAAKiyB,QAAL,CAAcv0B,QAA9C;AAEH,GAlmByE;;AAomB1E;;;;;;;AAOA84B,EAAAA,UAAU,EAAE,YAAY;AAEpB,WAAO,KAAK1C,OAAZ;AAEH,GA/mByE;;AAinB1E;;;;;;AAMA2C,EAAAA,QAAQ,EAAE,YAAY;AAElB,WAAO,KAAKp9B,KAAZ;AAEH,GA3nByE;;AA6nB1E;;;;;;AAMAq9B,EAAAA,SAAS,EAAE,YAAY;AAEnB,WAAO,KAAKtK,MAAZ;AAEH,GAvoByE;;AAyoB1E;;;;;;AAMAuK,EAAAA,WAAW,EAAE,YAAY;AAErB,WAAO,KAAKzI,QAAZ;AAEH,GAnpByE;;AAqpB1E;;;;;;AAMA3hB,EAAAA,YAAY,EAAE,YAAY;AAEtB,WAAO,KAAKnT,SAAZ;AAEH,GA/pByE;;AAiqB1E;;;;;;AAMAw9B,EAAAA,YAAY,EAAE,YAAY;AAEtB,WAAO,KAAK9C,OAAL,CAAa3gB,EAApB;AAEH,GA3qByE;;AA6qB1E;;;;;;AAMA0jB,EAAAA,gBAAgB,EAAE,YAAY;AAE1B,WAAO,KAAKhD,QAAL,CAAe,KAAKiD,mBAAL,EAAf,EAA4C3jB,EAAnD;AAEH,GAvrByE;;AAyrB1E;;;;;;AAMA2jB,EAAAA,mBAAmB,EAAE,YAAY;AAE7B,UAAMjD,QAAQ,GAAG,KAAKA,QAAtB;AACA,UAAMC,OAAO,GAAG,KAAKA,OAArB;AACA,UAAMiD,SAAS,GAAGlD,QAAQ,CAACv9B,OAAT,CAAkBw9B,OAAlB,IAA8B,CAAhD;AAEA,WAASiD,SAAS,IAAIlD,QAAQ,CAAC15B,MAAxB,GAAmC,CAAnC,GAAuC48B,SAA9C;AAEH,GAvsByE;;AAysB1E;;;;;;AAMAC,EAAAA,YAAY,EAAE,UAAWrM,GAAX,EAAiB;AAE3B,SAAKyB,MAAL,CAAYzB,GAAZ,GAAkBA,GAAlB;AACA,SAAKyB,MAAL,CAAYlB,sBAAZ;AAEH,GAptByE;;AAstB1E;;;;;;AAMA+L,EAAAA,aAAa,EAAE,UAAW5+B,KAAX,EAAmB;AAE9BA,IAAAA,KAAK,GAAKA,KAAK,IAAI,CAAT,IAAcA,KAAK,GAAG,KAAKw7B,QAAL,CAAc15B,MAAtC,GAAiD9B,KAAjD,GAAyD,CAAjE;AAEA,SAAKy7B,OAAL,CAAal/B,OAAb,GAAuB,KAAvB;AAEA,SAAKk/B,OAAL,GAAe,KAAKD,QAAL,CAAex7B,KAAf,CAAf;AAEA,SAAKy7B,OAAL,CAAal/B,OAAb,GAAuB,IAAvB;;AAEA,YAASyD,KAAT;AAEA,WAAK3F,QAAQ,CAACC,KAAd;AAEI,aAAKy5B,MAAL,CAAY1uB,QAAZ,CAAqBsC,IAArB,CAA2B,KAAKiyB,QAAL,CAAcv0B,QAAzC;AACA,aAAK0uB,MAAL,CAAY1uB,QAAZ,CAAqB6B,CAArB,IAA0B,CAA1B;AAEA;;AAEJ,WAAK7M,QAAQ,CAACE,iBAAd;AAEI,aAAKw5B,MAAL,CAAY1uB,QAAZ,CAAqBsC,IAArB,CAA2B,KAAKiyB,QAAL,CAAcv0B,QAAzC;AAEA;;AAEJ;AAEI;AAjBJ;;AAoBA,SAAKo2B,OAAL,CAAavyB,MAAb;AAEA,SAAK0zB,kBAAL,CAAyB58B,KAAzB,EAAgC9C,SAAhC;AAEH,GA9vByE;;AAgwB1E;;;;;AAKA2hC,EAAAA,cAAc,EAAE,YAAY;AAExB,SAAKpD,OAAL,CAAal/B,OAAb,GAAuB,KAAvB;AAEH,GAzwByE;;AA2wB1E;;;;;AAKAuiC,EAAAA,iBAAiB,EAAE,YAAY;AAE3B,SAAKF,aAAL,CAAoB,KAAKH,mBAAL,EAApB;AAEH,GApxByE;;AAsxB1E;;;;;AAKAM,EAAAA,eAAe,EAAE,UAAWC,WAAX,EAAyB;AAEtC,UAAMne,MAAM,GAAGme,WAAW,CAACnT,KAAZ,EAAf;AACA,UAAMoT,SAAS,GAAK,KAAKl+B,SAAL,CAAe8E,WAAjB,GAAiC,CAAnD;AACA,UAAMq5B,UAAU,GAAG,KAAKn+B,SAAL,CAAe+E,YAAf,GAA8B,CAAjD;AAEA+a,IAAAA,MAAM,CAACse,OAAP,CAAgB,KAAKpL,MAArB;AAEAlT,IAAAA,MAAM,CAAC3Y,CAAP,GAAa2Y,MAAM,CAAC3Y,CAAP,GAAW+2B,SAAb,GAA2BA,SAAtC;AACApe,IAAAA,MAAM,CAAC1Y,CAAP,GAAW,EAAI0Y,MAAM,CAAC1Y,CAAP,GAAW+2B,UAAf,IAA8BA,UAAzC;AACAre,IAAAA,MAAM,CAAC3Z,CAAP,GAAW,CAAX;AAEA,WAAO2Z,MAAP;AAEH,GAzyByE;;AA2yB1E;;;;;AAKAue,EAAAA,qBAAqB,EAAE,UAAWC,MAAX,EAAoB;AAEvC,SAAKtL,MAAL,CAAYuL,kBAAZ,CAA+BC,UAA/B,CAA2C,KAAKxL,MAAL,CAAYyL,WAAvD;AACA,SAAKjF,0BAAL,CAAgCkF,gBAAhC,CAAkD,KAAK1L,MAAL,CAAY2L,gBAA9D,EAAgF,KAAK3L,MAAL,CAAYuL,kBAA5F;AACA,SAAKhF,aAAL,CAAmBqF,aAAnB,CAAkC,KAAKpF,0BAAvC;AAEA,WAAO8E,MAAM,CAACz1B,OAAP,IAAkB,KAAK0wB,aAAL,CAAmBsF,gBAAnB,CAAqCP,MAArC,CAAzB;AAEH,GAxzByE;;AA0zB1E;;;;;AAKAvD,EAAAA,wBAAwB,EAAE,YAAY;AAElC,SAAKxP,aAAL,CAAmBU,WAAnB,IAAkC,CAAC,CAAnC;AACA,SAAKV,aAAL,CAAmBkB,qBAAnB,IAA4C,CAAC,CAA7C;AAEH,GAp0ByE;;AAs0B1E;;;;;AAKAmO,EAAAA,UAAU,EAAE,YAAY;AAEpB,SAAKjC,OAAL,GAAe,IAAIvzB,OAAJ,CAAa,QAAb,EAAuB,IAAvB,EAA6B,KAAKiZ,OAAL,CAAa9Y,SAA1C,CAAf;AACA,SAAKozB,OAAL,CAAa7vB,IAAb;AACA,SAAKkqB,MAAL,CAAYj2B,GAAZ,CAAiB,KAAK47B,OAAtB;AACA,SAAKF,YAAL,CAAkB17B,GAAlB,CAAuB,KAAKi2B,MAA5B;AAEH,GAl1ByE;;AAo1B1E;;;;;;;;AAQA8L,EAAAA,kBAAkB,EAAE,UAAWhf,MAAX,EAAmB/X,QAAnB,EAA6BwF,MAA7B,EAAsC;AAEtD,QAAK,KAAKmtB,OAAL,KAAiB,KAAKnP,aAA3B,EAA2C;AAEvC;AAEH,KANqD,CAQtD;;;AACA,QAAKzL,MAAM,YAAYjT,KAAvB,EAA+B;AAE3B9E,MAAAA,QAAQ,GAAG+X,MAAM,CAAE,CAAF,CAAjB;AACAvS,MAAAA,MAAM,GAAGuS,MAAM,CAAE,CAAF,CAAf;AACAA,MAAAA,MAAM,GAAGA,MAAM,CAAE,CAAF,CAAf;AAEH;;AAED/X,IAAAA,QAAQ,GAAGA,QAAQ,KAAK5L,SAAb,GAAyB4L,QAAzB,GAAoC,IAA/C;AACAwF,IAAAA,MAAM,GAAGA,MAAM,IAAInE,KAAK,CAACqC,MAAN,CAAawD,WAAb,CAAyBR,GAA5C;AAEA,QAAIkI,KAAJ,EAAWooB,EAAX,EAAeC,EAAf,EAAmBC,GAAnB,EAAwBC,GAAxB,EAA6BC,EAA7B,EAAiCC,EAAjC,EAAqCC,IAArC,EAA2CC,EAA3C,EAA+CC,EAA/C;AAEA5oB,IAAAA,KAAK,GAAG,IAAR;AAEAsoB,IAAAA,GAAG,GAAG,KAAKjM,MAAL,CAAYwM,iBAAZ,CAA+B,IAAIxoC,OAAJ,EAA/B,CAAN;AACAkoC,IAAAA,GAAG,GAAGD,GAAG,CAACnU,KAAJ,EAAN;AAEAuU,IAAAA,IAAI,GAAG,KAAKxG,QAAL,CAAc4G,gBAAd,CAAgC,IAAIzoC,OAAJ,EAAhC,EAAgDo6B,GAAhD,CAAqD,KAAK4B,MAAL,CAAYyM,gBAAZ,CAA8B,IAAIzoC,OAAJ,EAA9B,CAArD,CAAP;AAEAmoC,IAAAA,EAAE,GAAGrf,MAAM,CAACgL,KAAP,EAAL,CA7BsD,CA8BtD;;AACAqU,IAAAA,EAAE,CAACh4B,CAAH,IAAQ,CAAC,CAAT;AACAg4B,IAAAA,EAAE,CAACpiC,GAAH,CAAQsiC,IAAR,EAAeK,SAAf;AACAN,IAAAA,EAAE,GAAGD,EAAE,CAACrU,KAAH,EAAL;AAEAmU,IAAAA,GAAG,CAAC73B,CAAJ,GAAQ,CAAR;AACA+3B,IAAAA,EAAE,CAAC/3B,CAAH,GAAO,CAAP;AAEA23B,IAAAA,EAAE,GAAGhnC,IAAI,CAACm6B,KAAL,CAAYiN,EAAE,CAACh5B,CAAf,EAAkBg5B,EAAE,CAACh4B,CAArB,IAA2BpP,IAAI,CAACm6B,KAAL,CAAY+M,GAAG,CAAC94B,CAAhB,EAAmB84B,GAAG,CAAC93B,CAAvB,CAAhC;AACA43B,IAAAA,EAAE,GAAGA,EAAE,GAAGhnC,IAAI,CAACkP,EAAV,GAAe83B,EAAE,GAAG,IAAIhnC,IAAI,CAACkP,EAA7B,GAAkC83B,EAAvC;AACAA,IAAAA,EAAE,GAAGA,EAAE,GAAG,CAAChnC,IAAI,CAACkP,EAAX,GAAgB83B,EAAE,GAAG,IAAIhnC,IAAI,CAACkP,EAA9B,GAAmC83B,EAAxC;AACAC,IAAAA,EAAE,GAAGjnC,IAAI,CAAC05B,GAAL,CAAUyN,GAAG,CAACS,OAAJ,CAAaV,GAAb,KAAuBC,GAAG,CAAC93B,CAAJ,GAAQg4B,EAAE,CAACh4B,CAAX,IAAgB,CAAhB,GAAoBg4B,EAAE,CAACO,OAAH,CAAYR,EAAZ,CAApB,GAAuC,CAACC,EAAE,CAACO,OAAH,CAAYR,EAAZ,CAA/D,CAAV,CAAL;AACAH,IAAAA,EAAE,IAAII,EAAE,CAACh4B,CAAH,GAAO83B,GAAG,CAAC93B,CAAX,GAAe,CAAf,GAAmB,CAAC,CAA1B;AAEAk4B,IAAAA,EAAE,GAAG;AAAE96B,MAAAA,IAAI,EAAE,CAAR;AAAWurB,MAAAA,EAAE,EAAE;AAAf,KAAL;AACAwP,IAAAA,EAAE,GAAG;AAAE/6B,MAAAA,IAAI,EAAE,CAAR;AAAWurB,MAAAA,EAAE,EAAE;AAAf,KAAL;AAEA,SAAKqK,kBAAL,CAAwBj5B,IAAxB;AACA,SAAKk5B,gBAAL,CAAsBl5B,IAAtB;AAEA,SAAKi5B,kBAAL,GAA0B,IAAIhxB,KAAK,CAACA,KAAV,CAAiBk2B,EAAjB,EACrB9yB,EADqB,CACjB;AAAEhI,MAAAA,IAAI,EAAEu6B;AAAR,KADiB,EACHh3B,QADG,EAErBwF,MAFqB,CAEbA,MAFa,EAGrBO,QAHqB,CAGZ,UAASwxB,EAAT,EAAY;AAClB3oB,MAAAA,KAAK,CAAC+jB,OAAN,CAAclK,UAAd,CAA0B8O,EAAE,CAAC96B,IAAH,GAAU+6B,EAAE,CAAC/6B,IAAvC;AACA+6B,MAAAA,EAAE,CAAC/6B,IAAH,GAAU86B,EAAE,CAAC96B,IAAb;AACH,KANqB,EAOrBnD,KAPqB,EAA1B;AASA,SAAKg5B,gBAAL,GAAwB,IAAIjxB,KAAK,CAACA,KAAV,CAAiBk2B,EAAjB,EACnB9yB,EADmB,CACf;AAAEujB,MAAAA,EAAE,EAAEiP;AAAN,KADe,EACHj3B,QADG,EAEnBwF,MAFmB,CAEXA,MAFW,EAGnBO,QAHmB,CAGV,UAASwxB,EAAT,EAAY;AAClB3oB,MAAAA,KAAK,CAAC+jB,OAAN,CAAc/J,QAAd,CAAwB2O,EAAE,CAACvP,EAAH,GAAQwP,EAAE,CAACxP,EAAnC;AACAwP,MAAAA,EAAE,CAACxP,EAAH,GAAQuP,EAAE,CAACvP,EAAX;AACH,KANmB,EAOnB1uB,KAPmB,EAAxB;AASH,GAh6ByE;;AAk6B1E;;;;;;;;AAQAu+B,EAAAA,0BAA0B,EAAE,UAAWj1B,MAAX,EAAmB5C,QAAnB,EAA6BwF,MAA7B,EAAsC;AAE9D,QAAIsyB,uBAAuB,GAAG,KAA9B;AAEAl1B,IAAAA,MAAM,CAACm1B,iBAAP,CAA0B,UAAWC,QAAX,EAAsB;AAE5C,UAAKA,QAAQ,CAAChgB,gBAAd,EAAiC;AAE7B8f,QAAAA,uBAAuB,GAAG,IAA1B;AAEH;AACJ,KAPD;;AASA,QAAKA,uBAAL,EAA+B;AAE3B,YAAMG,aAAa,GAAG,IAAIhpC,OAAJ,CAAa,CAAC,CAAd,EAAiB,CAAjB,EAAoB,CAApB,CAAtB;AAEA,WAAK8nC,kBAAL,CAAyBn0B,MAAM,CAAC80B,gBAAP,CAAyB,IAAIzoC,OAAJ,EAAzB,EAAyCszB,QAAzC,CAAmD0V,aAAnD,CAAzB,EAA6Fj4B,QAA7F,EAAuGwF,MAAvG;AAEH,KAND,MAMO;AAEH,WAAKuxB,kBAAL,CAAyBn0B,MAAM,CAAC80B,gBAAP,CAAyB,IAAIzoC,OAAJ,EAAzB,CAAzB,EAAmE+Q,QAAnE,EAA6EwF,MAA7E;AAEH;AAEJ,GAn8ByE;;AAq8B1E;;;;;;;;AAQAlK,EAAAA,cAAc,EAAE,UAAW48B,WAAX,EAAwBC,YAAxB,EAAuC;AAEnD,QAAI1gC,KAAJ,EAAWE,MAAX;AAEA,UAAMygC,MAAM,GAAG,KAAKngC,SAAL,CAAeiV,SAAf,CAAyBmrB,QAAzB,CAAmC,oBAAnC,KAA6D,KAAKpgC,SAAL,CAAe2Y,YAA3F;;AAEA,QAAKsnB,WAAW,KAAK9jC,SAAhB,IAA6B+jC,YAAY,KAAK/jC,SAAnD,EAA+D;AAE3DqD,MAAAA,KAAK,GAAGygC,WAAR;AACAvgC,MAAAA,MAAM,GAAGwgC,YAAT;AACA,WAAKlgC,SAAL,CAAe2T,MAAf,GAAwBssB,WAAxB;AACA,WAAKjgC,SAAL,CAAe4T,OAAf,GAAyBssB,YAAzB;AAEH,KAPD,MAOO;AAEH,YAAMG,SAAS,GAAG,aAAan+B,IAAb,CAAkBxF,MAAM,CAACsE,SAAP,CAAiBsiB,SAAnC,CAAlB;AAEA,YAAMgd,WAAW,GAAGD,SAAS,GACvBtoC,IAAI,CAAC85B,GAAL,CAASh1B,QAAQ,CAAC0jC,eAAT,CAAyBz7B,WAAlC,EAA+CpI,MAAM,CAAC4jB,UAAP,IAAqB,CAApE,CADuB,GAEvBvoB,IAAI,CAACmuB,GAAL,CAASrpB,QAAQ,CAAC0jC,eAAT,CAAyBz7B,WAAlC,EAA+CpI,MAAM,CAAC4jB,UAAP,IAAqB,CAApE,CAFN;AAIA,YAAMkgB,YAAY,GAAGH,SAAS,GACxBtoC,IAAI,CAAC85B,GAAL,CAASh1B,QAAQ,CAAC0jC,eAAT,CAAyBx7B,YAAlC,EAAgDrI,MAAM,CAAC67B,WAAP,IAAsB,CAAtE,CADwB,GAExBxgC,IAAI,CAACmuB,GAAL,CAASrpB,QAAQ,CAAC0jC,eAAT,CAAyBx7B,YAAlC,EAAgDrI,MAAM,CAAC67B,WAAP,IAAsB,CAAtE,CAFN;AAIA/4B,MAAAA,KAAK,GAAG2gC,MAAM,GAAGG,WAAH,GAAiB,KAAKtgC,SAAL,CAAe8E,WAA9C;AACApF,MAAAA,MAAM,GAAGygC,MAAM,GAAGK,YAAH,GAAkB,KAAKxgC,SAAL,CAAe+E,YAAhD;AAEA,WAAK/E,SAAL,CAAe2T,MAAf,GAAwBnU,KAAxB;AACA,WAAKQ,SAAL,CAAe4T,OAAf,GAAyBlU,MAAzB;AAEH;;AAED,SAAKszB,MAAL,CAAYkC,MAAZ,GAAqB11B,KAAK,GAAGE,MAA7B;AACA,SAAKszB,MAAL,CAAYlB,sBAAZ;AAEA,SAAKgD,QAAL,CAAcsB,OAAd,CAAuB52B,KAAvB,EAA8BE,MAA9B,EApCmD,CAsCnD;;AACA,QAAK,KAAK2e,OAAL,CAAa4Z,aAAb,IAA8B,KAAKW,iBAAxC,EAA4D;AAExD,WAAK0D,kBAAL;AAEH;AAED;;;;;;;;;AAOA,SAAK54B,aAAL,CAAoB;AAAEjC,MAAAA,IAAI,EAAE,eAAR;AAAyBjC,MAAAA,KAAK,EAAEA,KAAhC;AAAuCE,MAAAA,MAAM,EAAEA;AAA/C,KAApB;AACA,SAAKO,KAAL,CAAWggB,QAAX,CAAqB,UAAWtV,MAAX,EAAoB;AAErC,UAAKA,MAAM,CAACjH,aAAZ,EAA4B;AAExBiH,QAAAA,MAAM,CAACjH,aAAP,CAAsB;AAAEjC,UAAAA,IAAI,EAAE,eAAR;AAAyBjC,UAAAA,KAAK,EAAEA,KAAhC;AAAuCE,UAAAA,MAAM,EAAEA;AAA/C,SAAtB;AAEH;AAEJ,KARD;AAUH,GA5gCyE;;AA8gC1E;;;;;AAKAw7B,EAAAA,gBAAgB,EAAE,YAAY;AAE1B,UAAMh7B,OAAO,GAAGrD,QAAQ,CAACqH,aAAT,CAAwB,KAAxB,CAAhB;AACAhE,IAAAA,OAAO,CAACmE,KAAR,CAAcC,QAAd,GAAyB,UAAzB;AACApE,IAAAA,OAAO,CAACmE,KAAR,CAAcqP,KAAd,GAAsB,MAAtB;AACAxT,IAAAA,OAAO,CAACmE,KAAR,CAAcE,GAAd,GAAoB,MAApB;AACArE,IAAAA,OAAO,CAACmE,KAAR,CAAcgB,KAAd,GAAsB,MAAtB;AACA,SAAKrF,SAAL,CAAekT,WAAf,CAA4BhT,OAA5B;AACA,SAAKw5B,gBAAL,GAAwBx5B,OAAxB;AAEH,GA7hCyE;;AA+hC1E;;;;;AAKAugC,EAAAA,cAAc,EAAE,YAAY;AAExB,UAAMzgB,UAAU,GAAG,KAAKmZ,SAAL,CAAeuH,eAAf,CAAgC,KAAK7H,QAArC,EAA+C,IAA/C,CAAnB;;AAEA,QAAK7Y,UAAU,CAACjf,MAAX,GAAoB,CAAzB,EAA6B;AAEzB,YAAM4/B,KAAK,GAAG3gB,UAAU,CAAE,CAAF,CAAV,CAAgB2gB,KAAhB,CAAsB7V,KAAtB,EAAd;AACA,YAAM8V,SAAS,GAAG,IAAI5pC,OAAJ,CAAa,CAAC,CAAd,EAAiB,CAAjB,EAAoB,CAApB,CAAlB;AACA,YAAM6pC,KAAK,GAAG,KAAKhI,QAAL,CAAc4G,gBAAd,CAAgC,IAAIzoC,OAAJ,EAAhC,CAAd;AACA2pC,MAAAA,KAAK,CAACvP,GAAN,CAAWyP,KAAX,EAAmBvW,QAAnB,CAA6BsW,SAA7B;AAEA,YAAMt8B,QAAQ,GAAG;AACb6C,QAAAA,CAAC,EAAEw5B,KAAK,CAACx5B,CAAN,CAAQ25B,OAAR,CAAgB,CAAhB,CADU;AAEb15B,QAAAA,CAAC,EAAEu5B,KAAK,CAACv5B,CAAN,CAAQ05B,OAAR,CAAgB,CAAhB,CAFU;AAGb36B,QAAAA,CAAC,EAAEw6B,KAAK,CAACx6B,CAAN,CAAQ26B,OAAR,CAAgB,CAAhB;AAHU,OAAjB;AAMA,YAAMC,OAAO,GAAI,GAAEz8B,QAAQ,CAAC6C,CAAE,KAAI7C,QAAQ,CAAC8C,CAAE,KAAI9C,QAAQ,CAAC6B,CAAE,EAA5D;;AAEA,UAAKw6B,KAAK,CAAC5/B,MAAN,OAAmB,CAAxB,EAA4B;AAAE;AAAS;;AAEvC,cAAS,KAAKsd,OAAL,CAAaga,MAAtB;AAEA,aAAK,OAAL;AACI;;;;;AAKA,eAAK30B,aAAL,CAAoB;AAAEjC,YAAAA,IAAI,EAAE,iBAAR;AAA2B6C,YAAAA,QAAQ,EAAEA;AAArC,WAApB;AACA;;AAEJ,aAAK,SAAL;AACI7B,UAAAA,OAAO,CAACu+B,IAAR,CAAcD,OAAd;AACA;;AAEJ,aAAK,SAAL;AACI,eAAKrH,gBAAL,CAAsBhlB,WAAtB,GAAoCqsB,OAApC;AACA;;AAEJ;AACI;AApBJ;AAwBH;AAEJ,GAnlCyE;;AAqlC1E;;;;;;AAMAhmB,EAAAA,WAAW,EAAE,UAAWld,KAAX,EAAmB;AAE5BA,IAAAA,KAAK,CAACmY,cAAN;AAEA,SAAK6S,SAAL,CAAe1hB,CAAf,GAAqBtJ,KAAK,CAAC2V,OAAN,IAAiB,CAAnB,GAAyB3V,KAAK,CAAC2V,OAA/B,GAAyC3V,KAAK,CAAC8rB,OAAN,CAAc,CAAd,EAAiBnW,OAA7E;AACA,SAAKqV,SAAL,CAAezhB,CAAf,GAAqBvJ,KAAK,CAAC4V,OAAN,IAAiB,CAAnB,GAAyB5V,KAAK,CAAC4V,OAA/B,GAAyC5V,KAAK,CAAC8rB,OAAN,CAAc,CAAd,EAAiBlW,OAA7E;AACA,SAAKoV,SAAL,CAAepnB,IAAf,GAAsB,WAAtB;AACA,SAAK0W,KAAL,CAAYta,KAAZ;AAEH,GApmCyE;;AAsmC1E;;;;;;AAMAwrB,EAAAA,WAAW,EAAE,UAAWxrB,KAAX,EAAmB;AAE5BA,IAAAA,KAAK,CAACmY,cAAN;AACA,SAAK6S,SAAL,CAAepnB,IAAf,GAAsB,WAAtB;AACA,SAAK0W,KAAL,CAAYta,KAAZ;AAEH,GAlnCyE;;AAonC1E;;;;;;AAMAyrB,EAAAA,SAAS,EAAE,UAAWzrB,KAAX,EAAmB;AAE1B,QAAIojC,QAAQ,GAAG,KAAf;AAEA,SAAKpY,SAAL,CAAepnB,IAAf,GAAsB,SAAtB;AAEA,UAAMA,IAAI,GAAK,KAAKonB,SAAL,CAAe1hB,CAAf,IAAoBtJ,KAAK,CAAC2V,OAAN,GAAgB,KAAK6K,OAAL,CAAayZ,cAAjD,IAChB,KAAKjP,SAAL,CAAe1hB,CAAf,IAAoBtJ,KAAK,CAAC2V,OAAN,GAAgB,KAAK6K,OAAL,CAAayZ,cADjC,IAEhB,KAAKjP,SAAL,CAAezhB,CAAf,IAAoBvJ,KAAK,CAAC4V,OAAN,GAAgB,KAAK4K,OAAL,CAAayZ,cAFjC,IAGhB,KAAKjP,SAAL,CAAezhB,CAAf,IAAoBvJ,KAAK,CAAC4V,OAAN,GAAgB,KAAK4K,OAAL,CAAayZ,cAHnC,IAIXj6B,KAAK,CAACod,cAAN,IACH,KAAK4N,SAAL,CAAe1hB,CAAf,IAAoBtJ,KAAK,CAACod,cAAN,CAAqB,CAArB,EAAwBzH,OAAxB,GAAkC,KAAK6K,OAAL,CAAayZ,cADhE,IAEH,KAAKjP,SAAL,CAAe1hB,CAAf,IAAoBtJ,KAAK,CAACod,cAAN,CAAqB,CAArB,EAAwBzH,OAAxB,GAAkC,KAAK6K,OAAL,CAAayZ,cAFhE,IAGH,KAAKjP,SAAL,CAAezhB,CAAf,IAAoBvJ,KAAK,CAACod,cAAN,CAAqB,CAArB,EAAwBxH,OAAxB,GAAkC,KAAK4K,OAAL,CAAayZ,cAHhE,IAIH,KAAKjP,SAAL,CAAezhB,CAAf,IAAoBvJ,KAAK,CAACod,cAAN,CAAqB,CAArB,EAAwBxH,OAAxB,GAAkC,KAAK4K,OAAL,CAAayZ,cARrD,GASP,OATO,GASG37B,SAThB,CAN0B,CAiB1B;;AACA,QAAK0B,KAAK,IAAIA,KAAK,CAAC2d,MAAf,IAAyB,CAAC3d,KAAK,CAAC2d,MAAN,CAAavG,SAAb,CAAuBmrB,QAAvB,CAAiC,iBAAjC,CAA/B,EAAsF;AAAE;AAAS;;AAEjGviC,IAAAA,KAAK,CAACmY,cAAN;;AAEA,QAAKnY,KAAK,CAACod,cAAN,IAAwBpd,KAAK,CAACod,cAAN,CAAqBla,MAArB,KAAgC,CAA7D,EAAiE;AAE7DkgC,MAAAA,QAAQ,GAAG,KAAK9oB,KAAL,CAAY;AAAE3E,QAAAA,OAAO,EAAE3V,KAAK,CAACod,cAAN,CAAqB,CAArB,EAAwBzH,OAAnC;AAA4CC,QAAAA,OAAO,EAAE5V,KAAK,CAACod,cAAN,CAAqB,CAArB,EAAwBxH;AAA7E,OAAZ,EAAoGhS,IAApG,CAAX;AAEH,KAJD,MAIO;AAEHw/B,MAAAA,QAAQ,GAAG,KAAK9oB,KAAL,CAAYta,KAAZ,EAAmB4D,IAAnB,CAAX;AAEH;;AAED,SAAKonB,SAAL,CAAepnB,IAAf,GAAsB,MAAtB;;AAEA,QAAKw/B,QAAL,EAAgB;AAEZ;AAEH;;AAED,QAAKx/B,IAAI,KAAK,OAAd,EAAwB;AAEpB,YAAM;AAAE4c,QAAAA,OAAO,EAAE;AAAEuZ,UAAAA,gBAAF;AAAoBD,UAAAA;AAApB,SAAX;AAAqDkB,QAAAA,QAArD;AAA+DqI,QAAAA;AAA/D,UAAoF,IAA1F;;AAEA,UAAKtJ,gBAAgB,IAAIiB,QAAzB,EAAoC;AAEhCA,QAAAA,QAAQ,CAACrY,wBAAT;AAEH;;AAED,UAAKmX,kBAAL,EAA0B;AAEtBuJ,QAAAA,gBAAgB;AAEnB;AAEJ;AAEJ,GAprCyE;;AAsrC1E;;;;;;;AAOA/oB,EAAAA,KAAK,EAAE,UAAWta,KAAX,EAAkB4D,IAAlB,EAAyB;AAE5B,UAAM;AAAE+C,MAAAA,IAAF;AAAQD,MAAAA;AAAR,QAAgB,KAAKvE,SAAL,CAAe2b,qBAAf,EAAtB;AACA,UAAM;AAAE7W,MAAAA,WAAF;AAAeC,MAAAA;AAAf,QAAgC,KAAK/E,SAA3C;AAEA,SAAKo5B,cAAL,CAAoBjyB,CAApB,GAA0B,CAAEtJ,KAAK,CAAC2V,OAAN,GAAgBhP,IAAlB,IAA2BM,WAA7B,GAA6C,CAA7C,GAAiD,CAAzE;AACA,SAAKs0B,cAAL,CAAoBhyB,CAApB,GAAwB,EAAI,CAAEvJ,KAAK,CAAC4V,OAAN,GAAgBlP,GAAlB,IAA0BQ,YAA9B,IAA+C,CAA/C,GAAmD,CAA3E;AAEA,SAAKo0B,SAAL,CAAegI,aAAf,CAA8B,KAAK/H,cAAnC,EAAmD,KAAKpG,MAAxD,EAR4B,CAU5B;;AACA,QAAK,CAAC,KAAK6F,QAAX,EAAsB;AAElB;AAEH,KAf2B,CAiB5B;;;AACA,QAAKh7B,KAAK,CAAC4D,IAAN,KAAe,WAAf,IAA8B,KAAKk4B,cAAnC,IAAqD,KAAKQ,eAA/D,EAAiF;AAE7E,WAAKsG,cAAL;AAEH;;AAGD,UAAMzgB,UAAU,GAAG,KAAKmZ,SAAL,CAAeiI,gBAAf,CAAiC,KAAKvI,QAAL,CAAcza,QAA/C,EAAyD,IAAzD,CAAnB;AACA,UAAMijB,gBAAgB,GAAG,KAAKC,qBAAL,CAA4BthB,UAA5B,CAAzB;AACA,UAAMuhB,SAAS,GAAKvhB,UAAU,CAACjf,MAAX,GAAoB,CAAtB,GAA4Bif,UAAU,CAAC,CAAD,CAAV,CAAcrV,MAA1C,GAAmDxO,SAArE;;AAEA,QAAK,KAAK0sB,SAAL,CAAepnB,IAAf,KAAwB,SAA7B,EAA0C;AAEtC,UAAK4/B,gBAAgB,IAAI,KAAKpI,iBAAL,KAA2BoI,gBAA/C,IAAmE,KAAKpI,iBAAL,CAAuBv1B,aAA/F,EAA+G;AAE3G,aAAKu1B,iBAAL,CAAuBv1B,aAAvB,CAAsC;AAAEjC,UAAAA,IAAI,EAAE,kBAAR;AAA4B8R,UAAAA,UAAU,EAAE1V;AAAxC,SAAtC;AAEH;;AAED,WAAKo7B,iBAAL,GAAyB98B,SAAzB;AAEH;;AAED,QAAK,KAAK0sB,SAAL,CAAepnB,IAAf,KAAwB,SAA7B,EAA0C;AAEtC,UAAK8/B,SAAS,IAAI,KAAKrI,WAAL,KAAqBqI,SAAlC,IAA+C,KAAKrI,WAAL,CAAiBx1B,aAArE,EAAqF;AAEjF,aAAKw1B,WAAL,CAAiBx1B,aAAjB,CAAgC;AAAEjC,UAAAA,IAAI,EAAE,WAAR;AAAqB8R,UAAAA,UAAU,EAAE1V;AAAjC,SAAhC;AAEH;;AAED,WAAKq7B,WAAL,GAAmB/8B,SAAnB;AAEH;;AAED,QAAKsF,IAAI,KAAK,OAAd,EAAwB;AAEpB,WAAKo3B,QAAL,CAAcn1B,aAAd,CAA6B;AAAEjC,QAAAA,IAAI,EAAE,OAAR;AAAiBue,QAAAA,UAAU,EAAEA,UAA7B;AAAyCzM,QAAAA,UAAU,EAAE1V;AAArD,OAA7B;;AAEA,UAAKwjC,gBAAgB,IAAIA,gBAAgB,CAAC39B,aAA1C,EAA0D;AAEtD29B,QAAAA,gBAAgB,CAAC39B,aAAjB,CAAgC;AAAEjC,UAAAA,IAAI,EAAE,cAAR;AAAwB8R,UAAAA,UAAU,EAAE1V;AAApC,SAAhC;AAEH;;AAED,UAAK0jC,SAAS,IAAIA,SAAS,CAAC79B,aAA5B,EAA4C;AAExC69B,QAAAA,SAAS,CAAC79B,aAAV,CAAyB;AAAEjC,UAAAA,IAAI,EAAE,OAAR;AAAiB8R,UAAAA,UAAU,EAAE1V;AAA7B,SAAzB;AAEH;AAEJ,KAhBD,MAgBO;AAEH,WAAKg7B,QAAL,CAAcn1B,aAAd,CAA6B;AAAEjC,QAAAA,IAAI,EAAE,OAAR;AAAiBue,QAAAA,UAAU,EAAEA,UAA7B;AAAyCzM,QAAAA,UAAU,EAAE1V;AAArD,OAA7B;;AAEA,UAAO,KAAKk7B,WAAL,IAAoB/Y,UAAU,CAACjf,MAAX,GAAoB,CAAxC,IAA6C,KAAKg4B,WAAL,KAAqBsI,gBAApE,IACR,KAAKtI,WAAL,IAAoB/Y,UAAU,CAACjf,MAAX,KAAsB,CADvC,EAC4C;AAExC,YAAK,KAAKg4B,WAAL,CAAiBr1B,aAAtB,EAAsC;AAElC,eAAKq1B,WAAL,CAAiBr1B,aAAjB,CAAgC;AAAEjC,YAAAA,IAAI,EAAE,YAAR;AAAsB8R,YAAAA,UAAU,EAAE1V;AAAlC,WAAhC;AAEA,eAAK86B,OAAL,CAAa5vB,GAAb;AAEH;;AAED,aAAKgwB,WAAL,GAAmB58B,SAAnB;AAEH;;AAED,UAAKklC,gBAAgB,IAAIrhB,UAAU,CAACjf,MAAX,GAAoB,CAA7C,EAAiD;AAE7C,YAAK,KAAKg4B,WAAL,KAAqBsI,gBAA1B,EAA6C;AAEzC,eAAKtI,WAAL,GAAmBsI,gBAAnB;;AAEA,cAAK,KAAKtI,WAAL,CAAiBr1B,aAAtB,EAAsC;AAElC,iBAAKq1B,WAAL,CAAiBr1B,aAAjB,CAAgC;AAAEjC,cAAAA,IAAI,EAAE,YAAR;AAAsB8R,cAAAA,UAAU,EAAE1V;AAAlC,aAAhC,EAFkC,CAIlC;;AACA,gBAAK,KAAKwgB,OAAL,CAAa6Z,iBAAb,IAAkC,KAAK7Z,OAAL,CAAa4Z,aAA/C,IAAgE,KAAKW,iBAA1E,EAA8F;AAC1F,mBAAKD,OAAL,CAAat3B,KAAb,CAAoB,KAAK8W,KAAL,CAAW/W,IAAX,CAAiB,IAAjB,EAAuBvD,KAAvB,EAA8B,OAA9B,CAApB;AACH;AAEJ;AAEJ;;AAED,YAAK,KAAKgrB,SAAL,CAAepnB,IAAf,KAAwB,WAAxB,IAAuC,KAAKw3B,iBAAL,IAA0BoI,gBAAtE,EAAyF;AAErF,eAAKpI,iBAAL,GAAyBoI,gBAAzB;;AAEA,cAAK,KAAKpI,iBAAL,CAAuBv1B,aAA5B,EAA4C;AAExC,iBAAKu1B,iBAAL,CAAuBv1B,aAAvB,CAAsC;AAAEjC,cAAAA,IAAI,EAAE,mBAAR;AAA6B8R,cAAAA,UAAU,EAAE1V;AAAzC,aAAtC;AAEH;AAEJ;;AAED,YAAK,KAAKgrB,SAAL,CAAepnB,IAAf,KAAwB,WAAxB,IAAuC,KAAKy3B,WAAL,IAAoBqI,SAAhE,EAA4E;AAExE,eAAKrI,WAAL,GAAmBqI,SAAnB;;AAEA,cAAK,KAAKrI,WAAL,CAAiBx1B,aAAtB,EAAsC;AAElC,iBAAKw1B,WAAL,CAAiBx1B,aAAjB,CAAgC;AAAEjC,cAAAA,IAAI,EAAE,YAAR;AAAsB8R,cAAAA,UAAU,EAAE1V;AAAlC,aAAhC;AAEH;AAEJ;;AAED,YAAK,KAAKgrB,SAAL,CAAepnB,IAAf,KAAwB,WAAxB,IAAuC,KAAK4c,OAAL,CAAa4Z,aAAzD,EAAyE;AAErE,cAAKsJ,SAAS,IAAIA,SAAS,CAAC79B,aAA5B,EAA4C;AAExC69B,YAAAA,SAAS,CAAC79B,aAAV,CAAyB;AAAEjC,cAAAA,IAAI,EAAE,OAAR;AAAiB8R,cAAAA,UAAU,EAAE1V;AAA7B,aAAzB;AAEH;;AAED,cAAK,KAAKo7B,iBAAL,IAA0B,KAAKA,iBAAL,CAAuBv1B,aAAtD,EAAsE;AAElE,iBAAKu1B,iBAAL,CAAuBv1B,aAAvB,CAAsC;AAAEjC,cAAAA,IAAI,EAAE,kBAAR;AAA4B8R,cAAAA,UAAU,EAAE1V;AAAxC,aAAtC;AAEH;;AAED,cAAK,KAAKq7B,WAAL,IAAoB,KAAKA,WAAL,CAAiBx1B,aAA1C,EAA0D;AAEtD,iBAAKw1B,WAAL,CAAiBx1B,aAAjB,CAAgC;AAAEjC,cAAAA,IAAI,EAAE,WAAR;AAAqB8R,cAAAA,UAAU,EAAE1V;AAAjC,aAAhC;AAEH;AAEJ;AAEJ;;AAED,UAAK,CAACwjC,gBAAD,IAAqB,KAAKpI,iBAA1B,IAA+C,KAAKA,iBAAL,CAAuBv1B,aAA3E,EAA2F;AAEvF,aAAKu1B,iBAAL,CAAuBv1B,aAAvB,CAAsC;AAAEjC,UAAAA,IAAI,EAAE,kBAAR;AAA4B8R,UAAAA,UAAU,EAAE1V;AAAxC,SAAtC;AAEA,aAAKo7B,iBAAL,GAAyB98B,SAAzB;AAEH;;AAED,UAAK,CAAColC,SAAD,IAAc,KAAKrI,WAAnB,IAAkC,KAAKA,WAAL,CAAiBx1B,aAAxD,EAAwE;AAEpE,aAAKw1B,WAAL,CAAiBx1B,aAAjB,CAAgC;AAAEjC,UAAAA,IAAI,EAAE,WAAR;AAAqB8R,UAAAA,UAAU,EAAE1V;AAAjC,SAAhC;AAEA,aAAKq7B,WAAL,GAAmB/8B,SAAnB;AAEH;AAEJ,KA3K2B,CA6K5B;;;AACA,QAAKolC,SAAS,IAAIA,SAAS,YAAYtwB,QAAvC,EAAkD;AAE9C,WAAK+nB,QAAL,GAAgBuI,SAAhB;;AAEA,UAAK9/B,IAAI,KAAK,OAAd,EAAwB;AAEpB,eAAO,IAAP;AAEH;AAGJ,KAXD,MAWO,IAAK,KAAKu3B,QAAV,EAAqB;AAExB,WAAK0C,YAAL;AAEH,KA7L2B,CA+L5B;;;AACA,QAAK,KAAKrd,OAAL,CAAa+N,UAAb,IAA2B,KAAKvD,SAAL,CAAepnB,IAAf,KAAwB,WAAxD,EAAsE;AAElE;AACAi7B,MAAAA,YAAY,CAAE,KAAKjD,mBAAP,CAAZ;;AAEA,UAAK,KAAKiB,OAAL,KAAiB,KAAKnP,aAA3B,EAA2C;AAEvC,aAAKA,aAAL,CAAmBa,UAAnB,GAAgC,KAAhC;AACA,aAAKqN,mBAAL,GAA2B/8B,MAAM,CAACJ,UAAP,CAAmB,KAAKkgC,cAAL,CAAoBp7B,IAApB,CAA0B,IAA1B,CAAnB,EAAqD,KAAKid,OAAL,CAAaia,4BAAlE,CAA3B;AAEH;AAEJ;AAEJ,GA34CyE;;AA64C1E;;;;;;AAMAgJ,EAAAA,qBAAqB,EAAE,UAAWthB,UAAX,EAAwB;AAE3C,QAAIuhB,SAAJ;;AAEA,SAAM,IAAIpiC,CAAC,GAAG,CAAd,EAAiBA,CAAC,GAAG6gB,UAAU,CAACjf,MAAhC,EAAwC5B,CAAC,EAAzC,EAA8C;AAE1C,UAAK6gB,UAAU,CAAC7gB,CAAD,CAAV,CAAc4qB,QAAd,IAA0B,CAA1B,IAA+B/J,UAAU,CAAC7gB,CAAD,CAAV,CAAcwL,MAA7C,IAAuD,CAACqV,UAAU,CAAC7gB,CAAD,CAAV,CAAcwL,MAAd,CAAqB62B,WAAlF,EAAgG;AAE5F,YAAKxhB,UAAU,CAAC7gB,CAAD,CAAV,CAAcwL,MAAd,CAAqB82B,MAArB,IAA+BzhB,UAAU,CAAC7gB,CAAD,CAAV,CAAcwL,MAAd,CAAqB82B,MAArB,CAA4BD,WAAhE,EAA8E;AAC1E;AACH,SAFD,MAEO,IAAKxhB,UAAU,CAAC7gB,CAAD,CAAV,CAAcwL,MAAd,CAAqB82B,MAArB,IAA+B,CAACzhB,UAAU,CAAC7gB,CAAD,CAAV,CAAcwL,MAAd,CAAqB82B,MAArB,CAA4BD,WAAjE,EAA+E;AAClFD,UAAAA,SAAS,GAAGvhB,UAAU,CAAC7gB,CAAD,CAAV,CAAcwL,MAAd,CAAqB82B,MAAjC;AACA;AACH,SAHM,MAGA;AACHF,UAAAA,SAAS,GAAGvhB,UAAU,CAAC7gB,CAAD,CAAV,CAAcwL,MAA1B;AACA;AACH;AAEJ;AAEJ;;AAED,WAAO42B,SAAP;AAEH,GA36CyE;;AA66C1E;;;;;AAKA7F,EAAAA,YAAY,EAAE,YAAY;AAEtB,QAAK,KAAK1C,QAAV,EAAqB;AAEjB,WAAKA,QAAL,CAAcpmB,UAAd;AAEA,WAAKomB,QAAL,GAAgB78B,SAAhB;AAEH;AAEJ,GA57CyE;;AA87C1E;;;;;;AAMA+kC,EAAAA,gBAAgB,EAAE,YAAY;AAE1B,UAAM;AAAEpI,MAAAA;AAAF,QAAa,IAAnB;AAEA;;;;;;AAKA,QAAKA,MAAL,EAAc;AAEVA,MAAAA,MAAM,CAACp1B,aAAP,CAAsB;AAAEjC,QAAAA,IAAI,EAAE;AAAR,OAAtB;AAEH;AAEJ,GAn9CyE;;AAq9C1E;;;;;;AAMAkxB,EAAAA,SAAS,EAAE,UAAW90B,KAAX,EAAmB;AAE1B,QAAK,KAAKwgB,OAAL,CAAaga,MAAb,IAAuB,KAAKha,OAAL,CAAaga,MAAb,KAAwB,MAA/C,IAAyDx6B,KAAK,CAAC6jC,GAAN,KAAc,SAA5E,EAAwF;AAEpF,WAAKvH,eAAL,GAAuB,IAAvB;AAEH;AAEJ,GAn+CyE;;AAq+C1E;;;;;;AAMA1H,EAAAA,OAAO,EAAE,YAAY;AAEjB,SAAK0H,eAAL,GAAuB,KAAvB;AAEH,GA/+CyE;;AAi/C1E;;;;;AAKAhyB,EAAAA,MAAM,EAAE,YAAY;AAEhBiB,IAAAA,KAAK,CAACjB,MAAN;AAEA,SAAKkxB,eAAL,CAAqBnZ,OAArB,CAA8B,UAAU3Z,QAAV,EAAoB;AAAEA,MAAAA,QAAQ;AAAK,KAAjE;AAEA,SAAKm0B,OAAL,CAAavyB,MAAb;AAEA,SAAKlI,KAAL,CAAWggB,QAAX,CAAqB,UAAUE,KAAV,EAAiB;AAClC,UAAKA,KAAK,YAAYlP,QAAjB,IACVkP,KAAK,CAACjgB,OADI,KAER,KAAK64B,WAAL,KAAqB5Y,KAArB,IACDA,KAAK,CAACjgB,OAAN,CAAcmE,KAAd,CAAoBM,OAApB,KAAgC,MAD/B,IAEAwb,KAAK,CAACjgB,OAAN,CAAcsE,IAAd,IAAsB2b,KAAK,CAACjgB,OAAN,CAAcsE,IAAd,CAAmBH,KAAnB,CAAyBM,OAAzB,KAAqC,MAF3D,IAGAwb,KAAK,CAACjgB,OAAN,CAAcwT,KAAd,IAAuByM,KAAK,CAACjgB,OAAN,CAAcwT,KAAd,CAAoBrP,KAApB,CAA0BM,OAA1B,KAAsC,MALrD,CAAL,EAKsE;AAClE,YAAK,KAAK05B,qBAAL,CAA4Ble,KAA5B,CAAL,EAA2C;AACvC,gBAAM;AAAEhZ,YAAAA,CAAF;AAAKC,YAAAA;AAAL,cAAW,KAAK42B,eAAL,CAAsB7d,KAAK,CAACsf,gBAAN,CAAwB,IAAIzoC,OAAJ,EAAxB,CAAtB,CAAjB;AACAmpB,UAAAA,KAAK,CAAClM,gBAAN,CAAwB9M,CAAxB,EAA2BC,CAA3B;AACH,SAHD,MAGO;AACH+Y,UAAAA,KAAK,CAACrN,SAAN;AACH;AAEJ;AACJ,KAfoB,CAenB1R,IAfmB,CAeb,IAfa,CAArB;AAiBH,GA/gDyE;;AAihD1E;;;;;;AAMAm1B,EAAAA,MAAM,EAAE,YAAY;AAEhB,QAAK,KAAK/kB,IAAL,KAAc/X,KAAK,CAACG,SAApB,IAAiC,KAAK4X,IAAL,KAAc/X,KAAK,CAACI,MAA1D,EAAmE;AAE/D,WAAKi7B,QAAL,CAAc4B,KAAd;AACA,WAAKiE,MAAL,CAAYpE,MAAZ,CAAoB,KAAKt2B,KAAzB,EAAgC,KAAK+yB,MAArC;AACA,WAAK2H,MAAL,CAAYpE,MAAZ,CAAoB,KAAKkC,YAAzB,EAAuC,KAAKzF,MAA5C;AAGH,KAPD,MAOO;AAEH,WAAK8B,QAAL,CAAc4B,KAAd;AACA,WAAK5B,QAAL,CAAcyB,MAAd,CAAsB,KAAKt2B,KAA3B,EAAkC,KAAK+yB,MAAvC;AACA,WAAK8B,QAAL,CAAciC,UAAd;AACA,WAAKjC,QAAL,CAAcyB,MAAd,CAAsB,KAAKkC,YAA3B,EAAyC,KAAKzF,MAA9C;AAEH;AAEJ,GAziDyE;;AA2iD1E;;;;;AAKAoI,EAAAA,OAAO,EAAE,YAAY;AAEjB,SAAK9B,kBAAL,GAA0B58B,MAAM,CAAC0L,qBAAP,CAA8B,KAAKgzB,OAAL,CAAah6B,IAAb,CAAmB,IAAnB,CAA9B,CAA1B;AAEA,SAAKugC,QAAL;AAEH,GAtjDyE;;AAwjD1E;;;;;AAKAA,EAAAA,QAAQ,EAAE,YAAY;AAElB,SAAKx5B,MAAL;AACA,SAAKouB,MAAL;AAEH,GAlkDyE;;AAokD1E;;;;;AAKA0E,EAAAA,2BAA2B,EAAE,YAAY;AAErC,UAAM5c,OAAO,GAAG;AAAErD,MAAAA,OAAO,EAAE;AAAX,KAAhB;AAEA,SAAKhb,SAAL,CAAevD,gBAAf,CAAiC,WAAjC,EAAgD,KAAKm9B,kBAArD,EAAyEvb,OAAzE;AACA,SAAKre,SAAL,CAAevD,gBAAf,CAAiC,WAAjC,EAAgD,KAAKq9B,kBAArD,EAAyEzb,OAAzE;AACA,SAAKre,SAAL,CAAevD,gBAAf,CAAiC,SAAjC,EAA+C,KAAKo9B,gBAApD,EAAwExb,OAAxE;AACA,SAAKre,SAAL,CAAevD,gBAAf,CAAiC,YAAjC,EAAgD,KAAKm9B,kBAArD,EAAyEvb,OAAzE;AACA,SAAKre,SAAL,CAAevD,gBAAf,CAAiC,UAAjC,EAAgD,KAAKo9B,gBAArD,EAAyExb,OAAzE;AAEH,GAnlDyE;;AAqlD1E;;;;;AAKA+d,EAAAA,6BAA6B,EAAE,YAAY;AAEvC,SAAKp8B,SAAL,CAAeoD,mBAAf,CAAoC,WAApC,EAAmD,KAAKw2B,kBAAxD,EAA4E,KAA5E;AACA,SAAK55B,SAAL,CAAeoD,mBAAf,CAAoC,WAApC,EAAmD,KAAK02B,kBAAxD,EAA4E,KAA5E;AACA,SAAK95B,SAAL,CAAeoD,mBAAf,CAAoC,SAApC,EAAiD,KAAKy2B,gBAAtD,EAA0E,KAA1E;AACA,SAAK75B,SAAL,CAAeoD,mBAAf,CAAoC,YAApC,EAAmD,KAAKw2B,kBAAxD,EAA4E,KAA5E;AACA,SAAK55B,SAAL,CAAeoD,mBAAf,CAAoC,UAApC,EAAmD,KAAKy2B,gBAAxD,EAA4E,KAA5E;AAEH,GAlmDyE;;AAomD1E;;;;;AAKAwC,EAAAA,oBAAoB,EAAE,YAAY;AAE9B,SAAKQ,iBAAL,CAAwB,KAAK3C,WAA7B;AAEH,GA7mDyE;;AA+mD1E;;;;;AAKAqC,EAAAA,sBAAsB,EAAE,YAAY;AAEhC,SAAKO,oBAAL,CAA2B,KAAK5C,WAAhC;AAEH,GAxnDyE;;AA0nD1E;;;;;AAKAoC,EAAAA,kBAAkB,EAAE,YAAY;AAE5B,UAAM9oB,OAAO,GAAG,KAAKxT,SAAL,CAAe8E,WAAf,GAA6B,CAA7B,GAAiC,KAAK9E,SAAL,CAAe4hC,UAAhE;AACA,UAAMnuB,OAAO,GAAG,KAAKzT,SAAL,CAAe+E,YAAf,GAA8B,CAA9C;AAEA,SAAK+3B,oBAAL,CAA2B,KAAK5C,WAAhC;AACA,SAAKA,WAAL,GAAmB,KAAK/hB,KAAL,CAAW/W,IAAX,CAAiB,IAAjB,EAAuB;AAAEoS,MAAAA,OAAF;AAAWC,MAAAA;AAAX,KAAvB,CAAnB;AACA,SAAKopB,iBAAL,CAAwB,KAAK3C,WAA7B;AAEH,GAxoDyE;;AA0oD1E;;;;;AAKAiB,EAAAA,sBAAsB,EAAE,YAAY;AAEhC;AACAz+B,IAAAA,MAAM,CAACD,gBAAP,CAAyB,QAAzB,EAAoC,KAAKs9B,qBAAzC,EAAgE,IAAhE,EAHgC,CAKhC;;AACAr9B,IAAAA,MAAM,CAACD,gBAAP,CAAyB,SAAzB,EAAoC,KAAKu9B,gBAAzC,EAA2D,IAA3D;AACAt9B,IAAAA,MAAM,CAACD,gBAAP,CAAyB,OAAzB,EAAoC,KAAKw9B,cAAzC,EAA2D,IAA3D;AAEH,GAxpDyE;;AA0pD1E;;;;;AAKA4H,EAAAA,wBAAwB,EAAE,YAAY;AAElC;AACAnlC,IAAAA,MAAM,CAAC0G,mBAAP,CAA4B,QAA5B,EAAuC,KAAK22B,qBAA5C,EAAmE,IAAnE,EAHkC,CAKlC;;AACAr9B,IAAAA,MAAM,CAAC0G,mBAAP,CAA4B,SAA5B,EAAuC,KAAK42B,gBAA5C,EAA8D,IAA9D;AACAt9B,IAAAA,MAAM,CAAC0G,mBAAP,CAA4B,OAA5B,EAAuC,KAAK62B,cAA5C,EAA8D,IAA9D;AAEH,GAxqDyE;;AA0qD1E;;;;;AAKAzkB,EAAAA,OAAO,EAAE,YAAY;AAEjB,SAAK4kB,kBAAL,CAAwBj5B,IAAxB;AACA,SAAKk5B,gBAAL,CAAsBl5B,IAAtB,GAHiB,CAKjB;;AACA,SAAK0gC,wBAAL,GANiB,CAQjB;;AACA,aAASlgB,gBAAT,CAA4BhX,MAA5B,EAAqC;AAEjC,WAAM,IAAIxL,CAAC,GAAGwL,MAAM,CAACyT,QAAP,CAAgBrd,MAAhB,GAAyB,CAAvC,EAA0C5B,CAAC,IAAI,CAA/C,EAAkDA,CAAC,EAAnD,EAAwD;AAEpDwiB,QAAAA,gBAAgB,CAAEhX,MAAM,CAACyT,QAAP,CAAgBjf,CAAhB,CAAF,CAAhB;AACAwL,QAAAA,MAAM,CAACb,MAAP,CAAea,MAAM,CAACyT,QAAP,CAAgBjf,CAAhB,CAAf;AAEH;;AAED,UAAKwL,MAAM,YAAYkU,QAAlB,IAA8BlU,MAAM,YAAYsG,QAArD,EAAgE;AAE5DtG,QAAAA,MAAM,CAAC6K,OAAP;AACA7K,QAAAA,MAAM,GAAG,IAAT;AAEH,OALD,MAKO,IAAKA,MAAM,CAACjH,aAAZ,EAA2B;AAE9BiH,QAAAA,MAAM,CAACjH,aAAP,CAAsB,SAAtB;AAEH;AAEJ;;AAEDie,IAAAA,gBAAgB,CAAE,KAAK1hB,KAAP,CAAhB,CA/BiB,CAiCjB;;AACA,QAAK,KAAK64B,MAAV,EAAmB;AAEf,WAAKA,MAAL,CAAYtjB,OAAZ;AACA,WAAKsjB,MAAL,GAAc,IAAd;AAEH,KAvCgB,CAyCjB;;;AACA,QAAK3iC,KAAK,IAAIA,KAAK,CAACqF,OAApB,EAA8B;AAE1BrF,MAAAA,KAAK,CAACugC,KAAN;AAEH;AAEJ,GA/tDyE;;AAiuD1E;;;;;AAKAoL,EAAAA,OAAO,EAAE,YAAY;AAEjB,SAAKtsB,OAAL;AACA,SAAK+gB,MAAL;AACA75B,IAAAA,MAAM,CAACiM,oBAAP,CAA6B,KAAK2wB,kBAAlC;AAEH,GA5uDyE;;AA8uD1E;;;;;AAKAyI,EAAAA,iBAAiB,EAAE,UAAWlJ,QAAX,EAAsB;AAErC,QAAKA,QAAQ,YAAYnW,aAAzB,EAAyC;AAErC,WAAKua,eAAL;AAEH;;AAED,QAAKpE,QAAQ,KAAK,KAAKA,QAAvB,EAAkC;AAE9B,WAAKA,QAAL,GAAgB,IAAhB;AAEH;AAEJ,GAjwDyE;;AAmwD1E;;;;;;;AAOAmJ,EAAAA,gBAAgB,EAAE,UAAW5mC,GAAX,EAAgBmL,QAAQ,GAAG,MAAM,CAAE,CAAnC,EAAsC;AAEpD,UAAM7K,OAAO,GAAG,IAAIgB,MAAM,CAACU,cAAX,EAAhB;;AACA1B,IAAAA,OAAO,CAACumC,SAAR,GAAoB,UAAWpkC,KAAX,EAAmB;AACnC0I,MAAAA,QAAQ,CAAE1I,KAAF,CAAR;AACH,KAFD;;AAGAnC,IAAAA,OAAO,CAAC2B,IAAR,CAAc,KAAd,EAAqBjC,GAArB,EAA0B,IAA1B;AACAM,IAAAA,OAAO,CAAC0C,IAAR,CAAc,IAAd;AAEH,GAnxDyE;;AAqxD1E;;;;;AAKA08B,EAAAA,gBAAgB,EAAE,YAAY;AAE1B,UAAMnkB,KAAK,GAAG,IAAd;;AAEA,aAASurB,iBAAT,CAA6BC,UAA7B,EAA0C;AAEtC,UAAKA,UAAU,CAAC5lC,MAAX,KAAsB,CAA3B,EAA+B;AAE/B,YAAM6lC,gBAAgB,GAAGD,UAAU,CAAC3mB,MAAX,CAAkB6mB,WAAlB,CAA8B9B,eAAvD;AACA6B,MAAAA,gBAAgB,CAAC/9B,KAAjB,CAAuB7E,KAAvB,GAA+BmX,KAAK,CAAC+hB,iBAAN,GAA0B,IAAzD;AACA0J,MAAAA,gBAAgB,CAAC/9B,KAAjB,CAAuB3E,MAAvB,GAAgCiX,KAAK,CAAC+hB,iBAAN,GAA0B,IAA1D;AACA0J,MAAAA,gBAAgB,CAAC/9B,KAAjB,CAAuBC,QAAvB,GAAkC,UAAlC;AACA89B,MAAAA,gBAAgB,CAAC/9B,KAAjB,CAAuBE,GAAvB,GAA6B,MAA7B;AACA69B,MAAAA,gBAAgB,CAAC/9B,KAAjB,CAAuBG,IAAvB,GAA8B,MAA9B;AACA49B,MAAAA,gBAAgB,CAAC/9B,KAAjB,CAAuBiE,OAAvB,GAAiC,KAAjC;AACA85B,MAAAA,gBAAgB,CAAC/9B,KAAjB,CAAuBiP,MAAvB,GAAgC,SAAhC;AACA8uB,MAAAA,gBAAgB,CAACroB,EAAjB,GAAsB,mCAAtB;AAEApD,MAAAA,KAAK,CAAC3W,SAAN,CAAgBkT,WAAhB,CAA6BkvB,gBAA7B;AAEA,YAAME,SAAS,GAAGF,gBAAgB,CAACvoB,aAAjB,CAAgC,YAAhC,CAAlB;;AACA,YAAM0oB,aAAa,GAAG,YAAY;AAE9B5rB,QAAAA,KAAK,CAACpO,MAAN,GAAeoO,KAAK,CAAC+hB,iBAAN,GAA0B,KAAzC;AACA/hB,QAAAA,KAAK,CAAC6rB,gBAAN,GAAyB7rB,KAAK,CAACqc,MAAN,CAAavhB,QAAb,CAAsBrK,CAAtB,GAA0BpP,MAAM,CAACmyB,QAAP,CAAiB,EAAjB,CAAnD;AACAxT,QAAAA,KAAK,CAAC8rB,QAAN,GAAiBzqC,MAAM,CAACmyB,QAAP,CAAiBxT,KAAK,CAACqc,MAAN,CAAazB,GAA9B,CAAjB;AACA5a,QAAAA,KAAK,CAAC+rB,SAAN,GAAkB,CAAC/rB,KAAK,CAAC6rB,gBAAP,GAA0B7rB,KAAK,CAAC8rB,QAAN,GAAiB,CAA7D;AACA9rB,QAAAA,KAAK,CAACgsB,UAAN,GAAmB,CAAChsB,KAAK,CAAC6rB,gBAAP,GAA0B7rB,KAAK,CAAC8rB,QAAN,GAAiB,CAA9D;AACA9rB,QAAAA,KAAK,CAACisB,KAAN,GAAcjsB,KAAK,CAACpO,MAAN,GAAexQ,IAAI,CAACgX,GAAL,CAAU4H,KAAK,CAAC+rB,SAAhB,CAA7B;AACA/rB,QAAAA,KAAK,CAACksB,KAAN,GAAclsB,KAAK,CAACpO,MAAN,GAAexQ,IAAI,CAACiX,GAAL,CAAU2H,KAAK,CAAC+rB,SAAhB,CAA7B;AACA/rB,QAAAA,KAAK,CAACmsB,MAAN,GAAensB,KAAK,CAACpO,MAAN,GAAexQ,IAAI,CAACgX,GAAL,CAAU4H,KAAK,CAACgsB,UAAhB,CAA9B;AACAhsB,QAAAA,KAAK,CAACosB,MAAN,GAAepsB,KAAK,CAACpO,MAAN,GAAexQ,IAAI,CAACiX,GAAL,CAAU2H,KAAK,CAACgsB,UAAhB,CAA9B;AACAhsB,QAAAA,KAAK,CAACqsB,UAAN,GAAmB,OAAOrsB,KAAK,CAACisB,KAAb,GAAqB,GAArB,GAA2BjsB,KAAK,CAACksB,KAAjC,GAAyC,KAAzC,GAAiDlsB,KAAK,CAACpO,MAAvD,GAAgE,GAAhE,GAAsEoO,KAAK,CAACpO,MAA5E,GAAqF,SAArF,GAAiGoO,KAAK,CAACmsB,MAAvG,GAAgH,GAAhH,GAAsHnsB,KAAK,CAACosB,MAA/I;;AAEA,YAAKpsB,KAAK,CAACisB,KAAN,IAAejsB,KAAK,CAACksB,KAArB,IAA8BlsB,KAAK,CAACmsB,MAApC,IAA8CnsB,KAAK,CAACosB,MAApD,IAA8DpsB,KAAK,CAACpO,MAAzE,EAAkF;AAE9E+5B,UAAAA,SAAS,CAACl+B,YAAV,CAAwB,GAAxB,EAA6BuS,KAAK,CAACqsB,UAAnC;AAEH;AAEJ,OAnBD;;AAqBArsB,MAAAA,KAAK,CAACkmB,iBAAN,CAAyB0F,aAAzB;;AAEA,YAAMU,qBAAqB,GAAG,YAAY;AAEtC,aAAK5+B,KAAL,CAAWiE,OAAX,GAAqB,GAArB;AAEH,OAJD;;AAMA,YAAM46B,qBAAqB,GAAG,YAAY;AAEtC,aAAK7+B,KAAL,CAAWiE,OAAX,GAAqB,KAArB;AAEH,OAJD;;AAMA85B,MAAAA,gBAAgB,CAAC3lC,gBAAjB,CAAmC,YAAnC,EAAiDwmC,qBAAjD;AACAb,MAAAA,gBAAgB,CAAC3lC,gBAAjB,CAAmC,YAAnC,EAAiDymC,qBAAjD;AACH;;AAED,SAAKlB,gBAAL,CAAuB1nC,SAAS,CAACW,aAAjC,EAAgDinC,iBAAhD;AAEH,GAx1DyE;;AA01D1E;;;;;;AAMAiB,EAAAA,iBAAiB,EAAE,UAAWC,MAAX,EAAoB;AAEnC,UAAMlrB,IAAI,GAAG,KAAK4gB,MAAL,CAAYxgB,gBAAZ,CAA8B8qB,MAA9B,CAAb;;AAEA,QAAKA,MAAM,CAACx4B,KAAP,KAAiB,OAAtB,EAAgC;AAE5B,WAAKkuB,MAAL,CAAY1iB,YAAZ,CAAyBlD,WAAzB,CAAsCgF,IAAtC;AAEH,KAJD,MAIO;AAEH,WAAK4gB,MAAL,CAAY5iB,UAAZ,CAAuBhD,WAAvB,CAAoCgF,IAApC;AAEH;;AAED,WAAOA,IAAP;AAEH,GAh3DyE;;AAk3D1E;;;;;AAKAmrB,EAAAA,aAAa,EAAE,YAAY;AAEvBltC,IAAAA,KAAK,CAACugC,KAAN;AAEH;AA33DyE,CAA3D,CAAnB;;AA+3DA,IAAK79B,UAAU,IAAIM,cAAnB,EAAoC;AAEhCsJ,EAAAA,OAAO,CAACC,IAAR,CAAe,4EAA2EvJ,cAAe,EAAzG;AAEH;AAED;;;;;;;AAKAuD,MAAM,CAACwN,KAAP,GAAed,KAAf;AAEA,SAASqZ,aAAT,EAAwBnpB,QAAxB,EAAkCQ,eAAlC,EAAmDqxB,cAAnD,EAAmEhJ,YAAnE,EAAiFxjB,iBAAjF,EAAoGrE,SAApG,EAA+G0nB,aAA/G,EAA8H0F,wBAA9H,EAAwJuD,iBAAxJ,EAA2K/vB,WAA3K,EAAwL0mB,aAAxL,EAAuM3Q,QAAvM,EAAiNqX,YAAjN,EAA+N7uB,KAA/N,EAAsO2F,KAAtO,EAA6OlF,OAA7O,EAAsP2kB,QAAtP,EAAgQjmB,QAAhQ,EAA0QwM,OAA1Q,EAAmRjM,cAAnR,EAAmSC,aAAnS,EAAkTiF,aAAlT,EAAiUnF,OAAjU,EAA0UwpB,aAA1U,EAAyV8U,MAAzV,EAAiW7hB,MAAjW","sourcesContent":["import { Cache, Texture, RGBFormat, RGBAFormat, CubeTexture, EventDispatcher, VideoTexture, LinearFilter, SpriteMaterial, Sprite, Color, CanvasTexture, DoubleSide, Vector3, Mesh, BackSide, Object3D, SphereBufferGeometry, MeshBasicMaterial, BufferGeometry, BufferAttribute, ShaderLib, BoxBufferGeometry, ShaderMaterial, Matrix4, Vector2, Quaternion, PlaneBufferGeometry, Math as Math$1, MOUSE, PerspectiveCamera, OrthographicCamera, Euler, Scene, StereoCamera, WebGLRenderTarget, NearestFilter, WebGLRenderer, Raycaster, Frustum, REVISION as REVISION$1 } from 'three';\n\nconst version=\"0.12.1\";const dependencies={three:\"^0.105.2\"};\n\n/**\n * REVISION\n * @module REVISION\n * @example PANOLENS.REVISION\n * @type {string} revision\n */\nconst REVISION = version.split( '.' )[ 1 ];\n\n/**\n * VERSION\n * @module VERSION\n * @example PANOLENS.VERSION\n * @type {string} version\n */\nconst VERSION = version;\n\n/**\n * THREEJS REVISION\n * @module THREE_REVISION\n * @example PANOLENS.THREE_REVISION\n * @type {string} threejs revision\n */\nconst THREE_REVISION = dependencies.three.split( '.' )[ 1 ];\n\n/**\n * THREEJS VERSION\n * @module THREE_VERSION\n * @example PANOLENS.THREE_VERSION\n * @type {string} threejs version\n */\nconst THREE_VERSION = dependencies.three.replace( /[^0-9.]/g, '' );\n\n/**\n * CONTROLS\n * @module CONTROLS\n * @example PANOLENS.CONTROLS.ORBIT\n * @property {number} ORBIT 0\n * @property {number} DEVICEORIENTATION 1\n */\nconst CONTROLS = { ORBIT: 0, DEVICEORIENTATION: 1 };\n\n/**\n * MODES\n * @module MODES\n * @example PANOLENS.MODES.UNKNOWN\n * @property {number} UNKNOWN 0\n * @property {number} NORMAL 1\n * @property {number} CARDBOARD 2\n * @property {number} STEREO 3\n */\nconst MODES = { UNKNOWN: 0, NORMAL: 1, CARDBOARD: 2, STEREO: 3 };\n\n/**\n * CONTROL_BUTTONS\n * @module CONTROL_BUTTONS\n * @example PANOLENS.VIEWER.CONTROL_BUTTONS\n * @property {string} FULLSCREEN\n * @property {string} SETTING\n * @property {string} VIDEO\n */\nconst CONTROL_BUTTONS = { FULLSCREEN: 'fullscreen', SETTING: 'setting', VIDEO: 'video' };\n\n/**\n * OUTPUTS\n * @module OUTPUTS\n * @example PANOLENS.VIEWER.OUTPUTS\n * @property {string} NONE\n * @property {string} CONSOLE\n * @property {string} OVERLAY\n */\nconst OUTPUTS = { NONE: 'none', CONSOLE: 'console', OVERLAY: 'overlay' };\n\n/**\n * Data URI Images\n * @module DataImage\n * @example PANOLENS.DataImage.Info\n * @property {string} Info Information Icon\n * @property {string} Arrow Arrow Icon\n * @property {string} FullscreenEnter Fullscreen Enter Icon\n * @property {string} FullscreenLeave Fullscreen Leave Icon\n * @property {string} VideoPlay Video Play Icon\n * @property {string} VideoPause Video Pause Icon\n * @property {string} WhiteTile White Tile Icon\n * @property {string} Setting Settings Icon\n * @property {string} ChevronRight Chevron Right Icon\n * @property {string} Check Check Icon\n * @property {string} ViewIndicator View Indicator Icon\n */\nconst DataImage = {\n    Info: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAABmJLR0QAAAAAAAD5Q7t/AAAACXBIWXMAAABIAAAASABGyWs+AAAACXZwQWcAAABAAAAAQADq8/hgAAADBklEQVR42u2bP08UQRiHnzFaSYCI/xoksdBIqGwIiYWRUBISExpCQ0ej38FWOmlIKKhoMPEbaCxsrrHiYrQgOSlQEaICrT+LHSPZzNzt3s3c3Hn7lHvLzvv82L2dm30XKioqKgYY062BJF0HpoA7wARwBbhsPz4DjoEG8AnYNcZ8Sx1Op8IXJM1KWpdUV3nq9m9nJV1I7VNGfEzSM0mNNqR9NOwxx1L7NRMflbQm6SSgeJ4TO8Zoat+8/LKkg4jieQ4kLaf2RtKwpJ0uiufZkTScSn5S0l5C+b/sSZrstvyMpKPU5uc4kjTTjkvpeYCkaeA1/+7hvcIZMGuMqUULQNIU8Aa4ltrWwyHwyBizGzwASSPAe+B2assW7AH3jTE/i+xcZoa12Qfy2Bo3i+5cKABl99zF1GYlWFTBeULLS0DZrOsDcDNggTXgc27bLWA64BhfgHvGmB8dHUXZ1DM0S45xliKMs9bKr+klIOkqsBrwv9JtVq1DewEAT4Ch1BYdMGQdygeg7Df4SmqDAKyoyXpCszPgITCeuvoAjFuX0gE8jljUdv7bCtiOOJ7XpdUZ8L/gdXHOA5QtYH5NXXVgbrgWWn1nwFTqaiPgdPIFcDd1tRFwOl307DwRuZgXwLvctgfA04hjOp18AcReZ6sZY16e3yDpUuQxnU6+S2AkcjEpcDr1zxOXSPgCKLSa0mc4nXwB/EpdbQScTr4AGqmrjYDTyRfAx9TVRsDp5Aug8LJyH+F0cgZg58z11BUHpO5ruGh2G3ybuuqAeF2aBfAqddUB8bq0OgP2U1cegH3aOQOMMb+BrdTVB2DLupQLwLIOnKY26IBT6+ClaQDGmO/ARmqLDtiwDn7HVkcY+EdjNoTlCI+tYhO2iUppm6HKslPUq2qQKHpUe8AFsjaUXuUQWCgqXyoAG8IuME/WkNRrnAHzZfqDSgdgQ6gBc2Td3b3CMTBXtkOsIzTIjZLnQhjcVtlcEIPZLJ0LoVvt8s/Va+3yuSAG84UJRxB98cpM9dJURUVFxSDzBxKde4Lk3/h2AAAAAElFTkSuQmCC', \n    Arrow: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAABmJLR0QAAAAAAAD5Q7t/AAAACXBIWXMAAABIAAAASABGyWs+AAAACXZwQWcAAABAAAAAQADq8/hgAAADPklEQVR42u2bMUscQRiG30/SRaJEI1ZKUiRErNIELRUbQYSAnX8hpVUgkDYp0wgWVjYW+QcJaQzYpLojJIXhtDDEKBpj65ti58ixmdmb2ZvZ7+T2AUHudmfmeXf2bnb3O6CmpqZmgJGqOiI5AWAWwEMA0wDuArht3r4CcAagBeAbgIaI/NQOp1fhIZKLJN+SbDKcptl3keSQtk+I+BjJVyRbJaRdtEybY9p+ReKjJN+QvIwonufS9DGq7ZuXXyd5nFA8zzHJdW1vkLxDcrdC8Ty7JO9oyc+QPFCUb3NAcqZq+TmSp9rmHZySnCvjErwOIPkUwHv8+w7vF64ALIrIfrIASM4C+ADgnratgxMACyLSiB4AyREAnwE80LbswgGAJyJy4bNxyApr6wbIw4xxy3djrwCYfeeuaZsFsEbPdULXU4DZqusLgMkEA21P05EEbf8A8FhEzos28pkBLxLKL5s/r/M1kEkz9vKQHGeatf05yfmOfubNa7G5JDle5NhtBjwHMBz5yFwAWBaRT+0XzP8pZsKwcQiH2fX8Ycojb+kzxUw4ZJn7CSQXqpRPHMKCq7+iZJ71Mvdy/DftXSQ6HcJdSDaqPPKW/mPOBO+lcbvzCU35RCFM2PpwnQKzZQfdgfe0dxH5dLA6uQJ4pC2fIASrkyuA6X6QjxyC1ckVQNn7bNHlI4ZgdXIFUObiJJl8pBCsTjGfuIwA2Cv4FN7xbYjkjqsRAHuIePXoCiDF1Zk2VidXAL+1R5sAq5MrgJb2aBNgdXIF8FV7tAmwOrkCCFs73wysTtYATHFCU3vEEWm6Ci6KvgY/ao86Ik6XogDeaY86Ik6XbjPgSHvkEThCwQy45XpDRK5JbgN4GWkgUyR9H65MRQxgW0SunZ5FezK7pfwd8e8MV8UfAPdF5Jdrg8JrAbPjprZFD2wWyQP6j8ZSEufRmGlgQ9umBBvd5IOgbjFUKLu+XnWBhG+rpsFVZGUo/coJgFVf+aAATAgNACvICpL6jSsAKyH1QcEBmBD2ASwhq+7uF84ALIVWiPUEB7lQsiOEwS2VzQUxmMXSuRCqKpd/zX4rl88FMZg/mLAEcSN+MlP/aKqmpqZmkPkL0hSjwOpNKxwAAAAASUVORK5CYII=',\n    FullscreenEnter: 'data:image/svg+xml;base64,PHN2ZyBmaWxsPSIjRkZGRkZGIiBoZWlnaHQ9IjI0IiB2aWV3Qm94PSIwIDAgMjQgMjQiIHdpZHRoPSIyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICAgIDxwYXRoIGQ9Ik0wIDBoMjR2MjRIMHoiIGZpbGw9Im5vbmUiLz4KICAgIDxwYXRoIGQ9Ik03IDE0SDV2NWg1di0ySDd2LTN6bS0yLTRoMlY3aDNWNUg1djV6bTEyIDdoLTN2Mmg1di01aC0ydjN6TTE0IDV2MmgzdjNoMlY1aC01eiIvPgo8L3N2Zz4=',\n    FullscreenLeave: 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz48IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCI+PHBhdGggc3R5bGU9ImZpbGw6I2ZmZiIgZD0iTTE0LDE0SDE5VjE2SDE2VjE5SDE0VjE0TTUsMTRIMTBWMTlIOFYxNkg1VjE0TTgsNUgxMFYxMEg1VjhIOFY1TTE5LDhWMTBIMTRWNUgxNlY4SDE5WiIgLz48L3N2Zz4=',\n    VideoPlay: 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz48IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCI+PHBhdGggc3R5bGU9ImZpbGw6I2ZmZiIgZD0iTTgsNS4xNFYxOS4xNEwxOSwxMi4xNEw4LDUuMTRaIiAvPjwvc3ZnPg==',\n    VideoPause: 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz48IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCI+PHBhdGggc3R5bGU9ImZpbGw6I2ZmZiIgZD0iTTE0LDE5LjE0SDE4VjUuMTRIMTRNNiwxOS4xNEgxMFY1LjE0SDZWMTkuMTRaIiAvPjwvc3ZnPg==',\n    WhiteTile: 'data:image/png;base64,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',\n    Setting: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAABmJLR0QAAAAAAAD5Q7t/AAAACXBIWXMAAABIAAAASABGyWs+AAAACXZwQWcAAABAAAAAQADq8/hgAAADn0lEQVR42u2bzUsVURjGnyO6CPzAMnTjppAo3LTwH1CqTfaxbeOiRS37A0wXtROFVi1aRBs3LWohSIGbQAQXViBGRhG0UIRKUCpK7q/FnOB2uc6cOXNmRnGe3eW+H8/7zLln3vNxpQoVKlQ4wjBFJAFOSRqX1O7osivpvjHmU1nChBZglvSYLYJbS0EanCvIJzWK+gnsyH34/8OuMaYjb265jwCgz6N4SWq3vodbAEmnS/KtBDgoAgyU5BteAOAkMAPcBroc7PskDWfgN+wyDwBdltMMcDI3tYBnde/pHeARMNTErgd4APzweP834oeN1dMkz5DlsFNn/yyv4kdiSK4At4AO4CqwGaDwRmza2B0210qM7YhrXU59ANAq6bWkwQTTn5KO5fIE0uVYlXTeGLOXFMx1DrjlULwKKN41x6DlnIjEEQCckPRe0okCiguJr5LOGGO+xhm5jICJQ1i8LOeJJKPYEQAMKvrtt5ZdjSf2FM0Fq/sZJI2A6UNcvCz36TiDfUcAcE1SPu/U6Mm8k/TFfu6XdFb5iX3dGPM8lQfwNod3+TowBnQ3yddtv1vPIe+b1JIBiwEJ1IAJ208k5W21trWA+V/5CHAcmAtU/A2P/DcCiTAHHE8tgCVhgLvAXgYCk17Jo/yTGfLuWe7Zd72AC8CWB4n3OAz7mLytNkZabAEXMhfeQKYfWEpJZCxA3rGUOZeA/qDF15FpAz47EvlNk9neI2e3jeWCz0BbmvipNkSMMX8kuSZYM8Z8zyqAjbHmaN5mOeYjgIXrU93MWrxHrNQjrqiDkQMLHwG+OdqF3NN3jeXKzU8AoF1SzdH8XKhJUO7HZDXLMbwAwICkJUULFxe0SbqSVQAbw3Xi7Ze0ZLmGAzAKbHs0JGU1QtvAaIjCW4B7ZOvJy2qFa5a730RPtBiaz0CgnkiZi6F5fBZDVMvho7EhcuS3xJJ2hV9IupgTqaLw0hhzab8vq23xOG/r+LDsKjLgYVzxUnU0ltwK2wDezUyJmEwqXgp/PL4rvxthaeCSI+zxuA10J8ZkWdJNSb2SLkvayKHwDRu71+ZajrG941J8agALDQ3GU/a/IvMkYCPzmCbtLNEVmacNtgs5iP9fYVNEV1Q6Hez7yNZSL+J2SarTcpqiyV2iUkG0IvPFvbz5FbEn+KEk3wMjwMeSfCsBXFBdly9CAPk9ydyffpECuB5tZfVJjaKWueOSfinln6YK4lahQoUKRxd/AcRPGTcQCAUQAAAAAElFTkSuQmCC',\n    ChevronRight: 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz48IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCI+PHBhdGggZD0iTTguNTksMTYuNThMMTMuMTcsMTJMOC41OSw3LjQxTDEwLDZMMTYsMTJMMTAsMThMOC41OSwxNi41OFoiIC8+PC9zdmc+',\n    Check: 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz48IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCI+PHBhdGggZD0iTTIxLDdMOSwxOUwzLjUsMTMuNUw0LjkxLDEyLjA5TDksMTYuMTdMMTkuNTksNS41OUwyMSw3WiIgLz48L3N2Zz4=',\n    ViewIndicator: 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPCFET0NUWVBFIHN2ZyBQVUJMSUMgIi0vL1czQy8vRFREIFNWRyAxLjEvL0VOIiAiaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkIj4KPHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBpZD0idmlldy1pbmRpY2F0b3IiIGhlaWdodD0iMzAiIHdpZHRoPSIzMCIgdmlld0JveD0iLTIuNSAtMSAzMCAzMCI+Cgk8c3R5bGUgdHlwZT0idGV4dC9jc3MiPi5zdDB7c3Ryb2tlLXdpZHRoOjI7c3Ryb2tlLW1pdGVybGltaXQ6MTA7ZmlsbDpub25lO30uc3Qxe3N0cm9rZS13aWR0aDo2O3N0cm9rZS1taXRlcmxpbWl0OjEwO30KCTwvc3R5bGU+Cgk8Zz4KCQk8cGF0aCBjbGFzcz0ic3QwIiBkPSJNIDEyLjUgMCBBIDEyLjUgMTIuNSAwIDAgMCAtMTIuNSAwIEEgMTIuNSAxMi41IDAgMCAwIDEyLjUgMCIgdHJhbnNmb3JtPSJtYXRyaXgoMSwwLDAsMSwxMywxNS41KSI+PC9wYXRoPgoJCTxwYXRoIGNsYXNzPSJzdDIiIGQ9Ik0gMTMgMCBMIDEwIDIgTCAxNiAyIFoiPjwvcGF0aD4KCQk8cGF0aCBjbGFzcz0ic3QyIiBkPSJNIDIgMCBBIDIgMiAwIDAgMCAtMiAwIEEgMiAyIDAgMCAwIDIgMCIgdHJhbnNmb3JtPSJtYXRyaXgoMSwwLDAsMSwxMywxNS41KSI+PC9wYXRoPgoJCTxwYXRoIGNsYXNzPSJzdDEiIGlkPSJpbmRpY2F0b3IiIHRyYW5zZm9ybT0ibWF0cml4KDEsMCwwLDEsMTMsMTUuNSkiPjwvcGF0aD4KCTwvZz4KPC9zdmc+'\n};\n\n/**\n * @module ImageLoader\n * @description Image loader with progress based on {@link https://github.com/mrdoob/three.js/blob/master/src/loaders/ImageLoader.js}\n */\nconst ImageLoader = {\n\n    /**\n     * Load image\n     * @example PANOLENS.ImageLoader.load( IMAGE_URL )\n     * @method load\n     * @param  {string}   url        - An image url\n     * @param  {function} onLoad     - On load callback\n     * @param  {function} onProgress - In progress callback\n     * @param  {function} onError    - On error callback\n     */\n    load: function ( url, onLoad = () => {}, onProgress = () => {}, onError = () => {} ) {\n\n        // Enable cache\n        Cache.enabled = true;\n\n        let cached, request, arrayBufferView, blob, urlCreator, image, reference;\n\n        // Reference key\n        for (let iconName in DataImage) {\n\n            if (DataImage.hasOwnProperty(iconName) && url === DataImage[iconName]) {\n\n                reference = iconName;\n\n            }\n\n        }\n\n        // Cached\n        cached = Cache.get(reference ? reference : url);\n\n        if (cached !== undefined) {\n\n            if (onLoad) {\n\n                if ( cached.complete && cached.src ) {\n                    setTimeout( function () {\n\n                        onProgress( { loaded: 1, total: 1 } );\n                        onLoad( cached );\n\n                    }, 0 );\n                } else {\n                    cached.addEventListener( 'load', function () {\n\n                        onProgress( { loaded: 1, total: 1 } );\n                        onLoad( cached );\n\n                    }, false );\n                }\n\n            }\n\n            return cached;\n\n        }\n\n        // Construct a new XMLHttpRequest\n        urlCreator = window.URL || window.webkitURL;\n        image = document.createElementNS('http://www.w3.org/1999/xhtml', 'img');\n\n        // Add to cache\n        Cache.add(reference ? reference : url, image);\n\n        const onImageLoaded = () => {\n\n            urlCreator.revokeObjectURL(image.src);\n            onLoad(image);\n\n        };\n\n        if (url.indexOf('data:') === 0) {\n\n            image.addEventListener('load', onImageLoaded, false);\n            image.src = url;\n            return image;\n        }\n\n        image.crossOrigin = this.crossOrigin !== undefined ? this.crossOrigin : '';\n\n        request = new window.XMLHttpRequest();\n        request.open('GET', url, true);\n        if (process.env.npm_lifecycle_event !== 'test') {\n            /* istanbul ignore next */\n            request.onreadystatechange = function () {\n                if (this.readyState === 4 && this.status >= 400) {\n                    onError();\n                }\n            };\n        }\n        request.responseType = 'arraybuffer';\n        request.addEventListener( 'error', onError );\n        request.addEventListener( 'progress', event => {\n\n            if  ( !event ) return;\n\n            const { loaded, total, lengthComputable } = event;\n            \n            if ( lengthComputable ) {\n\t\n                onProgress( { loaded, total } );\n\t\n            }\n\t\n        } );\n        \n        request.addEventListener( 'loadend', event => {\n\n            if  ( !event ) return;\n            const { currentTarget: { response } } = event;\n\n            arrayBufferView = new Uint8Array( response );\n            blob = new window.Blob( [ arrayBufferView ] );\n\t\t\t\t\n            image.addEventListener( 'load', onImageLoaded, false );\n            image.src = urlCreator.createObjectURL( blob );\n\t\n        } );\n\t\n        request.send(null);\n\t\n    }\n\n};\n\n/**\n * @module TextureLoader\n * @description Texture loader based on {@link https://github.com/mrdoob/three.js/blob/master/src/loaders/TextureLoader.js}\n */\nconst TextureLoader = {\n\n    /**\n     * Load image texture\n     * @example PANOLENS.TextureLoader.load( IMAGE_URL )\n     * @method load\n     * @param  {string}   url        - An image url\n     * @param  {function} onLoad     - On load callback\n     * @param  {function} onProgress - In progress callback\n     * @param  {function} onError    - On error callback\n     * @return {THREE.Texture}   \t - Image texture\n     */\n    load: function ( url, onLoad = () => {}, onProgress, onError ) {\n\n        var texture = new Texture(); \n\n        ImageLoader.load( url, function ( image ) {\n\n            texture.image = image;\n\n            // JPEGs can't have an alpha channel, so memory can be saved by storing them as RGB.\n            const isJPEG = url.search( /\\.(jpg|jpeg)$/ ) > 0 || url.search( /^data\\:image\\/jpeg/ ) === 0;\n\n            texture.format = isJPEG ? RGBFormat : RGBAFormat;\n            texture.needsUpdate = true;\n\n            onLoad( texture );\n\n        }, onProgress, onError );\n\n        return texture;\n\n    }\n\n};\n\n/**\n * @module CubeTextureLoader\n * @description Cube Texture Loader based on {@link https://github.com/mrdoob/three.js/blob/master/src/loaders/CubeTextureLoader.js}\n */\nconst CubeTextureLoader = {\n\n    /**\n     * Load 6 images as a cube texture\n     * @example PANOLENS.CubeTextureLoader.load( [ 'px.png', 'nx.png', 'py.png', 'ny.png', 'pz.png', 'nz.png' ] )\n     * @method load\n     * @param  {array}   urls        - array of 6 urls to images, one for each side of the CubeTexture. The urls should be specified in the following order: pos-x, neg-x, pos-y, neg-y, pos-z, neg-z\n     * @param  {function} onLoad     - On load callback\n     * @param  {function} onProgress - In progress callback\n     * @param  {function} onError    - On error callback\n     * @return {THREE.CubeTexture}   - Cube texture\n     */\n    load: function ( urls, onLoad = () => {}, onProgress = () => {}, onError ) {\n\n\t   var texture, loaded, progress, all, loadings;\n\n\t   texture = new CubeTexture( [] );\n\n\t   loaded = 0;\n\t   progress = {};\n\t   all = {};\n\n\t   urls.map( function ( url, index ) {\n\n\t\t   ImageLoader.load( url, function ( image ) {\n\n\t\t\t   texture.images[ index ] = image;\n\n\t\t\t   loaded++;\n\n\t\t\t   if ( loaded === 6 ) {\n\n\t\t\t\t   texture.needsUpdate = true;\n\n\t\t\t\t   onLoad( texture );\n\n\t\t\t   }\n\n\t\t   }, function ( event ) {\n\n\t\t\t   progress[ index ] = { loaded: event.loaded, total: event.total };\n\n\t\t\t   all.loaded = 0;\n\t\t\t   all.total = 0;\n\t\t\t   loadings = 0;\n\n\t\t\t   for ( var i in progress ) {\n\n\t\t\t\t   loadings++;\n\t\t\t\t   all.loaded += progress[ i ].loaded;\n\t\t\t\t   all.total += progress[ i ].total;\n\n\t\t\t   }\n\n\t\t\t   if ( loadings < 6 ) {\n\n\t\t\t\t   all.total = all.total / loadings * 6;\n\n\t\t\t   }\n\n\t\t\t   onProgress( all );\n\n\t\t   }, onError );\n\n\t   } );\n\n\t   return texture;\n\n    }\n\n};\n\n/**\n * @classdesc User Media\n * @constructor\n * @param {object} [constraints={ video: { width: { ideal: 1920 }, height: { ideal: 1080 }, facingMode: { exact: 'environment' } }, audio: false }]\n */\nfunction Media ( constraints ) {\n\n    const defaultConstraints = { video: { width: { ideal: 1920 }, height: { ideal: 1080 }, facingMode: { exact: 'environment' } }, audio: false };\n\n    this.constraints = Object.assign( defaultConstraints, constraints );\n\n    this.container = null;\n    this.scene = null;\n    this.element = null;\n    this.devices = [];\n    this.stream = null;\n    this.ratioScalar = 1;\n    this.videoDeviceIndex = 0;\n\n}\nMedia.prototype = Object.assign( Object.create( EventDispatcher.prototype ), {\n\n    setContainer: function ( container ) {\n\n        this.container = container;\n\n    },\n\n    setScene: function ( scene ) {\n\n        this.scene = scene;\n\n    },\n\n    /**\n     * Enumerate devices\n     * @memberOf Media\n     * @instance\n     * @returns {Promise}\n     */\n    enumerateDevices: function () {\n\n        const devices = this.devices;\n        const resolvedPromise = new Promise( resolve => { resolve( devices ); } );\n\n        return devices.length > 0 ? resolvedPromise : window.navigator.mediaDevices.enumerateDevices();\n\n    },\n\n    /**\n     * Switch to next available video device\n     * @memberOf Media\n     * @instance\n     */\n    switchNextVideoDevice: function () {\n\n        const stop = this.stop.bind( this );\n        const start = this.start.bind( this );\n        const setVideDeviceIndex = this.setVideDeviceIndex.bind( this );\n\n        let index = this.videoDeviceIndex;\n\n        this.getDevices( 'video' )\n            .then( devices => {\n                stop();\n                index++;\n                if ( index >= devices.length ) {\n                    setVideDeviceIndex( 0 );\n                    index--;\n                } else {\n                    setVideDeviceIndex( index );\n                }\n\n                start( devices[ index ] );\n            \n\n            } );\n\n    },\n\n    /**\n     * Get devices\n     * @param {string} type - type keyword to match device.kind\n     * @memberOf Media\n     * @instance\n     */\n    getDevices: function ( type = 'video' ) {\n\n        const devices = this.devices;\n        const validate = _devices => {\n\n            return _devices.map( device => { \n                \n                if ( !devices.includes( device ) ) { devices.push( device ); }\n                return device; \n            \n            } );\n            \n        };\n        const filter = _devices => {\n\n            const reg = new RegExp( type, 'i' );\n            return _devices.filter( device => reg.test( device.kind ) );\n\n        };\n\n        return this.enumerateDevices()\n            .then( validate )\n            .then( filter );\n\n    },\n\n    /**\n     * Get user media\n     * @param {MediaStreamConstraints} constraints\n     * @memberOf Media\n     * @instance\n     */\n    getUserMedia: function ( constraints ) {\n\n        const setMediaStream = this.setMediaStream.bind( this );\n        const playVideo = this.playVideo.bind( this );\n        const onCatchError = error => { console.warn( `PANOLENS.Media: ${error}` ); };\n\n        return window.navigator.mediaDevices.getUserMedia( constraints )\n            .then( setMediaStream )\n            .then( playVideo )\n            .catch( onCatchError );\n\n    },\n\n    /**\n     * Set video device index\n     * @param {number} index \n     * @memberOf Media\n     * @instance\n     */\n    setVideDeviceIndex: function ( index ) {\n\n        this.videoDeviceIndex = index;\n\n    },\n\n    /**\n     * Start streaming\n     * @param {MediaDeviceInfo} [targetDevice]\n     * @memberOf Media\n     * @instance\n     */\n    start: function( targetDevice ) {\n\n        const constraints = this.constraints;\n        const getUserMedia = this.getUserMedia.bind( this );\n        const onVideoDevices = devices => {\n\n            if ( !devices || devices.length === 0 ) {\n\n                throw Error( 'no video device found' );\n\n            }\n\n            const device = targetDevice || devices[ 0 ];\n            constraints.video.deviceId = device.deviceId;\n\n            return getUserMedia( constraints );\n\n        };\n\n        this.element = this.createVideoElement();\n\n        return this.getDevices().then( onVideoDevices );\n\n    },\n\n    /**\n     * Stop streaming\n     * @memberOf Media\n     * @instance\n     */\n    stop: function () {\n\n        const stream = this.stream;\n\n        if ( stream && stream.active ) {\n\n            const track = stream.getTracks()[ 0 ];\n\n            track.stop();\n\n            window.removeEventListener( 'resize', this.onWindowResize.bind( this ) );\n\n            this.element = null;\n            this.stream = null;\n\n        }\n\n    },\n\n    /**\n     * Set media stream\n     * @param {MediaStream} stream \n     * @memberOf Media\n     * @instance\n     */\n    setMediaStream: function ( stream ) {\n\n        this.stream = stream;\n        this.element.srcObject = stream;\n\n        if ( this.scene ) {\n\n            this.scene.background = this.createVideoTexture();\n\n        }\n        \n        window.addEventListener( 'resize', this.onWindowResize.bind( this ) );\n\n    },\n\n    /**\n     * Play video element\n     * @memberOf Media\n     * @instance\n     */\n    playVideo: function () {\n\n        const { element } = this;\n\n        if ( element ) {\n\n            element.play();\n            this.dispatchEvent( { type: 'play' } );\n\n        }\n\n    },\n\n    /**\n     * Pause video element\n     * @memberOf Media\n     * @instance\n     */\n    pauseVideo: function () {\n\n        const { element } = this;\n\n        if ( element ) {\n\n            element.pause();\n            this.dispatchEvent( { type: 'pause' } );\n\n        }\n\n    },\n\n    /**\n     * Create video texture\n     * @memberOf Media\n     * @instance\n     * @returns {THREE.VideoTexture}\n     */\n    createVideoTexture: function () {\n\n        const video = this.element;\n        const texture = new VideoTexture( video );\n\n        texture.generateMipmaps = false;\n        texture.minFilter = LinearFilter;\n        texture.magFilter = LinearFilter;\n        texture.format = RGBFormat;\n        texture.center.set( 0.5, 0.5 );\n\n        video.addEventListener( 'canplay', this.onWindowResize.bind( this ) );\n\n        return texture;\n\n    },\n\n    /**\n     * Create video element\n     * @memberOf Media\n     * @instance\n     * @returns {HTMLVideoElement}\n     * @fires Media#canplay\n     */\n    createVideoElement: function() {\n\n        const dispatchEvent = this.dispatchEvent.bind( this );\n        const video = document.createElement( 'video' );\n\n        /**\n         * Video can play event\n         * @type {object}\n         * @event Media#canplay\n         */\n        const canPlay = () => dispatchEvent( { type: 'canplay' } );\n        \n        video.setAttribute( 'autoplay', '' );\n        video.setAttribute( 'muted', '' );\n        video.setAttribute( 'playsinline', '' );\n\n        video.style.position = 'absolute';\n        video.style.top = '0';\n        video.style.left = '0';\n        video.style.width = '100%';\n        video.style.height = '100%';\n        video.style.objectPosition = 'center';\n        video.style.objectFit = 'cover';\n        video.style.display = this.scene ? 'none' : '';\n\n        video.addEventListener( 'canplay', canPlay );\n\n        return video;\n\n    },\n\n    /**\n     * On window resize event\n     * @param {Event} event \n     * @memberOf Media\n     * @instance\n     */\n    onWindowResize: function () {\n\n        if ( this.element && this.element.videoWidth && this.element.videoHeight && this.scene ) {\n\n            const { clientWidth: width, clientHeight: height } = this.container;\n            const texture = this.scene.background;\n            const { videoWidth, videoHeight } = this.element;\n            const cameraRatio = videoHeight / videoWidth;\n            const viewportRatio = this.container ? width / height : 1.0;\n            const ratio = cameraRatio * viewportRatio * this.ratioScalar;\n\n            if ( width > height ) {\n                texture.repeat.set( ratio, 1 );\n            } else {\n                texture.repeat.set( 1, 1 / ratio );\n            }\n\n        }\n\n    }\n\n} );\n\n/**\n * @classdesc Reticle 3D Sprite\n * @constructor\n * @param {THREE.Color} [color=0xffffff] - Color of the reticle sprite\n * @param {boolean} [autoSelect=true] - Auto selection\n * @param {number} [dwellTime=1500] - Duration for dwelling sequence to complete\n */\n\nfunction Reticle ( color = 0xffffff, autoSelect = true, dwellTime = 1500 ) {\n\n    this.dpr = window.devicePixelRatio;\n\n    const { canvas, context } = this.createCanvas();\n    const material = new SpriteMaterial( { color, map: this.createCanvasTexture( canvas ) } );\n\n    Sprite.call( this, material );\n\n    this.canvasWidth = canvas.width;\n    this.canvasHeight = canvas.height;\n    this.context = context;\n    this.color = color instanceof Color ? color : new Color( color );    \n\n    this.autoSelect = autoSelect;\n    this.dwellTime = dwellTime;\n    this.rippleDuration = 500;\n    this.position.z = -10;\n    this.center.set( 0.5, 0.5 );\n    this.scale.set( 0.5, 0.5, 1 );\n\n    this.startTimestamp = null;\n    this.timerId = null;\n    this.callback = null;\n\n    this.frustumCulled = false;\n\n    this.updateCanvasArcByProgress( 0 );\n\n}\nReticle.prototype = Object.assign( Object.create( Sprite.prototype ), {\n\n    constructor: Reticle,\n\n    /**\n     * Set material color\n     * @param {THREE.Color} color \n     * @memberOf Reticle\n     * @instance\n     */\n    setColor: function ( color ) {\n\n        this.material.color.copy( color instanceof Color ? color : new Color( color ) );\n\n    },\n\n    /**\n     * Create canvas texture\n     * @param {HTMLCanvasElement} canvas \n     * @memberOf Reticle\n     * @instance\n     * @returns {THREE.CanvasTexture}\n     */\n    createCanvasTexture: function ( canvas ) {\n\n        const texture = new CanvasTexture( canvas );\n        texture.minFilter = LinearFilter;\n        texture.magFilter = LinearFilter;\n        texture.generateMipmaps = false;\n\n        return texture;\n\n    },\n\n    /**\n     * Create canvas element\n     * @memberOf Reticle\n     * @instance\n     * @returns {object} object\n     * @returns {HTMLCanvasElement} object.canvas\n     * @returns {CanvasRenderingContext2D} object.context\n     */\n    createCanvas: function () {\n\n        const width = 32;\n        const height = 32;\n        const canvas = document.createElement( 'canvas' );\n        const context = canvas.getContext( '2d' );\n        const dpr = this.dpr;\n\n        canvas.width = width * dpr;\n        canvas.height = height * dpr;\n        context.scale( dpr, dpr );\n\n        context.shadowBlur = 5;\n        context.shadowColor = 'rgba(200,200,200,0.9)';\n\n        return { canvas, context };\n\n    },\n\n    /**\n     * Update canvas arc by progress\n     * @param {number} progress \n     * @memberOf Reticle\n     * @instance\n     */\n    updateCanvasArcByProgress: function ( progress ) {\n\n        const context = this.context;\n        const { canvasWidth, canvasHeight, material } = this;\n        const dpr = this.dpr;\n        const degree = progress * Math.PI * 2;\n        const color = this.color.getStyle();\n        const x = canvasWidth * 0.5 / dpr;\n        const y = canvasHeight * 0.5 / dpr;\n        const lineWidth = 3;\n        \n        context.clearRect( 0, 0, canvasWidth, canvasHeight );\n        context.beginPath();\n\n        if ( progress === 0 ) {\n            context.arc( x, y, canvasWidth / 16, 0, 2 * Math.PI );\n            context.fillStyle = color;\n            context.fill();\n        } else {\n            context.arc( x, y, canvasWidth / 4 - lineWidth, -Math.PI / 2, -Math.PI / 2 + degree );\n            context.strokeStyle = color;\n            context.lineWidth = lineWidth;\n            context.stroke();\n        }\n\n        context.closePath();\n\n        material.map.needsUpdate = true;\n\n    },\n\n    /**\n     * Ripple effect\n     * @memberOf Reticle\n     * @instance\n     * @fires Reticle#reticle-ripple-start\n     * @fires Reticle#reticle-ripple-end\n     */\n    ripple: function () {\n\n        const context = this.context;\n        const { canvasWidth, canvasHeight, material } = this;\n        const duration = this.rippleDuration;\n        const timestamp = performance.now();\n        const color = this.color;\n        const dpr = this.dpr;\n        const x = canvasWidth * 0.5 / dpr;\n        const y = canvasHeight * 0.5 / dpr;\n\n        const update = () => {\n\n            const timerId = window.requestAnimationFrame( update );\n            const elapsed = performance.now() - timestamp;\n            const progress = elapsed / duration;\n            const opacity = 1.0 - progress > 0 ? 1.0 - progress : 0;\n            const radius = progress * canvasWidth * 0.5 / dpr;\n\n            context.clearRect( 0, 0, canvasWidth, canvasHeight );\n            context.beginPath();\n            context.arc( x, y, radius, 0, Math.PI * 2 );\n            context.fillStyle = `rgba(${color.r * 255}, ${color.g * 255}, ${color.b * 255}, ${opacity})`;\n            context.fill();\n            context.closePath();\n\n            if ( progress >= 1.0 ) {\n\n                window.cancelAnimationFrame( timerId );\n                this.updateCanvasArcByProgress( 0 );\n\n                /**\n                 * Reticle ripple end event\n                 * @type {object}\n                 * @event Reticle#reticle-ripple-end\n                 */\n                this.dispatchEvent( { type: 'reticle-ripple-end' } );\n\n            }\n\n            material.map.needsUpdate = true;\n\n        };\n\n        /**\n         * Reticle ripple start event\n         * @type {object}\n         * @event Reticle#reticle-ripple-start\n         */\n        this.dispatchEvent( { type: 'reticle-ripple-start' } );\n\n        update();\n\n    },\n\n    /**\n     * Make reticle visible\n     * @memberOf Reticle\n     * @instance\n     */\n    show: function () {\n\n        this.visible = true;\n\n    },\n\n    /**\n     * Make reticle invisible\n     * @memberOf Reticle\n     * @instance\n     */\n    hide: function () {\n\n        this.visible = false;\n\n    },\n\n    /**\n     * Start dwelling\n     * @param {function} callback \n     * @memberOf Reticle\n     * @instance\n     * @fires Reticle#reticle-start\n     */\n    start: function ( callback ) {\n\n        if ( !this.autoSelect ) {\n\n            return;\n\n        }\n\n        /**\n         * Reticle start event\n         * @type {object}\n         * @event Reticle#reticle-start\n         */\n        this.dispatchEvent( { type: 'reticle-start' } );\n\n        this.startTimestamp = performance.now();\n        this.callback = callback;\n        this.update();\n\n    },\n\n    /**\n     * End dwelling\n     * @memberOf Reticle\n     * @instance\n     * @fires Reticle#reticle-end\n     */\n    end: function(){\n\n        if ( !this.startTimestamp ) { return; }\n\n        window.cancelAnimationFrame( this.timerId );\n\n        this.updateCanvasArcByProgress( 0 );\n        this.callback = null;\n        this.timerId = null;\n        this.startTimestamp = null;\n\n        /**\n         * Reticle end event\n         * @type {object}\n         * @event Reticle#reticle-end\n         */\n        this.dispatchEvent( { type: 'reticle-end' } );\n\n    },\n\n    /**\n     * Update dwelling\n     * @memberOf Reticle\n     * @instance\n     * @fires Reticle#reticle-update\n     */\n    update: function () {\n\n        this.timerId = window.requestAnimationFrame( this.update.bind( this ) );\n\n        const elapsed = performance.now() - this.startTimestamp;\n        const progress = elapsed / this.dwellTime;\n\n        this.updateCanvasArcByProgress( progress );\n\n        /**\n         * Reticle update event\n         * @type {object}\n         * @event Reticle#reticle-update\n         */\n        this.dispatchEvent( { type: 'reticle-update', progress } );\n\n        if ( progress >= 1.0 ) {\n\n            window.cancelAnimationFrame( this.timerId );\n            if ( this.callback ) { this.callback(); }\n            this.end();\n            this.ripple();\n\n        }\n\n    }\n\n} );\n\nfunction createCommonjsModule(fn, module) {\n\treturn module = { exports: {} }, fn(module, module.exports), module.exports;\n}\n\nvar Tween = createCommonjsModule(function (module, exports) {\n/**\n * Tween.js - Licensed under the MIT license\n * https://github.com/tweenjs/tween.js\n * ----------------------------------------------\n *\n * See https://github.com/tweenjs/tween.js/graphs/contributors for the full list of contributors.\n * Thank you all, you're awesome!\n */\n\n\nvar _Group = function () {\n\tthis._tweens = {};\n\tthis._tweensAddedDuringUpdate = {};\n};\n\n_Group.prototype = {\n\tgetAll: function () {\n\n\t\treturn Object.keys(this._tweens).map(function (tweenId) {\n\t\t\treturn this._tweens[tweenId];\n\t\t}.bind(this));\n\n\t},\n\n\tremoveAll: function () {\n\n\t\tthis._tweens = {};\n\n\t},\n\n\tadd: function (tween) {\n\n\t\tthis._tweens[tween.getId()] = tween;\n\t\tthis._tweensAddedDuringUpdate[tween.getId()] = tween;\n\n\t},\n\n\tremove: function (tween) {\n\n\t\tdelete this._tweens[tween.getId()];\n\t\tdelete this._tweensAddedDuringUpdate[tween.getId()];\n\n\t},\n\n\tupdate: function (time, preserve) {\n\n\t\tvar tweenIds = Object.keys(this._tweens);\n\n\t\tif (tweenIds.length === 0) {\n\t\t\treturn false;\n\t\t}\n\n\t\ttime = time !== undefined ? time : TWEEN.now();\n\n\t\t// Tweens are updated in \"batches\". If you add a new tween during an update, then the\n\t\t// new tween will be updated in the next batch.\n\t\t// If you remove a tween during an update, it may or may not be updated. However,\n\t\t// if the removed tween was added during the current batch, then it will not be updated.\n\t\twhile (tweenIds.length > 0) {\n\t\t\tthis._tweensAddedDuringUpdate = {};\n\n\t\t\tfor (var i = 0; i < tweenIds.length; i++) {\n\n\t\t\t\tvar tween = this._tweens[tweenIds[i]];\n\n\t\t\t\tif (tween && tween.update(time) === false) {\n\t\t\t\t\ttween._isPlaying = false;\n\n\t\t\t\t\tif (!preserve) {\n\t\t\t\t\t\tdelete this._tweens[tweenIds[i]];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\ttweenIds = Object.keys(this._tweensAddedDuringUpdate);\n\t\t}\n\n\t\treturn true;\n\n\t}\n};\n\nvar TWEEN = new _Group();\n\nTWEEN.Group = _Group;\nTWEEN._nextId = 0;\nTWEEN.nextId = function () {\n\treturn TWEEN._nextId++;\n};\n\n\n// Include a performance.now polyfill.\n// In node.js, use process.hrtime.\nif (typeof (self) === 'undefined' && typeof (process) !== 'undefined' && process.hrtime) {\n\tTWEEN.now = function () {\n\t\tvar time = process.hrtime();\n\n\t\t// Convert [seconds, nanoseconds] to milliseconds.\n\t\treturn time[0] * 1000 + time[1] / 1000000;\n\t};\n}\n// In a browser, use self.performance.now if it is available.\nelse if (typeof (self) !== 'undefined' &&\n         self.performance !== undefined &&\n\t\t self.performance.now !== undefined) {\n\t// This must be bound, because directly assigning this function\n\t// leads to an invocation exception in Chrome.\n\tTWEEN.now = self.performance.now.bind(self.performance);\n}\n// Use Date.now if it is available.\nelse if (Date.now !== undefined) {\n\tTWEEN.now = Date.now;\n}\n// Otherwise, use 'new Date().getTime()'.\nelse {\n\tTWEEN.now = function () {\n\t\treturn new Date().getTime();\n\t};\n}\n\n\nTWEEN.Tween = function (object, group) {\n\tthis._object = object;\n\tthis._valuesStart = {};\n\tthis._valuesEnd = {};\n\tthis._valuesStartRepeat = {};\n\tthis._duration = 1000;\n\tthis._repeat = 0;\n\tthis._repeatDelayTime = undefined;\n\tthis._yoyo = false;\n\tthis._isPlaying = false;\n\tthis._reversed = false;\n\tthis._delayTime = 0;\n\tthis._startTime = null;\n\tthis._easingFunction = TWEEN.Easing.Linear.None;\n\tthis._interpolationFunction = TWEEN.Interpolation.Linear;\n\tthis._chainedTweens = [];\n\tthis._onStartCallback = null;\n\tthis._onStartCallbackFired = false;\n\tthis._onUpdateCallback = null;\n\tthis._onRepeatCallback = null;\n\tthis._onCompleteCallback = null;\n\tthis._onStopCallback = null;\n\tthis._group = group || TWEEN;\n\tthis._id = TWEEN.nextId();\n\n};\n\nTWEEN.Tween.prototype = {\n\tgetId: function () {\n\t\treturn this._id;\n\t},\n\n\tisPlaying: function () {\n\t\treturn this._isPlaying;\n\t},\n\n\tto: function (properties, duration) {\n\n\t\tthis._valuesEnd = Object.create(properties);\n\n\t\tif (duration !== undefined) {\n\t\t\tthis._duration = duration;\n\t\t}\n\n\t\treturn this;\n\n\t},\n\n\tduration: function duration(d) {\n\t\tthis._duration = d;\n\t\treturn this;\n\t},\n\n\tstart: function (time) {\n\n\t\tthis._group.add(this);\n\n\t\tthis._isPlaying = true;\n\n\t\tthis._onStartCallbackFired = false;\n\n\t\tthis._startTime = time !== undefined ? typeof time === 'string' ? TWEEN.now() + parseFloat(time) : time : TWEEN.now();\n\t\tthis._startTime += this._delayTime;\n\n\t\tfor (var property in this._valuesEnd) {\n\n\t\t\t// Check if an Array was provided as property value\n\t\t\tif (this._valuesEnd[property] instanceof Array) {\n\n\t\t\t\tif (this._valuesEnd[property].length === 0) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t// Create a local copy of the Array with the start value at the front\n\t\t\t\tthis._valuesEnd[property] = [this._object[property]].concat(this._valuesEnd[property]);\n\n\t\t\t}\n\n\t\t\t// If `to()` specifies a property that doesn't exist in the source object,\n\t\t\t// we should not set that property in the object\n\t\t\tif (this._object[property] === undefined) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// Save the starting value.\n\t\t\tthis._valuesStart[property] = this._object[property];\n\n\t\t\tif ((this._valuesStart[property] instanceof Array) === false) {\n\t\t\t\tthis._valuesStart[property] *= 1.0; // Ensures we're using numbers, not strings\n\t\t\t}\n\n\t\t\tthis._valuesStartRepeat[property] = this._valuesStart[property] || 0;\n\n\t\t}\n\n\t\treturn this;\n\n\t},\n\n\tstop: function () {\n\n\t\tif (!this._isPlaying) {\n\t\t\treturn this;\n\t\t}\n\n\t\tthis._group.remove(this);\n\t\tthis._isPlaying = false;\n\n\t\tif (this._onStopCallback !== null) {\n\t\t\tthis._onStopCallback(this._object);\n\t\t}\n\n\t\tthis.stopChainedTweens();\n\t\treturn this;\n\n\t},\n\n\tend: function () {\n\n\t\tthis.update(Infinity);\n\t\treturn this;\n\n\t},\n\n\tstopChainedTweens: function () {\n\n\t\tfor (var i = 0, numChainedTweens = this._chainedTweens.length; i < numChainedTweens; i++) {\n\t\t\tthis._chainedTweens[i].stop();\n\t\t}\n\n\t},\n\n\tgroup: function (group) {\n\t\tthis._group = group;\n\t\treturn this;\n\t},\n\n\tdelay: function (amount) {\n\n\t\tthis._delayTime = amount;\n\t\treturn this;\n\n\t},\n\n\trepeat: function (times) {\n\n\t\tthis._repeat = times;\n\t\treturn this;\n\n\t},\n\n\trepeatDelay: function (amount) {\n\n\t\tthis._repeatDelayTime = amount;\n\t\treturn this;\n\n\t},\n\n\tyoyo: function (yoyo) {\n\n\t\tthis._yoyo = yoyo;\n\t\treturn this;\n\n\t},\n\n\teasing: function (easingFunction) {\n\n\t\tthis._easingFunction = easingFunction;\n\t\treturn this;\n\n\t},\n\n\tinterpolation: function (interpolationFunction) {\n\n\t\tthis._interpolationFunction = interpolationFunction;\n\t\treturn this;\n\n\t},\n\n\tchain: function () {\n\n\t\tthis._chainedTweens = arguments;\n\t\treturn this;\n\n\t},\n\n\tonStart: function (callback) {\n\n\t\tthis._onStartCallback = callback;\n\t\treturn this;\n\n\t},\n\n\tonUpdate: function (callback) {\n\n\t\tthis._onUpdateCallback = callback;\n\t\treturn this;\n\n\t},\n\n\tonRepeat: function onRepeat(callback) {\n\n\t\tthis._onRepeatCallback = callback;\n\t\treturn this;\n\n\t},\n\n\tonComplete: function (callback) {\n\n\t\tthis._onCompleteCallback = callback;\n\t\treturn this;\n\n\t},\n\n\tonStop: function (callback) {\n\n\t\tthis._onStopCallback = callback;\n\t\treturn this;\n\n\t},\n\n\tupdate: function (time) {\n\n\t\tvar property;\n\t\tvar elapsed;\n\t\tvar value;\n\n\t\tif (time < this._startTime) {\n\t\t\treturn true;\n\t\t}\n\n\t\tif (this._onStartCallbackFired === false) {\n\n\t\t\tif (this._onStartCallback !== null) {\n\t\t\t\tthis._onStartCallback(this._object);\n\t\t\t}\n\n\t\t\tthis._onStartCallbackFired = true;\n\t\t}\n\n\t\telapsed = (time - this._startTime) / this._duration;\n\t\telapsed = (this._duration === 0 || elapsed > 1) ? 1 : elapsed;\n\n\t\tvalue = this._easingFunction(elapsed);\n\n\t\tfor (property in this._valuesEnd) {\n\n\t\t\t// Don't update properties that do not exist in the source object\n\t\t\tif (this._valuesStart[property] === undefined) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tvar start = this._valuesStart[property] || 0;\n\t\t\tvar end = this._valuesEnd[property];\n\n\t\t\tif (end instanceof Array) {\n\n\t\t\t\tthis._object[property] = this._interpolationFunction(end, value);\n\n\t\t\t} else {\n\n\t\t\t\t// Parses relative end values with start as base (e.g.: +10, -3)\n\t\t\t\tif (typeof (end) === 'string') {\n\n\t\t\t\t\tif (end.charAt(0) === '+' || end.charAt(0) === '-') {\n\t\t\t\t\t\tend = start + parseFloat(end);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tend = parseFloat(end);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Protect against non numeric properties.\n\t\t\t\tif (typeof (end) === 'number') {\n\t\t\t\t\tthis._object[property] = start + (end - start) * value;\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tif (this._onUpdateCallback !== null) {\n\t\t\tthis._onUpdateCallback(this._object, elapsed);\n\t\t}\n\n\t\tif (elapsed === 1) {\n\n\t\t\tif (this._repeat > 0) {\n\n\t\t\t\tif (isFinite(this._repeat)) {\n\t\t\t\t\tthis._repeat--;\n\t\t\t\t}\n\n\t\t\t\t// Reassign starting values, restart by making startTime = now\n\t\t\t\tfor (property in this._valuesStartRepeat) {\n\n\t\t\t\t\tif (typeof (this._valuesEnd[property]) === 'string') {\n\t\t\t\t\t\tthis._valuesStartRepeat[property] = this._valuesStartRepeat[property] + parseFloat(this._valuesEnd[property]);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this._yoyo) {\n\t\t\t\t\t\tvar tmp = this._valuesStartRepeat[property];\n\n\t\t\t\t\t\tthis._valuesStartRepeat[property] = this._valuesEnd[property];\n\t\t\t\t\t\tthis._valuesEnd[property] = tmp;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis._valuesStart[property] = this._valuesStartRepeat[property];\n\n\t\t\t\t}\n\n\t\t\t\tif (this._yoyo) {\n\t\t\t\t\tthis._reversed = !this._reversed;\n\t\t\t\t}\n\n\t\t\t\tif (this._repeatDelayTime !== undefined) {\n\t\t\t\t\tthis._startTime = time + this._repeatDelayTime;\n\t\t\t\t} else {\n\t\t\t\t\tthis._startTime = time + this._delayTime;\n\t\t\t\t}\n\n\t\t\t\tif (this._onRepeatCallback !== null) {\n\t\t\t\t\tthis._onRepeatCallback(this._object);\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\n\t\t\t} else {\n\n\t\t\t\tif (this._onCompleteCallback !== null) {\n\n\t\t\t\t\tthis._onCompleteCallback(this._object);\n\t\t\t\t}\n\n\t\t\t\tfor (var i = 0, numChainedTweens = this._chainedTweens.length; i < numChainedTweens; i++) {\n\t\t\t\t\t// Make the chained tweens start exactly at the time they should,\n\t\t\t\t\t// even if the `update()` method was called way past the duration of the tween\n\t\t\t\t\tthis._chainedTweens[i].start(this._startTime + this._duration);\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn true;\n\n\t}\n};\n\n\nTWEEN.Easing = {\n\n\tLinear: {\n\n\t\tNone: function (k) {\n\n\t\t\treturn k;\n\n\t\t}\n\n\t},\n\n\tQuadratic: {\n\n\t\tIn: function (k) {\n\n\t\t\treturn k * k;\n\n\t\t},\n\n\t\tOut: function (k) {\n\n\t\t\treturn k * (2 - k);\n\n\t\t},\n\n\t\tInOut: function (k) {\n\n\t\t\tif ((k *= 2) < 1) {\n\t\t\t\treturn 0.5 * k * k;\n\t\t\t}\n\n\t\t\treturn - 0.5 * (--k * (k - 2) - 1);\n\n\t\t}\n\n\t},\n\n\tCubic: {\n\n\t\tIn: function (k) {\n\n\t\t\treturn k * k * k;\n\n\t\t},\n\n\t\tOut: function (k) {\n\n\t\t\treturn --k * k * k + 1;\n\n\t\t},\n\n\t\tInOut: function (k) {\n\n\t\t\tif ((k *= 2) < 1) {\n\t\t\t\treturn 0.5 * k * k * k;\n\t\t\t}\n\n\t\t\treturn 0.5 * ((k -= 2) * k * k + 2);\n\n\t\t}\n\n\t},\n\n\tQuartic: {\n\n\t\tIn: function (k) {\n\n\t\t\treturn k * k * k * k;\n\n\t\t},\n\n\t\tOut: function (k) {\n\n\t\t\treturn 1 - (--k * k * k * k);\n\n\t\t},\n\n\t\tInOut: function (k) {\n\n\t\t\tif ((k *= 2) < 1) {\n\t\t\t\treturn 0.5 * k * k * k * k;\n\t\t\t}\n\n\t\t\treturn - 0.5 * ((k -= 2) * k * k * k - 2);\n\n\t\t}\n\n\t},\n\n\tQuintic: {\n\n\t\tIn: function (k) {\n\n\t\t\treturn k * k * k * k * k;\n\n\t\t},\n\n\t\tOut: function (k) {\n\n\t\t\treturn --k * k * k * k * k + 1;\n\n\t\t},\n\n\t\tInOut: function (k) {\n\n\t\t\tif ((k *= 2) < 1) {\n\t\t\t\treturn 0.5 * k * k * k * k * k;\n\t\t\t}\n\n\t\t\treturn 0.5 * ((k -= 2) * k * k * k * k + 2);\n\n\t\t}\n\n\t},\n\n\tSinusoidal: {\n\n\t\tIn: function (k) {\n\n\t\t\treturn 1 - Math.cos(k * Math.PI / 2);\n\n\t\t},\n\n\t\tOut: function (k) {\n\n\t\t\treturn Math.sin(k * Math.PI / 2);\n\n\t\t},\n\n\t\tInOut: function (k) {\n\n\t\t\treturn 0.5 * (1 - Math.cos(Math.PI * k));\n\n\t\t}\n\n\t},\n\n\tExponential: {\n\n\t\tIn: function (k) {\n\n\t\t\treturn k === 0 ? 0 : Math.pow(1024, k - 1);\n\n\t\t},\n\n\t\tOut: function (k) {\n\n\t\t\treturn k === 1 ? 1 : 1 - Math.pow(2, - 10 * k);\n\n\t\t},\n\n\t\tInOut: function (k) {\n\n\t\t\tif (k === 0) {\n\t\t\t\treturn 0;\n\t\t\t}\n\n\t\t\tif (k === 1) {\n\t\t\t\treturn 1;\n\t\t\t}\n\n\t\t\tif ((k *= 2) < 1) {\n\t\t\t\treturn 0.5 * Math.pow(1024, k - 1);\n\t\t\t}\n\n\t\t\treturn 0.5 * (- Math.pow(2, - 10 * (k - 1)) + 2);\n\n\t\t}\n\n\t},\n\n\tCircular: {\n\n\t\tIn: function (k) {\n\n\t\t\treturn 1 - Math.sqrt(1 - k * k);\n\n\t\t},\n\n\t\tOut: function (k) {\n\n\t\t\treturn Math.sqrt(1 - (--k * k));\n\n\t\t},\n\n\t\tInOut: function (k) {\n\n\t\t\tif ((k *= 2) < 1) {\n\t\t\t\treturn - 0.5 * (Math.sqrt(1 - k * k) - 1);\n\t\t\t}\n\n\t\t\treturn 0.5 * (Math.sqrt(1 - (k -= 2) * k) + 1);\n\n\t\t}\n\n\t},\n\n\tElastic: {\n\n\t\tIn: function (k) {\n\n\t\t\tif (k === 0) {\n\t\t\t\treturn 0;\n\t\t\t}\n\n\t\t\tif (k === 1) {\n\t\t\t\treturn 1;\n\t\t\t}\n\n\t\t\treturn -Math.pow(2, 10 * (k - 1)) * Math.sin((k - 1.1) * 5 * Math.PI);\n\n\t\t},\n\n\t\tOut: function (k) {\n\n\t\t\tif (k === 0) {\n\t\t\t\treturn 0;\n\t\t\t}\n\n\t\t\tif (k === 1) {\n\t\t\t\treturn 1;\n\t\t\t}\n\n\t\t\treturn Math.pow(2, -10 * k) * Math.sin((k - 0.1) * 5 * Math.PI) + 1;\n\n\t\t},\n\n\t\tInOut: function (k) {\n\n\t\t\tif (k === 0) {\n\t\t\t\treturn 0;\n\t\t\t}\n\n\t\t\tif (k === 1) {\n\t\t\t\treturn 1;\n\t\t\t}\n\n\t\t\tk *= 2;\n\n\t\t\tif (k < 1) {\n\t\t\t\treturn -0.5 * Math.pow(2, 10 * (k - 1)) * Math.sin((k - 1.1) * 5 * Math.PI);\n\t\t\t}\n\n\t\t\treturn 0.5 * Math.pow(2, -10 * (k - 1)) * Math.sin((k - 1.1) * 5 * Math.PI) + 1;\n\n\t\t}\n\n\t},\n\n\tBack: {\n\n\t\tIn: function (k) {\n\n\t\t\tvar s = 1.70158;\n\n\t\t\treturn k * k * ((s + 1) * k - s);\n\n\t\t},\n\n\t\tOut: function (k) {\n\n\t\t\tvar s = 1.70158;\n\n\t\t\treturn --k * k * ((s + 1) * k + s) + 1;\n\n\t\t},\n\n\t\tInOut: function (k) {\n\n\t\t\tvar s = 1.70158 * 1.525;\n\n\t\t\tif ((k *= 2) < 1) {\n\t\t\t\treturn 0.5 * (k * k * ((s + 1) * k - s));\n\t\t\t}\n\n\t\t\treturn 0.5 * ((k -= 2) * k * ((s + 1) * k + s) + 2);\n\n\t\t}\n\n\t},\n\n\tBounce: {\n\n\t\tIn: function (k) {\n\n\t\t\treturn 1 - TWEEN.Easing.Bounce.Out(1 - k);\n\n\t\t},\n\n\t\tOut: function (k) {\n\n\t\t\tif (k < (1 / 2.75)) {\n\t\t\t\treturn 7.5625 * k * k;\n\t\t\t} else if (k < (2 / 2.75)) {\n\t\t\t\treturn 7.5625 * (k -= (1.5 / 2.75)) * k + 0.75;\n\t\t\t} else if (k < (2.5 / 2.75)) {\n\t\t\t\treturn 7.5625 * (k -= (2.25 / 2.75)) * k + 0.9375;\n\t\t\t} else {\n\t\t\t\treturn 7.5625 * (k -= (2.625 / 2.75)) * k + 0.984375;\n\t\t\t}\n\n\t\t},\n\n\t\tInOut: function (k) {\n\n\t\t\tif (k < 0.5) {\n\t\t\t\treturn TWEEN.Easing.Bounce.In(k * 2) * 0.5;\n\t\t\t}\n\n\t\t\treturn TWEEN.Easing.Bounce.Out(k * 2 - 1) * 0.5 + 0.5;\n\n\t\t}\n\n\t}\n\n};\n\nTWEEN.Interpolation = {\n\n\tLinear: function (v, k) {\n\n\t\tvar m = v.length - 1;\n\t\tvar f = m * k;\n\t\tvar i = Math.floor(f);\n\t\tvar fn = TWEEN.Interpolation.Utils.Linear;\n\n\t\tif (k < 0) {\n\t\t\treturn fn(v[0], v[1], f);\n\t\t}\n\n\t\tif (k > 1) {\n\t\t\treturn fn(v[m], v[m - 1], m - f);\n\t\t}\n\n\t\treturn fn(v[i], v[i + 1 > m ? m : i + 1], f - i);\n\n\t},\n\n\tBezier: function (v, k) {\n\n\t\tvar b = 0;\n\t\tvar n = v.length - 1;\n\t\tvar pw = Math.pow;\n\t\tvar bn = TWEEN.Interpolation.Utils.Bernstein;\n\n\t\tfor (var i = 0; i <= n; i++) {\n\t\t\tb += pw(1 - k, n - i) * pw(k, i) * v[i] * bn(n, i);\n\t\t}\n\n\t\treturn b;\n\n\t},\n\n\tCatmullRom: function (v, k) {\n\n\t\tvar m = v.length - 1;\n\t\tvar f = m * k;\n\t\tvar i = Math.floor(f);\n\t\tvar fn = TWEEN.Interpolation.Utils.CatmullRom;\n\n\t\tif (v[0] === v[m]) {\n\n\t\t\tif (k < 0) {\n\t\t\t\ti = Math.floor(f = m * (1 + k));\n\t\t\t}\n\n\t\t\treturn fn(v[(i - 1 + m) % m], v[i], v[(i + 1) % m], v[(i + 2) % m], f - i);\n\n\t\t} else {\n\n\t\t\tif (k < 0) {\n\t\t\t\treturn v[0] - (fn(v[0], v[0], v[1], v[1], -f) - v[0]);\n\t\t\t}\n\n\t\t\tif (k > 1) {\n\t\t\t\treturn v[m] - (fn(v[m], v[m], v[m - 1], v[m - 1], f - m) - v[m]);\n\t\t\t}\n\n\t\t\treturn fn(v[i ? i - 1 : 0], v[i], v[m < i + 1 ? m : i + 1], v[m < i + 2 ? m : i + 2], f - i);\n\n\t\t}\n\n\t},\n\n\tUtils: {\n\n\t\tLinear: function (p0, p1, t) {\n\n\t\t\treturn (p1 - p0) * t + p0;\n\n\t\t},\n\n\t\tBernstein: function (n, i) {\n\n\t\t\tvar fc = TWEEN.Interpolation.Utils.Factorial;\n\n\t\t\treturn fc(n) / fc(i) / fc(n - i);\n\n\t\t},\n\n\t\tFactorial: (function () {\n\n\t\t\tvar a = [1];\n\n\t\t\treturn function (n) {\n\n\t\t\t\tvar s = 1;\n\n\t\t\t\tif (a[n]) {\n\t\t\t\t\treturn a[n];\n\t\t\t\t}\n\n\t\t\t\tfor (var i = n; i > 1; i--) {\n\t\t\t\t\ts *= i;\n\t\t\t\t}\n\n\t\t\t\ta[n] = s;\n\t\t\t\treturn s;\n\n\t\t\t};\n\n\t\t})(),\n\n\t\tCatmullRom: function (p0, p1, p2, p3, t) {\n\n\t\t\tvar v0 = (p2 - p0) * 0.5;\n\t\t\tvar v1 = (p3 - p1) * 0.5;\n\t\t\tvar t2 = t * t;\n\t\t\tvar t3 = t * t2;\n\n\t\t\treturn (2 * p1 - 2 * p2 + v0 + v1) * t3 + (- 3 * p1 + 3 * p2 - 2 * v0 - v1) * t2 + v0 * t + p1;\n\n\t\t}\n\n\t}\n\n};\n\n// UMD (Universal Module Definition)\n(function (root) {\n\n\t{\n\n\t\t// Node.js\n\t\tmodule.exports = TWEEN;\n\n\t}\n\n})();\n});\n\n/**\n * @classdesc Information spot attached to panorama\n * @constructor\n * @param {number} [scale=300] - Default scale\n * @param {string} [imageSrc=PANOLENS.DataImage.Info] - Image overlay info\n * @param {boolean} [animated=true] - Enable default hover animation\n */\nfunction Infospot ( scale = 300, imageSrc, animated ) {\n\t\n    const duration = 500, scaleFactor = 1.3;\n\n    imageSrc = imageSrc || DataImage.Info;\n\n    Sprite.call( this );\n\n    this.type = 'infospot';\n\n    this.animated = animated !== undefined ? animated : true;\n    this.isHovering = false;\n\n    /*\n     * TODO: Three.js bug hotfix for sprite raycasting r104\n     * https://github.com/mrdoob/three.js/issues/14624\n     */\n    this.frustumCulled = false;\n\n    this.element = null;\n    this.toPanorama = null;\n    this.cursorStyle = null;\n\n    this.mode = MODES.NORMAL;\n\n    this.scale.set( scale, scale, 1 );\n    this.rotation.y = Math.PI;\n\n    this.container = null;\n\n    this.originalRaycast = this.raycast;\n\n    // Event Handler\n    this.HANDLER_FOCUS = null;\t\n\n    this.material.side = DoubleSide;\n    this.material.depthTest = false;\n    this.material.transparent = true;\n    this.material.opacity = 0;\n\n    this.scaleUpAnimation = new Tween.Tween();\n    this.scaleDownAnimation = new Tween.Tween();\n\n\n    const postLoad = function ( texture ) {\n\n        if ( !this.material ) { return; }\n\n        const ratio = texture.image.width / texture.image.height;\n        const textureScale = new Vector3();\n\n        texture.image.width = texture.image.naturalWidth || 64;\n        texture.image.height = texture.image.naturalHeight || 64;\n\n        this.scale.set( ratio * scale, scale, 1 );\n\n        textureScale.copy( this.scale );\n\n        this.scaleUpAnimation = new Tween.Tween( this.scale )\n            .to( { x: textureScale.x * scaleFactor, y: textureScale.y * scaleFactor }, duration )\n            .easing( Tween.Easing.Elastic.Out );\n\n        this.scaleDownAnimation = new Tween.Tween( this.scale )\n            .to( { x: textureScale.x, y: textureScale.y }, duration )\n            .easing( Tween.Easing.Elastic.Out );\n\n        this.material.map = texture;\n        this.material.needsUpdate = true;\n\n    }.bind( this );\n\n    // Add show and hide animations\n    this.showAnimation = new Tween.Tween( this.material )\n        .to( { opacity: 1 }, duration )\n        .onStart( this.enableRaycast.bind( this, true ) )\n        .easing( Tween.Easing.Quartic.Out );\n\n    this.hideAnimation = new Tween.Tween( this.material )\n        .to( { opacity: 0 }, duration )\n        .onStart( this.enableRaycast.bind( this, false ) )\n        .easing( Tween.Easing.Quartic.Out );\n\n    // Attach event listeners\n    this.addEventListener( 'click', this.onClick );\n    this.addEventListener( 'hover', this.onHover );\n    this.addEventListener( 'hoverenter', this.onHoverStart );\n    this.addEventListener( 'hoverleave', this.onHoverEnd );\n    this.addEventListener( 'panolens-dual-eye-effect', this.onDualEyeEffect );\n    this.addEventListener( 'panolens-container', this.setContainer.bind( this ) );\n    this.addEventListener( 'dismiss', this.onDismiss );\n    this.addEventListener( 'panolens-infospot-focus', this.setFocusMethod );\n\n    TextureLoader.load( imageSrc, postLoad );\t\n\n}\nInfospot.prototype = Object.assign( Object.create( Sprite.prototype ), {\n\n    constructor: Infospot,\n\n    /**\n     * Set infospot container\n     * @param {HTMLElement|object} data - Data with container information\n     * @memberOf Infospot\n     * @instance\n     */\n    setContainer: function ( data ) {\n\n        let container;\n\t\n        if ( data instanceof HTMLElement ) {\n\t\n            container = data;\n\t\n        } else if ( data && data.container ) {\n\t\n            container = data.container;\n\t\n        }\n\t\n        // Append element if exists\n        if ( container && this.element ) {\n\t\n            container.appendChild( this.element );\n\t\n        }\n\t\n        this.container = container;\n\t\n    },\n\n    /**\n     * Get container\n     * @memberOf Infospot\n     * @instance\n     * @return {HTMLElement} - The container of this infospot\n     */\n    getContainer: function () {\n\n        return this.container;\n\n    },\n\n    /**\n     * This will be called by a click event\n     * Translate and lock the hovering element if any\n     * @param  {object} event - Event containing mouseEvent with clientX and clientY\n     * @memberOf Infospot\n     * @instance\n     */\n    onClick: function ( event ) {\n\n        if ( this.element && this.getContainer() ) {\n\n            this.onHoverStart( event );\n\n            // Lock element\n            this.lockHoverElement();\n\n        }\n\n    },\n\n    /**\n     * Dismiss current element if any\n     * @param  {object} event - Dismiss event\n     * @memberOf Infospot\n     * @instance\n     */\n    onDismiss: function () {\n\n        if ( this.element ) {\n\n            this.unlockHoverElement();\n            this.onHoverEnd();\n\n        }\n\n    },\n\n    /**\n     * This will be called by a mouse hover event\n     * Translate the hovering element if any\n     * @param  {object} event - Event containing mouseEvent with clientX and clientY\n     * @memberOf Infospot\n     * @instance\n     */\n    onHover: function () {},\n\n    /**\n     * This will be called on a mouse hover start\n     * Sets cursor style to 'pointer', display the element and scale up the infospot\n     * @param {object} event\n     * @memberOf Infospot\n     * @instance\n     */\n    onHoverStart: function ( event ) {\n\n        if ( !this.getContainer() ) { return; }\n\n        const cursorStyle = this.cursorStyle || ( this.mode === MODES.NORMAL ? 'pointer' : 'default' );\n        const { scaleDownAnimation, scaleUpAnimation, element } = this;\n\n        this.isHovering = true;\n        this.container.style.cursor = cursorStyle;\n\t\t\n        if ( this.animated ) {\n\n            scaleDownAnimation.stop();\n            scaleUpAnimation.start();\n\n        }\n\t\t\n        if ( element && event.mouseEvent.clientX >= 0 && event.mouseEvent.clientY >= 0 ) {\n\n            const { left, right, style } = element;\n\n            if ( this.mode === MODES.CARDBOARD || this.mode === MODES.STEREO ) {\n\n                style.display = 'none';\n                left.style.display = 'block';\n                right.style.display = 'block';\n\n                // Store element width for reference\n                element._width = left.clientWidth;\n                element._height = left.clientHeight;\n\n            } else {\n\n                style.display = 'block';\n                if ( left ) { left.style.display = 'none'; }\n                if ( right ) { right.style.display = 'none'; }\n\n                // Store element width for reference\n                element._width = element.clientWidth;\n                element._height = element.clientHeight;\n\n            }\n\t\t\t\n        }\n\n    },\n\n    /**\n     * This will be called on a mouse hover end\n     * Sets cursor style to 'default', hide the element and scale down the infospot\n     * @memberOf Infospot\n     * @instance\n     */\n    onHoverEnd: function () {\n\n        if ( !this.getContainer() ) { return; }\n\n        const { scaleDownAnimation, scaleUpAnimation, element } = this;\n\n        this.isHovering = false;\n        this.container.style.cursor = 'default';\n\n        if ( this.animated ) {\n\n            scaleUpAnimation.stop();\n            scaleDownAnimation.start();\n\n        }\n\n        if ( element && !this.element.locked ) {\n\n            const { left, right, style } = element;\n\n            style.display = 'none';\n            if ( left ) { left.style.display = 'none'; }\n            if ( right ) { right.style.display = 'none'; }\n\n            this.unlockHoverElement();\n\n        }\n\n    },\n\n    /**\n     * On dual eye effect handler\n     * Creates duplicate left and right element\n     * @param  {object} event - panolens-dual-eye-effect event\n     * @memberOf Infospot\n     * @instance\n     */\n    onDualEyeEffect: function ( event ) {\n\t\t\n        if ( !this.getContainer() ) { return; }\n\n        let element, halfWidth, halfHeight;\n\n        this.mode = event.mode;\n\n        element = this.element;\n\n        halfWidth = this.container.clientWidth / 2;\n        halfHeight = this.container.clientHeight / 2;\n\n        if ( !element ) {\n\n            return;\n\n        }\n\n        if ( !element.left && !element.right ) {\n\n            element.left = element.cloneNode( true );\n            element.right = element.cloneNode( true );\n\n        }\n\n        if ( this.mode === MODES.CARDBOARD || this.mode === MODES.STEREO ) {\n\n            element.left.style.display = element.style.display;\n            element.right.style.display = element.style.display;\n            element.style.display = 'none';\n\n        } else {\n\n            element.style.display = element.left.style.display;\n            element.left.style.display = 'none';\n            element.right.style.display = 'none';\n\n        }\n\n        // Update elements translation\n        this.translateElement( halfWidth, halfHeight );\n\n        this.container.appendChild( element.left );\n        this.container.appendChild( element.right );\n\n    },\n\n    /**\n     * Translate the hovering element by css transform\n     * @param  {number} x - X position on the window screen\n     * @param  {number} y - Y position on the window screen\n     * @memberOf Infospot\n     * @instance\n     */\n    translateElement: function ( x, y ) {\n\n        if ( !this.element._width || !this.element._height || !this.getContainer() ) {\n\n            return;\n\n        }\n\n        let left, top, element, width, height, delta, container;\n\n        container = this.container;\n        element = this.element;\n        width = element._width / 2;\n        height = element._height / 2;\n        delta = element.verticalDelta !== undefined ? element.verticalDelta : 40;\n\n        left = x - width;\n        top = y - height - delta;\n\n        if ( ( this.mode === MODES.CARDBOARD || this.mode === MODES.STEREO ) \n\t\t\t\t&& element.left && element.right\n\t\t\t\t&& !( x === container.clientWidth / 2 && y === container.clientHeight / 2 ) ) {\n\n            left = container.clientWidth / 4 - width + ( x - container.clientWidth / 2 );\n            top = container.clientHeight / 2 - height - delta + ( y - container.clientHeight / 2 );\n\n            this.setElementStyle( 'transform', element.left, 'translate(' + left + 'px, ' + top + 'px)' );\n\n            left += container.clientWidth / 2;\n\n            this.setElementStyle( 'transform', element.right, 'translate(' + left + 'px, ' + top + 'px)' );\n\n        } else {\n\n            this.setElementStyle( 'transform', element, 'translate(' + left + 'px, ' + top + 'px)' );\n\n        }\n\n    },\n\n    /**\n     * Set vendor specific css\n     * @param {string} type - CSS style name\n     * @param {HTMLElement} element - The element to be modified\n     * @param {string} value - Style value\n     * @memberOf Infospot\n     * @instance\n     */\n    setElementStyle: function ( type, element, value ) {\n\n        const style = element.style;\n\n        if ( type === 'transform' ) {\n\n            style.webkitTransform = style.msTransform = style.transform = value;\n\n        }\n\n    },\n\n    /**\n     * Set hovering text content\n     * @param {string} text - Text to be displayed\n     * @memberOf Infospot\n     * @instance\n     */\n    setText: function ( text ) {\n\n        if ( this.element ) {\n\n            this.element.textContent = text;\n\n        }\n\n    },\n\n    /**\n     * Set cursor css style on hover\n     * @memberOf Infospot\n     * @instance\n     */\n    setCursorHoverStyle: function ( style ) {\n\n        this.cursorStyle = style;\n\n    },\n\n    /**\n     * Add hovering text element\n     * @param {string} text - Text to be displayed\n     * @param {number} [delta=40] - Vertical delta to the infospot\n     * @memberOf Infospot\n     * @instance\n     */\n    addHoverText: function ( text, delta = 40 ) {\n\n        if ( !this.element ) {\n\n            this.element = document.createElement( 'div' );\n            this.element.style.display = 'none';\n            this.element.style.color = '#fff';\n            this.element.style.top = 0;\n            this.element.style.maxWidth = '50%';\n            this.element.style.maxHeight = '50%';\n            this.element.style.textShadow = '0 0 3px #000000';\n            this.element.style.fontFamily = '\"Trebuchet MS\", Helvetica, sans-serif';\n            this.element.style.position = 'absolute';\n            this.element.classList.add( 'panolens-infospot' );\n            this.element.verticalDelta = delta;\n\n        }\n\n        this.setText( text );\n\n    },\n\n    /**\n     * Add hovering element by cloning an element\n     * @param {HTMLDOMElement} el - Element to be cloned and displayed\n     * @param {number} [delta=40] - Vertical delta to the infospot\n     * @memberOf Infospot\n     * @instance\n     */\n    addHoverElement: function ( el, delta = 40 ) {\n\n        if ( !this.element ) { \n\n            this.element = el.cloneNode( true );\n            this.element.style.display = 'none';\n            this.element.style.top = 0;\n            this.element.style.position = 'absolute';\n            this.element.classList.add( 'panolens-infospot' );\n            this.element.verticalDelta = delta;\n\n        }\n\n    },\n\n    /**\n     * Remove hovering element\n     * @memberOf Infospot\n     * @instance\n     */\n    removeHoverElement: function () {\n\n        if ( this.element ) { \n\n            if ( this.element.left ) {\n\n                this.container.removeChild( this.element.left );\n                this.element.left = null;\n\n            }\n\n            if ( this.element.right ) {\n\n                this.container.removeChild( this.element.right );\n                this.element.right = null;\n\n            }\n\n            this.container.removeChild( this.element );\n            this.element = null;\n\n        }\n\n    },\n\n    /**\n     * Lock hovering element\n     * @memberOf Infospot\n     * @instance\n     */\n    lockHoverElement: function () {\n\n        if ( this.element ) { \n\n            this.element.locked = true;\n\n        }\n\n    },\n\n    /**\n     * Unlock hovering element\n     * @memberOf Infospot\n     * @instance\n     */\n    unlockHoverElement: function () {\n\n        if ( this.element ) { \n\n            this.element.locked = false;\n\n        }\n\n    },\n\n    /**\n     * Enable raycasting\n     * @param {boolean} [enabled=true]\n     * @memberOf Infospot\n     * @instance\n     */\n    enableRaycast: function ( enabled = true ) {\n\n        if ( enabled ) {\n\n            this.raycast = this.originalRaycast;\n\n        } else {\n\n            this.raycast = () => {};\n\n        }\n\n    },\n\n    /**\n     * Show infospot\n     * @param  {number} [delay=0] - Delay time to show\n     * @memberOf Infospot\n     * @instance\n     */\n    show: function ( delay = 0 ) {\n\n        const { animated, hideAnimation, showAnimation, material } = this;\n\n        if ( animated ) {\n\n            hideAnimation.stop();\n            showAnimation.delay( delay ).start();\n\n        } else {\n\n            this.enableRaycast( true );\n            material.opacity = 1;\n\n        }\n\n    },\n\n    /**\n     * Hide infospot\n     * @param  {number} [delay=0] - Delay time to hide\n     * @memberOf Infospot\n     * @instance\n     */\n    hide: function ( delay = 0 ) {\n\n        const { animated, hideAnimation, showAnimation, material, element } = this;\n\n        if ( element ) {\n            const { style } = element;\n            style.display = 'none';\n        }\n\n        if ( animated ) {\n\n            showAnimation.stop();\n            hideAnimation.delay( delay ).start();\n\n        } else {\n\n            this.enableRaycast( false );\n            material.opacity = 0;\n\n        }\n\t\t\n    },\n\n    /**\n     * Set focus event handler\n     * @memberOf Infospot\n     * @instance\n     */\n    setFocusMethod: function ( event ) {\n\n        if ( event ) {\n\n            this.HANDLER_FOCUS = event.method;\n\n        }\n\n    },\n\n    /**\n     * Focus camera center to this infospot\n     * @param {number} [duration=1000] - Duration to tween\n     * @param {function} [easing=TWEEN.Easing.Exponential.Out] - Easing function\n     * @memberOf Infospot\n     * @instance\n     */\n    focus: function ( duration, easing ) {\n\n        if ( this.HANDLER_FOCUS ) {\n\n            this.HANDLER_FOCUS( this.position, duration, easing );\n            this.onDismiss();\n\n        }\n\n    },\n\n    /**\n     * Dispose\n     * @memberOf Infospot\n     * @instance\n     */\n    dispose: function () {\n\n        const { geometry, material } = this;\n        const { map } = material;\n\n        this.removeHoverElement();\n\n        if ( this.parent ) {\n\n            this.parent.remove( this );\n\n        }\n\n        if ( map ) { map.dispose(); material.map = null; }\n        if ( geometry ) { geometry.dispose(); this.geometry = null; }\n        if ( material ) { material.dispose(); this.material = null; }\n\n    }\n\n} );\n\n/**\n * @classdesc Widget for controls\n * @constructor\n * @param {HTMLElement} container - A domElement where default control widget will be attached to\n */\nfunction Widget ( container ) {\n\n    if ( !container ) {\n\n        console.warn( 'PANOLENS.Widget: No container specified' );\n\n    }\n\n    EventDispatcher.call( this );\n\n    this.DEFAULT_TRANSITION  = 'all 0.27s ease';\n    this.TOUCH_ENABLED = !!(( 'ontouchstart' in window ) || window.DocumentTouch && document instanceof DocumentTouch);\n    this.PREVENT_EVENT_HANDLER = function ( event ) {\n        event.preventDefault();\n        event.stopPropagation();\n    };\n\n    this.container = container;\n\n    this.barElement = null;\n    this.fullscreenElement = null;\n    this.videoElement = null;\n    this.settingElement = null;\n\n    this.mainMenu = null;\n\n    this.activeMainItem = null;\n    this.activeSubMenu = null;\n    this.mask = null;\n\n}\n\nWidget.prototype = Object.assign( Object.create( EventDispatcher.prototype ), {\n\n    constructor: Widget,\n\n    /**\n     * Add control bar\n     * @memberOf Widget\n     * @instance\n     */\n    addControlBar: function () {\n\n        if ( !this.container ) {\n\n            console.warn( 'Widget container not set' ); \n            return; \n        }\n\n        var scope = this, bar, styleTranslate, styleOpacity, gradientStyle;\n\n        gradientStyle = 'linear-gradient(bottom, rgba(0,0,0,0.2), rgba(0,0,0,0))';\n\n        bar = document.createElement( 'div' );\n        bar.style.width = '100%';\n        bar.style.height = '44px';\n        bar.style.float = 'left';\n        bar.style.transform = bar.style.webkitTransform = bar.style.msTransform = 'translateY(-100%)';\n        bar.style.background = '-webkit-' + gradientStyle;\n        bar.style.background = '-moz-' + gradientStyle;\n        bar.style.background = '-o-' + gradientStyle;\n        bar.style.background = '-ms-' + gradientStyle;\n        bar.style.background = gradientStyle;\n        bar.style.transition = this.DEFAULT_TRANSITION;\n        bar.style.pointerEvents = 'none';\n        bar.isHidden = false;\n        bar.toggle = function () {\n            bar.isHidden = !bar.isHidden;\n            styleTranslate = bar.isHidden ? 'translateY(0)' : 'translateY(-100%)';\n            styleOpacity = bar.isHidden ? 0 : 1;\n            bar.style.transform = bar.style.webkitTransform = bar.style.msTransform = styleTranslate;\n            bar.style.opacity = styleOpacity;\n        };\n\n        // Menu\n        var menu = this.createDefaultMenu();\n        this.mainMenu = this.createMainMenu( menu );\n        bar.appendChild( this.mainMenu );\n\n        // Mask\n        var mask = this.createMask();\n        this.mask = mask;\n        this.container.appendChild( mask );\n\n        // Dispose\n        bar.dispose = function () {\n\n            if ( scope.fullscreenElement ) {\n\n                bar.removeChild( scope.fullscreenElement );\n                scope.fullscreenElement.dispose();\n                scope.fullscreenElement = null;\n\n            }\n\n            if ( scope.settingElement ) {\n\n                bar.removeChild( scope.settingElement );\n                scope.settingElement.dispose();\n                scope.settingElement = null;\n\n            }\n\n            if ( scope.videoElement ) {\n\n                bar.removeChild( scope.videoElement );\n                scope.videoElement.dispose();\n                scope.videoElement = null;\n\n            }\n\n        };\n\n        this.container.appendChild( bar );\n\n        // Mask events\n        this.mask.addEventListener( 'mousemove', this.PREVENT_EVENT_HANDLER, true );\n        this.mask.addEventListener( 'mouseup', this.PREVENT_EVENT_HANDLER, true );\n        this.mask.addEventListener( 'mousedown', this.PREVENT_EVENT_HANDLER, true );\n        this.mask.addEventListener( scope.TOUCH_ENABLED ? 'touchend' : 'click', function ( event ) {\n\n            event.preventDefault();\n            event.stopPropagation();\n\n            scope.mask.hide();\n            scope.settingElement.deactivate();\n\n        }, false );\n\n        // Event listener\n        this.addEventListener( 'control-bar-toggle', bar.toggle );\n\n        this.barElement = bar;\n\n    },\n\n    /**\n     * Create default menu\n     * @memberOf Widget\n     * @instance\n     */\n    createDefaultMenu: function () {\n\n        var scope = this, handler;\n\n        handler = function ( method, data ) {\n\n            return function () {\n\n                scope.dispatchEvent( { \n\n                    type: 'panolens-viewer-handler', \n                    method: method, \n                    data: data \n\n                } ); \n\n            };\n\n        };\n\n        return [\n\n            { \n                title: 'Control', \n                subMenu: [ \n                    { \n                        title: this.TOUCH_ENABLED ? 'Touch' : 'Mouse', \n                        handler: handler( 'enableControl', CONTROLS.ORBIT )\n                    },\n                    { \n                        title: 'Sensor', \n                        handler: handler( 'enableControl', CONTROLS.DEVICEORIENTATION ) \n                    } \n                ]\n            },\n\n            { \n                title: 'Mode', \n                subMenu: [ \n                    { \n                        title: 'Normal',\n                        handler: handler( 'disableEffect' )\n                    }, \n                    { \n                        title: 'Cardboard',\n                        handler: handler( 'enableEffect', MODES.CARDBOARD )\n                    },\n                    { \n                        title: 'Stereoscopic',\n                        handler: handler( 'enableEffect', MODES.STEREO )\n                    }\n                ]\n            }\n\n        ];\n\n    },\n\n    /**\n     * Add buttons on top of control bar\n     * @param {string} name - The control button name to be created\n     * @memberOf Widget\n     * @instance\n     */\n    addControlButton: function ( name ) {\n\n        let element;\n\n        switch( name ) {\n\n        case 'fullscreen':\n\n            element = this.createFullscreenButton();\n            this.fullscreenElement = element; \n\n            break;\n\n        case 'setting':\n\n            element = this.createSettingButton();\n            this.settingElement = element;\n\n            break;\n\n        case 'video':\n\n            element = this.createVideoControl();\n            this.videoElement = element;\n\n            break;\n\n        default:\n\n            return;\n\n        }\n\n        if ( !element ) {\n\n            return;\n\n        }\n\n        this.barElement.appendChild( element );\n\n    },\n\n    /**\n     * Create modal mask\n     * @memberOf Widget\n     * @instance\n     */\n    createMask: function () {\n\n        const element = document.createElement( 'div' );\n        element.style.position = 'absolute';\n        element.style.top = 0;\n        element.style.left = 0;\n        element.style.width = '100%';\n        element.style.height = '100%';\n        element.style.background = 'transparent';\n        element.style.display = 'none';\n\n        element.show = function () {\n\n            this.style.display = 'block';\n\n        };\n\n        element.hide = function () {\n\n            this.style.display = 'none';\n\n        };\n\n        return element;\n\n    },\n\n    /**\n     * Create Setting button to toggle menu\n     * @memberOf Widget\n     * @instance\n     */\n    createSettingButton: function () {\n\n        let scope = this, item;\n\n        function onTap ( event ) {\n\n            event.preventDefault();\n            event.stopPropagation();\n\n            scope.mainMenu.toggle();\n\n            if ( this.activated ) {\n\t\n                this.deactivate();\n\n            } else {\n\n                this.activate();\n\n            }\n\n        }\n\n        item = this.createCustomItem( { \n\n            style: { \n\n                backgroundImage: 'url(\"' + DataImage.Setting + '\")',\n                webkitTransition: this.DEFAULT_TRANSITION,\n                transition: this.DEFAULT_TRANSITION\n\n            },\n\n            onTap: onTap\n\n        } );\n\n        item.activate = function () {\n\n            this.style.transform = 'rotate3d(0,0,1,90deg)';\n            this.activated = true;\n            scope.mask.show();\n\n        };\n\n        item.deactivate = function () {\n\n            this.style.transform = 'rotate3d(0,0,0,0)';\n            this.activated = false;\n            scope.mask.hide();\n\n            if ( scope.mainMenu && scope.mainMenu.visible ) {\n\n                scope.mainMenu.hide();\n\t\t\t\t\n            }\n\n            if ( scope.activeSubMenu && scope.activeSubMenu.visible ) {\n\n                scope.activeSubMenu.hide();\n\n            }\n\n            if ( scope.mainMenu && scope.mainMenu._width ) {\n\n                scope.mainMenu.changeSize( scope.mainMenu._width );\n                scope.mainMenu.unslideAll();\n\n            }\n\t\t\t\n        };\n\n        item.activated = false;\n\n        return item;\n\n    },\n\n    /**\n     * Create Fullscreen button\n     * @return {HTMLSpanElement} - The dom element icon for fullscreen\n     * @memberOf Widget\n     * @instance\n     * @fires Widget#panolens-viewer-handler\n     */\n    createFullscreenButton: function () {\n\n        let scope = this, item, isFullscreen = false, tapSkipped = true, stylesheetId;\n\n        const { container } = this;\n\n        stylesheetId = 'panolens-style-addon';\n\n        // Don't create button if no support\n        if ( !document.fullscreenEnabled       && \n\t\t\t!document.webkitFullscreenEnabled &&\n\t\t\t!document.mozFullScreenEnabled    &&\n\t\t\t!document.msFullscreenEnabled ) {\n            return;\n        }\n\n        function onTap ( event ) {\n\n            event.preventDefault();\n            event.stopPropagation();\n\n            tapSkipped = false;\n\n            if ( !isFullscreen ) {\n\n                if ( container.requestFullscreen ) { container.requestFullscreen(); }\n                if ( container.msRequestFullscreen ) { container.msRequestFullscreen(); }\n                if ( container.mozRequestFullScreen ) { container.mozRequestFullScreen(); }\n                if ( container.webkitRequestFullscreen ) { container.webkitRequestFullscreen( Element.ALLOW_KEYBOARD_INPUT ); }\n              \n                isFullscreen = true;\n\n            } else {\n\n                if ( document.exitFullscreen ) { document.exitFullscreen(); }\n                if ( document.msExitFullscreen ) { document.msExitFullscreen(); }\n                if ( document.mozCancelFullScreen ) { document.mozCancelFullScreen(); }\n                if ( document.webkitExitFullscreen ) { document.webkitExitFullscreen( ); }\n\n                isFullscreen = false;\n\n            }\n\n            this.style.backgroundImage = ( isFullscreen ) \n                ? 'url(\"' + DataImage.FullscreenLeave + '\")' \n                : 'url(\"' + DataImage.FullscreenEnter + '\")';\n\n        }\n\n        function onFullScreenChange () {\n\n            if ( tapSkipped ) {\n\n                isFullscreen = !isFullscreen; \n\n                item.style.backgroundImage = ( isFullscreen ) \n                    ? 'url(\"' + DataImage.FullscreenLeave + '\")' \n                    : 'url(\"' + DataImage.FullscreenEnter + '\")';\n\n            }\n\n            /**\n             * Viewer handler event\n             * @type {object}\n             * @event Widget#panolens-viewer-handler\n             * @property {string} method - 'onWindowResize' function call on Viewer\n             */\n            scope.dispatchEvent( { type: 'panolens-viewer-handler', method: 'onWindowResize' } );\n\n            tapSkipped = true;\n\n        }\n\n        document.addEventListener( 'fullscreenchange', onFullScreenChange, false );\n        document.addEventListener( 'webkitfullscreenchange', onFullScreenChange, false );\n        document.addEventListener( 'mozfullscreenchange', onFullScreenChange, false );\n        document.addEventListener( 'MSFullscreenChange', onFullScreenChange, false );\n\n        item = this.createCustomItem( { \n\n            style: { \n\n                backgroundImage: 'url(\"' + DataImage.FullscreenEnter + '\")' \n\n            },\n\n            onTap: onTap\n\n        } );\n\n        // Add fullscreen stlye if not exists\n        if ( !document.querySelector( stylesheetId ) ) {\n            const sheet = document.createElement( 'style' );\n            sheet.id = stylesheetId;\n            sheet.innerHTML = ':-webkit-full-screen { width: 100% !important; height: 100% !important }';\n            document.body.appendChild( sheet );\n        }\n\t\t\n        return item;\n\n    },\n\n    /**\n     * Create video control container\n     * @memberOf Widget\n     * @instance\n     * @return {HTMLSpanElement} - The dom element icon for video control\n     */\n    createVideoControl: function () {\n\n        const item = document.createElement( 'span' );\n        item.style.display = 'none';\n        item.show = function () { \n\n            item.style.display = '';\n\n        };\n\n        item.hide = function () { \n\n            item.style.display = 'none';\n            item.controlButton.paused = true;\n            item.controlButton.update();\n\n        };\n\n        item.controlButton = this.createVideoControlButton();\n        item.seekBar = this.createVideoControlSeekbar();\n\t\t\n        item.appendChild( item.controlButton );\n        item.appendChild( item.seekBar );\n\n        item.dispose = function () {\n\n            item.removeChild( item.controlButton );\n            item.removeChild( item.seekBar );\n\n            item.controlButton.dispose();\n            item.controlButton = null;\n\n            item.seekBar.dispose();\n            item.seekBar = null;\n\n        };\n\n        this.addEventListener( 'video-control-show', item.show );\n        this.addEventListener( 'video-control-hide', item.hide );\n\n        return item;\n\n    },\n\n    /**\n     * Create video control button\n     * @memberOf Widget\n     * @instance\n     * @return {HTMLSpanElement} - The dom element icon for video control\n     * @fires Widget#panolens-viewer-handler\n     */\n    createVideoControlButton: function () {\n\n        const scope = this;\n\n        function onTap ( event ) {\n\n            event.preventDefault();\n            event.stopPropagation();\n\n            /**\n             * Viewer handler event\n             * @type {object}\n             * @event Widget#panolens-viewer-handler\n             * @property {string} method - 'toggleVideoPlay' function call on Viewer\n             */\n            scope.dispatchEvent( { type: 'panolens-viewer-handler', method: 'toggleVideoPlay', data: !this.paused } );\n\n            this.paused = !this.paused;\n\n            item.update();\n\n        }\n        const item = this.createCustomItem( { \n\n            style: { \n\n                float: 'left',\n                backgroundImage: 'url(\"' + DataImage.VideoPlay + '\")'\n\n            },\n\n            onTap: onTap\n\n        } );\n\n        item.paused = true;\n\n        item.update = function ( paused ) {\n\n            this.paused = paused !== undefined ? paused : this.paused;\n\n            this.style.backgroundImage = 'url(\"' + ( this.paused \n                ? DataImage.VideoPlay \n                : DataImage.VideoPause ) + '\")';\n\n        };\n\n        return item;\n\n    },\n\n    /**\n     * Create video seekbar\n     * @memberOf Widget\n     * @instance\n     * @return {HTMLSpanElement} - The dom element icon for video seekbar\n     * @fires Widget#panolens-viewer-handler\n     */\n    createVideoControlSeekbar: function () {\n\n        let scope = this, item, progressElement, progressElementControl,\n            isDragging = false, mouseX, percentageNow, percentageNext;\n\n        progressElement = document.createElement( 'div' );\n        progressElement.style.width = '0%';\n        progressElement.style.height = '100%';\n        progressElement.style.backgroundColor = '#fff';\n\n        progressElementControl = document.createElement( 'div' );\n        progressElementControl.style.float = 'right';\n        progressElementControl.style.width = '14px';\n        progressElementControl.style.height = '14px';\n        progressElementControl.style.transform = 'translate(7px, -5px)';\n        progressElementControl.style.borderRadius = '50%';\n        progressElementControl.style.backgroundColor = '#ddd';\n\n        progressElementControl.addEventListener( 'mousedown', onMouseDown, { passive: true } );\n        progressElementControl.addEventListener( 'touchstart', onMouseDown,  { passive: true } );\n\n        function onMouseDown ( event ) {\n\n            event.stopPropagation();\n\t\t\t\n            isDragging = true;\n\t\t\t\n            mouseX = event.clientX || ( event.changedTouches && event.changedTouches[0].clientX );\n\n            percentageNow = parseInt( progressElement.style.width ) / 100;\n\n            addControlListeners();\n        }\n\n        function onVideoControlDrag ( event ) {\n\n            if( isDragging ){\n\n                const clientX = event.clientX || ( event.changedTouches && event.changedTouches[0].clientX );\n\t\t\t\t\n                percentageNext = ( clientX - mouseX ) / item.clientWidth;\n\n                percentageNext = percentageNow + percentageNext;\n\n                percentageNext = percentageNext > 1 ? 1 : ( ( percentageNext < 0 ) ? 0 : percentageNext );\n\n                item.setProgress ( percentageNext );\n\n                /**\n                 * Viewer handler event\n                 * @type {object}\n                 * @event Widget#panolens-viewer-handler\n                 * @property {string} method - 'setVideoCurrentTime' function call on Viewer\n                 * @property {number} data - Percentage of current video. Range from 0.0 to 1.0\n                 */\n                scope.dispatchEvent( { type: 'panolens-viewer-handler', method: 'setVideoCurrentTime', data: percentageNext } );\n\n            }\n\n        }\n\n        function onVideoControlStop ( event ) {\n\n            event.stopPropagation();\n\n            isDragging = false;\n\n            removeControlListeners();\n\n        }\n\n        function addControlListeners () {\n\n            scope.container.addEventListener( 'mousemove', onVideoControlDrag, { passive: true } );\n            scope.container.addEventListener( 'mouseup', onVideoControlStop, { passive: true } );\n            scope.container.addEventListener( 'touchmove', onVideoControlDrag, { passive: true } );\n            scope.container.addEventListener( 'touchend', onVideoControlStop, { passive: true } );\n\n\n        }\n\n        function removeControlListeners () {\n\n            scope.container.removeEventListener( 'mousemove', onVideoControlDrag, false );\n            scope.container.removeEventListener( 'mouseup', onVideoControlStop, false );\n            scope.container.removeEventListener( 'touchmove', onVideoControlDrag, false );\n            scope.container.removeEventListener( 'touchend', onVideoControlStop, false );\n\n        }\n\n        function onTap ( event ) {\n\n            event.preventDefault();\n            event.stopPropagation();\n\n            if ( event.target === progressElementControl ) { return; }\n\n            const percentage = ( event.changedTouches && event.changedTouches.length > 0 )\n                ? ( event.changedTouches[0].pageX - event.target.getBoundingClientRect().left ) / this.clientWidth\n                : event.offsetX / this.clientWidth;\n\n            /**\n             * Viewer handler event\n             * @type {object}\n             * @property {string} method - 'setVideoCurrentTime' function call on Viewer\n             * @property {number} data - Percentage of current video. Range from 0.0 to 1.0\n             */\n            scope.dispatchEvent( { type: 'panolens-viewer-handler', method: 'setVideoCurrentTime', data: percentage } );\n\n            item.setProgress( event.offsetX / this.clientWidth );\n\n        }\n        function onDispose () {\n\n            removeControlListeners();\n            progressElement = null;\n            progressElementControl = null;\n\n        }\n\n        progressElement.appendChild( progressElementControl );\n\n        item = this.createCustomItem( {\n\n            style: { \n\n                float: 'left',\n                width: '30%',\n                height: '4px',\n                marginTop: '20px',\n                backgroundColor: 'rgba(188,188,188,0.8)'\n\n            },\n\n            onTap: onTap,\n            onDispose: onDispose\n\n        } );\n\n        item.appendChild( progressElement );\n\n        item.setProgress = function( percentage ) {\n\n            progressElement.style.width = percentage * 100 + '%';\n\n        };\t\t\n\n        this.addEventListener( 'video-update', function ( event ) { \n\n            item.setProgress( event.percentage ); \n\n        } );\n\n        item.progressElement = progressElement;\n        item.progressElementControl = progressElementControl;\n\n        return item;\n\n    },\n\n    /**\n     * Create menu item\n     * @param  {string} title - Title to display\n     * @memberOf Widget\n     * @instance\n     * @return {HTMLElement} - An anchor tag element\n     */\n    createMenuItem: function ( title ) {\n\n        const scope = this; \n        const item = document.createElement( 'a' );\n        item.textContent = title;\n        item.style.display = 'block';\n        item.style.padding = '10px';\n        item.style.textDecoration = 'none';\n        item.style.cursor = 'pointer';\n        item.style.pointerEvents = 'auto';\n        item.style.transition = this.DEFAULT_TRANSITION;\n\n        item.slide = function ( right ) {\n\n            this.style.transform = 'translateX(' + ( right ? '' : '-' ) + '100%)';\n\n        };\n\n        item.unslide = function () {\n\n            this.style.transform = 'translateX(0)';\n\n        };\n\n        item.setIcon = function ( url ) {\n\n            if ( this.icon ) {\n\n                this.icon.style.backgroundImage = 'url(' + url + ')';\n\n            }\n\n        };\n\n        item.setSelectionTitle = function ( title ) {\n\n            if ( this.selection ) {\n\n                this.selection.textContent = title;\n\n            }\n\n        };\n\n        item.addSelection = function ( name ) {\n\t\t\t\n            const selection = document.createElement( 'span' );\n            selection.style.fontSize = '13px';\n            selection.style.fontWeight = '300';\n            selection.style.float = 'right';\n\n            this.selection = selection;\n            this.setSelectionTitle( name );\n            this.appendChild( selection );\n\t\t\t\n            return this;\n\n        };\n\n        item.addIcon = function ( url = DataImage.ChevronRight, left = false, flip = false ) {\n\t\t\t\n            const element = document.createElement( 'span' );\n            element.style.float = left ? 'left' : 'right';\n            element.style.width = '17px';\n            element.style.height = '17px';\n            element.style[ 'margin' + ( left ? 'Right' : 'Left' ) ] = '12px';\n            element.style.backgroundSize = 'cover';\n\n            if ( flip ) {\n\n                element.style.transform = 'rotateZ(180deg)';\n\n            }\n\n            this.icon = element;\n            this.setIcon( url );\n            this.appendChild( element );\n\n            return this;\n\n        };\n\n        item.addSubMenu = function ( title, items ) {\n\n            this.subMenu = scope.createSubMenu( title, items );\n\n            return this;\n\n        };\n\n        item.addEventListener( 'mouseenter', function () {\n\t\t\t\n            this.style.backgroundColor = '#e0e0e0';\n\n        }, false );\n\n        item.addEventListener( 'mouseleave', function () {\n\t\t\t\n            this.style.backgroundColor = '#fafafa';\n\n        }, false );\n\n        return item;\n\n    },\n\n    /**\n     * Create menu item header\n     * @param  {string} title - Title to display\n     * @memberOf Widget\n     * @instance\n     * @return {HTMLElement} - An anchor tag element\n     */\n    createMenuItemHeader: function ( title ) {\n\n        const header = this.createMenuItem( title );\n\n        header.style.borderBottom = '1px solid #333';\n        header.style.paddingBottom = '15px';\n\n        return header;\n\n    },\n\n    /**\n     * Create main menu\n     * @param  {array} menus - Menu array list\n     * @memberOf Widget\n     * @instance\n     * @return {HTMLElement} - A span element\n     */\n    createMainMenu: function ( menus ) {\n\t\t\n        let scope = this, menu = this.createMenu();\n\n        menu._width = 200;\n        menu.changeSize( menu._width );\n\n        function onTap ( event ) {\n\n            event.preventDefault();\n            event.stopPropagation();\n\n            let mainMenu = scope.mainMenu, subMenu = this.subMenu;\n\n            function onNextTick () {\n\n                mainMenu.changeSize( subMenu.clientWidth );\n                subMenu.show();\n                subMenu.unslideAll();\n\n            }\n\n            mainMenu.hide();\n            mainMenu.slideAll();\n            mainMenu.parentElement.appendChild( subMenu );\n\n            scope.activeMainItem = this;\n            scope.activeSubMenu = subMenu;\n\n            window.requestAnimationFrame( onNextTick );\n\n        }\n        for ( var i = 0; i < menus.length; i++ ) {\n\n            var item = menu.addItem( menus[ i ].title );\n\n            item.style.paddingLeft = '20px';\n\n            item.addIcon()\n                .addEventListener( scope.TOUCH_ENABLED ? 'touchend' : 'click', onTap, false );\n\n            if ( menus[ i ].subMenu && menus[ i ].subMenu.length > 0 ) {\n\n                var title = menus[ i ].subMenu[ 0 ].title;\n\n                item.addSelection( title )\n                    .addSubMenu( menus[ i ].title, menus[ i ].subMenu );\n\n            }\n\n        }\n\n        return menu;\n\n    },\n\n    /**\n     * Create sub menu\n     * @param {string} title - Sub menu title\n     * @param {array} items - Item array list\n     * @memberOf Widget\n     * @instance\n     * @return {HTMLElement} - A span element\n     */\n    createSubMenu: function ( title, items ) {\n\n        let scope = this, menu, subMenu = this.createMenu();\n\n        subMenu.items = items;\n        subMenu.activeItem = null;\n\n        function onTap ( event ) {\n\n            event.preventDefault();\n            event.stopPropagation();\n\n            menu = scope.mainMenu;\n            menu.changeSize( menu._width );\n            menu.unslideAll();\n            menu.show();\n            subMenu.slideAll( true );\n            subMenu.hide();\n\n            if ( this.type !== 'header' ) {\n\n                subMenu.setActiveItem( this );\n                scope.activeMainItem.setSelectionTitle( this.textContent );\n\n                if ( this.handler ) { this.handler(); }\n\n            }\n\n        }\n\n        subMenu.addHeader( title ).addIcon( undefined, true, true ).addEventListener( scope.TOUCH_ENABLED ? 'touchend' : 'click', onTap, false );\n\n        for ( let i = 0; i < items.length; i++ ) {\n\n            const item = subMenu.addItem( items[ i ].title );\n\n            item.style.fontWeight = 300;\n            item.handler = items[ i ].handler;\n            item.addIcon( ' ', true );\n            item.addEventListener( scope.TOUCH_ENABLED ? 'touchend' : 'click', onTap, false );\n\n            if ( !subMenu.activeItem ) {\n\n                subMenu.setActiveItem( item );\n\n            }\n\n        }\n\n        subMenu.slideAll( true );\n\n        return subMenu;\n\t\t\n    },\n\n    /**\n     * Create general menu\n     * @memberOf Widget\n     * @instance\n     * @return {HTMLElement} - A span element\n     */\n    createMenu: function () {\n\n        const scope = this;\n        const menu = document.createElement( 'span' );\n        const style = menu.style;\n\n        style.padding = '5px 0';\n        style.position = 'fixed';\n        style.bottom = '100%';\n        style.right = '14px';\n        style.backgroundColor = '#fafafa';\n        style.fontFamily = 'Helvetica Neue';\n        style.fontSize = '14px';\n        style.visibility = 'hidden';\n        style.opacity = 0;\n        style.boxShadow = '0 0 12pt rgba(0,0,0,0.25)';\n        style.borderRadius = '2px';\n        style.overflow = 'hidden';\n        style.willChange = 'width, height, opacity';\n        style.pointerEvents = 'auto';\n        style.transition = this.DEFAULT_TRANSITION;\n\n        menu.visible = false;\n\n        menu.changeSize = function ( width, height ) {\n\n            if ( width ) {\n\n                this.style.width = width + 'px';\n\n            }\n\n            if ( height ) {\n\n                this.style.height = height + 'px';\n\n            }\n\n        };\n\n        menu.show = function () {\n\n            this.style.opacity = 1;\n            this.style.visibility = 'visible';\n            this.visible = true;\n\n        };\n\n        menu.hide = function () {\n\n            this.style.opacity = 0;\n            this.style.visibility = 'hidden';\n            this.visible = false;\n\n        };\n\n        menu.toggle = function () {\n\n            if ( this.visible ) {\n\n                this.hide();\n\n            } else {\n\n                this.show();\n\n            }\n\n        };\n\n        menu.slideAll = function ( right ) {\n\n            for ( let i = 0; i < menu.children.length; i++ ){\n\n                if ( menu.children[ i ].slide ) {\n\n                    menu.children[ i ].slide( right );\n\n                }\n\n            }\n\n        };\n\n        menu.unslideAll = function () {\n\n            for ( let i = 0; i < menu.children.length; i++ ){\n\n                if ( menu.children[ i ].unslide ) {\n\n                    menu.children[ i ].unslide();\n\n                }\n\n            }\n\n        };\n\n        menu.addHeader = function ( title ) {\n\n            const header = scope.createMenuItemHeader( title );\n            header.type = 'header';\n\n            this.appendChild( header );\n\n            return header;\n\n        };\n\n        menu.addItem = function ( title ) {\n\n            const item = scope.createMenuItem( title );\n            item.type = 'item';\n\n            this.appendChild( item );\n\n            return item;\n\n        };\n\n        menu.setActiveItem = function ( item ) {\n\n            if ( this.activeItem ) {\n\n                this.activeItem.setIcon( ' ' );\n\n            }\n\n            item.setIcon( DataImage.Check );\n\n            this.activeItem = item;\n\n        };\n\n        menu.addEventListener( 'mousemove', this.PREVENT_EVENT_HANDLER, true );\n        menu.addEventListener( 'mouseup', this.PREVENT_EVENT_HANDLER, true );\n        menu.addEventListener( 'mousedown', this.PREVENT_EVENT_HANDLER, true );\n\n        return menu;\n\n    },\n\n    /**\n     * Create custom item element\n     * @memberOf Widget\n     * @instance\n     * @return {HTMLSpanElement} - The dom element icon\n     */\n    createCustomItem: function ( options = {} ) {\n\n        const scope = this;\n        const item = options.element || document.createElement( 'span' );\n        const { onDispose } = options;\n\n        item.style.cursor = 'pointer';\n        item.style.float = 'right';\n        item.style.width = '44px';\n        item.style.height = '100%';\n        item.style.backgroundSize = '60%';\n        item.style.backgroundRepeat = 'no-repeat';\n        item.style.backgroundPosition = 'center';\n        item.style.webkitUserSelect = \n\t\titem.style.MozUserSelect = \n\t\titem.style.userSelect = 'none';\n        item.style.position = 'relative';\n        item.style.pointerEvents = 'auto';\n\n        // White glow on icon\n        item.addEventListener( scope.TOUCH_ENABLED ? 'touchstart' : 'mouseenter', function() {\n            item.style.filter = \n\t\t\titem.style.webkitFilter = 'drop-shadow(0 0 5px rgba(255,255,255,1))';\n        }, { passive: true });\n        item.addEventListener( scope.TOUCH_ENABLED ? 'touchend' : 'mouseleave', function() {\n            item.style.filter = \n\t\t\titem.style.webkitFilter = '';\n        }, { passive: true });\n\n        this.mergeStyleOptions( item, options.style );\n\n        if ( options.onTap ) {\n\n            item.addEventListener( scope.TOUCH_ENABLED ? 'touchend' : 'click', options.onTap, false );\n\n        }\n\n        item.dispose = function () {\n\n            item.removeEventListener( scope.TOUCH_ENABLED ? 'touchend' : 'click', options.onTap, false );\n\n            if ( onDispose ) { options.onDispose(); }\n\n        };\n\t\t\n        return item;\n\n    },\n\n    /**\n     * Merge item css style\n     * @param  {HTMLElement} element - The element to be merged with style\n     * @param  {object} options - The style options\n     * @memberOf Widget\n     * @instance\n     * @return {HTMLElement} - The same element with merged styles\n     */\n    mergeStyleOptions: function ( element, options = {} ) {\n\n        for ( let property in options ){\n\n            if ( options.hasOwnProperty( property ) ) {\n\n                element.style[ property ] = options[ property ];\n\n            }\n\n        }\n\n        return element;\n\n    },\n\n    /**\n     * Dispose widgets by detaching dom elements from container\n     * @memberOf Widget\n     * @instance\n     */\n    dispose: function () {\n\n        if ( this.barElement ) {\n            this.container.removeChild( this.barElement );\n            this.barElement.dispose();\n            this.barElement = null;\n\n        }\n\n    }\n\t\n} );\n\n/**\n * @classdesc Base Panorama\n * @constructor\n * @param {THREE.Geometry} geometry - The geometry for this panorama\n * @param {THREE.Material} material - The material for this panorama\n */\nfunction Panorama ( geometry, material ) {\n\n    Mesh.call( this, geometry, material );\n\n    this.type = 'panorama';\n\n    this.ImageQualityLow = 1;\n    this.ImageQualityFair = 2;\n    this.ImageQualityMedium = 3;\n    this.ImageQualityHigh = 4;\n    this.ImageQualitySuperHigh = 5;\n\n    this.animationDuration = 1000;\n\n    this.defaultInfospotSize = 350;\n\n    this.container = undefined;\n\n    this.loaded = false;\n\n    this.linkedSpots = [];\n\n    this.isInfospotVisible = false;\n\t\n    this.linkingImageURL = undefined;\n    this.linkingImageScale = undefined;\n\n    this.material.side = BackSide;\n    this.material.opacity = 0;\n\n    this.scale.x *= -1;\n    this.renderOrder = -1;\n\n    this.active = false;\n\n    this.infospotAnimation = new Tween.Tween( this ).to( {}, this.animationDuration / 2 );\n\n    this.addEventListener( 'load', this.fadeIn.bind( this ) );\n    this.addEventListener( 'panolens-container', this.setContainer.bind( this ) );\n    this.addEventListener( 'click', this.onClick.bind( this ) );\n\n    this.setupTransitions();\n\n}\n\nPanorama.prototype = Object.assign( Object.create( Mesh.prototype ), {\n\n    constructor: Panorama,\n\n    /**\n     * Adding an object\n     * To counter the scale.x = -1, it will automatically add an \n     * empty object with inverted scale on x\n     * @memberOf Panorama\n     * @instance\n     * @param {THREE.Object3D} object - The object to be added\n     */\n    add: function ( object ) {\n\n        let invertedObject;\n\n        if ( arguments.length > 1 ) {\n\n            for ( var i = 0; i < arguments.length; i ++ ) {\n\n                this.add( arguments[ i ] );\n\n            }\n\n            return this;\n\n        }\n\n        // In case of infospots\n        if ( object instanceof Infospot ) {\n\n            invertedObject = object;\n\n            if ( object.dispatchEvent ) {\n\n                const { container } = this;\n\n                if ( container ) { object.dispatchEvent( { type: 'panolens-container', container } ); }\n\t\t\t\t\n                object.dispatchEvent( { type: 'panolens-infospot-focus', method: function ( vector, duration, easing ) {\n\n                    /**\n                     * Infospot focus handler event\n                     * @type {object}\n                     * @event Panorama#panolens-viewer-handler\n                     * @property {string} method - Viewer function name\n                     * @property {*} data - The argument to be passed into the method\n                     */\n                    this.dispatchEvent( { type: 'panolens-viewer-handler', method: 'tweenControlCenter', data: [ vector, duration, easing ] } );\n\n\n                }.bind( this ) } );\n            }\n\n        } else {\n\n            // Counter scale.x = -1 effect\n            invertedObject = new Object3D();\n            invertedObject.scale.x = -1;\n            invertedObject.scalePlaceHolder = true;\n            invertedObject.add( object );\n\n        }\n\n        Object3D.prototype.add.call( this, invertedObject );\n\n    },\n\n    load: function () {\n\n        this.onLoad();\n\t\t\n    },\n\n    /**\n     * Click event handler\n     * @param  {object} event - Click event\n     * @memberOf Panorama\n     * @instance\n     * @fires Infospot#dismiss\n     */\n    onClick: function ( event ) {\n\n        if ( event.intersects && event.intersects.length === 0 ) {\n\n            this.traverse( function ( object ) {\n\n                /**\n                 * Dimiss event\n                 * @type {object}\n                 * @event Infospot#dismiss\n                 */\n                object.dispatchEvent( { type: 'dismiss' } );\n\n            } );\n\n        }\n\n    },\n\n    /**\n     * Set container of this panorama \n     * @param {HTMLElement|object} data - Data with container information\n     * @memberOf Panorama\n     * @instance\n     * @fires Infospot#panolens-container\n     */\n    setContainer: function ( data ) {\n\n        let container;\n\n        if ( data instanceof HTMLElement ) {\n\n            container = data;\n\n        } else if ( data && data.container ) {\n\n            container = data.container;\n\n        }\n\n        if ( container ) {\n\n            this.children.forEach( function ( child ) {\n\n                if ( child instanceof Infospot && child.dispatchEvent ) {\n\n                    /**\n                     * Set container event\n                     * @type {object}\n                     * @event Infospot#panolens-container\n                     * @property {HTMLElement} container - The container of this panorama\n                     */\n                    child.dispatchEvent( { type: 'panolens-container', container: container } );\n\n                }\n\n            } );\n\n            this.container = container;\n\n        }\n\n    },\n\n    /**\n     * This will be called when panorama is loaded\n     * @memberOf Panorama\n     * @instance\n     * @fires Panorama#load\n     */\n    onLoad: function () {\n\n        this.loaded = true;\n\n        /**\n         * Load panorama event\n         * @type {object}\n         * @event Panorama#load\n         */\n        this.dispatchEvent( { type: 'load' } );\n\n    },\n\n    /**\n     * This will be called when panorama is in progress\n     * @memberOf Panorama\n     * @instance\n     * @fires Panorama#progress\n     */\n    onProgress: function ( progress ) {\n\n        /**\n         * Loading panorama progress event\n         * @type {object}\n         * @event Panorama#progress\n         * @property {object} progress - The progress object containing loaded and total amount\n         */\n        this.dispatchEvent( { type: 'progress', progress: progress } );\n\n    },\n\n    /**\n     * This will be called when panorama loading has error\n     * @memberOf Panorama\n     * @instance\n     * @fires Panorama#error\n     */\n    onError: function () {\n\n        /**\n         * Loading panorama error event\n         * @type {object}\n         * @event Panorama#error\n         */\n        this.dispatchEvent( { type: 'error' } );\n\n    },\n\n    /**\n     * Get zoom level based on window width\n     * @memberOf Panorama\n     * @instance\n     * @return {number} zoom level indicating image quality\n     */\n    getZoomLevel: function () {\n\n        let zoomLevel;\n\n        if ( window.innerWidth <= 800 ) {\n\n            zoomLevel = this.ImageQualityFair;\n\n        } else if ( window.innerWidth > 800 &&  window.innerWidth <= 1280 ) {\n\n            zoomLevel = this.ImageQualityMedium;\n\n        } else if ( window.innerWidth > 1280 && window.innerWidth <= 1920 ) {\n\n            zoomLevel = this.ImageQualityHigh;\n\n        } else if ( window.innerWidth > 1920 ) {\n\n            zoomLevel = this.ImageQualitySuperHigh;\n\n        } else {\n\n            zoomLevel = this.ImageQualityLow;\n\n        }\n\n        return zoomLevel;\n\n    },\n\n    /**\n     * Update texture of a panorama\n     * @memberOf Panorama\n     * @instance\n     * @param {THREE.Texture} texture - Texture to be updated\n     */\n    updateTexture: function ( texture ) {\n\n        this.material.map = texture;\n        this.material.needsUpdate = true;\n\n    },\n\n    /**\n     * Toggle visibility of infospots in this panorama\n     * @param  {boolean} isVisible - Visibility of infospots\n     * @param  {number} delay - Delay in milliseconds to change visibility\n     * @memberOf Panorama\n     * @instance\n     * @fires Panorama#infospot-animation-complete\n     */\n    toggleInfospotVisibility: function ( isVisible, delay ) {\n\n        delay = ( delay !== undefined ) ? delay : 0;\n\n        const visible = ( isVisible !== undefined ) ? isVisible : ( this.isInfospotVisible ? false : true );\n\n        this.traverse( function ( object ) {\n\n            if ( object instanceof Infospot ) {\n\n                if ( visible ) {\n\n                    object.show( delay );\n\n                } else {\n\n                    object.hide( delay );\n\n                }\n\n            }\n\n        } );\n\n        this.isInfospotVisible = visible;\n\n        // Animation complete event\n        this.infospotAnimation.onComplete( function () {\n\n            /**\n             * Complete toggling infospot visibility\n             * @event Panorama#infospot-animation-complete\n             * @type {object} \n             */\n            this.dispatchEvent( { type: 'infospot-animation-complete', visible: visible } );\n\n        }.bind( this ) ).delay( delay ).start();\n\n    },\n\n    /**\n     * Set image of this panorama's linking infospot\n     * @memberOf Panorama\n     * @instance\n     * @param {string} url   - Url to the image asset\n     * @param {number} scale - Scale factor of the infospot\n     */\n    setLinkingImage: function ( url, scale ) {\n\n        this.linkingImageURL = url;\n        this.linkingImageScale = scale;\n\n    },\n\n    /**\n     * Link one-way panorama\n     * @param  {Panorama} pano  - The panorama to be linked to\n     * @param  {THREE.Vector3} position - The position of infospot which navigates to the pano\n     * @param  {number} [imageScale=300] - Image scale of linked infospot\n     * @param  {string} [imageSrc=DataImage.Arrow] - The image source of linked infospot\n     * @memberOf Panorama\n     * @instance\n     */\n    link: function ( pano, position, imageScale, imageSrc ) {\n\n        let scale, img;\n\n        this.visible = true;\n\n        if ( !position ) {\n\n            console.warn( 'Please specify infospot position for linking' );\n\n            return;\n\n        }\n\n        // Infospot scale\n        if ( imageScale !== undefined ) {\n\n            scale = imageScale;\n\n        } else if ( pano.linkingImageScale !== undefined ) {\n\n            scale = pano.linkingImageScale;\n\n        } else {\n\n            scale = 300;\n\n        }\n\n\n        // Infospot image\n        if ( imageSrc ) {\n\n            img = imageSrc;\n\n        } else if ( pano.linkingImageURL ) {\n\n            img = pano.linkingImageURL;\n\n        } else {\n\n            img = DataImage.Arrow;\n\n        }\n\n        // Creates a new infospot\n        const spot = new Infospot( scale, img );\n        spot.position.copy( position );\n        spot.toPanorama = pano;\n        spot.addEventListener( 'click', function () {\n\n            /**\n             * Viewer handler event\n             * @type {object}\n             * @event Panorama#panolens-viewer-handler\n             * @property {string} method - Viewer function name\n             * @property {*} data - The argument to be passed into the method\n             */\n            this.dispatchEvent( { type: 'panolens-viewer-handler', method: 'setPanorama', data: pano } );\n\n        }.bind( this ) );\n\n        this.linkedSpots.push( spot );\n\n        this.add( spot );\n\n        this.visible = false;\n\n    },\n\n    reset: function () {\n\n        this.children.length = 0;\t\n\n    },\n\n    setupTransitions: function () {\n\n        this.fadeInAnimation = new Tween.Tween( this.material )\n            .easing( Tween.Easing.Quartic.Out )\n            .onStart( function () {\n\n                this.visible = true;\n                // this.material.visible = true;\n\n                /**\n                 * Enter panorama fade in start event\n                 * @event Panorama#enter-fade-start\n                 * @type {object} \n                 */\n                this.dispatchEvent( { type: 'enter-fade-start' } );\n\n            }.bind( this ) );\n\n        this.fadeOutAnimation = new Tween.Tween( this.material )\n            .easing( Tween.Easing.Quartic.Out )\n            .onComplete( function () {\n\n                this.visible = false;\n                // this.material.visible = true;\n\n                /**\n                 * Leave panorama complete event\n                 * @event Panorama#leave-complete\n                 * @type {object} \n                 */\n                this.dispatchEvent( { type: 'leave-complete' } );\n\n            }.bind( this ) );\n\n        this.enterTransition = new Tween.Tween( this )\n            .easing( Tween.Easing.Quartic.Out )\n            .onComplete( function () {\n\n                /**\n                 * Enter panorama and animation complete event\n                 * @event Panorama#enter-complete\n                 * @type {object} \n                 */\n                this.dispatchEvent( { type: 'enter-complete' } );\n\n            }.bind ( this ) )\n            .start();\n\n        this.leaveTransition = new Tween.Tween( this )\n            .easing( Tween.Easing.Quartic.Out );\n\n    },\n\n    onFadeAnimationUpdate: function () {\n\n        const alpha = this.material.opacity;\n        const { uniforms } = this.material;\n\n        if ( uniforms && uniforms.opacity ) {\n            uniforms.opacity.value = alpha;\n        }\n\n    },\n\n    /**\n     * Start fading in animation\n     * @memberOf Panorama\n     * @instance\n     * @fires Panorama#enter-fade-complete\n     */\n    fadeIn: function ( duration ) {\n\n        duration = duration >= 0 ? duration : this.animationDuration;\n\n        this.fadeOutAnimation.stop();\n        this.fadeInAnimation\n            .to( { opacity: 1 }, duration )\n            .onUpdate( this.onFadeAnimationUpdate.bind( this ) )\n            .onComplete( function () {\n\n                this.toggleInfospotVisibility( true, duration / 2 );\n\n                /**\n                 * Enter panorama fade complete event\n                 * @event Panorama#enter-fade-complete\n                 * @type {object} \n                 */\n                this.dispatchEvent( { type: 'enter-fade-complete' } );\t\t\t\n\n            }.bind( this ) )\n            .start();\n\n    },\n\n    /**\n     * Start fading out animation\n     * @memberOf Panorama\n     * @instance\n     */\n    fadeOut: function ( duration ) {\n\n        duration = duration >= 0 ? duration : this.animationDuration;\n\n        this.fadeInAnimation.stop();\n        this.fadeOutAnimation\n            .to( { opacity: 0 }, duration )\n            .onUpdate( this.onFadeAnimationUpdate.bind( this ) )\n            .start();\n\n    },\n\n    /**\n     * This will be called when entering a panorama \n     * @memberOf Panorama\n     * @instance\n     * @fires Panorama#enter\n     * @fires Panorama#enter-start\n     */\n    onEnter: function () {\n\n        const duration = this.animationDuration;\n\n        this.leaveTransition.stop();\n        this.enterTransition\n            .to( {}, duration )\n            .onStart( function () {\n\n                /**\n                 * Enter panorama and animation starting event\n                 * @event Panorama#enter-start\n                 * @type {object} \n                 */\n                this.dispatchEvent( { type: 'enter-start' } );\n\t\t\t\t\n                if ( this.loaded ) {\n\n                    this.fadeIn( duration );\n\n                } else {\n\n                    this.load();\n\n                }\n\t\t\t\t\n            }.bind( this ) )\n            .start();\n\n        /**\n         * Enter panorama event\n         * @event Panorama#enter\n         * @type {object} \n         */\n        this.dispatchEvent( { type: 'enter' } );\n\n        this.children.forEach( child => {\n\n            child.dispatchEvent( { type: 'panorama-enter' } );\n\n        } );\n\n        this.active = true;\n\n    },\n\n    /**\n     * This will be called when leaving a panorama\n     * @memberOf Panorama\n     * @instance\n     * @fires Panorama#leave\n     */\n    onLeave: function () {\n\n        const duration = this.animationDuration;\n\n        this.enterTransition.stop();\n        this.leaveTransition\n            .to( {}, duration )\n            .onStart( function () {\n\n                /**\n                 * Leave panorama and animation starting event\n                 * @event Panorama#leave-start\n                 * @type {object} \n                 */\n                this.dispatchEvent( { type: 'leave-start' } );\n\n                this.fadeOut( duration );\n                this.toggleInfospotVisibility( false );\n\n            }.bind( this ) )\n            .start();\n\n        /**\n         * Leave panorama event\n         * @event Panorama#leave\n         * @type {object} \n         */\n        this.dispatchEvent( { type: 'leave' } );\n\n        this.children.forEach( child => {\n\n            child.dispatchEvent( { type: 'panorama-leave' } );\n\n        } );\n\n        this.active = false;\n\n    },\n\n    /**\n     * Dispose panorama\n     * @memberOf Panorama\n     * @instance\n     */\n    dispose: function () {\n\n        this.infospotAnimation.stop();\n        this.fadeInAnimation.stop();\n        this.fadeOutAnimation.stop();\n        this.enterTransition.stop();\n        this.leaveTransition.stop();\n\n        /**\n         * On panorama dispose handler\n         * @type {object}\n         * @event Panorama#panolens-viewer-handler\n         * @property {string} method - Viewer function name\n         * @property {*} data - The argument to be passed into the method\n         */\n        this.dispatchEvent( { type: 'panolens-viewer-handler', method: 'onPanoramaDispose', data: this } );\n\n        // recursive disposal on 3d objects\n        function recursiveDispose ( object ) {\n\n            const { geometry, material } = object;\n\n            for ( var i = object.children.length - 1; i >= 0; i-- ) {\n\n                recursiveDispose( object.children[i] );\n                object.remove( object.children[i] );\n\n            }\n\n            if ( object instanceof Infospot ) {\n\n                object.dispose();\n\n            }\n\t\t\t\n            if ( geometry ) { geometry.dispose(); object.geometry = null; }\n            if ( material ) { material.dispose(); object.material = null; }\n\n        }\n\n        recursiveDispose( this );\n\n        if ( this.parent ) {\n\n            this.parent.remove( this );\n\n        }\n\n    }\n\n} );\n\n/**\n * @classdesc Equirectangular based image panorama\n * @constructor\n * @param {string} image - Image url or HTMLImageElement\n */\nfunction ImagePanorama ( image, _geometry, _material ) {\n\n    const radius = 5000;\n    const geometry = _geometry || new SphereBufferGeometry( radius, 60, 40 );\n    const material = _material || new MeshBasicMaterial( { opacity: 0, transparent: true } );\n\n    Panorama.call( this, geometry, material );\n\n    this.src = image;\n    this.radius = radius;\n\n}\n\nImagePanorama.prototype = Object.assign( Object.create( Panorama.prototype ), {\n\n    constructor: ImagePanorama,\n\n    /**\n     * Load image asset\n     * @param  {*} src - Url or image element\n     * @memberOf ImagePanorama\n     * @instance\n     */\n    load: function ( src ) {\n\n        src = src || this.src;\n\n        if ( !src ) { \n\n            console.warn( 'Image source undefined' );\n\n            return; \n\n        } else if ( typeof src === 'string' ) {\n\n            TextureLoader.load( src, this.onLoad.bind( this ), this.onProgress.bind( this ), this.onError.bind( this ) );\n\n        } else if ( src instanceof HTMLImageElement ) {\n\n            this.onLoad( new Texture( src ) );\n\n        }\n\n    },\n\n    /**\n     * This will be called when image is loaded\n     * @param  {THREE.Texture} texture - Texture to be updated\n     * @memberOf ImagePanorama\n     * @instance\n     */\n    onLoad: function ( texture ) {\n\n        texture.minFilter = texture.magFilter = LinearFilter;\n        texture.needsUpdate = true;\n\t\t\n        this.updateTexture( texture );\n\n        window.requestAnimationFrame( Panorama.prototype.onLoad.bind( this ) );\n\n    },\n\n    /**\n     * Reset\n     * @memberOf ImagePanorama\n     * @instance\n     */\n    reset: function () {\n\n        Panorama.prototype.reset.call( this );\n\n    },\n\n    /**\n     * Dispose\n     * @memberOf ImagePanorama\n     * @instance\n     */\n    dispose: function () {\n\n        const { material: { map } } = this;\n\n        // Release cached image\n        Cache.remove( this.src );\n\n        if ( map ) { map.dispose(); }\n\n        Panorama.prototype.dispose.call( this );\n\n    }\n\n} );\n\n/**\n * @classdesc Empty panorama\n * @constructor\n */\nfunction EmptyPanorama () {\n\n    const geometry = new BufferGeometry();\n    const material = new MeshBasicMaterial( { color: 0x000000, opacity: 0, transparent: true } );\n\n    geometry.addAttribute( 'position', new BufferAttribute( new Float32Array(), 1 ) );\n\n    Panorama.call( this, geometry, material );\n\n}\n\nEmptyPanorama.prototype = Object.assign( Object.create( Panorama.prototype ), {\n\n    constructor: EmptyPanorama\n\n} );\n\n/**\n * @classdesc Cubemap-based panorama\n * @constructor\n * @param {array} images - Array of 6 urls to images, one for each side of the CubeTexture. The urls should be specified in the following order: pos-x, neg-x, pos-y, neg-y, pos-z, neg-z\n */\nfunction CubePanorama ( images = [] ){\n\n    const edgeLength = 10000;\n    const shader = Object.assign( {}, ShaderLib[ 'cube' ] );\n    const geometry = new BoxBufferGeometry( edgeLength, edgeLength, edgeLength );\n    const material = new ShaderMaterial( {\n\n        fragmentShader: shader.fragmentShader,\n        vertexShader: shader.vertexShader,\n        uniforms: shader.uniforms,\n        side: BackSide,\n        transparent: true\n\n    } );\n\n    Panorama.call( this, geometry, material );\n\n    this.images = images;\n    this.edgeLength = edgeLength;\n    this.material.uniforms.opacity.value = 0;\n\n}\n\nCubePanorama.prototype = Object.assign( Object.create( Panorama.prototype ), {\n\n    constructor: CubePanorama,\n\n    /**\n     * Load 6 images and bind listeners\n     * @memberOf CubePanorama\n     * @instance\n     */\n    load: function () {\n\n        CubeTextureLoader.load( \t\n\n            this.images, \n\n            this.onLoad.bind( this ), \n            this.onProgress.bind( this ), \n            this.onError.bind( this ) \n\n        );\n\n    },\n\n    /**\n     * This will be called when 6 textures are ready\n     * @param  {THREE.CubeTexture} texture - Cube texture\n     * @memberOf CubePanorama\n     * @instance\n     */\n    onLoad: function ( texture ) {\n\t\t\n        this.material.uniforms[ 'tCube' ].value = texture;\n\n        Panorama.prototype.onLoad.call( this );\n\n    },\n\n    /**\n     * Dispose\n     * @memberOf CubePanorama\n     * @instance\n     */\n    dispose: function () {\t\n\n        const { value } = this.material.uniforms.tCube;\n\n        this.images.forEach( ( image ) => { Cache.remove( image ); } );\n\n        if ( value instanceof CubeTexture ) {\n\n            value.dispose();\n\n        }\n\n        Panorama.prototype.dispose.call( this );\n\n    }\n\n} );\n\n/**\n * @classdesc Basic panorama with 6 pre-defined grid images\n * @constructor\n */\nfunction BasicPanorama () {\n\n    const images = [];\n\n    for ( let i = 0; i < 6; i++ ) {\n\n        images.push( DataImage.WhiteTile );\n\n    }\n\n    CubePanorama.call( this, images );\n\n}\n\nBasicPanorama.prototype = Object.assign( Object.create( CubePanorama.prototype ), {\n\n    constructor: BasicPanorama\n\n} );\n\n/**\n * @classdesc Video Panorama\n * @constructor\n * @param {string} src - Equirectangular video url\n * @param {object} [options] - Option for video settings\n * @param {HTMLElement} [options.videoElement] - HTML5 video element contains the video\n * @param {boolean} [options.loop=true] - Specify if the video should loop in the end\n * @param {boolean} [options.muted=true] - Mute the video or not. Need to be true in order to autoplay on some browsers\n * @param {boolean} [options.autoplay=false] - Specify if the video should auto play\n * @param {boolean} [options.playsinline=true] - Specify if video should play inline for iOS. If you want it to auto play inline, set both autoplay and muted options to true\n * @param {string} [options.crossOrigin=\"anonymous\"] - Sets the cross-origin attribute for the video, which allows for cross-origin videos in some browsers (Firefox, Chrome). Set to either \"anonymous\" or \"use-credentials\".\n * @param {number} [radius=5000] - The minimum radius for this panoram\n */\nfunction VideoPanorama ( src, options = {} ) {\n\n    const radius = 5000;\n    const geometry = new SphereBufferGeometry( radius, 60, 40 );\n    const material = new MeshBasicMaterial( { opacity: 0, transparent: true } );\n\n    Panorama.call( this, geometry, material );\n\n    this.src = src;\n\n    this.options = {\n\n        videoElement: document.createElement( 'video' ),\n        loop: true,\n        muted: true,\n        autoplay: false,\n        playsinline: true,\n        crossOrigin: 'anonymous'\n\n    };\n\n    Object.assign( this.options, options );\n\n    this.videoElement = this.options.videoElement;\n    this.videoProgress = 0;\n    this.radius = radius;\n\n    this.addEventListener( 'leave', this.pauseVideo.bind( this ) );\n    this.addEventListener( 'enter-fade-start', this.resumeVideoProgress.bind( this ) );\n    this.addEventListener( 'video-toggle', this.toggleVideo.bind( this ) );\n    this.addEventListener( 'video-time', this.setVideoCurrentTime.bind( this ) );\n\n}\nVideoPanorama.prototype = Object.assign( Object.create( Panorama.prototype ), {\n\n    constructor: VideoPanorama,\n\n    isMobile: function () {\n\n        let check = false;\n        (function(a){if(/(android|bb\\d+|meego).+mobile|avantgo|bada\\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\\-(n|u)|c55\\/|capi|ccwa|cdm\\-|cell|chtm|cldc|cmd\\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\\-s|devi|dica|dmob|do(c|p)o|ds(12|\\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\\-|_)|g1 u|g560|gene|gf\\-5|g\\-mo|go(\\.w|od)|gr(ad|un)|haie|hcit|hd\\-(m|p|t)|hei\\-|hi(pt|ta)|hp( i|ip)|hs\\-c|ht(c(\\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\\-(20|go|ma)|i230|iac( |\\-|\\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\\/)|klon|kpt |kwc\\-|kyo(c|k)|le(no|xi)|lg( g|\\/(k|l|u)|50|54|\\-[a-w])|libw|lynx|m1\\-w|m3ga|m50\\/|ma(te|ui|xo)|mc(01|21|ca)|m\\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\\-2|po(ck|rt|se)|prox|psio|pt\\-g|qa\\-a|qc(07|12|21|32|60|\\-[2-7]|i\\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\\-|oo|p\\-)|sdk\\/|se(c(\\-|0|1)|47|mc|nd|ri)|sgh\\-|shar|sie(\\-|m)|sk\\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\\-|v\\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\\-|tdg\\-|tel(i|m)|tim\\-|t\\-mo|to(pl|sh)|ts(70|m\\-|m3|m5)|tx\\-9|up(\\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\\-|your|zeto|zte\\-/i.test(a.substr(0,4))) check = true;})( window.navigator.userAgent || window.navigator.vendor || window.opera );\n        return check;\n\n    },\n\n    /**\n     * Load video panorama\n     * @memberOf VideoPanorama\n     * @instance\n     * @fires  Panorama#panolens-viewer-handler\n     */\n    load: function () {\n\n        const { muted, loop, autoplay, playsinline, crossOrigin } = this.options;\n        const video = this.videoElement;\n        const material = this.material;\n        const onProgress = this.onProgress.bind( this );\n        const onLoad = this.onLoad.bind( this );\n\n        video.loop = loop;\n        video.autoplay = autoplay;\n        video.playsinline = playsinline;\n        video.crossOrigin = crossOrigin;\n        video.muted = muted;\n\t\t\n        if ( playsinline ) {\n\n            video.setAttribute( 'playsinline', '' );\n            video.setAttribute( 'webkit-playsinline', '' );\n\n        } \n\n        const onloadeddata = function() {\n\n            this.setVideoTexture( video );\n\n            if ( autoplay ) {\n\n                /**\n                 * Viewer handler event\n                 * @type {object}\n                 * @property {string} method - 'updateVideoPlayButton'\n                 * @property {boolean} data - Pause video or not\n                 */\n                this.dispatchEvent( { type: 'panolens-viewer-handler', method: 'updateVideoPlayButton', data: false } );\n\n            }\n\n            // For mobile silent autoplay\n            if ( this.isMobile() ) {\n\n                video.pause();\n\n                if ( autoplay && muted ) {\n\n                    /**\n                     * Viewer handler event\n                     * @type {object}\n                     * @property {string} method - 'updateVideoPlayButton'\n                     * @property {boolean} data - Pause video or not\n                     */\n                    this.dispatchEvent( { type: 'panolens-viewer-handler', method: 'updateVideoPlayButton', data: false } );\n\n                } else {\n\n                    /**\n                     * Viewer handler event\n                     * @type {object}\n                     * @property {string} method - 'updateVideoPlayButton'\n                     * @property {boolean} data - Pause video or not\n                     */\n                    this.dispatchEvent( { type: 'panolens-viewer-handler', method: 'updateVideoPlayButton', data: true } );\n\n                }\n\t\t\t\t\n            }\n\n            const loaded = () => {\n\n                // Fix for threejs r89 delayed update\n                material.map.needsUpdate = true;\n\n                onProgress( { loaded: 1, total: 1 } );\n                onLoad();\n\n            };\n\n            window.requestAnimationFrame( loaded );\n\t\t\t\n        };\n\n        /**\n         * Ready state of the audio/video element\n         * 0 = HAVE_NOTHING - no information whether or not the audio/video is ready\n         * 1 = HAVE_METADATA - metadata for the audio/video is ready\n         * 2 = HAVE_CURRENT_DATA - data for the current playback position is available, but not enough data to play next frame/millisecond\n         * 3 = HAVE_FUTURE_DATA - data for the current and at least the next frame is available\n         * 4 = HAVE_ENOUGH_DATA - enough data available to start playing\n         */\n        if ( video.readyState > 2 ) {\n\n            onloadeddata.call( this );\n\n        } else {\n\n            if ( video.querySelectorAll( 'source' ).length === 0 ) {\n\n                const source = document.createElement( 'source' );\n                source.src = this.src;\n                video.appendChild( source );\n\n            }\n\n            video.load();\n        }\n\n        video.addEventListener( 'loadeddata', onloadeddata.bind( this ) );\n\t\t\n        video.addEventListener( 'timeupdate', function () {\n\n            this.videoProgress = video.duration >= 0 ? video.currentTime / video.duration : 0;\n\n            /**\n             * Viewer handler event\n             * @type {object}\n             * @property {string} method - 'onVideoUpdate'\n             * @property {number} data - The percentage of video progress. Range from 0.0 to 1.0\n             */\n            this.dispatchEvent( { type: 'panolens-viewer-handler', method: 'onVideoUpdate', data: this.videoProgress } );\n\n        }.bind( this ) );\n\n        video.addEventListener( 'ended', function () {\n\t\t\t\n            if ( !loop ) {\n\n                this.resetVideo();\n                this.dispatchEvent( { type: 'panolens-viewer-handler', method: 'updateVideoPlayButton', data: true } );\n\n            }\n\n        }.bind( this ), false ); \n\n    },\n\n    /**\n     * Set video texture\n     * @memberOf VideoPanorama\n     * @instance\n     * @param {HTMLVideoElement} video  - The html5 video element\n     * @fires Panorama#panolens-viewer-handler\n     */\n    setVideoTexture: function ( video ) {\n\n        if ( !video ) return;\n\n        const videoTexture = new VideoTexture( video );\n        videoTexture.minFilter = LinearFilter;\n        videoTexture.magFilter = LinearFilter;\n        videoTexture.format = RGBFormat;\n\n        this.updateTexture( videoTexture );\n\t\n    },\n\n    /**\n     * Reset\n     * @memberOf VideoPanorama\n     * @instance\n     */\n    reset: function () {\n\n        this.videoElement = undefined;\t\n\n        Panorama.prototype.reset.call( this );\n\n    },\n\n    /**\n     * Check if video is paused\n     * @memberOf VideoPanorama\n     * @instance\n     * @return {boolean} - is video paused or not\n     */\n    isVideoPaused: function () {\n\n        return this.videoElement.paused;\n\n    },\n\n    /**\n     * Toggle video to play or pause\n     * @memberOf VideoPanorama\n     * @instance\n     */\n    toggleVideo: function () {\n\n        const video = this.videoElement;\n\n        if ( !video ) { return; }\n\n        video[ video.paused ? 'play' : 'pause' ]();\n\n    },\n\n    /**\n     * Set video currentTime\n     * @memberOf VideoPanorama\n     * @instance\n     * @param {object} event - Event contains percentage. Range from 0.0 to 1.0\n     */\n    setVideoCurrentTime: function ( { percentage } ) {\n\n        const video = this.videoElement;\n\n        if ( video && !Number.isNaN( percentage ) && percentage !== 1 ) {\n\n            video.currentTime = video.duration * percentage;\n\n            this.dispatchEvent( { type: 'panolens-viewer-handler', method: 'onVideoUpdate', data: percentage } );\n\n        }\n\n    },\n\n    /**\n     * Play video\n     * @memberOf VideoPanorama\n     * @instance\n     * @fires VideoPanorama#play\n     * @fires VideoPanorama#play-error\n     */\n    playVideo: function () {\n\n        const video = this.videoElement;\n        const playVideo = this.playVideo.bind( this );\n        const dispatchEvent = this.dispatchEvent.bind( this );\n        const onSuccess = () => {\n\n            /**\n             * Play event\n             * @type {object}\n             * @event VideoPanorama#play\n             *\n             */\n            dispatchEvent( { type: 'play' } );\n\n        };\n        const onError = ( error ) => {\n\n            // Error playing video. Retry next frame. Possibly Waiting for user interaction\n            window.requestAnimationFrame( playVideo );\n\n            /**\n             * Play event\n             * @type {object}\n             * @event VideoPanorama#play-error\n             *\n             */\n            dispatchEvent( { type: 'play-error', error } );\n\n        };\n\n        if ( video && video.paused ) {\n\n            video.play().then( onSuccess ).catch( onError );\n\n        }\n\n    },\n\n    /**\n     * Pause video\n     * @memberOf VideoPanorama\n     * @instance\n     * @fires VideoPanorama#pause\n     */\n    pauseVideo: function () {\n\n        const video = this.videoElement;\n\n        if ( video && !video.paused ) {\n\n            video.pause();\n\n        }\n\n        /**\n         * Pause event\n         * @type {object}\n         * @event VideoPanorama#pause\n         *\n         */\n        this.dispatchEvent( { type: 'pause' } );\n\n    },\n\n    /**\n     * Resume video\n     * @memberOf VideoPanorama\n     * @instance\n     */\n    resumeVideoProgress: function () {\n\n        const video = this.videoElement;\n\n        if ( video.readyState >= 4 && video.autoplay && !this.isMobile() ) {\n\n            this.playVideo();\n\n            /**\n             * Viewer handler event\n             * @type {object}\n             * @property {string} method - 'updateVideoPlayButton'\n             * @property {boolean} data - Pause video or not\n             */\n            this.dispatchEvent( { type: 'panolens-viewer-handler', method: 'updateVideoPlayButton', data: false } );\n\n        } else {\n\n            this.pauseVideo();\n\n            /**\n             * Viewer handler event\n             * @type {object}\n             * @property {string} method - 'updateVideoPlayButton'\n             * @property {boolean} data - Pause video or not\n             */\n            this.dispatchEvent( { type: 'panolens-viewer-handler', method: 'updateVideoPlayButton', data: true } );\n\n        }\n\n        this.setVideoCurrentTime( { percentage: this.videoProgress } );\n\n    },\n\n    /**\n     * Reset video at stating point\n     * @memberOf VideoPanorama\n     * @instance\n     */\n    resetVideo: function () {\n\n        const video = this.videoElement;\n\n        if ( video ) {\n\n            this.setVideoCurrentTime( { percentage: 0 } );\n\n        }\n\n    },\n\n    /**\n     * Check if video is muted\n     * @memberOf VideoPanorama\n     * @instance\n     * @return {boolean} - is video muted or not\n     */\n    isVideoMuted: function () {\n\n        return this.videoElement.muted;\n\n    },\n\n    /**\n     * Mute video\n     * @memberOf VideoPanorama\n     * @instance\n     */\n    muteVideo: function () {\n\n        const video = this.videoElement;\n\n        if ( video && !video.muted ) {\n\n            video.muted = true;\n\n        }\n\n        this.dispatchEvent( { type: 'volumechange' } );\n\n    },\n\n    /**\n     * Unmute video\n     * @memberOf VideoPanorama\n     * @instance\n     */\n    unmuteVideo: function () {\n\n        const video = this.videoElement;\n\n        if ( video && this.isVideoMuted() ) {\n\n            video.muted = false;\n\n        }\n\n        this.dispatchEvent( { type: 'volumechange' } );\n\n    },\n\n    /**\n     * Returns the video element\n     * @memberOf VideoPanorama\n     * @instance\n     * @returns {HTMLElement}\n     */\n    getVideoElement: function () {\n\n        return this.videoElement;\n\n    },\n\n    /**\n     * Dispose video panorama\n     * @memberOf VideoPanorama\n     * @instance\n     */\n    dispose: function () {\n\n        const { material: { map } } = this;\n\n        this.pauseVideo();\n\t\t\n        this.removeEventListener( 'leave', this.pauseVideo.bind( this ) );\n        this.removeEventListener( 'enter-fade-start', this.resumeVideoProgress.bind( this ) );\n        this.removeEventListener( 'video-toggle', this.toggleVideo.bind( this ) );\n        this.removeEventListener( 'video-time', this.setVideoCurrentTime.bind( this ) );\n\n        if ( map ) { map.dispose(); }\n\n        Panorama.prototype.dispose.call( this );\n\n    }\n\n} );\n\n/**\n * @classdesc Google Street View Loader\n * @constructor\n * @param {object} parameters \n */\nfunction GoogleStreetviewLoader ( parameters = {} ) {\n\n    this._parameters = parameters;\n    this._zoom = null;\n    this._panoId = null;\n    this._panoClient = new google.maps.StreetViewService();\n    this._count = 0;\n    this._total = 0;\n    this._canvas = [];\n    this._ctx = [];\n    this._wc = 0;\n    this._hc = 0;\n    this.result = null;\n    this.rotation = 0;\n    this.copyright = '';\n    this.onSizeChange = null;\n    this.onPanoramaLoad = null;\n\n    this.levelsW = [ 1, 2, 4, 7, 13, 26 ];\n    this.levelsH = [ 1, 1, 2, 4, 7, 13 ];\n\n    this.widths = [ 416, 832, 1664, 3328, 6656, 13312 ];\n    this.heights = [ 416, 416, 832, 1664, 3328, 6656 ];\n\n    this.maxW = 6656;\n    this.maxH = 6656;\n\n    let gl;\n\n    try {\n\n        const canvas = document.createElement( 'canvas' );\n\n        gl = canvas.getContext( 'experimental-webgl' );\n\n        if( !gl ) {\n\n            gl = canvas.getContext( 'webgl' );\n\n        }\n\n    }\n    catch ( error ) {\n\n    }\n\n    this.maxW = Math.max( gl.getParameter( gl.MAX_TEXTURE_SIZE ), this.maxW );\n    this.maxH = Math.max( gl.getParameter( gl.MAX_TEXTURE_SIZE ), this.maxH );\n\n}\n\nObject.assign( GoogleStreetviewLoader.prototype, {\n\n    constructor: GoogleStreetviewLoader,\n\n    /**\n     * Set progress\n     * @param {number} loaded \n     * @param {number} total \n     * @memberOf GoogleStreetviewLoader\n     * @instance\n     */\n    setProgress: function ( loaded, total ) {\n\n        if ( this.onProgress ) {\n\n            this.onProgress( { loaded: loaded, total: total } );\n\n        }\n\t\t\n    },\n\n    /**\n     * Adapt texture to zoom\n     * @memberOf GoogleStreetviewLoader\n     * @instance\n     */\n    adaptTextureToZoom: function () {\n\n        const w = this.widths [ this._zoom ];\n        const h = this.heights[ this._zoom ];\n\n        const maxW = this.maxW;\n        const maxH = this.maxH;\n\n        this._wc = Math.ceil( w / maxW );\n        this._hc = Math.ceil( h / maxH );\n\n        for( let y = 0; y < this._hc; y++ ) {\n            for( let x = 0; x < this._wc; x++ ) {\n                const c = document.createElement( 'canvas' );\n                if( x < ( this._wc - 1 ) ) c.width = maxW; else c.width = w - ( maxW * x );\n                if( y < ( this._hc - 1 ) ) c.height = maxH; else c.height = h - ( maxH * y );\n                this._canvas.push( c );\n                this._ctx.push( c.getContext( '2d' ) );\n            }\n        }\n\n    },\n\n    /**\n     * Compose from tile\n     * @param {number} x \n     * @param {number} y \n     * @param {*} texture \n     * @memberOf GoogleStreetviewLoader\n     * @instance\n     */\n    composeFromTile: function ( x, y, texture ) {\n\n        const maxW = this.maxW;\n        const maxH = this.maxH;\n\n        x *= 512;\n        y *= 512;\n\n        const px = Math.floor( x / maxW );\n        const py = Math.floor( y / maxH );\n\n        x -= px * maxW;\n        y -= py * maxH;\n\n        this._ctx[ py * this._wc + px ].drawImage( texture, 0, 0, texture.width, texture.height, x, y, 512, 512 );\n\n        this.progress();\n\t\t\n    },\n\n    /**\n     * Progress\n     * @memberOf GoogleStreetviewLoader\n     * @instance\n     */\n    progress: function() {\n\n        this._count++;\n\t\t\n        this.setProgress( this._count, this._total );\n\t\t\n        if ( this._count === this._total) {\n\n            this.canvas = this._canvas;\n            this.panoId = this._panoId;\n            this.zoom = this._zoom;\n\n            if ( this.onPanoramaLoad ) {\n\n                this.onPanoramaLoad( this._canvas[ 0 ] );\n\n            }\n\n        }\n    },\n\n    /**\n     * Compose panorama\n     * @memberOf GoogleStreetviewLoader\n     * @instance\n     */\n    composePanorama: function () {\n\n        this.setProgress( 0, 1 );\n\t\t\n        const w = this.levelsW[ this._zoom ];\n        const h = this.levelsH[ this._zoom ];\n        const self = this;\n\t\t\t\n        this._count = 0;\n        this._total = w * h;\n\n        const { useWebGL } = this._parameters;\n\n        for( let y = 0; y < h; y++ ) {\n            for( let x = 0; x < w; x++ ) {\n                const url = 'https://geo0.ggpht.com/cbk?cb_client=maps_sv.tactile&authuser=0&hl=en&output=tile&zoom=' + this._zoom + '&x=' + x + '&y=' + y + '&panoid=' + this._panoId + '&nbt&fover=2';\n                ( function( x, y ) { \n                    if( useWebGL ) {\n                        const texture = TextureLoader.load( url, null, function() {\n                            self.composeFromTile( x, y, texture );\n                        } );\n                    } else {\n                        const img = new Image();\n                        img.addEventListener( 'load', function() {\n                            self.composeFromTile( x, y, this );\t\t\t\n                        } );\n                        img.crossOrigin = '';\n                        img.src = url;\n                    }\n                } )( x, y );\n            }\n        }\n\t\t\n    },\n\n    /**\n     * Load\n     * @param {string} panoid \n     * @memberOf GoogleStreetviewLoader\n     * @instance\n     */\n    load: function ( panoid ) {\n\n        this.loadPano( panoid );\n\n    },\n\n    /**\n     * Load panorama\n     * @param {string} id\n     * @memberOf GoogleStreetviewLoader\n     * @instance\n     */\n    loadPano: function( id ) {\n\n        const self = this;\n        this._panoClient.getPanoramaById( id, function (result, status) {\n            if (status === google.maps.StreetViewStatus.OK) {\n                self.result = result;\n                self.copyright = result.copyright;\n                self._panoId = result.location.pano;\n                self.composePanorama();\n            }\n        });\n\t\t\n    },\n\n    /**\n     * Set zoom level\n     * @param {number} z \n     * @memberOf GoogleStreetviewLoader\n     * @instance\n     */\n    setZoom: function( z ) {\n\n        this._zoom = z;\n        this.adaptTextureToZoom();\n    }\n\t\n} );\n\n/**\n * @classdesc Google streetview panorama\n * @description [How to get Panorama ID]{@link http://stackoverflow.com/questions/29916149/google-maps-streetview-how-to-get-panorama-id}\n * @constructor\n * @param {string} panoId - Panorama id from Google Streetview \n * @param {string} [apiKey] - Google Street View API Key\n */\nfunction GoogleStreetviewPanorama ( panoId, apiKey ) {\n\n    ImagePanorama.call( this );\n\n    this.panoId = panoId;\n\n    this.gsvLoader = null;\n\n    this.loadRequested = false;\n\n    this.setupGoogleMapAPI( apiKey );\n\n}\n\nGoogleStreetviewPanorama.prototype = Object.assign( Object.create( ImagePanorama.prototype ), {\n\n    constructor: GoogleStreetviewPanorama,\n\n    /**\n     * Load Google Street View by panorama id\n     * @param {string} panoId - Gogogle Street View panorama id\n     * @memberOf GoogleStreetviewPanorama\n     * @instance\n     */\n    load: function ( panoId ) {\n\n        this.loadRequested = true;\n\n        panoId = ( panoId || this.panoId ) || {};\n\n        if ( panoId && this.gsvLoader ) {\n\n            this.loadGSVLoader( panoId );\n\n        }\n\n    },\n\n    /**\n     * Setup Google Map API\n     * @param {string}  apiKey\n     * @memberOf GoogleStreetviewPanorama\n     * @instance\n     */\n    setupGoogleMapAPI: function ( apiKey ) {\n\n        const script = document.createElement( 'script' );\n        script.src = 'https://maps.googleapis.com/maps/api/js?';\n        script.src += apiKey ? 'key=' + apiKey : '';\n        script.onreadystatechange = this.setGSVLoader.bind( this );\n        script.onload = this.setGSVLoader.bind( this );\n\n        document.querySelector( 'head' ).appendChild( script );\n\n    },\n\n    /**\n     * Set GSV Loader\n     * @memberOf GoogleStreetviewPanorama\n     * @instance\n     */\n    setGSVLoader: function () {\n\n        this.gsvLoader = new GoogleStreetviewLoader();\n\n        if ( this.loadRequested ) {\n\n            this.load();\n\n        }\n\n    },\n\n    /**\n     * Get GSV Loader\n     * @memberOf GoogleStreetviewPanorama\n     * @instance\n     * @return {GoogleStreetviewLoader} GSV Loader instance\n     */\n    getGSVLoader: function () {\n\n        return this.gsvLoader;\n\n    },\n\n    /**\n     * Load GSV Loader\n     * @param  {string} panoId - Gogogle Street View panorama id\n     * @memberOf GoogleStreetviewPanorama\n     * @instance\n     */\n    loadGSVLoader: function ( panoId ) {\n\n        this.loadRequested = false;\n\n        this.gsvLoader.onProgress = this.onProgress.bind( this );\n\n        this.gsvLoader.onPanoramaLoad = this.onLoad.bind( this );\n\n        this.gsvLoader.setZoom( this.getZoomLevel() );\n\n        this.gsvLoader.load( panoId );\n\n        this.gsvLoader.loaded = true;\n    },\n\n    /**\n     * This will be called when panorama is loaded\n     * @param  {HTMLCanvasElement} canvas - Canvas where the tiles have been drawn\n     * @memberOf GoogleStreetviewPanorama\n     * @instance\n     */\n    onLoad: function ( canvas ) {\n\n        ImagePanorama.prototype.onLoad.call( this, new Texture( canvas ) );\n\n    },\n\n    /**\n     * Reset\n     * @memberOf GoogleStreetviewPanorama\n     * @instance\n     */\n    reset: function () {\n\n        this.gsvLoader = undefined;\n\n        ImagePanorama.prototype.reset.call( this );\n\n    }\n\n} );\n\n/**\n * Stereographic projection shader\n * based on http://notlion.github.io/streetview-stereographic\n * @author pchen66\n */\n\n/**\n * @description Stereograhpic Shader\n * @module StereographicShader\n * @property {object} uniforms\n * @property {THREE.Texture} uniforms.tDiffuse diffuse map\n * @property {number} uniforms.resolution image resolution\n * @property {THREE.Matrix4} uniforms.transform transformation matrix\n * @property {number} uniforms.zoom image zoom factor\n * @property {number} uniforms.opacity image opacity\n * @property {string} vertexShader vertex shader\n * @property {string} fragmentShader fragment shader\n */\nconst StereographicShader = {\n\n    uniforms: {\n\n        'tDiffuse': { value: new Texture() },\n        'resolution': { value: 1.0 },\n        'transform': { value: new Matrix4() },\n        'zoom': { value: 1.0 },\n        'opacity': { value: 1.0 }\n\n    },\n\n    vertexShader: [\n\n        'varying vec2 vUv;',\n\n        'void main() {',\n\n        'vUv = uv;',\n        'gl_Position = vec4( position, 1.0 );',\n\n        '}' \n\n    ].join( '\\n' ),\n\n    fragmentShader: [\n\n        'uniform sampler2D tDiffuse;',\n        'uniform float resolution;',\n        'uniform mat4 transform;',\n        'uniform float zoom;',\n        'uniform float opacity;',\n\n        'varying vec2 vUv;',\n\n        'const float PI = 3.141592653589793;',\n\n        'void main(){',\n\n        'vec2 position = -1.0 +  2.0 * vUv;',\n\n        'position *= vec2( zoom * resolution, zoom * 0.5 );',\n\n        'float x2y2 = position.x * position.x + position.y * position.y;',\n        'vec3 sphere_pnt = vec3( 2. * position, x2y2 - 1. ) / ( x2y2 + 1. );',\n\n        'sphere_pnt = vec3( transform * vec4( sphere_pnt, 1.0 ) );',\n\n        'vec2 sampleUV = vec2(',\n        '(atan(sphere_pnt.y, sphere_pnt.x) / PI + 1.0) * 0.5,',\n        '(asin(sphere_pnt.z) / PI + 0.5)',\n        ');',\n\n        'gl_FragColor = texture2D( tDiffuse, sampleUV );',\n\n        'gl_FragColor.a *= opacity;',\n\n        '}'\n\n    ].join( '\\n' )\n\n};\n\n/**\n * @classdesc Little Planet\n * @constructor\n * @param {string} type \t\t- Type of little planet basic class\n * @param {string} source \t\t- URL for the image source\n * @param {number} [size=10000] - Size of plane geometry\n * @param {number} [ratio=0.5]  - Ratio of plane geometry's height against width\n */\nfunction LittlePlanet ( type = 'image', source, size = 10000, ratio = 0.5 ) {\n\n    if ( type === 'image' ) {\n\n        ImagePanorama.call( this, source, this.createGeometry( size, ratio ), this.createMaterial( size ) );\n\n    }\n\n    this.size = size;\n    this.ratio = ratio;\n    this.EPS = 0.000001;\n    this.frameId = null;\n\n    this.dragging = false;\n    this.userMouse = new Vector2();\n\n    this.quatA = new Quaternion();\n    this.quatB = new Quaternion();\n    this.quatCur = new Quaternion();\n    this.quatSlerp = new Quaternion();\n\n    this.vectorX = new Vector3( 1, 0, 0 );\n    this.vectorY = new Vector3( 0, 1, 0 );\n\n    this.addEventListener( 'window-resize', this.onWindowResize );\n\n}\n\nLittlePlanet.prototype = Object.assign( Object.create( ImagePanorama.prototype ), {\n\n    constructor: LittlePlanet,\n\n    add: function ( object ) {\n\n        if ( arguments.length > 1 ) {\n\t\t\t\n            for ( let i = 0; i < arguments.length; i ++ ) {\n\n                this.add( arguments[ i ] );\n\n            }\n\n            return this;\n\n        }\n\n        if ( object instanceof Infospot ) {\n\n            object.material.depthTest = false;\n\t\t\t\n        }\n\n        ImagePanorama.prototype.add.call( this, object );\n\n    },\n\n    createGeometry: function ( size, ratio ) {\n\n        return new PlaneBufferGeometry( size, size * ratio );\n\n    },\n\n    createMaterial: function ( size ) {\n\n        const shader = Object.assign( {}, StereographicShader ), uniforms = shader.uniforms;\n\n        uniforms.zoom.value = size;\n        uniforms.opacity.value = 0.0;\n\n        return new ShaderMaterial( {\n\n            uniforms: uniforms,\n            vertexShader: shader.vertexShader,\n            fragmentShader: shader.fragmentShader,\n            side: BackSide,\n            transparent: true\n\n        } );\n\t\t\n    },\n\n    registerMouseEvents: function () {\n\n        this.container.addEventListener( 'mousedown', this.onMouseDown.bind( this ), { passive: true } );\n        this.container.addEventListener( 'mousemove', this.onMouseMove.bind( this ), { passive: true } );\n        this.container.addEventListener( 'mouseup', this.onMouseUp.bind( this ), { passive: true } );\n        this.container.addEventListener( 'touchstart', this.onMouseDown.bind( this ), { passive: true } );\n        this.container.addEventListener( 'touchmove', this.onMouseMove.bind( this ), { passive: true } );\n        this.container.addEventListener( 'touchend', this.onMouseUp.bind( this ), { passive: true } );\n        this.container.addEventListener( 'mousewheel', this.onMouseWheel.bind( this ), { passive: false } );\n        this.container.addEventListener( 'DOMMouseScroll', this.onMouseWheel.bind( this ), { passive: false } );\n        this.container.addEventListener( 'contextmenu', this.onContextMenu.bind( this ), { passive: true } );\n\t\t\n    },\n\n    unregisterMouseEvents: function () {\n\n        this.container.removeEventListener( 'mousedown', this.onMouseDown.bind( this ), false );\n        this.container.removeEventListener( 'mousemove', this.onMouseMove.bind( this ), false );\n        this.container.removeEventListener( 'mouseup', this.onMouseUp.bind( this ), false );\n        this.container.removeEventListener( 'touchstart', this.onMouseDown.bind( this ), false );\n        this.container.removeEventListener( 'touchmove', this.onMouseMove.bind( this ), false );\n        this.container.removeEventListener( 'touchend', this.onMouseUp.bind( this ), false );\n        this.container.removeEventListener( 'mousewheel', this.onMouseWheel.bind( this ), false );\n        this.container.removeEventListener( 'DOMMouseScroll', this.onMouseWheel.bind( this ), false );\n        this.container.removeEventListener( 'contextmenu', this.onContextMenu.bind( this ), false );\n\t\t\n    },\n\n    onMouseDown: function ( event ) {\n\n        const inputCount = ( event.touches && event.touches.length ) || 1 ;\n\n        switch ( inputCount ) {\n\n        case 1:\n\n            const x = ( event.clientX >= 0 ) ? event.clientX : event.touches[ 0 ].clientX;\n            const y = ( event.clientY >= 0 ) ? event.clientY : event.touches[ 0 ].clientY;\n\n            this.dragging = true;\n            this.userMouse.set( x, y );\n\n            break;\n\n        case 2:\n\n            const dx = event.touches[ 0 ].pageX - event.touches[ 1 ].pageX;\n            const dy = event.touches[ 0 ].pageY - event.touches[ 1 ].pageY;\n            const distance = Math.sqrt( dx * dx + dy * dy );\n            this.userMouse.pinchDistance = distance;\n\n            break;\n\n        default:\n\n            break;\n\n        }\n\n        this.onUpdateCallback();\n\n    },\n\n    onMouseMove: function ( event ) {\n\n        const inputCount = ( event.touches && event.touches.length ) || 1 ;\n\n        switch ( inputCount ) {\n\n        case 1:\n\n            const x = ( event.clientX >= 0 ) ? event.clientX : event.touches[ 0 ].clientX;\n            const y = ( event.clientY >= 0 ) ? event.clientY : event.touches[ 0 ].clientY;\n\n            const angleX = Math$1.degToRad( x - this.userMouse.x ) * 0.4;\n            const angleY = Math$1.degToRad( y - this.userMouse.y ) * 0.4;\n\n            if ( this.dragging ) {\n                this.quatA.setFromAxisAngle( this.vectorY, angleX );\n                this.quatB.setFromAxisAngle( this.vectorX, angleY );\n                this.quatCur.multiply( this.quatA ).multiply( this.quatB );\n                this.userMouse.set( x, y );\n            }\n\n            break;\n\n        case 2:\n\n            const dx = event.touches[ 0 ].pageX - event.touches[ 1 ].pageX;\n            const dy = event.touches[ 0 ].pageY - event.touches[ 1 ].pageY;\n            const distance = Math.sqrt( dx * dx + dy * dy );\n\n            this.addZoomDelta( this.userMouse.pinchDistance - distance );\n\n            break;\n\n        default:\n\n            break;\n\n        }\n\n    },\n\n    onMouseUp: function () {\n\n        this.dragging = false;\n\n    },\n\n    onMouseWheel: function ( event ) {\n\n        event.preventDefault();\n        event.stopPropagation();\n\n        let delta = 0;\n\n        if ( event.wheelDelta !== undefined ) { // WebKit / Opera / Explorer 9\n\n            delta = event.wheelDelta;\n\n        } else if ( event.detail !== undefined ) { // Firefox\n\n            delta = - event.detail;\n\n        }\n\n        this.addZoomDelta( delta );\n        this.onUpdateCallback();\n\n    },\n\n    addZoomDelta: function ( delta ) {\n\n        const uniforms = this.material.uniforms;\n        const lowerBound = this.size * 0.1;\n        const upperBound = this.size * 10;\n\n        uniforms.zoom.value += delta;\n\n        if ( uniforms.zoom.value <= lowerBound ) {\n\n            uniforms.zoom.value = lowerBound;\n\n        } else if ( uniforms.zoom.value >= upperBound ) {\n\n            uniforms.zoom.value = upperBound;\n\n        }\n\n    },\n\n    onUpdateCallback: function () {\n\n        this.frameId = window.requestAnimationFrame( this.onUpdateCallback.bind( this ) );\n\n        this.quatSlerp.slerp( this.quatCur, 0.1 );\n\n        if ( this.material ) {\n\n            this.material.uniforms.transform.value.makeRotationFromQuaternion( this.quatSlerp );\n\n        }\n        \n        if ( !this.dragging && 1.0 - this.quatSlerp.clone().dot( this.quatCur ) < this.EPS ) {\n\t\t\t\n            window.cancelAnimationFrame( this.frameId );\n\n        }\n\n    },\n\n    reset: function () {\n\n        this.quatCur.set( 0, 0, 0, 1 );\n        this.quatSlerp.set( 0, 0, 0, 1 );\n        this.onUpdateCallback();\n\n    },\n\n    onLoad: function ( texture ) {\n\n        this.material.uniforms.resolution.value = this.container.clientWidth / this.container.clientHeight;\n\n        this.registerMouseEvents();\n        this.onUpdateCallback();\n\t\t\n        this.dispatchEvent( { type: 'panolens-viewer-handler', method: 'disableControl' } );\n\n        ImagePanorama.prototype.onLoad.call( this, texture );\n\t\t\n    },\n\n    onLeave: function () {\n\n        this.unregisterMouseEvents();\n\n        this.dispatchEvent( { type: 'panolens-viewer-handler', method: 'enableControl', data: CONTROLS.ORBIT } );\n\n        window.cancelAnimationFrame( this.frameId );\n\n        ImagePanorama.prototype.onLeave.call( this );\n\t\t\n    },\n\n    onWindowResize: function () {\n\n        this.material.uniforms.resolution.value = this.container.clientWidth / this.container.clientHeight;\n\n    },\n\n    onContextMenu: function () {\n\n        this.dragging = false;\n\n    },\n\n    dispose: function () {\t\n\n        this.unregisterMouseEvents();\n\n        ImagePanorama.prototype.dispose.call( this );\n\n    }\n\n});\n\n/**\n * @classdesc Image Little Planet\n * @constructor\n * @param {string} source \t\t- URL for the image source\n * @param {number} [size=10000] - Size of plane geometry\n * @param {number} [ratio=0.5]  - Ratio of plane geometry's height against width\n */\nfunction ImageLittlePlanet ( source, size, ratio ) {\n\n    LittlePlanet.call( this, 'image', source, size, ratio );\n\n}\n\nImageLittlePlanet.prototype = Object.assign( Object.create( LittlePlanet.prototype ), {\n\n    constructor: ImageLittlePlanet,\n\n    /**\n     * On loaded with texture\n     * @param {THREE.Texture} texture\n     * @memberOf ImageLittlePlanet\n     * @instance\n     */\n    onLoad: function ( texture ) {\n\n        this.updateTexture( texture );\n\n        LittlePlanet.prototype.onLoad.call( this, texture );\n\n    },\n    \n    /**\n     * Update texture\n     * @param {THREE.Texture} texture \n     * @memberOf ImageLittlePlanet\n     * @instance\n     */\n    updateTexture: function ( texture ) {\n\n        texture.minFilter = texture.magFilter = LinearFilter;\n\t\t\n        this.material.uniforms[ 'tDiffuse' ].value = texture;\n\n    },\n\n    /**\n     * Dispose\n     * @memberOf ImageLittlePlanet\n     * @instance\n     */\n    dispose: function () {\n\n        const tDiffuse = this.material.uniforms[ 'tDiffuse' ];\n\n        if ( tDiffuse && tDiffuse.value ) {\n\n            tDiffuse.value.dispose();\n\n        }\n\n        LittlePlanet.prototype.dispose.call( this );\n\n    }\n\n} );\n\n/**\n * @classdesc Camera panorama\n * @description See {@link https://developer.mozilla.org/en-US/docs/Web/API/MediaStreamConstraints|MediaStreamConstraints} for constraints\n * @param {object} - camera constraints\n * @constructor\n */\nfunction CameraPanorama ( constraints ) {\n\n    const radius = 5000;\n    const geometry = new SphereBufferGeometry( radius, 60, 40 );\n    const material = new MeshBasicMaterial( { visible: false });\n\n    Panorama.call( this, geometry, material );\n\n    this.media = new Media( constraints );\n    this.radius = radius;\n\n    this.addEventListener( 'enter', this.start.bind( this ) );\n    this.addEventListener( 'leave', this.stop.bind( this ) );\n    this.addEventListener( 'panolens-container', this.onPanolensContainer.bind( this ) );\n    this.addEventListener( 'panolens-scene', this.onPanolensScene.bind( this ) );\n\n}\n\nCameraPanorama.prototype = Object.assign( Object.create( Panorama.prototype ), {\n\n    constructor: CameraPanorama,\n\n    /**\n     * On container event\n     * @param {object} event\n     * @memberOf CameraPanorama\n     * @instance\n     */\n    onPanolensContainer: function ( { container } ) {\n\n        this.media.setContainer( container );\n\n    },\n\n    /**\n     * On scene event\n     * @param {object} event \n     * @memberOf CameraPanorama\n     * @instance\n     */\n    onPanolensScene: function ( { scene } ) {\n\n        this.media.setScene( scene );\n\n    },\n\n    /**\n     * Start camera streaming\n     * @memberOf CameraPanorama\n     * @instance\n     * @returns {Promise}\n     */\n    start: function () {\n\n        return this.media.start();\n\n    },\n\n    /**\n     * Stop camera streaming\n     * @memberOf CameraPanorama\n     * @instance\n     */\n    stop: function () {\n\n        this.media.stop();\n\n    },\n\n} );\n\n/**\n * @classdesc Orbit Controls\n * @constructor\n * @external OrbitControls\n * @param {THREE.Object} object \n * @param {HTMLElement} domElement \n */\nfunction OrbitControls ( object, domElement ) {\n\n    this.object = object;\n    this.domElement = ( domElement !== undefined ) ? domElement : document;\n    this.document = ( domElement !== undefined ) ? domElement.ownerDocument : document;\n    this.frameId = null;\n\n    // API\n\n    // Set to false to disable this control\n    this.enabled = true;\n\n    /*\n     * \"target\" sets the location of focus, where the control orbits around\n     * and where it pans with respect to.\n     */\n    this.target = new Vector3();\n\n    // center is old, deprecated; use \"target\" instead\n    this.center = this.target;\n\n    /*\n     * This option actually enables dollying in and out; left as \"zoom\" for\n     * backwards compatibility\n     */\n    this.noZoom = false;\n    this.zoomSpeed = 1.0;\n\n    // Limits to how far you can dolly in and out ( PerspectiveCamera only )\n    this.minDistance = 0;\n    this.maxDistance = Infinity;\n\n    // Limits to how far you can zoom in and out ( OrthographicCamera only )\n    this.minZoom = 0;\n    this.maxZoom = Infinity;\n\n    // Set to true to disable this control\n    this.noRotate = false;\n    this.rotateSpeed = -0.15;\n\n    // Set to true to disable this control\n    this.noPan = true;\n    this.keyPanSpeed = 7.0;\t// pixels moved per arrow key push\n\n    // Set to true to automatically rotate around the target\n    this.autoRotate = false;\n    this.autoRotateSpeed = 2.0; // 30 seconds per round when fps is 60\n\n    /*\n     * How far you can orbit vertically, upper and lower limits.\n     * Range is 0 to Math.PI radians.\n     */\n    this.minPolarAngle = 0; // radians\n    this.maxPolarAngle = Math.PI; // radians\n\n    // Momentum\n  \tthis.momentumDampingFactor = 0.90;\n  \tthis.momentumScalingFactor = -0.005;\n  \tthis.momentumKeydownFactor = 20;\n\n  \t// Fov\n  \tthis.minFov = 30;\n  \tthis.maxFov = 120;\n\n    /*\n     * How far you can orbit horizontally, upper and lower limits.\n     * If set, must be a sub-interval of the interval [ - Math.PI, Math.PI ].\n     */\n    this.minAzimuthAngle = - Infinity; // radians\n    this.maxAzimuthAngle = Infinity; // radians\n\n    // Set to true to disable use of the keys\n    this.noKeys = false;\n\n    // The four arrow keys\n    this.keys = { LEFT: 37, UP: 38, RIGHT: 39, BOTTOM: 40 };\n\n    // Mouse buttons\n    this.mouseButtons = { ORBIT: MOUSE.LEFT, ZOOM: MOUSE.MIDDLE, PAN: MOUSE.RIGHT };\n\n    /*\n     * //////////\n     * internals\n     */\n\n    var scope = this;\n\n    var EPS = 10e-8;\n    var MEPS = 10e-5;\n\n    var rotateStart = new Vector2();\n    var rotateEnd = new Vector2();\n    var rotateDelta = new Vector2();\n\n    var panStart = new Vector2();\n    var panEnd = new Vector2();\n    var panDelta = new Vector2();\n    var panOffset = new Vector3();\n\n    var offset = new Vector3();\n\n    var dollyStart = new Vector2();\n    var dollyEnd = new Vector2();\n    var dollyDelta = new Vector2();\n\n    var theta = 0;\n    var phi = 0;\n    var phiDelta = 0;\n    var thetaDelta = 0;\n    var scale = 1;\n    var pan = new Vector3();\n\n    var lastPosition = new Vector3();\n    var lastQuaternion = new Quaternion();\n\n    var momentumLeft = 0, momentumUp = 0;\n    var eventPrevious;\n    var momentumOn = false;\n\n    var keyUp, keyBottom, keyLeft, keyRight;\n\n    var STATE = { NONE: -1, ROTATE: 0, DOLLY: 1, PAN: 2, TOUCH_ROTATE: 3, TOUCH_DOLLY: 4, TOUCH_PAN: 5 };\n\n    var state = STATE.NONE;\n\n    // for reset\n\n    this.target0 = this.target.clone();\n    this.position0 = this.object.position.clone();\n    this.zoom0 = this.object.zoom;\n\n    // so camera.up is the orbit axis\n\n    var quat = new Quaternion().setFromUnitVectors( object.up, new Vector3( 0, 1, 0 ) );\n    var quatInverse = quat.clone().inverse();\n\n    // events\n\n    var changeEvent = { type: 'change' };\n    var startEvent = { type: 'start' };\n    var endEvent = { type: 'end' };\n\n    this.setLastQuaternion = function ( quaternion ) {\n        lastQuaternion.copy( quaternion );\n        scope.object.quaternion.copy( quaternion );\n    };\n\n    this.getLastPosition = function () {\n        return lastPosition;\n    };\n\n    this.rotateLeft = function ( angle ) {\n\n        if ( angle === undefined ) {\n\n            angle = getAutoRotationAngle();\n\n        }\n\n        thetaDelta -= angle;\n\n\n    };\n\n    this.rotateUp = function ( angle ) {\n\n        if ( angle === undefined ) {\n\n            angle = getAutoRotationAngle();\n\n        }\n\n        phiDelta -= angle;\n\n    };\n\n    // pass in distance in world space to move left\n    this.panLeft = function ( distance ) {\n\n        var te = this.object.matrix.elements;\n\n        // get X column of matrix\n        panOffset.set( te[ 0 ], te[ 1 ], te[ 2 ] );\n        panOffset.multiplyScalar( - distance );\n\n        pan.add( panOffset );\n\n    };\n\n    // pass in distance in world space to move up\n    this.panUp = function ( distance ) {\n\n        var te = this.object.matrix.elements;\n\n        // get Y column of matrix\n        panOffset.set( te[ 4 ], te[ 5 ], te[ 6 ] );\n        panOffset.multiplyScalar( distance );\n\n        pan.add( panOffset );\n\n    };\n\n    /*\n     * pass in x,y of change desired in pixel space,\n     * right and down are positive\n     */\n    this.pan = function ( deltaX, deltaY ) {\n\n        var element = scope.domElement === document ? scope.domElement.body : scope.domElement;\n\n        if ( scope.object instanceof PerspectiveCamera ) {\n\n            // perspective\n            var position = scope.object.position;\n            var offset = position.clone().sub( scope.target );\n            var targetDistance = offset.length();\n\n            // half of the fov is center to top of screen\n            targetDistance *= Math.tan( ( scope.object.fov / 2 ) * Math.PI / 180.0 );\n\n            // we actually don't use screenWidth, since perspective camera is fixed to screen height\n            scope.panLeft( 2 * deltaX * targetDistance / element.clientHeight );\n            scope.panUp( 2 * deltaY * targetDistance / element.clientHeight );\n\n        } else if ( scope.object instanceof OrthographicCamera ) {\n\n            // orthographic\n            scope.panLeft( deltaX * (scope.object.right - scope.object.left) / element.clientWidth );\n            scope.panUp( deltaY * (scope.object.top - scope.object.bottom) / element.clientHeight );\n\n        } else {\n\n            // camera neither orthographic or perspective\n            console.warn( 'WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.' );\n\n        }\n\n    };\n\n    this.momentum = function(){\n\t\t\n        if ( !momentumOn ) return;\n\n        if ( Math.abs( momentumLeft ) < MEPS && Math.abs( momentumUp ) < MEPS ) { \n\n            momentumOn = false; \n            return;\n        }\n\n        momentumUp   *= this.momentumDampingFactor;\n        momentumLeft *= this.momentumDampingFactor;\n\n        thetaDelta -= this.momentumScalingFactor * momentumLeft;\n        phiDelta   -= this.momentumScalingFactor * momentumUp;\n\n    };\n\n    this.dollyIn = function ( dollyScale ) {\n\n        if ( dollyScale === undefined ) {\n\n            dollyScale = getZoomScale();\n\n        }\n\n        if ( scope.object instanceof PerspectiveCamera ) {\n\n            scale /= dollyScale;\n\n        } else if ( scope.object instanceof OrthographicCamera ) {\n\n            scope.object.zoom = Math.max( this.minZoom, Math.min( this.maxZoom, this.object.zoom * dollyScale ) );\n            scope.object.updateProjectionMatrix();\n            scope.dispatchEvent( changeEvent );\n\n        } else {\n\n            console.warn( 'WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.' );\n\n        }\n\n    };\n\n    this.dollyOut = function ( dollyScale ) {\n\n        if ( dollyScale === undefined ) {\n\n            dollyScale = getZoomScale();\n\n        }\n\n        if ( scope.object instanceof PerspectiveCamera ) {\n\n            scale *= dollyScale;\n\n        } else if ( scope.object instanceof OrthographicCamera ) {\n\n            scope.object.zoom = Math.max( this.minZoom, Math.min( this.maxZoom, this.object.zoom / dollyScale ) );\n            scope.object.updateProjectionMatrix();\n            scope.dispatchEvent( changeEvent );\n\n        } else {\n\n            console.warn( 'WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.' );\n\n        }\n\n    };\n\n    this.update = function ( ignoreUpdate ) {\n\n        var position = this.object.position;\n\n        offset.copy( position ).sub( this.target );\n\n        // rotate offset to \"y-axis-is-up\" space\n        offset.applyQuaternion( quat );\n\n        // angle from z-axis around y-axis\n\n        theta = Math.atan2( offset.x, offset.z );\n\n        // angle from y-axis\n\n        phi = Math.atan2( Math.sqrt( offset.x * offset.x + offset.z * offset.z ), offset.y );\n\n        if ( this.autoRotate && state === STATE.NONE ) {\n\n            this.rotateLeft( getAutoRotationAngle() );\n\n        }\n\n        this.momentum();\n\n        theta += thetaDelta;\n        phi += phiDelta;\n\n        // restrict theta to be between desired limits\n        theta = Math.max( this.minAzimuthAngle, Math.min( this.maxAzimuthAngle, theta ) );\n\n        // restrict phi to be between desired limits\n        phi = Math.max( this.minPolarAngle, Math.min( this.maxPolarAngle, phi ) );\n\n        // restrict phi to be betwee EPS and PI-EPS\n        phi = Math.max( EPS, Math.min( Math.PI - EPS, phi ) );\n\n        var radius = offset.length() * scale;\n\n        // restrict radius to be between desired limits\n        radius = Math.max( this.minDistance, Math.min( this.maxDistance, radius ) );\n\n        // move target to panned location\n        this.target.add( pan );\n\n        offset.x = radius * Math.sin( phi ) * Math.sin( theta );\n        offset.y = radius * Math.cos( phi );\n        offset.z = radius * Math.sin( phi ) * Math.cos( theta );\n\n        // rotate offset back to \"camera-up-vector-is-up\" space\n        offset.applyQuaternion( quatInverse );\n\n        position.copy( this.target ).add( offset );\n\n        this.object.lookAt( this.target );\n\n        thetaDelta = 0;\n        phiDelta = 0;\n        scale = 1;\n        pan.set( 0, 0, 0 );\n\n        /*\n         * update condition is:\n         * min(camera displacement, camera rotation in radians)^2 > EPS\n         * using small-angle approximation cos(x/2) = 1 - x^2 / 8\n         */\n        if ( lastPosition.distanceToSquared( this.object.position ) > EPS\n\t\t    || 8 * (1 - lastQuaternion.dot(this.object.quaternion)) > EPS ) {\n\n            if ( ignoreUpdate !== true ) { this.dispatchEvent( changeEvent ); }\n\n            lastPosition.copy( this.object.position );\n            lastQuaternion.copy (this.object.quaternion );\n\n        }\n\n    };\n\n\n    this.reset = function () {\n\n        state = STATE.NONE;\n\n        this.target.copy( this.target0 );\n        this.object.position.copy( this.position0 );\n        this.object.zoom = this.zoom0;\n\n        this.object.updateProjectionMatrix();\n        this.dispatchEvent( changeEvent );\n\n        this.update();\n\n    };\n\n    this.getPolarAngle = function () {\n\n        return phi;\n\n    };\n\n    this.getAzimuthalAngle = function () {\n\n        return theta;\n\n    };\n\n    function getAutoRotationAngle() {\n\n        return 2 * Math.PI / 60 / 60 * scope.autoRotateSpeed;\n\n    }\n\n    function getZoomScale() {\n\n        return Math.pow( 0.95, scope.zoomSpeed );\n\n    }\n\n    function onMouseDown( event ) {\n\n        momentumOn = false;\n\n   \t\tmomentumLeft = momentumUp = 0;\n\n        if ( scope.enabled === false ) return;\n        event.preventDefault();\n\n        if ( event.button === scope.mouseButtons.ORBIT ) {\n            if ( scope.noRotate === true ) return;\n\n            state = STATE.ROTATE;\n\n            rotateStart.set( event.clientX, event.clientY );\n\n        } else if ( event.button === scope.mouseButtons.ZOOM ) {\n            if ( scope.noZoom === true ) return;\n\n            state = STATE.DOLLY;\n\n            dollyStart.set( event.clientX, event.clientY );\n\n        } else if ( event.button === scope.mouseButtons.PAN ) {\n            if ( scope.noPan === true ) return;\n\n            state = STATE.PAN;\n\n            panStart.set( event.clientX, event.clientY );\n\n        }\n\n        if ( state !== STATE.NONE ) {\n            scope.document.addEventListener( 'mousemove', onMouseMove, false );\n            scope.document.addEventListener( 'mouseup', onMouseUp, false );\n            scope.dispatchEvent( startEvent );\n        }\n\n        scope.update();\n\n    }\n\n    function onMouseMove( event ) {\n\n        if ( scope.enabled === false ) return;\n\n        event.preventDefault();\n\n        var element = scope.domElement === document ? scope.domElement.body : scope.domElement;\n\n        if ( state === STATE.ROTATE ) {\n\n            if ( scope.noRotate === true ) return;\n\n            rotateEnd.set( event.clientX, event.clientY );\n            rotateDelta.subVectors( rotateEnd, rotateStart );\n\n            // rotating across whole screen goes 360 degrees around\n            scope.rotateLeft( 2 * Math.PI * rotateDelta.x / element.clientWidth * scope.rotateSpeed );\n\n            // rotating up and down along whole screen attempts to go 360, but limited to 180\n            scope.rotateUp( 2 * Math.PI * rotateDelta.y / element.clientHeight * scope.rotateSpeed );\n\n            rotateStart.copy( rotateEnd );\n\n            if( eventPrevious ){\n                momentumLeft = event.clientX - eventPrevious.clientX;\n                momentumUp = event.clientY - eventPrevious.clientY;\n            }\n\n            eventPrevious = event;\n\n        } else if ( state === STATE.DOLLY ) {\n\n            if ( scope.noZoom === true ) return;\n\n            dollyEnd.set( event.clientX, event.clientY );\n            dollyDelta.subVectors( dollyEnd, dollyStart );\n\n            if ( dollyDelta.y > 0 ) {\n\n                scope.dollyIn();\n\n            } else if ( dollyDelta.y < 0 ) {\n\n                scope.dollyOut();\n\n            }\n\n            dollyStart.copy( dollyEnd );\n\n        } else if ( state === STATE.PAN ) {\n\n            if ( scope.noPan === true ) return;\n\n            panEnd.set( event.clientX, event.clientY );\n            panDelta.subVectors( panEnd, panStart );\n\n            scope.pan( panDelta.x, panDelta.y );\n\n            panStart.copy( panEnd );\n\n        }\n\n        if ( state !== STATE.NONE ) scope.update();\n\n    }\n\n    function onMouseUp( /* event */ ) {\n\n        momentumOn = true;\n\n        eventPrevious = undefined;\n\n        if ( scope.enabled === false ) return;\n\n        scope.document.removeEventListener( 'mousemove', onMouseMove, false );\n        scope.document.removeEventListener( 'mouseup', onMouseUp, false );\n        scope.dispatchEvent( endEvent );\n        state = STATE.NONE;\n\n    }\n\n    function onMouseWheel( event ) {\n\n        if ( scope.enabled === false || scope.noZoom === true || state !== STATE.NONE ) return;\n\n        event.preventDefault();\n        event.stopPropagation();\n\n        var delta = 0;\n\n        if ( event.wheelDelta !== undefined ) { // WebKit / Opera / Explorer 9\n\n            delta = event.wheelDelta;\n\n        } else if ( event.detail !== undefined ) { // Firefox\n\n            delta = - event.detail;\n\n        }\n\n        if ( delta > 0 ) {\n\n            // scope.dollyOut();\n            scope.object.fov = ( scope.object.fov < scope.maxFov ) \n                ? scope.object.fov + 1\n                : scope.maxFov;\n            scope.object.updateProjectionMatrix();\n\n        } else if ( delta < 0 ) {\n\n            // scope.dollyIn();\n            scope.object.fov = ( scope.object.fov > scope.minFov ) \n                ? scope.object.fov - 1\n                : scope.minFov;\n            scope.object.updateProjectionMatrix();\n\n        }\n\n        scope.update();\n        scope.dispatchEvent( changeEvent );\n        scope.dispatchEvent( startEvent );\n        scope.dispatchEvent( endEvent );\n\n    }\n\n    function onKeyUp ( event ) {\n\n        switch ( event.keyCode ) {\n\n        case scope.keys.UP:\n            keyUp = false;\n            break;\n\n        case scope.keys.BOTTOM:\n            keyBottom = false;\n            break;\n\n        case scope.keys.LEFT:\n            keyLeft = false;\n            break;\n\n        case scope.keys.RIGHT:\n            keyRight = false;\n            break;\n\n        }\n\n    }\n\n    function onKeyDown( event ) {\n\n        if ( scope.enabled === false || scope.noKeys === true || scope.noRotate === true ) return;\n\n        switch ( event.keyCode ) {\n\n        case scope.keys.UP:\n            keyUp = true;\n            break;\n\n        case scope.keys.BOTTOM:\n            keyBottom = true;\n            break;\n\n        case scope.keys.LEFT:\n            keyLeft = true;\n            break;\n\n        case scope.keys.RIGHT:\n            keyRight = true;\n            break;\n\n        }\n\n        if (keyUp || keyBottom || keyLeft || keyRight) {\n\n            momentumOn = true;\n\n            if (keyUp) momentumUp = - scope.rotateSpeed * scope.momentumKeydownFactor;\n            if (keyBottom) momentumUp = scope.rotateSpeed * scope.momentumKeydownFactor;\n            if (keyLeft) momentumLeft = - scope.rotateSpeed * scope.momentumKeydownFactor;\n            if (keyRight) momentumLeft = scope.rotateSpeed * scope.momentumKeydownFactor;\n\n        }\n\n    }\n\n    function touchstart( event ) {\n\n        momentumOn = false;\n\n        momentumLeft = momentumUp = 0;\n\n        if ( scope.enabled === false ) return;\n\n        switch ( event.touches.length ) {\n\n        case 1:\t// one-fingered touch: rotate\n\n            if ( scope.noRotate === true ) return;\n\n            state = STATE.TOUCH_ROTATE;\n\n            rotateStart.set( event.touches[ 0 ].pageX, event.touches[ 0 ].pageY );\n            break;\n\n        case 2:\t// two-fingered touch: dolly\n\n            if ( scope.noZoom === true ) return;\n\n            state = STATE.TOUCH_DOLLY;\n\n            var dx = event.touches[ 0 ].pageX - event.touches[ 1 ].pageX;\n            var dy = event.touches[ 0 ].pageY - event.touches[ 1 ].pageY;\n            var distance = Math.sqrt( dx * dx + dy * dy );\n\n            dollyStart.set( 0, distance );\n\n            break;\n\n        case 3: // three-fingered touch: pan\n\n            if ( scope.noPan === true ) return;\n\n            state = STATE.TOUCH_PAN;\n\n            panStart.set( event.touches[ 0 ].pageX, event.touches[ 0 ].pageY );\n            break;\n\n        default:\n\n            state = STATE.NONE;\n\n        }\n\n        if ( state !== STATE.NONE ) scope.dispatchEvent( startEvent );\n\n    }\n\n    function touchmove( event ) {\n\n        if ( scope.enabled === false ) return;\n\n        event.preventDefault();\n        event.stopPropagation();\n\n        var element = scope.domElement === document ? scope.domElement.body : scope.domElement;\n\n        switch ( event.touches.length ) {\n\n        case 1: // one-fingered touch: rotate\n\n            if ( scope.noRotate === true ) return;\n            if ( state !== STATE.TOUCH_ROTATE ) return;\n\n            rotateEnd.set( event.touches[ 0 ].pageX, event.touches[ 0 ].pageY );\n            rotateDelta.subVectors( rotateEnd, rotateStart );\n\n            // rotating across whole screen goes 360 degrees around\n            scope.rotateLeft( 2 * Math.PI * rotateDelta.x / element.clientWidth * scope.rotateSpeed );\n            // rotating up and down along whole screen attempts to go 360, but limited to 180\n            scope.rotateUp( 2 * Math.PI * rotateDelta.y / element.clientHeight * scope.rotateSpeed );\n\n            rotateStart.copy( rotateEnd );\n\n            if( eventPrevious ){\n                momentumLeft = event.touches[ 0 ].pageX - eventPrevious.pageX;\n                momentumUp = event.touches[ 0 ].pageY - eventPrevious.pageY;\n            }\n\n            eventPrevious = {\n                pageX: event.touches[ 0 ].pageX,\n                pageY: event.touches[ 0 ].pageY,\n            };\n\n            scope.update();\n            break;\n\n        case 2: // two-fingered touch: dolly\n\n            if ( scope.noZoom === true ) return;\n            if ( state !== STATE.TOUCH_DOLLY ) return;\n\n            var dx = event.touches[ 0 ].pageX - event.touches[ 1 ].pageX;\n            var dy = event.touches[ 0 ].pageY - event.touches[ 1 ].pageY;\n            var distance = Math.sqrt( dx * dx + dy * dy );\n\n            dollyEnd.set( 0, distance );\n            dollyDelta.subVectors( dollyEnd, dollyStart );\n\n            if ( dollyDelta.y < 0 ) {\n\n                scope.object.fov = ( scope.object.fov < scope.maxFov ) \n                    ? scope.object.fov + 1\n                    : scope.maxFov;\n                scope.object.updateProjectionMatrix();\n\n            } else if ( dollyDelta.y > 0 ) {\n\n                scope.object.fov = ( scope.object.fov > scope.minFov ) \n                    ? scope.object.fov - 1\n                    : scope.minFov;\n                scope.object.updateProjectionMatrix();\n\n            }\n\n            dollyStart.copy( dollyEnd );\n\n            scope.update();\n            scope.dispatchEvent( changeEvent );\n            break;\n\n        case 3: // three-fingered touch: pan\n\n            if ( scope.noPan === true ) return;\n            if ( state !== STATE.TOUCH_PAN ) return;\n\n            panEnd.set( event.touches[ 0 ].pageX, event.touches[ 0 ].pageY );\n            panDelta.subVectors( panEnd, panStart );\n\n            scope.pan( panDelta.x, panDelta.y );\n\n            panStart.copy( panEnd );\n\n            scope.update();\n            break;\n\n        default:\n\n            state = STATE.NONE;\n\n        }\n\n    }\n\n    function touchend( /* event */ ) {\n\n        momentumOn = true;\n\n        eventPrevious = undefined;\n\n        if ( scope.enabled === false ) return;\n\n        scope.dispatchEvent( endEvent );\n        state = STATE.NONE;\n\n    }\n\n    this.dispose = function() {\n\n        this.domElement.removeEventListener( 'mousedown', onMouseDown );\n        this.domElement.removeEventListener( 'mousewheel', onMouseWheel );\n        this.domElement.removeEventListener( 'DOMMouseScroll', onMouseWheel );\n\n        this.domElement.removeEventListener( 'touchstart', touchstart );\n        this.domElement.removeEventListener( 'touchend', touchend );\n        this.domElement.removeEventListener( 'touchmove', touchmove );\n\n        window.removeEventListener( 'keyup', onKeyUp );\n        window.removeEventListener( 'keydown', onKeyDown );\n\n    };\n\n    // this.domElement.addEventListener( 'contextmenu', function ( event ) { event.preventDefault(); }, false );\n    this.domElement.addEventListener( 'mousedown', onMouseDown, { passive: false } );\n    this.domElement.addEventListener( 'mousewheel', onMouseWheel, { passive: false } );\n    this.domElement.addEventListener( 'DOMMouseScroll', onMouseWheel, { passive: false } ); // firefox\n\n    this.domElement.addEventListener( 'touchstart', touchstart, { passive: false } );\n    this.domElement.addEventListener( 'touchend', touchend, { passive: false } );\n    this.domElement.addEventListener( 'touchmove', touchmove, { passive: false } );\n\n    window.addEventListener( 'keyup', onKeyUp, { passive: false } );\n    window.addEventListener( 'keydown', onKeyDown, { passive: false } );\n\n    // force an update at start\n    this.update();\n\n}\nOrbitControls.prototype = Object.assign( Object.create( EventDispatcher.prototype ), {\n\n    constructor: OrbitControls\n\n} );\n\n/**\n * @classdesc Device Orientation Control\n * @constructor\n * @external DeviceOrientationControls\n * @param {THREE.Camera} camera \n * @param {HTMLElement} domElement \n */\nfunction DeviceOrientationControls ( camera, domElement ) {\n\n    var scope = this;\n    var changeEvent = { type: 'change' };\n\n    var rotY = 0;\n    var rotX = 0;\n    var tempX = 0;\n    var tempY = 0;\n\n    this.camera = camera;\n    this.camera.rotation.reorder( 'YXZ' );\n    this.domElement = ( domElement !== undefined ) ? domElement : document;\n\n    this.enabled = true;\n\n    this.deviceOrientation = {};\n    this.screenOrientation = 0;\n\n    this.alpha = 0;\n    this.alphaOffsetAngle = 0;\n\n\n    var onDeviceOrientationChangeEvent = function( event ) {\n\n        scope.deviceOrientation = event;\n\n    };\n\n    var onScreenOrientationChangeEvent = function() {\n\n        scope.screenOrientation = window.orientation || 0;\n\n    };\n\n    var onTouchStartEvent = function (event) {\n\n        event.preventDefault();\n        event.stopPropagation();\n\n        tempX = event.touches[ 0 ].pageX;\n        tempY = event.touches[ 0 ].pageY;\n\n    };\n\n    var onTouchMoveEvent = function (event) {\n\n        event.preventDefault();\n        event.stopPropagation();\n\n        rotY += Math$1.degToRad( ( event.touches[ 0 ].pageX - tempX ) / 4 );\n        rotX += Math$1.degToRad( ( tempY - event.touches[ 0 ].pageY ) / 4 );\n\n        scope.updateAlphaOffsetAngle( rotY );\n\n        tempX = event.touches[ 0 ].pageX;\n        tempY = event.touches[ 0 ].pageY;\n\n    };\n\n    // The angles alpha, beta and gamma form a set of intrinsic Tait-Bryan angles of type Z-X'-Y''\n\n    var setCameraQuaternion = function( quaternion, alpha, beta, gamma, orient ) {\n\n        var zee = new Vector3( 0, 0, 1 );\n\n        var euler = new Euler();\n\n        var q0 = new Quaternion();\n\n        var q1 = new Quaternion( - Math.sqrt( 0.5 ), 0, 0, Math.sqrt( 0.5 ) ); // - PI/2 around the x-axis\n\n        var vectorFingerY;\n        var fingerQY = new Quaternion();\n        var fingerQX = new Quaternion();\n\n        if ( scope.screenOrientation == 0 ) {\n\n            vectorFingerY = new Vector3( 1, 0, 0 );\n            fingerQY.setFromAxisAngle( vectorFingerY, -rotX );\n\n        } else if ( scope.screenOrientation == 180 ) {\n\n            vectorFingerY = new Vector3( 1, 0, 0 );\n            fingerQY.setFromAxisAngle( vectorFingerY, rotX );\n\n        } else if ( scope.screenOrientation == 90 ) {\n\n            vectorFingerY = new Vector3( 0, 1, 0 );\n            fingerQY.setFromAxisAngle( vectorFingerY, rotX );\n\n        } else if ( scope.screenOrientation == - 90) {\n\n            vectorFingerY = new Vector3( 0, 1, 0 );\n            fingerQY.setFromAxisAngle( vectorFingerY, -rotX );\n\n        }\n\n        q1.multiply( fingerQY );\n        q1.multiply( fingerQX );\n\n        euler.set( beta, alpha, - gamma, 'YXZ' ); // 'ZXY' for the device, but 'YXZ' for us\n\n        quaternion.setFromEuler( euler ); // orient the device\n\n        quaternion.multiply( q1 ); // camera looks out the back of the device, not the top\n\n        quaternion.multiply( q0.setFromAxisAngle( zee, - orient ) ); // adjust for screen orientation\n\n    };\n\n    this.connect = function() {\n\n        onScreenOrientationChangeEvent(); // run once on load\n\n        window.addEventListener( 'orientationchange', onScreenOrientationChangeEvent, { passive: true } );\n        window.addEventListener( 'deviceorientation', onDeviceOrientationChangeEvent, { passive: true } );\n        window.addEventListener( 'deviceorientation', this.update.bind( this ), { passive: true } );\n\n        scope.domElement.addEventListener( 'touchstart', onTouchStartEvent, { passive: false } );\n        scope.domElement.addEventListener( 'touchmove', onTouchMoveEvent, { passive: false } );\n\n        scope.enabled = true;\n\n    };\n\n    this.disconnect = function() {\n\n        window.removeEventListener( 'orientationchange', onScreenOrientationChangeEvent, false );\n        window.removeEventListener( 'deviceorientation', onDeviceOrientationChangeEvent, false );\n        window.removeEventListener( 'deviceorientation', this.update.bind( this ), false );\n\n        scope.domElement.removeEventListener( 'touchstart', onTouchStartEvent, false );\n        scope.domElement.removeEventListener( 'touchmove', onTouchMoveEvent, false );\n\n        scope.enabled = false;\n\n    };\n\n    this.update = function( ignoreUpdate ) {\n\n        if ( scope.enabled === false ) return;\n\n        var alpha = scope.deviceOrientation.alpha ? Math$1.degToRad( scope.deviceOrientation.alpha ) + scope.alphaOffsetAngle : 0; // Z\n        var beta = scope.deviceOrientation.beta ? Math$1.degToRad( scope.deviceOrientation.beta ) : 0; // X'\n        var gamma = scope.deviceOrientation.gamma ? Math$1.degToRad( scope.deviceOrientation.gamma ) : 0; // Y''\n        var orient = scope.screenOrientation ? Math$1.degToRad( scope.screenOrientation ) : 0; // O\n\n        setCameraQuaternion( scope.camera.quaternion, alpha, beta, gamma, orient );\n        scope.alpha = alpha;\n\n        if ( ignoreUpdate !== true ) { scope.dispatchEvent( changeEvent ); }\n\n    };\n\n    this.updateAlphaOffsetAngle = function( angle ) {\n\n        this.alphaOffsetAngle = angle;\n        this.update();\n\n    };\n\n    this.dispose = function() {\n\n        this.disconnect();\n\n    };\n\n    this.connect();\n\n}\nDeviceOrientationControls.prototype = Object.assign( Object.create( EventDispatcher.prototype), {\n\n    constructor: DeviceOrientationControls\n\n} );\n\n/**\n * @classdesc Google Cardboard Effect Composer\n * @constructor\n * @external CardboardEffect\n * @param {THREE.WebGLRenderer} renderer \n */\nfunction CardboardEffect ( renderer ) {\n\n    var _camera = new OrthographicCamera( - 1, 1, 1, - 1, 0, 1 );\n\n    var _scene = new Scene();\n\n    var _stereo = new StereoCamera();\n    _stereo.aspect = 0.5;\n\n    var _params = { minFilter: LinearFilter, magFilter: NearestFilter, format: RGBAFormat };\n\n    var _renderTarget = new WebGLRenderTarget( 512, 512, _params );\n    _renderTarget.scissorTest = true;\n    _renderTarget.texture.generateMipmaps = false;\n\n    /*\n     * Distortion Mesh ported from:\n     * https://github.com/borismus/webvr-boilerplate/blob/master/src/distortion/barrel-distortion-fragment.js\n     */\n\n    var distortion = new Vector2( 0.441, 0.156 );\n\n    var geometry = new PlaneBufferGeometry( 1, 1, 10, 20 ).removeAttribute( 'normal' ).toNonIndexed();\n\n    var positions = geometry.attributes.position.array;\n    var uvs = geometry.attributes.uv.array;\n\n    // duplicate\n    geometry.attributes.position.count *= 2;\n    geometry.attributes.uv.count *= 2;\n\n    var positions2 = new Float32Array( positions.length * 2 );\n    positions2.set( positions );\n    positions2.set( positions, positions.length );\n\n    var uvs2 = new Float32Array( uvs.length * 2 );\n    uvs2.set( uvs );\n    uvs2.set( uvs, uvs.length );\n\n    var vector = new Vector2();\n    var length = positions.length / 3;\n\n    for ( var i = 0, l = positions2.length / 3; i < l; i ++ ) {\n\n        vector.x = positions2[ i * 3 + 0 ];\n        vector.y = positions2[ i * 3 + 1 ];\n\n        var dot = vector.dot( vector );\n        var scalar = 1.5 + ( distortion.x + distortion.y * dot ) * dot;\n\n        var offset = i < length ? 0 : 1;\n\n        positions2[ i * 3 + 0 ] = ( vector.x / scalar ) * 1.5 - 0.5 + offset;\n        positions2[ i * 3 + 1 ] = ( vector.y / scalar ) * 3.0;\n\n        uvs2[ i * 2 ] = ( uvs2[ i * 2 ] + offset ) * 0.5;\n\n    }\n\n    geometry.attributes.position.array = positions2;\n    geometry.attributes.uv.array = uvs2;\n\n    //\n\n    var material = new MeshBasicMaterial( { map: _renderTarget.texture } );\n    var mesh = new Mesh( geometry, material );\n    _scene.add( mesh );\n\n    //\n\n    this.setSize = function ( width, height ) {\n\n        renderer.setSize( width, height );\n\n        var pixelRatio = renderer.getPixelRatio();\n\n        _renderTarget.setSize( width * pixelRatio, height * pixelRatio );\n\n    };\n\n    this.render = function ( scene, camera ) {\n\n        scene.updateMatrixWorld();\n\n        if ( camera.parent === null ) camera.updateMatrixWorld();\n\n        _stereo.update( camera );\n\n        var width = _renderTarget.width / 2;\n        var height = _renderTarget.height;\n\n        if ( renderer.autoClear ) renderer.clear();\n\n        _renderTarget.scissor.set( 0, 0, width, height );\n        _renderTarget.viewport.set( 0, 0, width, height );\n        renderer.setRenderTarget( _renderTarget );\n        renderer.render( scene, _stereo.cameraL );\n\n        renderer.clearDepth();\n\n        _renderTarget.scissor.set( width, 0, width, height );\n        _renderTarget.viewport.set( width, 0, width, height );\n        renderer.setRenderTarget( _renderTarget );\n        renderer.render( scene, _stereo.cameraR );\n\n        renderer.clearDepth();\n\n        renderer.setRenderTarget( null );\n        renderer.render( _scene, _camera );\n    };\n\n}\n\n/**\n * @classdesc Stereo Effect Composer\n * @constructor\n * @external StereoEffect\n * @param {THREE.WebGLRenderer} renderer \n */\nconst StereoEffect = function ( renderer ) {\n\n    var _stereo = new StereoCamera();\n    _stereo.aspect = 0.5;\n    var size = new Vector2();\n\n    this.setEyeSeparation = function ( eyeSep ) {\n\n        _stereo.eyeSep = eyeSep;\n\n    };\n\n    this.setSize = function ( width, height ) {\n\n        renderer.setSize( width, height );\n\n    };\n\n    this.render = function ( scene, camera ) {\n\n        scene.updateMatrixWorld();\n\n        if ( camera.parent === null ) camera.updateMatrixWorld();\n\n        _stereo.update( camera );\n\n        renderer.getSize( size );\n\n        if ( renderer.autoClear ) renderer.clear();\n        renderer.setScissorTest( true );\n\n        renderer.setScissor( 0, 0, size.width / 2, size.height );\n        renderer.setViewport( 0, 0, size.width / 2, size.height );\n        renderer.render( scene, _stereo.cameraL );\n\n        renderer.setScissor( size.width / 2, 0, size.width / 2, size.height );\n        renderer.setViewport( size.width / 2, 0, size.width / 2, size.height );\n        renderer.render( scene, _stereo.cameraR );\n\n        renderer.setScissorTest( false );\n\n    };\n\n};\n\n/**\n * @classdesc Viewer contains pre-defined scene, camera and renderer\n * @constructor\n * @param {object} [options] - Use custom or default config options\n * @param {HTMLElement} [options.container] - A HTMLElement to host the canvas\n * @param {THREE.Scene} [options.scene=THREE.Scene] - A THREE.Scene which contains panorama and 3D objects\n * @param {THREE.Camera} [options.camera=THREE.PerspectiveCamera] - A THREE.Camera to view the scene\n * @param {THREE.WebGLRenderer} [options.renderer=THREE.WebGLRenderer] - A THREE.WebGLRenderer to render canvas\n * @param {boolean} [options.controlBar=true] - Show/hide control bar on the bottom of the container\n * @param {array}   [options.controlButtons=[]] - Button names to mount on controlBar if controlBar exists, Defaults to ['fullscreen', 'setting', 'video']\n * @param {boolean} [options.autoHideControlBar=false] - Auto hide control bar when click on non-active area\n * @param {boolean} [options.autoHideInfospot=true] - Auto hide infospots when click on non-active area\n * @param {boolean} [options.horizontalView=false] - Allow only horizontal camera control\n * @param {number}  [options.clickTolerance=10] - Distance tolerance to tigger click / tap event\n * @param {number}  [options.cameraFov=60] - Camera field of view value\n * @param {boolean} [options.reverseDragging=false] - Reverse dragging direction\n * @param {boolean} [options.enableReticle=false] - Enable reticle for mouseless interaction other than VR mode\n * @param {number}  [options.dwellTime=1500] - Dwell time for reticle selection in ms\n * @param {boolean} [options.autoReticleSelect=true] - Auto select a clickable target after dwellTime\n * @param {boolean} [options.viewIndicator=false] - Adds an angle view indicator in upper left corner\n * @param {number}  [options.indicatorSize=30] - Size of View Indicator\n * @param {string}  [options.output='none'] - Whether and where to output raycast position. Could be 'event', 'console' or 'overlay'.\n * @param {boolean} [options.autoRotate=false] - Auto rotate\n * @param {number}  [options.autoRotateSpeed=2.0] - Auto rotate speed as in degree per second. Positive is counter-clockwise and negative is clockwise.\n * @param {number}  [options.autoRotateActivationDuration=5000] - Duration before auto rotatation when no user interactivity in ms\n */\nfunction Viewer ( options ) {\n\n    let container;\n\n    options = options || {};\n    options.controlBar = options.controlBar !== undefined ? options.controlBar : true;\n    options.controlButtons = options.controlButtons || [ 'fullscreen', 'setting', 'video' ];\n    options.autoHideControlBar = options.autoHideControlBar !== undefined ? options.autoHideControlBar : false;\n    options.autoHideInfospot = options.autoHideInfospot !== undefined ? options.autoHideInfospot : true;\n    options.horizontalView = options.horizontalView !== undefined ? options.horizontalView : false;\n    options.clickTolerance = options.clickTolerance || 10;\n    options.cameraFov = options.cameraFov || 60;\n    options.reverseDragging = options.reverseDragging || false;\n    options.enableReticle = options.enableReticle || false;\n    options.dwellTime = options.dwellTime || 1500;\n    options.autoReticleSelect = options.autoReticleSelect !== undefined ? options.autoReticleSelect : true;\n    options.viewIndicator = options.viewIndicator !== undefined ? options.viewIndicator : false;\n    options.indicatorSize = options.indicatorSize || 30;\n    options.output = options.output ? options.output : 'none';\n    options.autoRotate = options.autoRotate || false;\n    options.autoRotateSpeed = options.autoRotateSpeed || 2.0;\n    options.autoRotateActivationDuration = options.autoRotateActivationDuration || 5000;\n\n    this.options = options;\n\n    /*\n     * CSS Icon\n     * const styleLoader = new StyleLoader();\n     * styleLoader.inject( 'icono' );\n     */\n\n    // Container\n    if ( options.container ) {\n\n        container = options.container;\n        container._width = container.clientWidth;\n        container._height = container.clientHeight;\n\n    } else {\n\n        container = document.createElement( 'div' );\n        container.classList.add( 'panolens-container' );\n        container.style.width = '100%';\n        container.style.height = '100%';\n        container._width = window.innerWidth;\n        container._height = window.innerHeight;\n        document.body.appendChild( container );\n\n    }\n\n    this.container = container;\n\n    this.camera = options.camera || new PerspectiveCamera( this.options.cameraFov, this.container.clientWidth / this.container.clientHeight, 1, 10000 );\n    this.scene = options.scene || new Scene();\n    this.renderer = options.renderer || new WebGLRenderer( { alpha: true, antialias: false } );\n    this.sceneReticle = new Scene();\n\n    this.viewIndicatorSize = this.options.indicatorSize;\n\n    this.reticle = {};\n    this.tempEnableReticle = this.options.enableReticle;\n\n    this.mode = MODES.NORMAL;\n\n    this.panorama = null;\n    this.widget = null;\n\n    this.hoverObject = null;\n    this.infospot = null;\n    this.pressEntityObject = null;\n    this.pressObject = null;\n\n    this.raycaster = new Raycaster();\n    this.raycasterPoint = new Vector2();\n    this.userMouse = new Vector2();\n    this.updateCallbacks = [];\n    this.requestAnimationId = null;\n\n    this.cameraFrustum = new Frustum();\n    this.cameraViewProjectionMatrix = new Matrix4();\n\n    this.autoRotateRequestId = null;\n\n    this.outputDivElement = null;\n\n    this.touchSupported = 'ontouchstart' in window || window.DocumentTouch && document instanceof DocumentTouch;\n\n    // Handler references\n    this.HANDLER_MOUSE_DOWN = this.onMouseDown.bind( this );\n    this.HANDLER_MOUSE_UP = this.onMouseUp.bind( this );\n    this.HANDLER_MOUSE_MOVE = this.onMouseMove.bind( this );\n    this.HANDLER_WINDOW_RESIZE = this.onWindowResize.bind( this );\n    this.HANDLER_KEY_DOWN = this.onKeyDown.bind( this );\n    this.HANDLER_KEY_UP = this.onKeyUp.bind( this );\n    this.HANDLER_TAP = this.onTap.bind( this, {\n        clientX: this.container.clientWidth / 2,\n        clientY: this.container.clientHeight / 2\n    } );\n\n    // Flag for infospot output\n    this.OUTPUT_INFOSPOT = false;\n\n    // Animations\n    this.tweenLeftAnimation = new Tween.Tween();\n    this.tweenUpAnimation = new Tween.Tween();\n\n    // Renderer\n    this.renderer.setPixelRatio( window.devicePixelRatio );\n    this.renderer.setSize( this.container.clientWidth, this.container.clientHeight );\n    this.renderer.setClearColor( 0x000000, 0 );\n    this.renderer.autoClear = false;\n\n    // Append Renderer Element to container\n    this.renderer.domElement.classList.add( 'panolens-canvas' );\n    this.renderer.domElement.style.display = 'block';\n    this.container.style.backgroundColor = '#000';\n    this.container.appendChild( this.renderer.domElement );\n\n    // Camera Controls\n    this.OrbitControls = new OrbitControls( this.camera, this.container );\n    this.OrbitControls.id = 'orbit';\n    this.OrbitControls.minDistance = 1;\n    this.OrbitControls.noPan = true;\n    this.OrbitControls.autoRotate = this.options.autoRotate;\n    this.OrbitControls.autoRotateSpeed = this.options.autoRotateSpeed;\n\n    this.DeviceOrientationControls = new DeviceOrientationControls( this.camera, this.container );\n    this.DeviceOrientationControls.id = 'device-orientation';\n    this.DeviceOrientationControls.enabled = false;\n    this.camera.position.z = 1;\n\n    // Register change event if passiveRenering\n    if ( this.options.passiveRendering ) {\n\n        console.warn( 'passiveRendering is now deprecated' );\n\n    }\n\n    // Controls\n    this.controls = [ this.OrbitControls, this.DeviceOrientationControls ];\n    this.control = this.OrbitControls;\n\n    // Cardboard effect\n    this.CardboardEffect = new CardboardEffect( this.renderer );\n    this.CardboardEffect.setSize( this.container.clientWidth, this.container.clientHeight );\n\n    // Stereo effect\n    this.StereoEffect = new StereoEffect( this.renderer );\n    this.StereoEffect.setSize( this.container.clientWidth, this.container.clientHeight );\n\n    this.effect = this.CardboardEffect;\n\n    // Add default hidden reticle\n    this.addReticle();\n\n    // Lock horizontal view\n    if ( this.options.horizontalView ) {\n        this.OrbitControls.minPolarAngle = Math.PI / 2;\n        this.OrbitControls.maxPolarAngle = Math.PI / 2;\n    }\n\n    // Add Control UI\n    if ( this.options.controlBar !== false ) {\n        this.addDefaultControlBar( this.options.controlButtons );\n    }\n\n    // Add View Indicator\n    if ( this.options.viewIndicator ) {\n        this.addViewIndicator();\n    }\n\n    // Reverse dragging direction\n    if ( this.options.reverseDragging ) {\n        this.reverseDraggingDirection();\n    }\n\n    // Register event if reticle is enabled, otherwise defaults to mouse\n    if ( this.options.enableReticle ) {\n        this.enableReticleControl();\n    } else {\n        this.registerMouseAndTouchEvents();\n    }\n\n    // Output infospot position to an overlay container if specified\n    if ( this.options.output === 'overlay' ) {\n        this.addOutputElement();\n    }\n\n    // Register dom event listeners\n    this.registerEventListeners();\n\n    // Animate\n    this.animate.call( this );\n\n}\nViewer.prototype = Object.assign( Object.create( EventDispatcher.prototype ), {\n\n    constructor: Viewer,\n\n    /**\n     * Add an object to the scene\n     * Automatically hookup with panolens-viewer-handler listener\n     * to communicate with viewer method\n     * @param {THREE.Object3D} object - The object to be added\n     * @memberOf Viewer\n     * @instance\n     */\n    add: function ( object ) {\n\n        if ( arguments.length > 1 ) {\n\n            for ( let i = 0; i < arguments.length; i ++ ) {\n\n                this.add( arguments[ i ] );\n\n            }\n\n            return this;\n\n        }\n\n        this.scene.add( object );\n\n        // All object added to scene has 'panolens-viewer-handler' event to handle viewer communication\n        if ( object.addEventListener ) {\n\n            object.addEventListener( 'panolens-viewer-handler', this.eventHandler.bind( this ) );\n\n        }\n\n        // All object added to scene being passed with container\n        if ( object instanceof Panorama && object.dispatchEvent ) {\n\n            object.dispatchEvent( { type: 'panolens-container', container: this.container } );\n\n        }\n\n        if ( object instanceof CameraPanorama ) {\n\n            object.dispatchEvent( { type: 'panolens-scene', scene: this.scene } );\n\n        }\n\n        // Hookup default panorama event listeners\n        if ( object.type === 'panorama' ) {\n\n            this.addPanoramaEventListener( object );\n\n            if ( !this.panorama ) {\n\n                this.setPanorama( object );\n\n            }\n\n        }\n\n    },\n\n    /**\n     * Remove an object from the scene\n     * @param  {THREE.Object3D} object - Object to be removed\n     * @memberOf Viewer\n     * @instance\n     */\n    remove: function ( object ) {\n\n        if ( object.removeEventListener ) {\n\n            object.removeEventListener( 'panolens-viewer-handler', this.eventHandler.bind( this ) );\n\n        }\n\n        this.scene.remove( object );\n\n    },\n\n    /**\n     * Add default control bar\n     * @param {array} array - The control buttons array\n     * @memberOf Viewer\n     * @instance\n     */\n    addDefaultControlBar: function ( array ) {\n\n        if ( this.widget ) {\n\n            console.warn( 'Default control bar exists' );\n            return;\n\n        }\n\n        const widget = new Widget( this.container );\n        widget.addEventListener( 'panolens-viewer-handler', this.eventHandler.bind( this ) );\n        widget.addControlBar();\n        array.forEach( buttonName => {\n\n            widget.addControlButton( buttonName );\n\n        } );\n\n        this.widget = widget;\n\n    },\n\n    /**\n     * Set a panorama to be the current one\n     * @param {Panorama} pano - Panorama to be set\n     * @memberOf Viewer\n     * @instance\n     */\n    setPanorama: function ( pano ) {\n\n        const leavingPanorama = this.panorama;\n\n        if ( pano.type === 'panorama' && leavingPanorama !== pano ) {\n\n            // Clear exisiting infospot\n            this.hideInfospot();\n\n            const afterEnterComplete = function () {\n\n                if ( leavingPanorama ) { leavingPanorama.onLeave(); }\n                pano.removeEventListener( 'enter-fade-start', afterEnterComplete );\n\n            };\n\n            pano.addEventListener( 'enter-fade-start', afterEnterComplete );\n\n            // Assign and enter panorama\n            (this.panorama = pano).onEnter();\n\t\t\t\n        }\n\n    },\n\n    /**\n     * Event handler to execute commands from child objects\n     * @param {object} event - The dispatched event with method as function name and data as an argument\n     * @memberOf Viewer\n     * @instance\n     */\n    eventHandler: function ( event ) {\n\n        if ( event.method && this[ event.method ] ) {\n\n            this[ event.method ]( event.data );\n\n        }\n\n    },\n\n    /**\n     * Dispatch event to all descendants\n     * @param  {object} event - Event to be passed along\n     * @memberOf Viewer\n     * @instance\n     */\n    dispatchEventToChildren: function ( event ) {\n\n        this.scene.traverse( function ( object ) {\n\n            if ( object.dispatchEvent ) {\n\n                object.dispatchEvent( event );\n\n            }\n\n        });\n\n    },\n\n    /**\n     * Set widget content\n     * @method activateWidgetItem\n     * @param  {integer} controlIndex - Control index\n     * @param  {integer} mode - Modes for effects\n     * @memberOf Viewer\n     * @instance\n     */\n    activateWidgetItem: function ( controlIndex, mode ) {\n\n        const mainMenu = this.widget.mainMenu;\n        const ControlMenuItem = mainMenu.children[ 0 ];\n        const ModeMenuItem = mainMenu.children[ 1 ];\n\n        let item;\n\n        if ( controlIndex !== undefined ) {\n\n            switch ( controlIndex ) {\n\n            case 0:\n\n                item = ControlMenuItem.subMenu.children[ 1 ];\n\n                break;\n\n            case 1:\n\n                item = ControlMenuItem.subMenu.children[ 2 ];\n\n                break;\n\t\t\t\t\t\n            default:\n\n                item = ControlMenuItem.subMenu.children[ 1 ];\n\n                break;\t\n\n            }\n\n            ControlMenuItem.subMenu.setActiveItem( item );\n            ControlMenuItem.setSelectionTitle( item.textContent );\n\n        }\n\n        if ( mode !== undefined ) {\n\n            switch( mode ) {\n\n            case MODES.CARDBOARD:\n\n                item = ModeMenuItem.subMenu.children[ 2 ];\n\n                break;\n\n            case MODES.STEREO:\n\n                item = ModeMenuItem.subMenu.children[ 3 ];\n\t\t\t\t\t\n                break;\n\n            default:\n\n                item = ModeMenuItem.subMenu.children[ 1 ];\n\n                break;\n            }\n\n            ModeMenuItem.subMenu.setActiveItem( item );\n            ModeMenuItem.setSelectionTitle( item.textContent );\n\n        }\n\n    },\n\n    /**\n     * Enable rendering effect\n     * @param  {MODES} mode - Modes for effects\n     * @memberOf Viewer\n     * @instance\n     */\n    enableEffect: function ( mode ) {\n\n        if ( this.mode === mode ) { return; }\n        if ( mode === MODES.NORMAL ) { this.disableEffect(); return; }\n        else { this.mode = mode; }\n\n        const fov = this.camera.fov;\n\n        switch( mode ) {\n\n        case MODES.CARDBOARD:\n\n            this.effect = this.CardboardEffect;\n            this.enableReticleControl();\n\n            break;\n\n        case MODES.STEREO:\n\n            this.effect = this.StereoEffect;\n            this.enableReticleControl();\n\t\t\t\t\n            break;\n\n        default:\n\n            this.effect = null;\n            this.disableReticleControl();\n\n            break;\n\n        }\n\n        this.activateWidgetItem( undefined, this.mode );\n\n        /**\n         * Dual eye effect event\n         * @type {object}\n         * @event Infospot#panolens-dual-eye-effect\n         * @property {MODES} mode - Current display mode\n         */\n        this.dispatchEventToChildren( { type: 'panolens-dual-eye-effect', mode: this.mode } );\n\n        // Force effect stereo camera to update by refreshing fov\n        this.camera.fov = fov + 10e-3;\n        this.effect.setSize( this.container.clientWidth, this.container.clientHeight );\n        this.render();\n        this.camera.fov = fov;\n\n        /**\n         * Dispatch mode change event\n         * @type {object}\n         * @event Viewer#mode-change\n         * @property {MODES} mode - Current display mode\n         */\n        this.dispatchEvent( { type: 'mode-change', mode: this.mode } );\n\n    },\n\n    /**\n     * Disable additional rendering effect\n     * @memberOf Viewer\n     * @instance\n     */\n    disableEffect: function () {\n\n        if ( this.mode === MODES.NORMAL ) { return; }\n\n        this.mode = MODES.NORMAL;\n        this.disableReticleControl();\n\n        this.activateWidgetItem( undefined, this.mode );\n\n        /**\n         * Dual eye effect event\n         * @type {object}\n         * @event Infospot#panolens-dual-eye-effect\n         * @property {MODES} mode - Current display mode\n         */\n        this.dispatchEventToChildren( { type: 'panolens-dual-eye-effect', mode: this.mode } );\n\n        this.renderer.setSize( this.container.clientWidth, this.container.clientHeight );\n        this.render();\n\n        /**\n         * Dispatch mode change event\n         * @type {object}\n         * @event Viewer#mode-change\n         * @property {MODES} mode - Current display mode\n         */\n        this.dispatchEvent( { type: 'mode-change', mode: this.mode } );\n    },\n\n    /**\n     * Enable reticle control\n     * @memberOf Viewer\n     * @instance\n     */\n    enableReticleControl: function () {\n\n        if ( this.reticle.visible ) { return; }\n\n        this.tempEnableReticle = true;\n\n        // Register reticle event and unregister mouse event\n        this.unregisterMouseAndTouchEvents();\n        this.reticle.show();\n        this.registerReticleEvent();\n        this.updateReticleEvent();\n\n    },\n\n    /**\n     * Disable reticle control\n     * @memberOf Viewer\n     * @instance\n     */\n    disableReticleControl: function () {\n\n        this.tempEnableReticle = false;\n\n        // Register mouse event and unregister reticle event\n        if ( !this.options.enableReticle ) {\n\n            this.reticle.hide();\n            this.unregisterReticleEvent();\n            this.registerMouseAndTouchEvents();\n\n        } else {\n\n            this.updateReticleEvent();\n\n        }\n\n    },\n\n    /**\n     * Enable auto rotation\n     * @memberOf Viewer\n     * @instance\n     */\n    enableAutoRate: function () {\n\n        this.options.autoRotate = true;\n        this.OrbitControls.autoRotate = true;\n\n    },\n\n    /**\n     * Disable auto rotation\n     * @memberOf Viewer\n     * @instance\n     */\n    disableAutoRate: function () {\n\n        clearTimeout( this.autoRotateRequestId );\n        this.options.autoRotate = false;\n        this.OrbitControls.autoRotate = false;\n\n    },\n\n    /**\n     * Toggle video play or stop\n     * @param {boolean} pause\n     * @memberOf Viewer\n     * @instance\n     * @fires Viewer#video-toggle\n     */\n    toggleVideoPlay: function ( pause ) {\n\n        if ( this.panorama instanceof VideoPanorama ) {\n\n            /**\n             * Toggle video event\n             * @type {object}\n             * @event Viewer#video-toggle\n             */\n            this.panorama.dispatchEvent( { type: 'video-toggle', pause: pause } );\n\n        }\n\n    },\n\n    /**\n     * Set currentTime in a video\n     * @param {number} percentage - Percentage of a video. Range from 0.0 to 1.0\n     * @memberOf Viewer\n     * @instance\n     * @fires Viewer#video-time\n     */\n    setVideoCurrentTime: function ( percentage ) {\n\n        if ( this.panorama instanceof VideoPanorama ) {\n\n            /**\n             * Setting video time event\n             * @type {object}\n             * @event Viewer#video-time\n             * @property {number} percentage - Percentage of a video. Range from 0.0 to 1.0\n             */\n            this.panorama.dispatchEvent( { type: 'video-time', percentage: percentage } );\n\n        }\n\n    },\n\n    /**\n     * This will be called when video updates if an widget is present\n     * @param {number} percentage - Percentage of a video. Range from 0.0 to 1.0\n     * @memberOf Viewer\n     * @instance\n     * @fires Viewer#video-update\n     */\n    onVideoUpdate: function ( percentage ) {\n\n        const { widget } = this;\n\n        /**\n         * Video update event\n         * @type {object}\n         * @event Viewer#video-update\n         * @property {number} percentage - Percentage of a video. Range from 0.0 to 1.0\n         */\n        if( widget ) { widget.dispatchEvent( { type: 'video-update', percentage: percentage } ); }\n\n    },\n\n    /**\n     * Add update callback to be called every animation frame\n     * @param {function} callback\n     * @memberOf Viewer\n     * @instance\n     */\n    addUpdateCallback: function ( fn ) {\n\n        if ( fn ) {\n\n            this.updateCallbacks.push( fn );\n\n        }\n\n    },\n\n    /**\n     * Remove update callback\n     * @param  {function} fn - The function to be removed\n     * @memberOf Viewer\n     * @instance\n     */\n    removeUpdateCallback: function ( fn ) {\n\n        const index = this.updateCallbacks.indexOf( fn );\n\n        if ( fn && index >= 0 ) {\n\n            this.updateCallbacks.splice( index, 1 );\n\n        }\n\n    },\n\n    /**\n     * Show video widget\n     * @memberOf Viewer\n     * @instance\n     */\n    showVideoWidget: function () {\n\n        const { widget } = this;\n\n        /**\n         * Show video widget event\n         * @type {object}\n         * @event Viewer#video-control-show\n         */\n        if( widget ) { widget.dispatchEvent( { type: 'video-control-show' } ); }\n\n    },\n\n    /**\n     * Hide video widget\n     * @memberOf Viewer\n     * @instance\n     */\n    hideVideoWidget: function () {\n\n        const { widget } = this;\n\n        /**\n         * Hide video widget\n         * @type {object}\n         * @event Viewer#video-control-hide\n         */\n        if( widget ) { widget.dispatchEvent( { type: 'video-control-hide' } ); }\n\n    },\n\n    /**\n     * Update video play button\n     * @param {boolean} paused \n     * @memberOf Viewer\n     * @instance\n     */\n    updateVideoPlayButton: function ( paused ) {\n\n        const { widget } = this;\n\n        if ( widget && widget.videoElement && widget.videoElement.controlButton ) {\n\n            widget.videoElement.controlButton.update( paused );\n\n        }\n\n    },\n\n    /**\n     * Add default panorama event listeners\n     * @param {Panorama} pano - The panorama to be added with event listener\n     * @memberOf Viewer\n     * @instance\n     */\n    addPanoramaEventListener: function ( pano ) {\n\n        // Set camera control on every panorama\n        pano.addEventListener( 'enter-fade-start', this.setCameraControl.bind( this ) );\n\n        // Show and hide widget event only when it's VideoPanorama\n        if ( pano instanceof VideoPanorama ) {\n\n            pano.addEventListener( 'enter-fade-start', this.showVideoWidget.bind( this ) );\n            pano.addEventListener( 'leave', function () {\n\n                if ( !(this.panorama instanceof VideoPanorama) ) {\n\n                    this.hideVideoWidget.call( this );\n\n                }\n\t\t\t\t\n            }.bind( this ) );\n\n        }\n\n    },\n\n    /**\n     * Set camera control\n     * @memberOf Viewer\n     * @instance\n     */\n    setCameraControl: function () {\n\n        this.OrbitControls.target.copy( this.panorama.position );\n\n    },\n\n    /**\n     * Get current camera control\n     * @return {object} - Current navigation control\n     * @memberOf Viewer\n     * @instance\n     * @returns {THREE.OrbitControls|THREE.DeviceOrientationControls}\n     */\n    getControl: function () {\n\n        return this.control;\n\n    },\n\n    /**\n     * Get scene\n     * @memberOf Viewer\n     * @instance\n     * @return {THREE.Scene} - Current scene which the viewer is built on\n     */\n    getScene: function () {\n\n        return this.scene;\n\n    },\n\n    /**\n     * Get camera\n     * @memberOf Viewer\n     * @instance\n     * @return {THREE.Camera} - The scene camera\n     */\n    getCamera: function () {\n\n        return this.camera;\n\n    },\n\n    /**\n     * Get renderer\n     * @memberOf Viewer\n     * @instance\n     * @return {THREE.WebGLRenderer} - The renderer using webgl\n     */\n    getRenderer: function () {\n\n        return this.renderer;\n\n    },\n\n    /**\n     * Get container\n     * @memberOf Viewer\n     * @instance\n     * @return {HTMLElement} - The container holds rendererd canvas\n     */\n    getContainer: function () {\n\n        return this.container;\n\n    },\n\n    /**\n     * Get control id\n     * @memberOf Viewer\n     * @instance\n     * @return {string} - Control id. 'orbit' or 'device-orientation'\n     */\n    getControlId: function () {\n\n        return this.control.id;\n\n    },\n\n    /**\n     * Get next navigation control id\n     * @memberOf Viewer\n     * @instance\n     * @return {string} - Next control id\n     */\n    getNextControlId: function () {\n\n        return this.controls[ this.getNextControlIndex() ].id;\n\n    },\n\n    /**\n     * Get next navigation control index\n     * @memberOf Viewer\n     * @instance\n     * @return {number} - Next control index\n     */\n    getNextControlIndex: function () {\n\n        const controls = this.controls;\n        const control = this.control;\n        const nextIndex = controls.indexOf( control ) + 1;\n\n        return ( nextIndex >= controls.length ) ? 0 : nextIndex;\n\n    },\n\n    /**\n     * Set field of view of camera\n     * @param {number} fov\n     * @memberOf Viewer\n     * @instance\n     */\n    setCameraFov: function ( fov ) {\n\n        this.camera.fov = fov;\n        this.camera.updateProjectionMatrix();\n\n    },\n\n    /**\n     * Enable control by index\n     * @param  {CONTROLS} index - Index of camera control\n     * @memberOf Viewer\n     * @instance\n     */\n    enableControl: function ( index ) {\n\n        index = ( index >= 0 && index < this.controls.length ) ? index : 0;\n\n        this.control.enabled = false;\n\n        this.control = this.controls[ index ];\n\n        this.control.enabled = true;\n\n        switch ( index ) {\n\n        case CONTROLS.ORBIT:\n\n            this.camera.position.copy( this.panorama.position );\n            this.camera.position.z += 1;\n\n            break;\n\n        case CONTROLS.DEVICEORIENTATION:\n\n            this.camera.position.copy( this.panorama.position );\n\n            break;\n\n        default:\n\n            break;\n        }\n\n        this.control.update();\n\n        this.activateWidgetItem( index, undefined );\n\n    },\n\n    /**\n     * Disable current control\n     * @memberOf Viewer\n     * @instance\n     */\n    disableControl: function () {\n\n        this.control.enabled = false;\n\n    },\n\n    /**\n     * Toggle next control\n     * @memberOf Viewer\n     * @instance\n     */\n    toggleNextControl: function () {\n\n        this.enableControl( this.getNextControlIndex() );\n\n    },\n\n    /**\n     * Screen Space Projection\n     * @memberOf Viewer\n     * @instance\n     */\n    getScreenVector: function ( worldVector ) {\n\n        const vector = worldVector.clone();\n        const widthHalf = ( this.container.clientWidth ) / 2;\n        const heightHalf = this.container.clientHeight / 2;\n\n        vector.project( this.camera );\n\n        vector.x = ( vector.x * widthHalf ) + widthHalf;\n        vector.y = - ( vector.y * heightHalf ) + heightHalf;\n        vector.z = 0;\n\n        return vector;\n\n    },\n\n    /**\n     * Check Sprite in Viewport\n     * @memberOf Viewer\n     * @instance\n     */\n    checkSpriteInViewport: function ( sprite ) {\n\n        this.camera.matrixWorldInverse.getInverse( this.camera.matrixWorld );\n        this.cameraViewProjectionMatrix.multiplyMatrices( this.camera.projectionMatrix, this.camera.matrixWorldInverse );\n        this.cameraFrustum.setFromMatrix( this.cameraViewProjectionMatrix );\n\n        return sprite.visible && this.cameraFrustum.intersectsSprite( sprite );\n\n    },\n\n    /**\n     * Reverse dragging direction\n     * @memberOf Viewer\n     * @instance\n     */\n    reverseDraggingDirection: function () {\n\n        this.OrbitControls.rotateSpeed *= -1;\n        this.OrbitControls.momentumScalingFactor *= -1;\n\n    },\n\n    /**\n     * Add reticle \n     * @memberOf Viewer\n     * @instance\n     */\n    addReticle: function () {\n\n        this.reticle = new Reticle( 0xffffff, true, this.options.dwellTime );\n        this.reticle.hide();\n        this.camera.add( this.reticle );\n        this.sceneReticle.add( this.camera );\n\n    },\n\n    /**\n     * Tween control looking center\n     * @param {THREE.Vector3} vector - Vector to be looked at the center\n     * @param {number} [duration=1000] - Duration to tween\n     * @param {function} [easing=TWEEN.Easing.Exponential.Out] - Easing function\n     * @memberOf Viewer\n     * @instance\n     */\n    tweenControlCenter: function ( vector, duration, easing ) {\n\n        if ( this.control !== this.OrbitControls ) {\n\n            return;\n\n        }\n\n        // Pass in arguments as array\n        if ( vector instanceof Array ) {\n\n            duration = vector[ 1 ];\n            easing = vector[ 2 ];\n            vector = vector[ 0 ];\n\n        }\n\n        duration = duration !== undefined ? duration : 1000;\n        easing = easing || Tween.Easing.Exponential.Out;\n\n        let scope, ha, va, chv, cvv, hv, vv, vptc, ov, nv;\n\n        scope = this;\n\n        chv = this.camera.getWorldDirection( new Vector3() );\n        cvv = chv.clone();\n\n        vptc = this.panorama.getWorldPosition( new Vector3() ).sub( this.camera.getWorldPosition( new Vector3() ) );\n\n        hv = vector.clone();\n        // Scale effect\n        hv.x *= -1;\n        hv.add( vptc ).normalize();\n        vv = hv.clone();\n\n        chv.y = 0;\n        hv.y = 0;\n\n        ha = Math.atan2( hv.z, hv.x ) - Math.atan2( chv.z, chv.x );\n        ha = ha > Math.PI ? ha - 2 * Math.PI : ha;\n        ha = ha < -Math.PI ? ha + 2 * Math.PI : ha;\n        va = Math.abs( cvv.angleTo( chv ) + ( cvv.y * vv.y <= 0 ? vv.angleTo( hv ) : -vv.angleTo( hv ) ) );\n        va *= vv.y < cvv.y ? 1 : -1;\n\n        ov = { left: 0, up: 0 };\n        nv = { left: 0, up: 0 };\n\n        this.tweenLeftAnimation.stop();\n        this.tweenUpAnimation.stop();\n\n        this.tweenLeftAnimation = new Tween.Tween( ov )\n            .to( { left: ha }, duration )\n            .easing( easing )\n            .onUpdate(function(ov){\n                scope.control.rotateLeft( ov.left - nv.left );\n                nv.left = ov.left;\n            })\n            .start();\n\n        this.tweenUpAnimation = new Tween.Tween( ov )\n            .to( { up: va }, duration )\n            .easing( easing )\n            .onUpdate(function(ov){\n                scope.control.rotateUp( ov.up - nv.up );\n                nv.up = ov.up;\n            })\n            .start();\n\n    },\n\n    /**\n     * Tween control looking center by object\n     * @param {THREE.Object3D} object - Object to be looked at the center\n     * @param {number} [duration=1000] - Duration to tween\n     * @param {function} [easing=TWEEN.Easing.Exponential.Out] - Easing function\n     * @memberOf Viewer\n     * @instance\n     */\n    tweenControlCenterByObject: function ( object, duration, easing ) {\n\n        let isUnderScalePlaceHolder = false;\n\n        object.traverseAncestors( function ( ancestor ) {\n\n            if ( ancestor.scalePlaceHolder ) {\n\n                isUnderScalePlaceHolder = true;\n\n            }\n        } );\n\n        if ( isUnderScalePlaceHolder ) {\n\n            const invertXVector = new Vector3( -1, 1, 1 );\n\n            this.tweenControlCenter( object.getWorldPosition( new Vector3() ).multiply( invertXVector ), duration, easing );\n\n        } else {\n\n            this.tweenControlCenter( object.getWorldPosition( new Vector3() ), duration, easing );\n\n        }\n\n    },\n\n    /**\n     * This is called when window size is changed\n     * @fires Viewer#window-resize\n     * @param {number} [windowWidth] - Specify if custom element has changed width\n     * @param {number} [windowHeight] - Specify if custom element has changed height\n     * @memberOf Viewer\n     * @instance\n     */\n    onWindowResize: function ( windowWidth, windowHeight ) {\n\n        let width, height;\n\n        const expand = this.container.classList.contains( 'panolens-container' ) || this.container.isFullscreen;\n\n        if ( windowWidth !== undefined && windowHeight !== undefined ) {\n\n            width = windowWidth;\n            height = windowHeight;\n            this.container._width = windowWidth;\n            this.container._height = windowHeight;\n\n        } else {\n\n            const isAndroid = /(android)/i.test(window.navigator.userAgent);\n\n            const adjustWidth = isAndroid \n                ? Math.min(document.documentElement.clientWidth, window.innerWidth || 0) \n                : Math.max(document.documentElement.clientWidth, window.innerWidth || 0);\n\n            const adjustHeight = isAndroid \n                ? Math.min(document.documentElement.clientHeight, window.innerHeight || 0) \n                : Math.max(document.documentElement.clientHeight, window.innerHeight || 0);\n\n            width = expand ? adjustWidth : this.container.clientWidth;\n            height = expand ? adjustHeight : this.container.clientHeight;\n\n            this.container._width = width;\n            this.container._height = height;\n\n        }\n\n        this.camera.aspect = width / height;\n        this.camera.updateProjectionMatrix();\n\n        this.renderer.setSize( width, height );\n\n        // Update reticle\n        if ( this.options.enableReticle || this.tempEnableReticle ) {\n\n            this.updateReticleEvent();\n\n        }\n\n        /**\n         * Window resizing event\n         * @type {object}\n         * @event Viewer#window-resize\n         * @property {number} width  - Width of the window\n         * @property {number} height - Height of the window\n         */\n        this.dispatchEvent( { type: 'window-resize', width: width, height: height });\n        this.scene.traverse( function ( object ) {\n\n            if ( object.dispatchEvent ) {\n\n                object.dispatchEvent( { type: 'window-resize', width: width, height: height });\n\n            }\n\n        } );\n\n    },\n\n    /**\n     * Add output element\n     * @memberOf Viewer\n     * @instance\n     */\n    addOutputElement: function () {\n\n        const element = document.createElement( 'div' );\n        element.style.position = 'absolute';\n        element.style.right = '10px';\n        element.style.top = '10px';\n        element.style.color = '#fff';\n        this.container.appendChild( element );\n        this.outputDivElement = element;\n\n    },\n\n    /**\n     * Output position in developer console by holding down Ctrl button\n     * @memberOf Viewer\n     * @instance\n     */\n    outputPosition: function () {\n\n        const intersects = this.raycaster.intersectObject( this.panorama, true );\n\n        if ( intersects.length > 0 ) {\n\n            const point = intersects[ 0 ].point.clone();\n            const converter = new Vector3( -1, 1, 1 );\n            const world = this.panorama.getWorldPosition( new Vector3() );\n            point.sub( world ).multiply( converter );\n\n            const position = {\n                x: point.x.toFixed(2),\n                y: point.y.toFixed(2),\n                z: point.z.toFixed(2),\n            };\n\n            const message = `${position.x}, ${position.y}, ${position.z}`;\n\n            if ( point.length() === 0 ) { return; }\n\n            switch ( this.options.output ) {\n\n            case 'event':\n                /**\n                 * Dispatch raycast position as event\n                 * @type {object}\n                 * @event Viewer#position-output\n                 */\n                this.dispatchEvent( { type: 'position-output', position: position } );\n                break;\n\n            case 'console':\n                console.info( message );\n                break;\n\n            case 'overlay':\n                this.outputDivElement.textContent = message;\n                break;\n\n            default:\n                break;\n\n            }\n\n        }\n\n    },\n\n    /**\n     * On mouse down\n     * @param {MouseEvent} event \n     * @memberOf Viewer\n     * @instance\n     */\n    onMouseDown: function ( event ) {\n\n        event.preventDefault();\n\n        this.userMouse.x = ( event.clientX >= 0 ) ? event.clientX : event.touches[0].clientX;\n        this.userMouse.y = ( event.clientY >= 0 ) ? event.clientY : event.touches[0].clientY;\n        this.userMouse.type = 'mousedown';\n        this.onTap( event );\n\n    },\n\n    /**\n     * On mouse move\n     * @param {MouseEvent} event \n     * @memberOf Viewer\n     * @instance\n     */\n    onMouseMove: function ( event ) {\n\n        event.preventDefault();\n        this.userMouse.type = 'mousemove';\n        this.onTap( event );\n\n    },\n\n    /**\n     * On mouse up\n     * @param {MouseEvent} event \n     * @memberOf Viewer\n     * @instance\n     */\n    onMouseUp: function ( event ) {\n\n        let onTarget = false;\n\n        this.userMouse.type = 'mouseup';\n\n        const type = ( this.userMouse.x >= event.clientX - this.options.clickTolerance \n\t\t\t\t&& this.userMouse.x <= event.clientX + this.options.clickTolerance\n\t\t\t\t&& this.userMouse.y >= event.clientY - this.options.clickTolerance\n\t\t\t\t&& this.userMouse.y <= event.clientY + this.options.clickTolerance ) \n\t\t\t\t||  ( event.changedTouches \n\t\t\t\t&& this.userMouse.x >= event.changedTouches[0].clientX - this.options.clickTolerance\n\t\t\t\t&& this.userMouse.x <= event.changedTouches[0].clientX + this.options.clickTolerance \n\t\t\t\t&& this.userMouse.y >= event.changedTouches[0].clientY - this.options.clickTolerance\n\t\t\t\t&& this.userMouse.y <= event.changedTouches[0].clientY + this.options.clickTolerance ) \n            ? 'click' : undefined;\n\n        // Event should happen on canvas\n        if ( event && event.target && !event.target.classList.contains( 'panolens-canvas' ) ) { return; }\n\n        event.preventDefault();\n\n        if ( event.changedTouches && event.changedTouches.length === 1 ) {\n\n            onTarget = this.onTap( { clientX: event.changedTouches[0].clientX, clientY: event.changedTouches[0].clientY }, type );\n\t\t\n        } else {\n\n            onTarget = this.onTap( event, type );\n\n        }\n\n        this.userMouse.type = 'none';\n\n        if ( onTarget ) { \n\n            return; \n\n        }\n\n        if ( type === 'click' ) {\n\n            const { options: { autoHideInfospot, autoHideControlBar }, panorama, toggleControlBar } = this;\n\n            if ( autoHideInfospot && panorama ) {\n\n                panorama.toggleInfospotVisibility();\n\n            }\n\n            if ( autoHideControlBar ) {\n\n                toggleControlBar();\n\n            }\n\n        }\n\n    },\n\n    /**\n     * On tap eveny frame\n     * @param {MouseEvent} event \n     * @param {string} type \n     * @memberOf Viewer\n     * @instance\n     */\n    onTap: function ( event, type ) {\n\n        const { left, top } = this.container.getBoundingClientRect();\n        const { clientWidth, clientHeight } = this.container;\n\n        this.raycasterPoint.x = ( ( event.clientX - left ) / clientWidth ) * 2 - 1;\n        this.raycasterPoint.y = - ( ( event.clientY - top ) / clientHeight ) * 2 + 1;\n\n        this.raycaster.setFromCamera( this.raycasterPoint, this.camera );\n\n        // Return if no panorama \n        if ( !this.panorama ) { \n\n            return; \n\n        }\n\n        // output infospot information\n        if ( event.type !== 'mousedown' && this.touchSupported || this.OUTPUT_INFOSPOT ) { \n\n            this.outputPosition(); \n\n        }\n\n\n        const intersects = this.raycaster.intersectObjects( this.panorama.children, true );\n        const intersect_entity = this.getConvertedIntersect( intersects );\n        const intersect = ( intersects.length > 0 ) ? intersects[0].object : undefined;\n\n        if ( this.userMouse.type === 'mouseup'  ) {\n\n            if ( intersect_entity && this.pressEntityObject === intersect_entity && this.pressEntityObject.dispatchEvent ) {\n\n                this.pressEntityObject.dispatchEvent( { type: 'pressstop-entity', mouseEvent: event } );\n\n            }\n\n            this.pressEntityObject = undefined;\n\n        }\n\n        if ( this.userMouse.type === 'mouseup'  ) {\n\n            if ( intersect && this.pressObject === intersect && this.pressObject.dispatchEvent ) {\n\n                this.pressObject.dispatchEvent( { type: 'pressstop', mouseEvent: event } );\n\n            }\n\n            this.pressObject = undefined;\n\n        }\n\n        if ( type === 'click' ) {\n\n            this.panorama.dispatchEvent( { type: 'click', intersects: intersects, mouseEvent: event } );\n\n            if ( intersect_entity && intersect_entity.dispatchEvent ) {\n\n                intersect_entity.dispatchEvent( { type: 'click-entity', mouseEvent: event } );\n\n            }\n\n            if ( intersect && intersect.dispatchEvent ) {\n\n                intersect.dispatchEvent( { type: 'click', mouseEvent: event } );\n\n            }\n\n        } else {\n\n            this.panorama.dispatchEvent( { type: 'hover', intersects: intersects, mouseEvent: event } );\n\n            if ( ( this.hoverObject && intersects.length > 0 && this.hoverObject !== intersect_entity )\n\t\t\t\t|| ( this.hoverObject && intersects.length === 0 ) ){\n\n                if ( this.hoverObject.dispatchEvent ) {\n\n                    this.hoverObject.dispatchEvent( { type: 'hoverleave', mouseEvent: event } );\n\n                    this.reticle.end();\n\n                }\n\n                this.hoverObject = undefined;\n\n            }\n\n            if ( intersect_entity && intersects.length > 0 ) {\n\n                if ( this.hoverObject !== intersect_entity ) {\n\n                    this.hoverObject = intersect_entity;\n\n                    if ( this.hoverObject.dispatchEvent ) {\n\n                        this.hoverObject.dispatchEvent( { type: 'hoverenter', mouseEvent: event } );\n\n                        // Start reticle timer\n                        if ( this.options.autoReticleSelect && this.options.enableReticle || this.tempEnableReticle ) {\n                            this.reticle.start( this.onTap.bind( this, event, 'click' ) );\n                        }\n\n                    }\n\n                }\n\n                if ( this.userMouse.type === 'mousedown' && this.pressEntityObject != intersect_entity ) {\n\n                    this.pressEntityObject = intersect_entity;\n\n                    if ( this.pressEntityObject.dispatchEvent ) {\n\n                        this.pressEntityObject.dispatchEvent( { type: 'pressstart-entity', mouseEvent: event } );\n\n                    }\n\n                }\n\n                if ( this.userMouse.type === 'mousedown' && this.pressObject != intersect ) {\n\n                    this.pressObject = intersect;\n\n                    if ( this.pressObject.dispatchEvent ) {\n\n                        this.pressObject.dispatchEvent( { type: 'pressstart', mouseEvent: event } );\n\n                    }\n\n                }\n\n                if ( this.userMouse.type === 'mousemove' || this.options.enableReticle ) {\n\n                    if ( intersect && intersect.dispatchEvent ) {\n\n                        intersect.dispatchEvent( { type: 'hover', mouseEvent: event } );\n\n                    }\n\n                    if ( this.pressEntityObject && this.pressEntityObject.dispatchEvent ) {\n\n                        this.pressEntityObject.dispatchEvent( { type: 'pressmove-entity', mouseEvent: event } );\n\n                    }\n\n                    if ( this.pressObject && this.pressObject.dispatchEvent ) {\n\n                        this.pressObject.dispatchEvent( { type: 'pressmove', mouseEvent: event } );\n\n                    }\n\n                }\n\n            }\n\n            if ( !intersect_entity && this.pressEntityObject && this.pressEntityObject.dispatchEvent ) {\n\n                this.pressEntityObject.dispatchEvent( { type: 'pressstop-entity', mouseEvent: event } );\n\n                this.pressEntityObject = undefined;\n\n            }\n\n            if ( !intersect && this.pressObject && this.pressObject.dispatchEvent ) {\n\n                this.pressObject.dispatchEvent( { type: 'pressstop', mouseEvent: event } );\n\n                this.pressObject = undefined;\n\n            }\n\n        }\n\n        // Infospot handler\n        if ( intersect && intersect instanceof Infospot ) {\n\n            this.infospot = intersect;\n\t\t\t\n            if ( type === 'click' ) {\n\n                return true;\n\n            }\n\t\t\t\n\n        } else if ( this.infospot ) {\n\n            this.hideInfospot();\n\n        }\n\n        // Auto rotate\n        if ( this.options.autoRotate && this.userMouse.type !== 'mousemove' ) {\n\n            // Auto-rotate idle timer\n            clearTimeout( this.autoRotateRequestId );\n\n            if ( this.control === this.OrbitControls ) {\n\n                this.OrbitControls.autoRotate = false;\n                this.autoRotateRequestId = window.setTimeout( this.enableAutoRate.bind( this ), this.options.autoRotateActivationDuration );\n\n            }\n\n        }\t\t\n\n    },\n\n    /**\n     * Get converted intersect\n     * @param {array} intersects \n     * @memberOf Viewer\n     * @instance\n     */\n    getConvertedIntersect: function ( intersects ) {\n\n        let intersect;\n\n        for ( let i = 0; i < intersects.length; i++ ) {\n\n            if ( intersects[i].distance >= 0 && intersects[i].object && !intersects[i].object.passThrough ) {\n\n                if ( intersects[i].object.entity && intersects[i].object.entity.passThrough ) {\n                    continue;\n                } else if ( intersects[i].object.entity && !intersects[i].object.entity.passThrough ) {\n                    intersect = intersects[i].object.entity;\n                    break;\n                } else {\n                    intersect = intersects[i].object;\n                    break;\n                }\n\n            }\n\n        }\n\n        return intersect;\n\n    },\n\n    /**\n     * Hide infospot\n     * @memberOf Viewer\n     * @instance\n     */\n    hideInfospot: function () {\n\n        if ( this.infospot ) {\n\n            this.infospot.onHoverEnd();\n\n            this.infospot = undefined;\n\n        }\n\n    },\n\n    /**\n     * Toggle control bar\n     * @memberOf Viewer\n     * @instance\n     * @fires Viewer#control-bar-toggle\n     */\n    toggleControlBar: function () {\n\n        const { widget } = this;\n\n        /**\n         * Toggle control bar event\n         * @type {object}\n         * @event Viewer#control-bar-toggle\n         */\n        if ( widget ) {\n\n            widget.dispatchEvent( { type: 'control-bar-toggle' } );\n\n        }\n\n    },\n\n    /**\n     * On key down\n     * @param {KeyboardEvent} event \n     * @memberOf Viewer\n     * @instance\n     */\n    onKeyDown: function ( event ) {\n\n        if ( this.options.output && this.options.output !== 'none' && event.key === 'Control' ) {\n\n            this.OUTPUT_INFOSPOT = true;\n\n        }\n\n    },\n\n    /**\n     * On key up\n     * @param {KeyboardEvent} event \n     * @memberOf Viewer\n     * @instance\n     */\n    onKeyUp: function () {\n\n        this.OUTPUT_INFOSPOT = false;\n\n    },\n\n    /**\n     * Update control and callbacks\n     * @memberOf Viewer\n     * @instance\n     */\n    update: function () {\n\n        Tween.update();\n\n        this.updateCallbacks.forEach( function( callback ){ callback(); } );\n\n        this.control.update();\n\n        this.scene.traverse( function( child ){\n            if ( child instanceof Infospot \n\t\t\t\t&& child.element \n\t\t\t\t&& ( this.hoverObject === child \n\t\t\t\t\t|| child.element.style.display !== 'none' \n\t\t\t\t\t|| (child.element.left && child.element.left.style.display !== 'none')\n\t\t\t\t\t|| (child.element.right && child.element.right.style.display !== 'none') ) ) {\n                if ( this.checkSpriteInViewport( child ) ) {\n                    const { x, y } = this.getScreenVector( child.getWorldPosition( new Vector3() ) );\n                    child.translateElement( x, y );\n                } else {\n                    child.onDismiss();\n                }\n\t\t\t\t\n            }\n        }.bind( this ) );\n\n    },\n\n    /**\n     * Rendering function to be called on every animation frame\n     * Render reticle last\n     * @memberOf Viewer\n     * @instance\n     */\n    render: function () {\n\n        if ( this.mode === MODES.CARDBOARD || this.mode === MODES.STEREO ) {\n\n            this.renderer.clear();\n            this.effect.render( this.scene, this.camera );\n            this.effect.render( this.sceneReticle, this.camera );\n\t\t\t\n\n        } else {\n\n            this.renderer.clear();\n            this.renderer.render( this.scene, this.camera );\n            this.renderer.clearDepth();\n            this.renderer.render( this.sceneReticle, this.camera );\n\n        }\n\n    },\n\n    /**\n     * Animate\n     * @memberOf Viewer\n     * @instance\n     */\n    animate: function () {\n\n        this.requestAnimationId = window.requestAnimationFrame( this.animate.bind( this ) );\n\n        this.onChange();\n\n    },\n\n    /**\n     * On change\n     * @memberOf Viewer\n     * @instance\n     */\n    onChange: function () {\n\n        this.update();\n        this.render();\n\n    },\n\n    /**\n     * Register mouse and touch event on container\n     * @memberOf Viewer\n     * @instance\n     */\n    registerMouseAndTouchEvents: function () {\n\n        const options = { passive: false };\n\n        this.container.addEventListener( 'mousedown' , \tthis.HANDLER_MOUSE_DOWN, options );\n        this.container.addEventListener( 'mousemove' , \tthis.HANDLER_MOUSE_MOVE, options );\n        this.container.addEventListener( 'mouseup'\t , \tthis.HANDLER_MOUSE_UP  , options );\n        this.container.addEventListener( 'touchstart', \tthis.HANDLER_MOUSE_DOWN, options );\n        this.container.addEventListener( 'touchend'  , \tthis.HANDLER_MOUSE_UP  , options );\n\n    },\n\n    /**\n     * Unregister mouse and touch event on container\n     * @memberOf Viewer\n     * @instance\n     */\n    unregisterMouseAndTouchEvents: function () {\n\n        this.container.removeEventListener( 'mousedown' ,  this.HANDLER_MOUSE_DOWN, false );\n        this.container.removeEventListener( 'mousemove' ,  this.HANDLER_MOUSE_MOVE, false );\n        this.container.removeEventListener( 'mouseup'\t,  this.HANDLER_MOUSE_UP  , false );\n        this.container.removeEventListener( 'touchstart',  this.HANDLER_MOUSE_DOWN, false );\n        this.container.removeEventListener( 'touchend'  ,  this.HANDLER_MOUSE_UP  , false );\n\n    },\n\n    /**\n     * Register reticle event\n     * @memberOf Viewer\n     * @instance\n     */\n    registerReticleEvent: function () {\n\n        this.addUpdateCallback( this.HANDLER_TAP );\n\n    },\n\n    /**\n     * Unregister reticle event\n     * @memberOf Viewer\n     * @instance\n     */\n    unregisterReticleEvent: function () {\n\n        this.removeUpdateCallback( this.HANDLER_TAP );\n\n    },\n\n    /**\n     * Update reticle event\n     * @memberOf Viewer\n     * @instance\n     */\n    updateReticleEvent: function () {\n\n        const clientX = this.container.clientWidth / 2 + this.container.offsetLeft;\n        const clientY = this.container.clientHeight / 2;\n\n        this.removeUpdateCallback( this.HANDLER_TAP );\n        this.HANDLER_TAP = this.onTap.bind( this, { clientX, clientY } );\n        this.addUpdateCallback( this.HANDLER_TAP );\n\n    },\n\n    /**\n     * Register container and window listeners\n     * @memberOf Viewer\n     * @instance\n     */\n    registerEventListeners: function () {\n\n        // Resize Event\n        window.addEventListener( 'resize' , this.HANDLER_WINDOW_RESIZE, true );\n\n        // Keyboard Event\n        window.addEventListener( 'keydown', this.HANDLER_KEY_DOWN, true );\n        window.addEventListener( 'keyup'  , this.HANDLER_KEY_UP\t , true );\n\n    },\n\n    /**\n     * Unregister container and window listeners\n     * @memberOf Viewer\n     * @instance\n     */\n    unregisterEventListeners: function () {\n\n        // Resize Event\n        window.removeEventListener( 'resize' , this.HANDLER_WINDOW_RESIZE, true );\n\n        // Keyboard Event\n        window.removeEventListener( 'keydown', this.HANDLER_KEY_DOWN, true );\n        window.removeEventListener( 'keyup'  , this.HANDLER_KEY_UP  , true );\n\n    },\n\n    /**\n     * Dispose all scene objects and clear cache\n     * @memberOf Viewer\n     * @instance\n     */\n    dispose: function () {\n\n        this.tweenLeftAnimation.stop();\n        this.tweenUpAnimation.stop();\n\n        // Unregister dom event listeners\n        this.unregisterEventListeners();\n\n        // recursive disposal on 3d objects\n        function recursiveDispose ( object ) {\n\n            for ( let i = object.children.length - 1; i >= 0; i-- ) {\n\n                recursiveDispose( object.children[i] );\n                object.remove( object.children[i] );\n\n            }\n\n            if ( object instanceof Panorama || object instanceof Infospot ) {\n\n                object.dispose();\n                object = null;\n\n            } else if ( object.dispatchEvent ){\n\n                object.dispatchEvent( 'dispose' );\n\n            }\n\n        }\n\n        recursiveDispose( this.scene );\n\n        // dispose widget\n        if ( this.widget ) {\n\n            this.widget.dispose();\n            this.widget = null;\n\n        }\n\n        // clear cache\n        if ( Cache && Cache.enabled ) {\n\n            Cache.clear();\n\n        }\n\n    },\n\n    /**\n     * Destroy viewer by disposing and stopping requestAnimationFrame\n     * @memberOf Viewer\n     * @instance\n     */\n    destroy: function () {\n\n        this.dispose();\n        this.render();\n        window.cancelAnimationFrame( this.requestAnimationId );\t\t\n\n    },\n\n    /**\n     * On panorama dispose\n     * @memberOf Viewer\n     * @instance\n     */\n    onPanoramaDispose: function ( panorama ) {\n\n        if ( panorama instanceof VideoPanorama ) {\n\n            this.hideVideoWidget();\n\n        }\n\n        if ( panorama === this.panorama ) {\n\n            this.panorama = null;\n\n        }\n\n    },\n\n    /**\n     * Load ajax call\n     * @param {string} url - URL to be requested\n     * @param {function} [callback] - Callback after request completes\n     * @memberOf Viewer\n     * @instance\n     */\n    loadAsyncRequest: function ( url, callback = () => {} ) {\n\n        const request = new window.XMLHttpRequest();\n        request.onloadend = function ( event ) {\n            callback( event );\n        };\n        request.open( 'GET', url, true );\n        request.send( null );\n\n    },\n\n    /**\n     * View indicator in upper left\n     * @memberOf Viewer\n     * @instance\n     */\n    addViewIndicator: function () {\n\n        const scope = this;\n\n        function loadViewIndicator ( asyncEvent ) {\n\n            if ( asyncEvent.loaded === 0 ) return;\n\n            const viewIndicatorDiv = asyncEvent.target.responseXML.documentElement;\n            viewIndicatorDiv.style.width = scope.viewIndicatorSize + 'px';\n            viewIndicatorDiv.style.height = scope.viewIndicatorSize + 'px';\n            viewIndicatorDiv.style.position = 'absolute';\n            viewIndicatorDiv.style.top = '10px';\n            viewIndicatorDiv.style.left = '10px';\n            viewIndicatorDiv.style.opacity = '0.5';\n            viewIndicatorDiv.style.cursor = 'pointer';\n            viewIndicatorDiv.id = 'panolens-view-indicator-container';\n\n            scope.container.appendChild( viewIndicatorDiv );\n\n            const indicator = viewIndicatorDiv.querySelector( '#indicator' );\n            const setIndicatorD = function () {\n\n                scope.radius = scope.viewIndicatorSize * 0.225;\n                scope.currentPanoAngle = scope.camera.rotation.y - Math$1.degToRad( 90 );\n                scope.fovAngle = Math$1.degToRad( scope.camera.fov ) ;\n                scope.leftAngle = -scope.currentPanoAngle - scope.fovAngle / 2;\n                scope.rightAngle = -scope.currentPanoAngle + scope.fovAngle / 2;\n                scope.leftX = scope.radius * Math.cos( scope.leftAngle );\n                scope.leftY = scope.radius * Math.sin( scope.leftAngle );\n                scope.rightX = scope.radius * Math.cos( scope.rightAngle );\n                scope.rightY = scope.radius * Math.sin( scope.rightAngle );\n                scope.indicatorD = 'M ' + scope.leftX + ' ' + scope.leftY + ' A ' + scope.radius + ' ' + scope.radius + ' 0 0 1 ' + scope.rightX + ' ' + scope.rightY;\n\n                if ( scope.leftX && scope.leftY && scope.rightX && scope.rightY && scope.radius ) {\n\n                    indicator.setAttribute( 'd', scope.indicatorD );\n\n                }\n\n            };\n\n            scope.addUpdateCallback( setIndicatorD );\n\n            const indicatorOnMouseEnter = function () {\n\n                this.style.opacity = '1';\n\n            };\n\n            const indicatorOnMouseLeave = function () {\n\n                this.style.opacity = '0.5';\n\n            };\n\n            viewIndicatorDiv.addEventListener( 'mouseenter', indicatorOnMouseEnter );\n            viewIndicatorDiv.addEventListener( 'mouseleave', indicatorOnMouseLeave );\n        }\n\n        this.loadAsyncRequest( DataImage.ViewIndicator, loadViewIndicator );\n\n    },\n\n    /**\n     * Append custom control item to existing control bar\n     * @param {object} [option={}] - Style object to overwirte default element style. It takes 'style', 'onTap' and 'group' properties.\n     * @memberOf Viewer\n     * @instance\n     */\n    appendControlItem: function ( option ) {\n\n        const item = this.widget.createCustomItem( option );\t\t\n\n        if ( option.group === 'video' ) {\n\n            this.widget.videoElement.appendChild( item );\n\n        } else {\n\n            this.widget.barElement.appendChild( item );\n\n        }\n\n        return item;\n\n    },\n\n    /**\n     * Clear all cached files\n     * @memberOf Viewer\n     * @instance\n     */\n    clearAllCache: function () {\n\n        Cache.clear();\n\n    }\n\n} );\n\nif ( REVISION$1 != THREE_REVISION ) {\n\n    console.warn( `three.js version is not matched. Please consider use the target revision ${THREE_REVISION}` );\n\n}\n\n/**\n * Panolens.js\n * @author pchen66\n * @namespace PANOLENS\n */\nwindow.TWEEN = Tween;\n\nexport { BasicPanorama, CONTROLS, CONTROL_BUTTONS, CameraPanorama, CubePanorama, CubeTextureLoader, DataImage, EmptyPanorama, GoogleStreetviewPanorama, ImageLittlePlanet, ImageLoader, ImagePanorama, Infospot, LittlePlanet, MODES, Media, OUTPUTS, Panorama, REVISION, Reticle, THREE_REVISION, THREE_VERSION, TextureLoader, VERSION, VideoPanorama, Viewer, Widget };\n"]},"metadata":{},"sourceType":"module"}