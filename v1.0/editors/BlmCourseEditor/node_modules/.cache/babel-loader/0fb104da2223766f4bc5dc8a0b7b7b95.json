{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Rajesh\\\\Downloads\\\\bilim (2)\\\\bilim\\\\v1.0\\\\editors\\\\BlmCourseEditor\\\\src\\\\components\\\\content-editor\\\\components\\\\actions\\\\main\\\\audiomarker\\\\BlmAudioMarkerAction.tsx\";\nimport React, { useMemo, useCallback } from \"react\";\nimport { Select, MenuItem, Divider, ListItemText, ListItemIcon } from \"@material-ui/core\";\nimport { useTranslation } from \"react-i18next\";\nimport \"./styles.scss\";\nimport { useContentEditorCtx } from \"components/content-editor/core\";\nimport { createMediaCues, isSoundComponent } from \"utils\";\n\nfunction BlmAudioMarkerAction(props) {\n  const {\n    data,\n    onChange,\n    getFile,\n    markerFiles,\n    action,\n    name,\n    temp\n  } = props;\n  const {\n    sound,\n    marker\n  } = data || {};\n  const {\n    t\n  } = useTranslation(\"content-editor\");\n  const {\n    template\n  } = useContentEditorCtx();\n  const [selectedComponentId, setSelectedComponentId] = React.useState(sound);\n  const [selectedAudioMarkers, setSelectedAudioMarkers] = React.useState([]);\n  const [selectedmarkerId, setSelectedMarkerId] = React.useState(marker);\n  const items = useMemo(() => {\n    const components = template === null || template === void 0 ? void 0 : template.sounds;\n    let result = [];\n\n    if (components && components.some(component => component.value.media)) {\n      components === null || components === void 0 ? void 0 : components.forEach((component, index) => {\n        result.push({\n          label: `${t(\"sound_marker.Sound_label\")}${index + 1}`,\n          type: `${index + 1}`\n        });\n      });\n    } else {\n      var _template$repeater;\n\n      if (template === null || template === void 0 ? void 0 : (_template$repeater = template.repeater) === null || _template$repeater === void 0 ? void 0 : _template$repeater.sounds) {\n        var _template$repeater2, _template$repeater2$s;\n\n        template === null || template === void 0 ? void 0 : (_template$repeater2 = template.repeater) === null || _template$repeater2 === void 0 ? void 0 : (_template$repeater2$s = _template$repeater2.sounds[0].value) === null || _template$repeater2$s === void 0 ? void 0 : _template$repeater2$s.forEach((component, index) => {\n          result.push({\n            label: `${t(\"sound_marker.Sound_label\")}${index + 1}`,\n            type: `${index + 1}`\n          });\n        });\n      }\n    }\n\n    if (temp) {\n      result.push({\n        label: \"Background sound\",\n        type: `${100 + 1}`\n      });\n    }\n\n    return result;\n  }, [template, t, temp]);\n  const updateChange = useCallback(newData => {\n    if (onChange) {\n      onChange({\n        target: {\n          name: action ? action : \"audiomarker\",\n          value: newData\n        }\n      });\n    }\n  }, [onChange, action]);\n  var getFirstAudio = useCallback(val => {\n    if (val) {\n      const component = template === null || template === void 0 ? void 0 : template.sounds.find((media, ind) => ind + 1 === parseInt(val));\n\n      if (component && isSoundComponent(component) && (component === null || component === void 0 ? void 0 : component.value) && (component === null || component === void 0 ? void 0 : component.value.media)) {\n        var _component$value, _component$value$medi, _component$value$medi2;\n\n        const markerId = ((_component$value = component.value) === null || _component$value === void 0 ? void 0 : (_component$value$medi = _component$value.media) === null || _component$value$medi === void 0 ? void 0 : (_component$value$medi2 = _component$value$medi.marker) === null || _component$value$medi2 === void 0 ? void 0 : _component$value$medi2.id) || 0;\n        return markerId;\n      }\n    }\n  }, [template]);\n  React.useEffect(() => {\n    if (selectedComponentId === undefined && items.length === 1) {\n      let newData = {\n        sound,\n        marker\n      };\n      newData.sound = items[0].type;\n      var firstVidoe = getFirstAudio(items[0].type);\n\n      if (firstVidoe === 0) {\n        newData.marker = \"none\";\n        setSelectedMarkerId(\"none\");\n      } else {\n        newData.marker = \"\";\n        setSelectedMarkerId(\"\");\n      }\n\n      updateChange(newData);\n      setSelectedComponentId(items[0].type);\n    }\n  }, [items, marker, sound, selectedComponentId, updateChange, getFirstAudio]);\n  React.useEffect(() => {\n    var _temp$load, _temp$load$sound, _temp$load$sound$soun, _temp$load$sound$soun2, _temp$load2, _temp$load2$sound, _temp$load2$sound$sou, _temp$load2$sound$sou2;\n\n    if ((temp === null || temp === void 0 ? void 0 : (_temp$load = temp.load) === null || _temp$load === void 0 ? void 0 : (_temp$load$sound = _temp$load.sound) === null || _temp$load$sound === void 0 ? void 0 : (_temp$load$sound$soun = _temp$load$sound.sound) === null || _temp$load$sound$soun === void 0 ? void 0 : (_temp$load$sound$soun2 = _temp$load$sound$soun.marker) === null || _temp$load$sound$soun2 === void 0 ? void 0 : _temp$load$sound$soun2.id) && !markerFiles[temp === null || temp === void 0 ? void 0 : (_temp$load2 = temp.load) === null || _temp$load2 === void 0 ? void 0 : (_temp$load2$sound = _temp$load2.sound) === null || _temp$load2$sound === void 0 ? void 0 : (_temp$load2$sound$sou = _temp$load2$sound.sound) === null || _temp$load2$sound$sou === void 0 ? void 0 : (_temp$load2$sound$sou2 = _temp$load2$sound$sou.marker) === null || _temp$load2$sound$sou2 === void 0 ? void 0 : _temp$load2$sound$sou2.id]) {\n      var _temp$load3, _temp$load3$sound, _temp$load3$sound$sou, _temp$load3$sound$sou2, _temp$load4, _temp$load4$sound, _temp$load4$sound$sou, _temp$load4$sound$sou2;\n\n      getFile(temp === null || temp === void 0 ? void 0 : (_temp$load3 = temp.load) === null || _temp$load3 === void 0 ? void 0 : (_temp$load3$sound = _temp$load3.sound) === null || _temp$load3$sound === void 0 ? void 0 : (_temp$load3$sound$sou = _temp$load3$sound.sound) === null || _temp$load3$sound$sou === void 0 ? void 0 : (_temp$load3$sound$sou2 = _temp$load3$sound$sou.marker) === null || _temp$load3$sound$sou2 === void 0 ? void 0 : _temp$load3$sound$sou2.id, temp === null || temp === void 0 ? void 0 : (_temp$load4 = temp.load) === null || _temp$load4 === void 0 ? void 0 : (_temp$load4$sound = _temp$load4.sound) === null || _temp$load4$sound === void 0 ? void 0 : (_temp$load4$sound$sou = _temp$load4$sound.sound) === null || _temp$load4$sound$sou === void 0 ? void 0 : (_temp$load4$sound$sou2 = _temp$load4$sound$sou.marker) === null || _temp$load4$sound$sou2 === void 0 ? void 0 : _temp$load4$sound$sou2.url);\n    }\n\n    if (selectedComponentId) {\n      const component = template === null || template === void 0 ? void 0 : template.sounds.find(sound => sound.id === selectedComponentId);\n\n      if (component && isSoundComponent(component)) {\n        var _component$value2, _component$value2$med;\n\n        const marker = component === null || component === void 0 ? void 0 : (_component$value2 = component.value) === null || _component$value2 === void 0 ? void 0 : (_component$value2$med = _component$value2.media) === null || _component$value2$med === void 0 ? void 0 : _component$value2$med.marker;\n\n        if (marker && !markerFiles[marker.id]) {\n          getFile(marker.id, marker.url);\n        }\n      } else {\n        var _template$repeater3;\n\n        if (template === null || template === void 0 ? void 0 : (_template$repeater3 = template.repeater) === null || _template$repeater3 === void 0 ? void 0 : _template$repeater3.sounds) {\n          var _template$repeater4, _template$repeater4$s, _test$value, _test$value$media;\n\n          var test = template === null || template === void 0 ? void 0 : (_template$repeater4 = template.repeater) === null || _template$repeater4 === void 0 ? void 0 : (_template$repeater4$s = _template$repeater4.sounds[0].value) === null || _template$repeater4$s === void 0 ? void 0 : _template$repeater4$s.find((media, ind) => ind + 1 === parseInt(selectedComponentId));\n          const marker = test === null || test === void 0 ? void 0 : (_test$value = test.value) === null || _test$value === void 0 ? void 0 : (_test$value$media = _test$value.media) === null || _test$value$media === void 0 ? void 0 : _test$value$media.marker;\n\n          if (marker && !markerFiles[marker.id]) {\n            getFile(marker.id, marker.url);\n          }\n        }\n      }\n    }\n  }, [template, selectedComponentId, getFile, markerFiles, temp]);\n\n  const renderPlaceholder = () => {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 150,\n        columnNumber: 12\n      }\n    }, \"Select audio\");\n  };\n\n  const renderMarkerPlaceholder = () => {\n    return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"span\", {\n      className: \"markerIcon\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 156,\n        columnNumber: 9\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 157,\n        columnNumber: 9\n      }\n    }, \"Select marker\"));\n  };\n\n  const renderNoAudioFound = () => {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 163,\n        columnNumber: 12\n      }\n    }, \"No audio\");\n  };\n\n  const renderNoMarkerFound = () => {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 166,\n        columnNumber: 12\n      }\n    }, \"No marker\");\n  };\n\n  const renderSelectedAudioItem = () => {\n    const selectedItem = items.find(item => item.type === selectedComponentId);\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"selectedItem\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 172,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(ListItemIcon, {\n      className: \"audioIcon\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 173,\n        columnNumber: 9\n      }\n    }), /*#__PURE__*/React.createElement(ListItemText, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 174,\n        columnNumber: 9\n      }\n    }, selectedItem.label));\n  };\n\n  const renderSelectedMarkerItem = () => {\n    if (selectedAudioMarkers.length > 0) {\n      const selectedItem = selectedAudioMarkers.find((item, index) => (index + 1).toString() === (marker === null || marker === void 0 ? void 0 : marker.toString()));\n\n      if (selectedItem) {\n        return /*#__PURE__*/React.createElement(\"div\", {\n          className: \"selectedItem\",\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 186,\n            columnNumber: 11\n          }\n        }, /*#__PURE__*/React.createElement(ListItemIcon, {\n          className: \"markerIcon\",\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 187,\n            columnNumber: 13\n          }\n        }), /*#__PURE__*/React.createElement(\"p\", {\n          className: \"selectedMarkerIndex\",\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 188,\n            columnNumber: 13\n          }\n        }, marker && parseInt(marker) < 10 ? `0${marker}` : marker), /*#__PURE__*/React.createElement(ListItemText, {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 191,\n            columnNumber: 13\n          }\n        }, selectedItem.text));\n      } else {\n        return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"span\", {\n          className: \"markerIcon\",\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 197,\n            columnNumber: 13\n          }\n        }), /*#__PURE__*/React.createElement(\"div\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 198,\n            columnNumber: 13\n          }\n        }, \"Select marker\"));\n      }\n    }\n  };\n\n  const handleChange = event => {\n    const {\n      name,\n      value\n    } = event.target;\n    let newData = {\n      sound,\n      marker\n    };\n\n    if (name === \"audio\") {\n      var firstAudio = getFirstAudio(value);\n      newData.sound = value;\n\n      if (firstAudio === 0) {\n        newData.marker = \"none\";\n        setSelectedMarkerId(\"none\");\n      } else {\n        newData.marker = \"\";\n        setSelectedMarkerId(\"\");\n      }\n\n      setSelectedComponentId(value);\n    } else if (name === \"marker\") {\n      newData.marker = value;\n    }\n\n    updateChange(newData);\n  };\n\n  React.useEffect(() => {\n    var component;\n\n    if ((template === null || template === void 0 ? void 0 : template.sounds) && (template === null || template === void 0 ? void 0 : template.sounds.length) > 0) {\n      component = template === null || template === void 0 ? void 0 : template.sounds.find(media => media.id === selectedComponentId);\n    } else {\n      var _template$repeater5;\n\n      if (template === null || template === void 0 ? void 0 : (_template$repeater5 = template.repeater) === null || _template$repeater5 === void 0 ? void 0 : _template$repeater5.sounds) {\n        var _template$repeater6, _template$repeater6$s;\n\n        template === null || template === void 0 ? void 0 : (_template$repeater6 = template.repeater) === null || _template$repeater6 === void 0 ? void 0 : (_template$repeater6$s = _template$repeater6.sounds[0].value) === null || _template$repeater6$s === void 0 ? void 0 : _template$repeater6$s.forEach((media, index) => {\n          if ((index + 1).toString() === selectedComponentId) {\n            component = media;\n          }\n        });\n      }\n    }\n\n    if (component && isSoundComponent(component) && component.value && component.value.media || temp) {\n      var markerId;\n\n      if (component) {\n        var _component$value3, _component$value3$med, _component$value3$med2;\n\n        markerId = ((_component$value3 = component.value) === null || _component$value3 === void 0 ? void 0 : (_component$value3$med = _component$value3.media) === null || _component$value3$med === void 0 ? void 0 : (_component$value3$med2 = _component$value3$med.marker) === null || _component$value3$med2 === void 0 ? void 0 : _component$value3$med2.id) || 0;\n      } else {\n        var _temp$load$sound$soun3, _temp$load$sound$soun4;\n\n        markerId = (temp === null || temp === void 0 ? void 0 : (_temp$load$sound$soun3 = temp.load.sound.sound) === null || _temp$load$sound$soun3 === void 0 ? void 0 : (_temp$load$sound$soun4 = _temp$load$sound$soun3.marker) === null || _temp$load$sound$soun4 === void 0 ? void 0 : _temp$load$sound$soun4.id) || 0;\n      }\n\n      const markerFile = markerFiles[markerId];\n\n      if (typeof markerFile === \"string\") {\n        const markers = createMediaCues(markerFile).map(cue => ({ ...cue,\n          endTime: NaN\n        }));\n\n        if (selectedmarkerId === \"none\" && markers.length > 0) {\n          let newData = {\n            sound,\n            marker\n          };\n          newData.marker = \"\";\n          setSelectedMarkerId(\"\");\n          updateChange(newData);\n        }\n\n        if (markerFile === \"WEBVTT\" && markers.length === 0 && marker !== \"none\") {\n          let newData = {\n            sound,\n            marker\n          };\n          newData.marker = \"none\";\n          updateChange(newData);\n        }\n\n        const selectedItem = markers.find((item, index) => (index + 1).toString() === (marker === null || marker === void 0 ? void 0 : marker.toString()));\n\n        if (marker && selectedItem === undefined && markers.length < parseInt(marker)) {\n          let newData = {\n            sound,\n            marker\n          };\n          newData.marker = \"\";\n          updateChange(newData);\n        }\n\n        setSelectedAudioMarkers(markers);\n      } else {\n        setSelectedAudioMarkers([]);\n      }\n    }\n  }, [markerFiles, selectedComponentId, template, sound, marker, selectedmarkerId, temp, updateChange]);\n\n  const renderItems = () => {\n    if (items) {\n      return items.map((item, ind) => {\n        if (typeof item === \"object\") {\n          const {\n            type,\n            label\n          } = item;\n          return /*#__PURE__*/React.createElement(MenuItem, {\n            key: type,\n            value: type,\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 305,\n              columnNumber: 13\n            }\n          }, /*#__PURE__*/React.createElement(ListItemText, {\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 307,\n              columnNumber: 15\n            }\n          }, label));\n        } else if (item === \"divider\") {\n          return /*#__PURE__*/React.createElement(Divider, {\n            key: item + ind,\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 311,\n              columnNumber: 18\n            }\n          });\n        } else {\n          return /*#__PURE__*/React.createElement(\"div\", {\n            key: item,\n            className: \"goto-dropdown-menu-title\",\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 314,\n              columnNumber: 13\n            }\n          }, item);\n        }\n      });\n    } else {\n      return /*#__PURE__*/React.createElement(MenuItem, {\n        key: \"none\",\n        value: \"none\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 322,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(ListItemText, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 323,\n          columnNumber: 11\n        }\n      }, \"No audio\"));\n    }\n  };\n\n  const renderMarkerItems = () => {\n    if (selectedAudioMarkers.length > 0) {\n      return selectedAudioMarkers.map((item, index) => {\n        if (typeof item === \"object\") {\n          const {\n            text\n          } = item;\n          return /*#__PURE__*/React.createElement(MenuItem, {\n            key: index,\n            value: index + 1,\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 335,\n              columnNumber: 13\n            }\n          }, /*#__PURE__*/React.createElement(\"p\", {\n            className: \"selectedMarkerIndex\",\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 336,\n              columnNumber: 15\n            }\n          }, index + 1 < 10 ? `0${index + 1}` : index + 1), /*#__PURE__*/React.createElement(ListItemText, {\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 337,\n              columnNumber: 15\n            }\n          }, text));\n        } else if (item === \"divider\") {\n          return /*#__PURE__*/React.createElement(Divider, {\n            key: item + (index + 1),\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 341,\n              columnNumber: 18\n            }\n          });\n        } else {\n          return /*#__PURE__*/React.createElement(\"div\", {\n            key: item,\n            className: \"goto-dropdown-menu-title\",\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 344,\n              columnNumber: 13\n            }\n          }, item);\n        }\n      });\n    } else {\n      return /*#__PURE__*/React.createElement(MenuItem, {\n        key: \"none\",\n        value: \"none\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 352,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(ListItemText, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 354,\n          columnNumber: 11\n        }\n      }, \"No marker\"));\n    }\n  };\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"audiomaker-action-wrapper\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 361,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(Select, {\n    name: name ? name : \"audio\",\n    value: selectedComponentId || \"\",\n    displayEmpty: true,\n    MenuProps: {\n      className: \"audioomaker-actions-dropdown-popover\"\n    },\n    className: \"audiomaker-actions-dropdown\",\n    renderValue: selectedComponentId ? renderSelectedAudioItem : items.length > 0 ? renderPlaceholder : renderNoAudioFound,\n    onChange: handleChange,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 362,\n      columnNumber: 7\n    }\n  }, renderItems()), selectedComponentId && /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Select, {\n    name: \"marker\",\n    value: marker || \"\",\n    MenuProps: {\n      className: \"audiomaker-actions-dropdown-popover\"\n    },\n    className: \"audiomaker-actions-dropdown\",\n    renderValue: marker !== undefined && marker !== \"none\" ? renderSelectedMarkerItem : selectedAudioMarkers.length > 0 ? renderMarkerPlaceholder : renderNoMarkerFound,\n    displayEmpty: true,\n    onChange: handleChange,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 383,\n      columnNumber: 11\n    }\n  }, renderMarkerItems()), selectedAudioMarkers.length === 0 && /*#__PURE__*/React.createElement(\"div\", {\n    className: \"audiomarker-warning-lbl\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 403,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"span\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 404,\n      columnNumber: 15\n    }\n  }, \"THERE IS NO MARKERS IN THIS AUDIO.\"), /*#__PURE__*/React.createElement(\"span\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 405,\n      columnNumber: 15\n    }\n  }, \"PLEASE DEFINE MARKERS IN THIS AUDIO\"))));\n}\n\nexport default BlmAudioMarkerAction;","map":{"version":3,"sources":["C:/Users/Rajesh/Downloads/bilim (2)/bilim/v1.0/editors/BlmCourseEditor/src/components/content-editor/components/actions/main/audiomarker/BlmAudioMarkerAction.tsx"],"names":["React","useMemo","useCallback","Select","MenuItem","Divider","ListItemText","ListItemIcon","useTranslation","useContentEditorCtx","createMediaCues","isSoundComponent","BlmAudioMarkerAction","props","data","onChange","getFile","markerFiles","action","name","temp","sound","marker","t","template","selectedComponentId","setSelectedComponentId","useState","selectedAudioMarkers","setSelectedAudioMarkers","selectedmarkerId","setSelectedMarkerId","items","components","sounds","result","some","component","value","media","forEach","index","push","label","type","repeater","updateChange","newData","target","getFirstAudio","val","find","ind","parseInt","markerId","id","useEffect","undefined","length","firstVidoe","load","url","test","renderPlaceholder","renderMarkerPlaceholder","renderNoAudioFound","renderNoMarkerFound","renderSelectedAudioItem","selectedItem","item","renderSelectedMarkerItem","toString","text","handleChange","event","firstAudio","markerFile","markers","map","cue","endTime","NaN","renderItems","renderMarkerItems","className"],"mappings":"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","sourcesContent":["import React, { ChangeEvent, useMemo, useCallback } from \"react\";\r\nimport { Select, MenuItem, Divider, ListItemText, ListItemIcon } from \"@material-ui/core\";\r\nimport { useTranslation } from \"react-i18next\";\r\n\r\nimport {\r\n  ContentTemplateAction,\r\n  CustomChangeEvent,\r\n  MediaTrackCue,\r\n  SoundComponent,\r\n  SoundMarkerAction,\r\n} from \"types\";\r\nimport \"./styles.scss\";\r\nimport { useContentEditorCtx } from \"components/content-editor/core\";\r\nimport { createMediaCues, isSoundComponent } from \"utils\";\r\nimport { ContainerProps } from \"./continer\";\r\n\r\nexport interface CompProps {\r\n  data?: SoundMarkerAction;\r\n  showNavigation?: boolean;\r\n  showPage?: boolean;\r\n  onChange?: (event: CustomChangeEvent<SoundMarkerAction>) => void;\r\n  action?: string;\r\n  name?: string;\r\n  temp?: ContentTemplateAction | undefined;\r\n}\r\n\r\nfunction BlmAudioMarkerAction(props: CompProps & ContainerProps) {\r\n  const { data, onChange, getFile, markerFiles, action, name, temp } = props;\r\n  const { sound, marker } = data || {};\r\n  const { t } = useTranslation(\"content-editor\");\r\n  const { template } = useContentEditorCtx();\r\n  const [selectedComponentId, setSelectedComponentId] = React.useState<string | undefined>(sound);\r\n  const [selectedAudioMarkers, setSelectedAudioMarkers] = React.useState<MediaTrackCue[]>([]);\r\n  const [selectedmarkerId, setSelectedMarkerId] = React.useState<string | undefined>(marker);\r\n\r\n  const items = useMemo(() => {\r\n    const components = template?.sounds;\r\n    let result: any[] = [];\r\n    if (components && components.some((component: SoundComponent) => component.value.media)) {\r\n      components?.forEach((component: SoundComponent, index: number) => {\r\n        result.push({\r\n          label: `${t(\"sound_marker.Sound_label\")}${index + 1}`,\r\n          type: `${index + 1}`,\r\n        });\r\n      });\r\n    } else {\r\n      if (template?.repeater?.sounds) {\r\n        template?.repeater?.sounds[0].value?.forEach((component: SoundComponent, index: number) => {\r\n          result.push({\r\n            label: `${t(\"sound_marker.Sound_label\")}${index + 1}`,\r\n            type: `${index + 1}`,\r\n          });\r\n        });\r\n      }\r\n    }\r\n\r\n    if (temp) {\r\n      result.push({\r\n        label: \"Background sound\",\r\n        type: `${100 + 1}`,\r\n      });\r\n    }\r\n\r\n    return result;\r\n  }, [template, t, temp]);\r\n\r\n  const updateChange = useCallback(\r\n    (newData: SoundMarkerAction) => {\r\n      if (onChange) {\r\n        onChange({\r\n          target: { name: action ? action : \"audiomarker\", value: newData },\r\n        });\r\n      }\r\n    },\r\n    [onChange, action]\r\n  );\r\n\r\n  var getFirstAudio = useCallback(\r\n    (val: any) => {\r\n      if (val) {\r\n        const component = template?.sounds.find(\r\n          (media: SoundComponent, ind: number) => ind + 1 === parseInt(val)\r\n        );\r\n\r\n        if (\r\n          component &&\r\n          isSoundComponent(component) &&\r\n          component?.value &&\r\n          component?.value.media\r\n        ) {\r\n          const markerId = component.value?.media?.marker?.id || 0;\r\n          return markerId;\r\n        }\r\n      }\r\n    },\r\n    [template]\r\n  );\r\n\r\n  React.useEffect(() => {\r\n    if (selectedComponentId === undefined && items.length === 1) {\r\n      let newData = { sound, marker } as SoundMarkerAction;\r\n      newData.sound = items[0].type;\r\n\r\n      var firstVidoe = getFirstAudio(items[0].type);\r\n      if (firstVidoe === 0) {\r\n        newData.marker = \"none\";\r\n        setSelectedMarkerId(\"none\");\r\n      } else {\r\n        newData.marker = \"\";\r\n        setSelectedMarkerId(\"\");\r\n      }\r\n\r\n      updateChange(newData);\r\n      setSelectedComponentId(items[0].type);\r\n    }\r\n  }, [items, marker, sound, selectedComponentId, updateChange, getFirstAudio]);\r\n\r\n  React.useEffect(() => {\r\n    if (\r\n      temp?.load?.sound?.sound?.marker?.id &&\r\n      !markerFiles[temp?.load?.sound?.sound?.marker?.id]\r\n    ) {\r\n      getFile(temp?.load?.sound?.sound?.marker?.id, temp?.load?.sound?.sound?.marker?.url);\r\n    }\r\n    if (selectedComponentId) {\r\n      const component = template?.sounds.find(\r\n        (sound: SoundComponent) => sound.id === selectedComponentId\r\n      );\r\n      if (component && isSoundComponent(component)) {\r\n        const marker = component?.value?.media?.marker;\r\n        if (marker && !markerFiles[marker.id]) {\r\n          getFile(marker.id, marker.url);\r\n        }\r\n      } else {\r\n        if (template?.repeater?.sounds) {\r\n          var test = template?.repeater?.sounds[0].value?.find(\r\n            (media: SoundComponent, ind: number) => ind + 1 === parseInt(selectedComponentId)\r\n          );\r\n\r\n          const marker = test?.value?.media?.marker;\r\n          if (marker && !markerFiles[marker.id]) {\r\n            getFile(marker.id, marker.url);\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }, [template, selectedComponentId, getFile, markerFiles, temp]);\r\n\r\n  const renderPlaceholder = () => {\r\n    return <div>Select audio</div>;\r\n  };\r\n\r\n  const renderMarkerPlaceholder = () => {\r\n    return (\r\n      <>\r\n        <span className={\"markerIcon\"} />\r\n        <div>Select marker</div>\r\n      </>\r\n    );\r\n  };\r\n\r\n  const renderNoAudioFound = () => {\r\n    return <div>No audio</div>;\r\n  };\r\n  const renderNoMarkerFound = () => {\r\n    return <div>No marker</div>;\r\n  };\r\n\r\n  const renderSelectedAudioItem = () => {\r\n    const selectedItem = items.find((item: any) => item.type === selectedComponentId)!;\r\n    return (\r\n      <div className=\"selectedItem\">\r\n        <ListItemIcon className={\"audioIcon\"} />\r\n        <ListItemText>{selectedItem.label}</ListItemText>\r\n      </div>\r\n    );\r\n  };\r\n\r\n  const renderSelectedMarkerItem = () => {\r\n    if (selectedAudioMarkers.length > 0) {\r\n      const selectedItem = selectedAudioMarkers.find(\r\n        (item: MediaTrackCue, index: number) => (index + 1).toString() === marker?.toString()\r\n      )!;\r\n      if (selectedItem) {\r\n        return (\r\n          <div className=\"selectedItem\">\r\n            <ListItemIcon className={\"markerIcon\"} />\r\n            <p className=\"selectedMarkerIndex\">\r\n              {marker && parseInt(marker) < 10 ? `0${marker}` : marker}\r\n            </p>\r\n            <ListItemText>{selectedItem.text}</ListItemText>\r\n          </div>\r\n        );\r\n      } else {\r\n        return (\r\n          <>\r\n            <span className={\"markerIcon\"} />\r\n            <div>Select marker</div>\r\n          </>\r\n        );\r\n      }\r\n    }\r\n  };\r\n\r\n  const handleChange = (event: ChangeEvent<any> | CustomChangeEvent<string>) => {\r\n    const { name, value } = event.target;\r\n    let newData = { sound, marker } as SoundMarkerAction;\r\n\r\n    if (name === \"audio\") {\r\n      var firstAudio = getFirstAudio(value);\r\n      newData.sound = value;\r\n\r\n      if (firstAudio === 0) {\r\n        newData.marker = \"none\";\r\n        setSelectedMarkerId(\"none\");\r\n      } else {\r\n        newData.marker = \"\";\r\n        setSelectedMarkerId(\"\");\r\n      }\r\n\r\n      setSelectedComponentId(value);\r\n    } else if (name === \"marker\") {\r\n      newData.marker = value;\r\n    }\r\n    updateChange(newData);\r\n  };\r\n\r\n  React.useEffect(() => {\r\n    var component;\r\n    if (template?.sounds && template?.sounds.length > 0) {\r\n      component = template?.sounds.find(\r\n        (media: SoundComponent) => media.id === selectedComponentId\r\n      );\r\n    } else {\r\n      if (template?.repeater?.sounds) {\r\n        template?.repeater?.sounds[0].value?.forEach((media: SoundComponent, index: number) => {\r\n          if ((index + 1).toString() === selectedComponentId) {\r\n            component = media;\r\n          }\r\n        });\r\n      }\r\n    }\r\n\r\n    if (\r\n      (component && isSoundComponent(component) && component.value && component.value.media) ||\r\n      temp\r\n    ) {\r\n      var markerId;\r\n      if (component) {\r\n        markerId = component.value?.media?.marker?.id || 0;\r\n      } else {\r\n        markerId = temp?.load.sound.sound?.marker?.id || 0;\r\n      }\r\n      const markerFile = markerFiles[markerId];\r\n      if (typeof markerFile === \"string\") {\r\n        const markers: MediaTrackCue[] = createMediaCues(markerFile).map((cue) => ({\r\n          ...cue,\r\n          endTime: NaN,\r\n        }));\r\n\r\n        if (selectedmarkerId === \"none\" && markers.length > 0) {\r\n          let newData = { sound, marker } as SoundMarkerAction;\r\n          newData.marker = \"\";\r\n          setSelectedMarkerId(\"\");\r\n          updateChange(newData);\r\n        }\r\n\r\n        if (markerFile === \"WEBVTT\" && markers.length === 0 && marker !== \"none\") {\r\n          let newData = { sound, marker } as SoundMarkerAction;\r\n          newData.marker = \"none\";\r\n          updateChange(newData);\r\n        }\r\n\r\n        const selectedItem = markers.find(\r\n          (item: MediaTrackCue, index: number) => (index + 1).toString() === marker?.toString()\r\n        );\r\n        if (marker && selectedItem === undefined && markers.length < parseInt(marker)) {\r\n          let newData = { sound, marker } as SoundMarkerAction;\r\n          newData.marker = \"\";\r\n          updateChange(newData);\r\n        }\r\n\r\n        setSelectedAudioMarkers(markers);\r\n      } else {\r\n        setSelectedAudioMarkers([]);\r\n      }\r\n    }\r\n  }, [\r\n    markerFiles,\r\n    selectedComponentId,\r\n    template,\r\n    sound,\r\n    marker,\r\n    selectedmarkerId,\r\n    temp,\r\n    updateChange,\r\n  ]);\r\n\r\n  const renderItems = () => {\r\n    if (items) {\r\n      return items.map((item, ind) => {\r\n        if (typeof item === \"object\") {\r\n          const { type, label } = item;\r\n          return (\r\n            <MenuItem key={type} value={type}>\r\n              {/* <ListItemIcon className={type} /> */}\r\n              <ListItemText>{label}</ListItemText>\r\n            </MenuItem>\r\n          );\r\n        } else if (item === \"divider\") {\r\n          return <Divider key={item + ind} />;\r\n        } else {\r\n          return (\r\n            <div key={item} className=\"goto-dropdown-menu-title\">\r\n              {item}\r\n            </div>\r\n          );\r\n        }\r\n      });\r\n    } else {\r\n      return (\r\n        <MenuItem key={\"none\"} value={\"none\"}>\r\n          <ListItemText>{\"No audio\"}</ListItemText>\r\n        </MenuItem>\r\n      );\r\n    }\r\n  };\r\n\r\n  const renderMarkerItems = () => {\r\n    if (selectedAudioMarkers.length > 0) {\r\n      return selectedAudioMarkers.map((item: MediaTrackCue, index: number) => {\r\n        if (typeof item === \"object\") {\r\n          const { text } = item;\r\n          return (\r\n            <MenuItem key={index} value={index + 1}>\r\n              <p className=\"selectedMarkerIndex\">{index + 1 < 10 ? `0${index + 1}` : index + 1}</p>\r\n              <ListItemText>{text}</ListItemText>\r\n            </MenuItem>\r\n          );\r\n        } else if (item === \"divider\") {\r\n          return <Divider key={item + (index + 1)} />;\r\n        } else {\r\n          return (\r\n            <div key={item} className=\"goto-dropdown-menu-title\">\r\n              {item}\r\n            </div>\r\n          );\r\n        }\r\n      });\r\n    } else {\r\n      return (\r\n        <MenuItem key={\"none\"} value={\"none\"}>\r\n          {/* <ListItemIcon className={type} /> */}\r\n          <ListItemText>{\"No marker\"}</ListItemText>\r\n        </MenuItem>\r\n      );\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"audiomaker-action-wrapper\">\r\n      <Select\r\n        name={name ? name : \"audio\"}\r\n        value={selectedComponentId || \"\"}\r\n        displayEmpty={true}\r\n        MenuProps={{\r\n          className: \"audioomaker-actions-dropdown-popover\",\r\n        }}\r\n        className=\"audiomaker-actions-dropdown\"\r\n        renderValue={\r\n          selectedComponentId\r\n            ? renderSelectedAudioItem\r\n            : items.length > 0\r\n            ? renderPlaceholder\r\n            : renderNoAudioFound\r\n        }\r\n        onChange={handleChange}\r\n      >\r\n        {renderItems()}\r\n      </Select>\r\n      {selectedComponentId && (\r\n        <>\r\n          <Select\r\n            name=\"marker\"\r\n            value={marker || \"\"}\r\n            MenuProps={{\r\n              className: \"audiomaker-actions-dropdown-popover\",\r\n            }}\r\n            className=\"audiomaker-actions-dropdown\"\r\n            renderValue={\r\n              marker !== undefined && marker !== \"none\"\r\n                ? renderSelectedMarkerItem\r\n                : selectedAudioMarkers.length > 0\r\n                ? renderMarkerPlaceholder\r\n                : renderNoMarkerFound\r\n            }\r\n            displayEmpty={true}\r\n            onChange={handleChange}\r\n          >\r\n            {renderMarkerItems()}\r\n          </Select>\r\n          {selectedAudioMarkers.length === 0 && (\r\n            <div className=\"audiomarker-warning-lbl\">\r\n              <span>THERE IS NO MARKERS IN THIS AUDIO.</span>\r\n              <span>PLEASE DEFINE MARKERS IN THIS AUDIO</span>\r\n            </div>\r\n          )}\r\n        </>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default BlmAudioMarkerAction;\r\n"]},"metadata":{},"sourceType":"module"}