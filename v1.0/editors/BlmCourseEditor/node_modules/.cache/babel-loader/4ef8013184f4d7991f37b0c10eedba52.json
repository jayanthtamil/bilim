{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Rajesh\\\\Downloads\\\\bilim (2)\\\\bilim\\\\v1.0\\\\editors\\\\BlmCourseEditor\\\\src\\\\components\\\\properties\\\\hoc\\\\properties-board\\\\withBlmPropertiesBoard.tsx\";\nimport React, { useEffect, useCallback, forwardRef, useImperativeHandle } from \"react\";\nimport useStateRef from \"react-usestateref\";\nimport { ElementType } from \"editor-constants\";\nimport { differenceOfObjects, textArea } from \"utils\";\nimport { usePrevious } from \"hooks\";\nimport { getPropertiesMedias } from \"template-builders\";\nimport connector from \"./properties-board-container\";\nconst initEditor = {\n  data: undefined,\n  oldMedias: [],\n  isEdited: false\n};\n\nconst withBlmPropertiesBoard = WrappedComponent => {\n  const WithBlmPropertiesBoard = forwardRef((props, ref) => {\n    const {\n      element,\n      properties,\n      autoSave = true,\n      autoClear = true,\n      getElementProperties,\n      updateElementProperties,\n      clearElementProperties,\n      removeFiles,\n      clearFiles,\n      setElementProperties,\n      onChange,\n      ...wrappedProps\n    } = props;\n    const [editor, setEditor, editorRef] = useStateRef(initEditor);\n    const {\n      data,\n      isEdited\n    } = editor;\n    const prevData = usePrevious(data);\n    useImperativeHandle(ref, () => ({\n      isEdited,\n      save: saveChanges,\n      revert: revertChanges\n    }));\n\n    if (data === null || data === void 0 ? void 0 : data.description) {\n      let newDescription = textArea(data.description, \"<br>\", \"\\n\");\n      data.description = newDescription;\n    }\n\n    const updateTree = useCallback(newData => {\n      if (editorRef.current) {\n        const {\n          data\n        } = editorRef.current;\n\n        if (data && (data.type === ElementType.Chapter || data.type === ElementType.Page || data.type === ElementType.Custom) && (!newData || data.isEvaluation !== newData.isEvaluation || data.hasFeedback !== newData.hasFeedback || data.hasAssociateContent !== newData.hasAssociateContent)) {\n          setElementProperties(newData);\n        }\n      }\n    }, [editorRef, setElementProperties]);\n    const saveChanges = useCallback(() => {\n      if (editorRef.current) {\n        const {\n          data,\n          oldMedias,\n          isEdited\n        } = editorRef.current;\n\n        if (data === null || data === void 0 ? void 0 : data.description) {\n          let newDescription = textArea(data.description, \"\\n\", \"<br>\");\n          data.description = newDescription;\n        }\n\n        if (data && isEdited) {\n          const newMedias = getPropertiesMedias(data);\n          const deletedMedias = differenceOfObjects(oldMedias, newMedias, \"id\");\n          updateTree(data);\n          updateElementProperties(data);\n          removeFiles(deletedMedias);\n          clearFiles(data.id, true);\n          setEditor({\n            data,\n            oldMedias: newMedias,\n            isEdited: false\n          });\n        }\n      }\n    }, [editorRef, updateTree, updateElementProperties, removeFiles, clearFiles, setEditor]);\n\n    const revertChanges = () => {\n      updateTree(properties);\n      setEditor({ ...editor,\n        data: properties,\n        isEdited: false\n      });\n      clearFiles(properties.id, false);\n    };\n\n    useEffect(() => {\n      if (element && !properties) {\n        getElementProperties(element);\n      }\n    }, [element, properties, getElementProperties]);\n    useEffect(() => {\n      if (autoSave && element.id) {\n        return () => {\n          saveChanges();\n        };\n      }\n    }, [element.id, autoSave, saveChanges]);\n    useEffect(() => {\n      if (autoClear && element.id) {\n        return () => {\n          const id = element.type !== ElementType.Page && element.type !== ElementType.SimplePage ? element.id : undefined;\n          clearElementProperties(id);\n        };\n      }\n    }, [element.id, element.type, autoClear, clearElementProperties]);\n    useEffect(() => {\n      if (properties) {\n        setEditor({\n          data: properties,\n          oldMedias: getPropertiesMedias(properties),\n          isEdited: false\n        });\n      }\n    }, [properties, setEditor]);\n    useEffect(() => {\n      if (data && data !== prevData && onChange) {\n        onChange(data);\n      }\n    }, [data, prevData, onChange]);\n\n    const handleChange = (newData, forceSave) => {\n      updateTree(newData);\n      setEditor({ ...editor,\n        data: newData,\n        isEdited: true\n      });\n\n      if (forceSave) {\n        saveChanges();\n      }\n    };\n\n    const handleSave = () => {\n      saveChanges();\n    };\n\n    return /*#__PURE__*/React.createElement(WrappedComponent, Object.assign({}, wrappedProps, {\n      element: element,\n      data: data,\n      onChange: handleChange,\n      onSave: handleSave,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 188,\n        columnNumber: 7\n      }\n    }));\n  }); //https://github.com/DefinitelyTyped/DefinitelyTyped/issues/31363\n\n  return connector(WithBlmPropertiesBoard);\n};\n\nexport default withBlmPropertiesBoard;","map":{"version":3,"sources":["C:/Users/Rajesh/Downloads/bilim (2)/bilim/v1.0/editors/BlmCourseEditor/src/components/properties/hoc/properties-board/withBlmPropertiesBoard.tsx"],"names":["React","useEffect","useCallback","forwardRef","useImperativeHandle","useStateRef","ElementType","differenceOfObjects","textArea","usePrevious","getPropertiesMedias","connector","initEditor","data","undefined","oldMedias","isEdited","withBlmPropertiesBoard","WrappedComponent","WithBlmPropertiesBoard","props","ref","element","properties","autoSave","autoClear","getElementProperties","updateElementProperties","clearElementProperties","removeFiles","clearFiles","setElementProperties","onChange","wrappedProps","editor","setEditor","editorRef","prevData","save","saveChanges","revert","revertChanges","description","newDescription","updateTree","newData","current","type","Chapter","Page","Custom","isEvaluation","hasFeedback","hasAssociateContent","newMedias","deletedMedias","id","SimplePage","handleChange","forceSave","handleSave"],"mappings":";AAAA,OAAOA,KAAP,IACEC,SADF,EAGEC,WAHF,EAIEC,UAJF,EAKEC,mBALF,QAQO,OARP;AAUA,OAAOC,WAAP,MAAwB,mBAAxB;AAUA,SAASC,WAAT,QAA4B,kBAA5B;AACA,SAASC,mBAAT,EAA8BC,QAA9B,QAA8C,OAA9C;AACA,SAASC,WAAT,QAA4B,OAA5B;AACA,SAASC,mBAAT,QAAoC,mBAApC;AACA,OAAOC,SAAP,MAA0C,8BAA1C;AAiBA,MAAMC,UAAuB,GAAG;AAC9BC,EAAAA,IAAI,EAAEC,SADwB;AAE9BC,EAAAA,SAAS,EAAE,EAFmB;AAG9BC,EAAAA,QAAQ,EAAE;AAHoB,CAAhC;;AAMA,MAAMC,sBAAsB,GAA6BC,gBAA1B,IAAiE;AAC9F,QAAMC,sBAAsB,GAAGhB,UAAU,CAGvC,CAACiB,KAAD,EAAQC,GAAR,KAAgB;AAChB,UAAM;AACJC,MAAAA,OADI;AAEJC,MAAAA,UAFI;AAGJC,MAAAA,QAAQ,GAAG,IAHP;AAIJC,MAAAA,SAAS,GAAG,IAJR;AAKJC,MAAAA,oBALI;AAMJC,MAAAA,uBANI;AAOJC,MAAAA,sBAPI;AAQJC,MAAAA,WARI;AASJC,MAAAA,UATI;AAUJC,MAAAA,oBAVI;AAWJC,MAAAA,QAXI;AAYJ,SAAGC;AAZC,QAaFb,KAbJ;AAcA,UAAM,CAACc,MAAD,EAASC,SAAT,EAAoBC,SAApB,IAAiC/B,WAAW,CAACO,UAAD,CAAlD;AACA,UAAM;AAAEC,MAAAA,IAAF;AAAQG,MAAAA;AAAR,QAAqBkB,MAA3B;AACA,UAAMG,QAAQ,GAAG5B,WAAW,CAACI,IAAD,CAA5B;AAEAT,IAAAA,mBAAmB,CAACiB,GAAD,EAAM,OAAO;AAC9BL,MAAAA,QAD8B;AAE9BsB,MAAAA,IAAI,EAAEC,WAFwB;AAG9BC,MAAAA,MAAM,EAAEC;AAHsB,KAAP,CAAN,CAAnB;;AAMA,QAAI5B,IAAJ,aAAIA,IAAJ,uBAAIA,IAAI,CAAE6B,WAAV,EAAuB;AACrB,UAAIC,cAAc,GAAGnC,QAAQ,CAACK,IAAI,CAAC6B,WAAN,EAAmB,MAAnB,EAA2B,IAA3B,CAA7B;AACA7B,MAAAA,IAAI,CAAC6B,WAAL,GAAmBC,cAAnB;AACD;;AAED,UAAMC,UAAU,GAAG1C,WAAW,CAC3B2C,OAAD,IAAkC;AAChC,UAAIT,SAAS,CAACU,OAAd,EAAuB;AACrB,cAAM;AAAEjC,UAAAA;AAAF,YAAWuB,SAAS,CAACU,OAA3B;;AAEA,YACEjC,IAAI,KACHA,IAAI,CAACkC,IAAL,KAAczC,WAAW,CAAC0C,OAA1B,IACCnC,IAAI,CAACkC,IAAL,KAAczC,WAAW,CAAC2C,IAD3B,IAECpC,IAAI,CAACkC,IAAL,KAAczC,WAAW,CAAC4C,MAHxB,CAAJ,KAIC,CAACL,OAAD,IACChC,IAAI,CAACsC,YAAL,KAAsBN,OAAO,CAACM,YAD/B,IAECtC,IAAI,CAACuC,WAAL,KAAqBP,OAAO,CAACO,WAF9B,IAGCvC,IAAI,CAACwC,mBAAL,KAA6BR,OAAO,CAACQ,mBAPvC,CADF,EASE;AACAtB,UAAAA,oBAAoB,CAACc,OAAD,CAApB;AACD;AACF;AACF,KAlB2B,EAmB5B,CAACT,SAAD,EAAYL,oBAAZ,CAnB4B,CAA9B;AAsBA,UAAMQ,WAAW,GAAGrC,WAAW,CAAC,MAAM;AACpC,UAAIkC,SAAS,CAACU,OAAd,EAAuB;AACrB,cAAM;AAAEjC,UAAAA,IAAF;AAAQE,UAAAA,SAAR;AAAmBC,UAAAA;AAAnB,YAAgCoB,SAAS,CAACU,OAAhD;;AAEA,YAAIjC,IAAJ,aAAIA,IAAJ,uBAAIA,IAAI,CAAE6B,WAAV,EAAuB;AACrB,cAAIC,cAAc,GAAGnC,QAAQ,CAACK,IAAI,CAAC6B,WAAN,EAAmB,IAAnB,EAAyB,MAAzB,CAA7B;AACA7B,UAAAA,IAAI,CAAC6B,WAAL,GAAmBC,cAAnB;AACD;;AAED,YAAI9B,IAAI,IAAIG,QAAZ,EAAsB;AACpB,gBAAMsC,SAAS,GAAG5C,mBAAmB,CAACG,IAAD,CAArC;AACA,gBAAM0C,aAAa,GAAGhD,mBAAmB,CAACQ,SAAD,EAAYuC,SAAZ,EAAuB,IAAvB,CAAzC;AAEAV,UAAAA,UAAU,CAAC/B,IAAD,CAAV;AACAc,UAAAA,uBAAuB,CAACd,IAAD,CAAvB;AACAgB,UAAAA,WAAW,CAAC0B,aAAD,CAAX;AACAzB,UAAAA,UAAU,CAACjB,IAAI,CAAC2C,EAAN,EAAU,IAAV,CAAV;AACArB,UAAAA,SAAS,CAAC;AAAEtB,YAAAA,IAAF;AAAQE,YAAAA,SAAS,EAAEuC,SAAnB;AAA8BtC,YAAAA,QAAQ,EAAE;AAAxC,WAAD,CAAT;AACD;AACF;AACF,KApB8B,EAoB5B,CAACoB,SAAD,EAAYQ,UAAZ,EAAwBjB,uBAAxB,EAAiDE,WAAjD,EAA8DC,UAA9D,EAA0EK,SAA1E,CApB4B,CAA/B;;AAsBA,UAAMM,aAAa,GAAG,MAAM;AAC1BG,MAAAA,UAAU,CAACrB,UAAD,CAAV;AACAY,MAAAA,SAAS,CAAC,EAAE,GAAGD,MAAL;AAAarB,QAAAA,IAAI,EAAEU,UAAnB;AAA+BP,QAAAA,QAAQ,EAAE;AAAzC,OAAD,CAAT;AACAc,MAAAA,UAAU,CAACP,UAAU,CAACiC,EAAZ,EAAgB,KAAhB,CAAV;AACD,KAJD;;AAMAvD,IAAAA,SAAS,CAAC,MAAM;AACd,UAAIqB,OAAO,IAAI,CAACC,UAAhB,EAA4B;AAC1BG,QAAAA,oBAAoB,CAACJ,OAAD,CAApB;AACD;AACF,KAJQ,EAIN,CAACA,OAAD,EAAUC,UAAV,EAAsBG,oBAAtB,CAJM,CAAT;AAMAzB,IAAAA,SAAS,CAAC,MAAM;AACd,UAAIuB,QAAQ,IAAIF,OAAO,CAACkC,EAAxB,EAA4B;AAC1B,eAAO,MAAM;AACXjB,UAAAA,WAAW;AACZ,SAFD;AAGD;AACF,KANQ,EAMN,CAACjB,OAAO,CAACkC,EAAT,EAAahC,QAAb,EAAuBe,WAAvB,CANM,CAAT;AAQAtC,IAAAA,SAAS,CAAC,MAAM;AACd,UAAIwB,SAAS,IAAIH,OAAO,CAACkC,EAAzB,EAA6B;AAC3B,eAAO,MAAM;AACX,gBAAMA,EAAE,GACNlC,OAAO,CAACyB,IAAR,KAAiBzC,WAAW,CAAC2C,IAA7B,IAAqC3B,OAAO,CAACyB,IAAR,KAAiBzC,WAAW,CAACmD,UAAlE,GACInC,OAAO,CAACkC,EADZ,GAEI1C,SAHN;AAIAc,UAAAA,sBAAsB,CAAC4B,EAAD,CAAtB;AACD,SAND;AAOD;AACF,KAVQ,EAUN,CAAClC,OAAO,CAACkC,EAAT,EAAalC,OAAO,CAACyB,IAArB,EAA2BtB,SAA3B,EAAsCG,sBAAtC,CAVM,CAAT;AAYA3B,IAAAA,SAAS,CAAC,MAAM;AACd,UAAIsB,UAAJ,EAAgB;AACdY,QAAAA,SAAS,CAAC;AACRtB,UAAAA,IAAI,EAAEU,UADE;AAERR,UAAAA,SAAS,EAAEL,mBAAmB,CAACa,UAAD,CAFtB;AAGRP,UAAAA,QAAQ,EAAE;AAHF,SAAD,CAAT;AAKD;AACF,KARQ,EAQN,CAACO,UAAD,EAAaY,SAAb,CARM,CAAT;AAUAlC,IAAAA,SAAS,CAAC,MAAM;AACd,UAAIY,IAAI,IAAIA,IAAI,KAAKwB,QAAjB,IAA6BL,QAAjC,EAA2C;AACzCA,QAAAA,QAAQ,CAACnB,IAAD,CAAR;AACD;AACF,KAJQ,EAIN,CAACA,IAAD,EAAOwB,QAAP,EAAiBL,QAAjB,CAJM,CAAT;;AAMA,UAAM0B,YAAuC,GAAG,CAACb,OAAD,EAAUc,SAAV,KAAwB;AACtEf,MAAAA,UAAU,CAACC,OAAD,CAAV;AACAV,MAAAA,SAAS,CAAC,EAAE,GAAGD,MAAL;AAAarB,QAAAA,IAAI,EAAEgC,OAAnB;AAA4B7B,QAAAA,QAAQ,EAAE;AAAtC,OAAD,CAAT;;AAEA,UAAI2C,SAAJ,EAAe;AACbpB,QAAAA,WAAW;AACZ;AACF,KAPD;;AASA,UAAMqB,UAAU,GAAG,MAAM;AACvBrB,MAAAA,WAAW;AACZ,KAFD;;AAIA,wBACE,oBAAC,gBAAD,oBACON,YADP;AAEE,MAAA,OAAO,EAAEX,OAFX;AAGE,MAAA,IAAI,EAAET,IAHR;AAIE,MAAA,QAAQ,EAAE6C,YAJZ;AAKE,MAAA,MAAM,EAAEE,UALV;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OADF;AASD,GAnJwC,CAAzC,CAD8F,CAsJ9F;;AACA,SAAOjD,SAAS,CAACQ,sBAAD,CAAhB;AAGD,CA1JD;;AA4JA,eAAeF,sBAAf","sourcesContent":["import React, {\r\n  useEffect,\r\n  ComponentType,\r\n  useCallback,\r\n  forwardRef,\r\n  useImperativeHandle,\r\n  RefAttributes,\r\n  ForwardRefExoticComponent,\r\n} from \"react\";\r\nimport { Diff } from \"utility-types\";\r\nimport useStateRef from \"react-usestateref\";\r\n\r\nimport {\r\n  CourseElement,\r\n  CourseElementProps,\r\n  ElementPropsChangeHandler,\r\n  ElementPropsContainer,\r\n  MediaFile,\r\n  PropertiesEditorComponent,\r\n} from \"types\";\r\nimport { ElementType } from \"editor-constants\";\r\nimport { differenceOfObjects, textArea } from \"utils\";\r\nimport { usePrevious } from \"hooks\";\r\nimport { getPropertiesMedias } from \"template-builders\";\r\nimport connector, { ContainerProps } from \"./properties-board-container\";\r\n\r\ninterface InjectedProps extends ElementPropsContainer {}\r\n\r\ninterface CompProps {\r\n  element: CourseElement;\r\n  autoSave?: boolean;\r\n  autoClear?: boolean;\r\n  onChange?: ElementPropsChangeHandler;\r\n}\r\n\r\ninterface EditorState {\r\n  data?: CourseElementProps;\r\n  oldMedias: MediaFile[];\r\n  isEdited: boolean;\r\n}\r\n\r\nconst initEditor: EditorState = {\r\n  data: undefined,\r\n  oldMedias: [],\r\n  isEdited: false,\r\n};\r\n\r\nconst withBlmPropertiesBoard = <P extends InjectedProps>(WrappedComponent: ComponentType<P>) => {\r\n  const WithBlmPropertiesBoard = forwardRef<\r\n    PropertiesEditorComponent,\r\n    CompProps & ContainerProps & P\r\n  >((props, ref) => {\r\n    const {\r\n      element,\r\n      properties,\r\n      autoSave = true,\r\n      autoClear = true,\r\n      getElementProperties,\r\n      updateElementProperties,\r\n      clearElementProperties,\r\n      removeFiles,\r\n      clearFiles,\r\n      setElementProperties,\r\n      onChange,\r\n      ...wrappedProps\r\n    } = props;\r\n    const [editor, setEditor, editorRef] = useStateRef(initEditor);\r\n    const { data, isEdited } = editor;\r\n    const prevData = usePrevious(data);\r\n\r\n    useImperativeHandle(ref, () => ({\r\n      isEdited,\r\n      save: saveChanges,\r\n      revert: revertChanges,\r\n    }));\r\n\r\n    if (data?.description) {\r\n      let newDescription = textArea(data.description, \"<br>\", \"\\n\");\r\n      data.description = newDescription;\r\n    }\r\n\r\n    const updateTree = useCallback(\r\n      (newData?: CourseElementProps) => {\r\n        if (editorRef.current) {\r\n          const { data } = editorRef.current;\r\n\r\n          if (\r\n            data &&\r\n            (data.type === ElementType.Chapter ||\r\n              data.type === ElementType.Page ||\r\n              data.type === ElementType.Custom) &&\r\n            (!newData ||\r\n              data.isEvaluation !== newData.isEvaluation ||\r\n              data.hasFeedback !== newData.hasFeedback ||\r\n              data.hasAssociateContent !== newData.hasAssociateContent)\r\n          ) {\r\n            setElementProperties(newData);\r\n          }\r\n        }\r\n      },\r\n      [editorRef, setElementProperties]\r\n    );\r\n\r\n    const saveChanges = useCallback(() => {\r\n      if (editorRef.current) {\r\n        const { data, oldMedias, isEdited } = editorRef.current;\r\n\r\n        if (data?.description) {\r\n          let newDescription = textArea(data.description, \"\\n\", \"<br>\");\r\n          data.description = newDescription;\r\n        }\r\n\r\n        if (data && isEdited) {\r\n          const newMedias = getPropertiesMedias(data);\r\n          const deletedMedias = differenceOfObjects(oldMedias, newMedias, \"id\");\r\n\r\n          updateTree(data);\r\n          updateElementProperties(data);\r\n          removeFiles(deletedMedias);\r\n          clearFiles(data.id, true);\r\n          setEditor({ data, oldMedias: newMedias, isEdited: false });\r\n        }\r\n      }\r\n    }, [editorRef, updateTree, updateElementProperties, removeFiles, clearFiles, setEditor]);\r\n\r\n    const revertChanges = () => {\r\n      updateTree(properties);\r\n      setEditor({ ...editor, data: properties, isEdited: false });\r\n      clearFiles(properties.id, false);\r\n    };\r\n\r\n    useEffect(() => {\r\n      if (element && !properties) {\r\n        getElementProperties(element);\r\n      }\r\n    }, [element, properties, getElementProperties]);\r\n\r\n    useEffect(() => {\r\n      if (autoSave && element.id) {\r\n        return () => {\r\n          saveChanges();\r\n        };\r\n      }\r\n    }, [element.id, autoSave, saveChanges]);\r\n\r\n    useEffect(() => {\r\n      if (autoClear && element.id) {\r\n        return () => {\r\n          const id =\r\n            element.type !== ElementType.Page && element.type !== ElementType.SimplePage\r\n              ? element.id\r\n              : undefined;\r\n          clearElementProperties(id);\r\n        };\r\n      }\r\n    }, [element.id, element.type, autoClear, clearElementProperties]);\r\n\r\n    useEffect(() => {\r\n      if (properties) {\r\n        setEditor({\r\n          data: properties,\r\n          oldMedias: getPropertiesMedias(properties),\r\n          isEdited: false,\r\n        });\r\n      }\r\n    }, [properties, setEditor]);\r\n\r\n    useEffect(() => {\r\n      if (data && data !== prevData && onChange) {\r\n        onChange(data);\r\n      }\r\n    }, [data, prevData, onChange]);\r\n\r\n    const handleChange: ElementPropsChangeHandler = (newData, forceSave) => {\r\n      updateTree(newData);\r\n      setEditor({ ...editor, data: newData, isEdited: true });\r\n\r\n      if (forceSave) {\r\n        saveChanges();\r\n      }\r\n    };\r\n\r\n    const handleSave = () => {\r\n      saveChanges();\r\n    };\r\n\r\n    return (\r\n      <WrappedComponent\r\n        {...(wrappedProps as P)}\r\n        element={element}\r\n        data={data}\r\n        onChange={handleChange}\r\n        onSave={handleSave}\r\n      />\r\n    );\r\n  });\r\n\r\n  //https://github.com/DefinitelyTyped/DefinitelyTyped/issues/31363\r\n  return connector(WithBlmPropertiesBoard as any) as ForwardRefExoticComponent<\r\n    CompProps & Diff<P, InjectedProps> & RefAttributes<PropertiesEditorComponent>\r\n  >;\r\n};\r\n\r\nexport default withBlmPropertiesBoard;\r\n"]},"metadata":{},"sourceType":"module"}