{"ast":null,"code":"import { CourseElementProps, CourseElementTemplates, CourseElementTemplate, AssociatedTemplate, BackgroundProps, CompletionProps, ChapterEvaluationProps, PageEvaluationProps, CustomEvaluationProps, RetryQuizProps, BaseAdvancedProps, FeedbackOptions, RelatedToProps, PrerequisiteProps, TemplateScroll } from \"types\";\nimport { ElementType, BackgroundOptionTypes } from \"editor-constants\";\nimport { toBoolean, toJSONString, toJSONObject, getElementBySelector, createRGBA, fromRgbaStr, hasChapterEvaluation, hasPageEvaluation, hasCustomEvaluation, isImage } from \"utils\";\nexport const createPropertiesAPI = model => {\n  const result = {}; //General\n\n  result.nid = model.id;\n  result.type = model.type;\n  result.title = model.name;\n  result.title2 = model.subTitle;\n  result.description = model.description;\n  result.duration = model.duration;\n  result.media_param = toJSONString(model.mediaJSON);\n  result.nav_temp = toJSONString(model.navigationJSON);\n  result.metadatas = toJSONString(model.metadatasJSON);\n  result.hasassociatecontent = model.hasAssociateContent.toString();\n  result.stylesummary = model.styleSummary.toString();\n  result.screenonsummary = (model.screenSummary || false).toString(); //Completion\n\n  result.cust_comp = model.isCompletion.toString();\n  result.cust_comp_param = toJSONString(model.completionJSON); //Prerequisite\n\n  result.cust_prereq_param = toJSONString(model.prerequisiteJSON); //Evaluation\n\n  result.theme_ref = model.theme;\n  result.isevaluation = model.isEvaluation.toString();\n  result.hasfeedback = model.hasFeedback.toString();\n  result.eval_param = toJSONString(model.evalutionJSON); //Background\n\n  result.bgm_param = createBackgroundAPI(model.backgroundJSON); //Files\n\n  result.files_param = toJSONString(model.filesJSON); //Props\n\n  result.props_param = toJSONString(model.propsJSON);\n  return result;\n};\nexport const createPropertiesModel = (response, element) => {\n  const result = new CourseElementProps(response.nid, response.title, response.type); //General\n\n  result.level = element.level;\n  result.subTitle = response.title2;\n  result.description = response.description;\n  result.duration = response.duration;\n  result.mediaJSON = toJSONObject(response.media_param);\n  result.navigationJSON = toJSONObject(response.nav_temp);\n  result.metadatasJSON = toJSONObject(response.metadatas);\n  result.hasAssociateContent = toBoolean(response.hasassociatecontent);\n  result.styleSummary = response.stylesummary ? toBoolean(response.stylesummary) : true;\n  result.screenSummary = response.screenonsummary ? toBoolean(response.screenonsummary) : undefined; //Completion\n\n  result.isCompletion = toBoolean(response.cust_comp || \"\");\n  result.completionJSON = toJSONObject(response.cust_comp_param); //Prerequisite\n\n  result.prerequisiteJSON = toJSONObject(response.cust_prereq_param); //Evaluation\n\n  result.theme = response.theme_ref;\n  result.isDirectEvaluation = toBoolean(response.direct_evaluation);\n  result.isEvaluation = toBoolean(response.isevaluation);\n  result.hasFeedback = toBoolean(response.hasfeedback);\n  result.evalutionJSON = toJSONObject(response.eval_param); //Background\n\n  result.backgroundJSON = createBackgroundModel(response.bgm_param); //Files\n\n  result.filesJSON = toJSONObject(response.files_param); //Porps\n\n  result.propsJSON = toJSONObject(response.props_param); //Logs\n\n  result.created = {\n    user: response.changed_by,\n    date: response.created\n  };\n  result.modified = {\n    user: response.modified_by,\n    date: response.changed\n  }; //Initialize\n\n  if (!result.completionJSON) {\n    result.completionJSON = new CompletionProps();\n  }\n\n  if (!result.prerequisiteJSON) {\n    result.prerequisiteJSON = new PrerequisiteProps();\n  }\n\n  if (!result.evalutionJSON) {\n    if (hasChapterEvaluation(result)) {\n      result.evalutionJSON = new ChapterEvaluationProps();\n    } else if (hasPageEvaluation(result)) {\n      result.evalutionJSON = new PageEvaluationProps();\n    } else if (hasCustomEvaluation(result)) {\n      result.evalutionJSON = new CustomEvaluationProps();\n    }\n  } else if (hasChapterEvaluation(result) || hasPageEvaluation(result)) {\n    //This is for old elements, we can delete this if database is cleared.\n    if (hasChapterEvaluation(result)) {\n      if (result.evalutionJSON.theme === undefined) {\n        result.evalutionJSON.theme = result.theme;\n      }\n    }\n\n    if (hasPageEvaluation(result)) {\n      if (result.evalutionJSON.advanced === undefined) {\n        result.evalutionJSON.advanced = new BaseAdvancedProps();\n      }\n    }\n\n    if (!result.evalutionJSON.related_to) {\n      result.evalutionJSON.related_to = new RelatedToProps();\n    } else if (typeof result.evalutionJSON.related_to === \"string\") {\n      result.evalutionJSON.related_to = new RelatedToProps(true, result.evalutionJSON.related_to);\n    }\n\n    if (result.evalutionJSON.feedback.checked === undefined) {\n      result.evalutionJSON.feedback.checked = result.hasFeedback;\n    }\n\n    if (result.evalutionJSON.retry_quiz === undefined) {\n      result.evalutionJSON.retry_quiz = new RetryQuizProps();\n    }\n\n    if (result.evalutionJSON.proposition_feedback === undefined) {\n      result.evalutionJSON.proposition_feedback = new FeedbackOptions();\n    }\n\n    if (!(typeof result.evalutionJSON.question_feedback === \"object\" && \"by_question\" in result.evalutionJSON.question_feedback)) {\n      result.evalutionJSON.question_feedback = new FeedbackOptions();\n    }\n  }\n\n  if (!result.backgroundJSON && (result.type === ElementType.Page || result.type === ElementType.SimplePage)) {\n    result.backgroundJSON = new BackgroundProps();\n  }\n\n  return result;\n};\n\nconst createBackgroundAPI = background => {\n  if (background) {\n    const result = {};\n    const {\n      media: {\n        main,\n        webm,\n        image,\n        tint,\n        option,\n        optionValue,\n        option2\n      },\n      tint: bgTint,\n      mediaSize,\n      colorSize\n    } = background;\n\n    if (main) {\n      result.path = main.url;\n      result.tint = createRGBA(tint.color, tint.alpha);\n      result.option1 = option;\n      result.media_size = mediaSize;\n      result.main = main;\n\n      if (isImage(main.type)) {\n        result.parallaxe = option === BackgroundOptionTypes.Parallax ? optionValue : undefined;\n        result.option2 = option2;\n      } else {\n        result.pathwebm = webm === null || webm === void 0 ? void 0 : webm.url;\n        result.paththumbnaill = image === null || image === void 0 ? void 0 : image.url;\n        result.loop = Boolean(optionValue);\n        result.webm = webm;\n        result.image = image;\n      }\n    }\n\n    if (bgTint.color) {\n      result.color = createRGBA(bgTint.color, bgTint.alpha);\n      result.color_size = colorSize;\n    }\n\n    return toJSONString(result);\n  }\n\n  return null;\n};\n\nconst createBackgroundModel = response => {\n  const background = toJSONObject(response);\n\n  if (background) {\n    const result = new BackgroundProps();\n    const {\n      media\n    } = result;\n    media.main = background.main;\n    media.webm = background.webm;\n    media.image = background.image;\n\n    if (background.tint) {\n      media.tint = fromRgbaStr(background.tint);\n    }\n\n    if (background.option1) {\n      media.option = background.option1;\n\n      if (media.option === BackgroundOptionTypes.Autoplay) {\n        var _background$loop;\n\n        media.optionValue = (_background$loop = background.loop) !== null && _background$loop !== void 0 ? _background$loop : false;\n      } else {\n        media.optionValue = background.parallaxe || 0;\n      }\n    }\n\n    if (background.option2) {\n      media.option2 = background.option2;\n    }\n\n    if (background.color) {\n      result.tint = fromRgbaStr(background.color);\n    }\n\n    if (background.media_size) {\n      result.mediaSize = background.media_size;\n    }\n\n    if (background.color_size) {\n      result.colorSize = background.color_size;\n    }\n\n    return result;\n  }\n\n  return null;\n};\n\nexport const createTemplatesModel = (response, element) => {\n  const {\n    id = \"\",\n    name = \"\",\n    type = ElementType.Screen\n  } = element;\n  const result = new CourseElementTemplates(id, name, type);\n  result.templates = [];\n\n  if (element) {\n    Object.assign(result, element);\n  }\n\n  if (Array.isArray(response.templates)) {\n    for (let resTemplate of response.templates) {\n      const template = createTemplateModel(resTemplate);\n      result.templates.push(template);\n    }\n  } else if (response.templates && response.templates[\"template-type\"]) {\n    const template = createTemplateModel(response.templates);\n    result.templates.push(template);\n  }\n\n  return result;\n};\nexport const createTemplateModel = response => {\n  const {\n    nid,\n    name: title,\n    type,\n    \"template-type\": tempaleType,\n    summary,\n    html,\n    htmlParam,\n    template\n  } = response;\n  const {\n    id,\n    name,\n    light_url,\n    dark_url\n  } = template;\n  const rootElement = getElementBySelector(html, `.outercontainer`);\n  const isDarkTemplate = (rootElement === null || rootElement === void 0 ? void 0 : rootElement.classList.contains(\"dark\")) || false;\n  const scroll = (rootElement === null || rootElement === void 0 ? void 0 : rootElement.getAttribute(\"blm-scroll-transition\")) || undefined;\n  const scrollOption = toJSONObject(rootElement === null || rootElement === void 0 ? void 0 : rootElement.getAttribute(\"blm-scroll-option\"));\n  const hasAnchor = (rootElement === null || rootElement === void 0 ? void 0 : rootElement.hasAttribute(\"anchor\")) || false;\n  const associated = new AssociatedTemplate(id, name, light_url, dark_url);\n  const result = new CourseElementTemplate(nid, title, type, tempaleType, html, associated, isDarkTemplate);\n  result.options = toJSONObject(rootElement === null || rootElement === void 0 ? void 0 : rootElement.getAttribute(\"blm-options\"));\n  result.scroll = new TemplateScroll(scroll, scrollOption === null || scrollOption === void 0 ? void 0 : scrollOption.fixedtransitioneffects, scrollOption === null || scrollOption === void 0 ? void 0 : scrollOption.parallaxecomponents);\n  result.hasAnchor = hasAnchor;\n  result.isSummary = toBoolean(summary);\n  result.hasAction = hasAction(result.options);\n  result.htmlJSON = toJSONObject(htmlParam);\n  return result;\n};\nexport const createDuplicateTemplatesAPI = templates => {\n  if (Array.isArray(templates)) {\n    return {\n      templates: templates.map(createDuplicatePageTemplateAPI)\n    };\n  } else {\n    return createDuplicateScreenTemplateAPI(templates);\n  }\n};\n\nconst createDuplicateScreenTemplateAPI = template1 => {\n  const {\n    template,\n    html,\n    htmlParam\n  } = template1;\n  return {\n    template_id: template.id,\n    template_type: template1[\"template-type\"],\n    html,\n    htmlParam: toJSONString(htmlParam)\n  };\n};\n\nconst createDuplicatePageTemplateAPI = template1 => {\n  const {\n    nid,\n    name,\n    template,\n    summary,\n    html,\n    htmlJSON\n  } = template1;\n  return {\n    id: nid,\n    name,\n    template_id: template.id,\n    template_type: template1[\"template-type\"],\n    summary: summary.toString(),\n    html,\n    htmlParam: toJSONString(htmlJSON)\n  };\n};\n\nexport const createTemplatesAPI = templates => {\n  if (Array.isArray(templates)) {\n    return {\n      templates: templates.map(createPageTemplateAPI)\n    };\n  } else {\n    return createScreenTemplateAPI(templates);\n  }\n};\n\nconst createScreenTemplateAPI = template1 => {\n  const {\n    template,\n    templateType,\n    html,\n    htmlJSON\n  } = template1;\n  return {\n    template_id: template.id,\n    template_type: templateType,\n    html,\n    htmlParam: toJSONString(htmlJSON)\n  };\n};\n\nconst createPageTemplateAPI = template1 => {\n  const {\n    id,\n    name,\n    template,\n    templateType,\n    isSummary,\n    html,\n    htmlJSON\n  } = template1;\n  return {\n    id,\n    name,\n    template_id: template.id,\n    template_type: templateType,\n    summary: isSummary.toString(),\n    html,\n    htmlParam: toJSONString(htmlJSON)\n  };\n};\n\nexport const resetTemplatesAPI = medias => {\n  const ids = medias.map(item => item.id);\n  return {\n    medias: ids\n  };\n};\n\nconst hasAction = options => {\n  if (options) {\n    var _onload$opensimplecon, _onload$changebackgro, _onload$playsound, _onload$stopsound, _onload$playbackgroun, _onload$stopbackgroun, _oncomplete$opensimpl, _oncomplete$changebac, _oncomplete$playsound;\n\n    const {\n      onload,\n      oncomplete\n    } = options;\n    return Boolean((onload === null || onload === void 0 ? void 0 : onload.hidenext) || (onload === null || onload === void 0 ? void 0 : onload.hideprevious) || (onload === null || onload === void 0 ? void 0 : onload.hideprevious) || (onload === null || onload === void 0 ? void 0 : (_onload$opensimplecon = onload.opensimplecontent) === null || _onload$opensimplecon === void 0 ? void 0 : _onload$opensimplecon.checked) || (onload === null || onload === void 0 ? void 0 : (_onload$changebackgro = onload.changebackground) === null || _onload$changebackgro === void 0 ? void 0 : _onload$changebackgro.checked) || (onload === null || onload === void 0 ? void 0 : (_onload$playsound = onload.playsound) === null || _onload$playsound === void 0 ? void 0 : _onload$playsound.checked) || (onload === null || onload === void 0 ? void 0 : (_onload$stopsound = onload.stopsound) === null || _onload$stopsound === void 0 ? void 0 : _onload$stopsound.checked) || (onload === null || onload === void 0 ? void 0 : (_onload$playbackgroun = onload.playbackgroundsound) === null || _onload$playbackgroun === void 0 ? void 0 : _onload$playbackgroun.checked) || (onload === null || onload === void 0 ? void 0 : (_onload$stopbackgroun = onload.stopbackgroundsound) === null || _onload$stopbackgroun === void 0 ? void 0 : _onload$stopbackgroun.checked) || (oncomplete === null || oncomplete === void 0 ? void 0 : oncomplete.keepnextkidden) || (oncomplete === null || oncomplete === void 0 ? void 0 : oncomplete.showprevious) || (oncomplete === null || oncomplete === void 0 ? void 0 : oncomplete.showhome) || (oncomplete === null || oncomplete === void 0 ? void 0 : (_oncomplete$opensimpl = oncomplete.opensimplecontent) === null || _oncomplete$opensimpl === void 0 ? void 0 : _oncomplete$opensimpl.checked) || (oncomplete === null || oncomplete === void 0 ? void 0 : (_oncomplete$changebac = oncomplete.changebackground) === null || _oncomplete$changebac === void 0 ? void 0 : _oncomplete$changebac.checked) || (oncomplete === null || oncomplete === void 0 ? void 0 : (_oncomplete$playsound = oncomplete.playsound) === null || _oncomplete$playsound === void 0 ? void 0 : _oncomplete$playsound.checked));\n  }\n\n  return false;\n};","map":{"version":3,"sources":["C:/Users/Rajesh/Downloads/bilim (2)/bilim/v1.0/editors/BlmCourseEditor/src/redux/course/element/utils/index.ts"],"names":["CourseElementProps","CourseElementTemplates","CourseElementTemplate","AssociatedTemplate","BackgroundProps","CompletionProps","ChapterEvaluationProps","PageEvaluationProps","CustomEvaluationProps","RetryQuizProps","BaseAdvancedProps","FeedbackOptions","RelatedToProps","PrerequisiteProps","TemplateScroll","ElementType","BackgroundOptionTypes","toBoolean","toJSONString","toJSONObject","getElementBySelector","createRGBA","fromRgbaStr","hasChapterEvaluation","hasPageEvaluation","hasCustomEvaluation","isImage","createPropertiesAPI","model","result","nid","id","type","title","name","title2","subTitle","description","duration","media_param","mediaJSON","nav_temp","navigationJSON","metadatas","metadatasJSON","hasassociatecontent","hasAssociateContent","toString","stylesummary","styleSummary","screenonsummary","screenSummary","cust_comp","isCompletion","cust_comp_param","completionJSON","cust_prereq_param","prerequisiteJSON","theme_ref","theme","isevaluation","isEvaluation","hasfeedback","hasFeedback","eval_param","evalutionJSON","bgm_param","createBackgroundAPI","backgroundJSON","files_param","filesJSON","props_param","propsJSON","createPropertiesModel","response","element","level","undefined","isDirectEvaluation","direct_evaluation","createBackgroundModel","created","user","changed_by","date","modified","modified_by","changed","advanced","related_to","feedback","checked","retry_quiz","proposition_feedback","question_feedback","Page","SimplePage","background","media","main","webm","image","tint","option","optionValue","option2","bgTint","mediaSize","colorSize","path","url","color","alpha","option1","media_size","parallaxe","Parallax","pathwebm","paththumbnaill","loop","Boolean","color_size","Autoplay","createTemplatesModel","Screen","templates","Object","assign","Array","isArray","resTemplate","template","createTemplateModel","push","tempaleType","summary","html","htmlParam","light_url","dark_url","rootElement","isDarkTemplate","classList","contains","scroll","getAttribute","scrollOption","hasAnchor","hasAttribute","associated","options","fixedtransitioneffects","parallaxecomponents","isSummary","hasAction","htmlJSON","createDuplicateTemplatesAPI","map","createDuplicatePageTemplateAPI","createDuplicateScreenTemplateAPI","template1","template_id","template_type","createTemplatesAPI","createPageTemplateAPI","createScreenTemplateAPI","templateType","resetTemplatesAPI","medias","ids","item","onload","oncomplete","hidenext","hideprevious","opensimplecontent","changebackground","playsound","stopsound","playbackgroundsound","stopbackgroundsound","keepnextkidden","showprevious","showhome"],"mappings":"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","sourcesContent":["import {\r\n  CourseElement,\r\n  CourseElementProps,\r\n  CourseElementTemplates,\r\n  CourseElementTemplate,\r\n  AssociatedTemplate,\r\n  BackgroundProps,\r\n  MediaFile,\r\n  CompletionProps,\r\n  ChapterEvaluationProps,\r\n  PageEvaluationProps,\r\n  CustomEvaluationProps,\r\n  RetryQuizProps,\r\n  BaseAdvancedProps,\r\n  FeedbackOptions,\r\n  RelatedToProps,\r\n  TemplateOptionsJSON,\r\n  PrerequisiteProps,\r\n  TemplateScrollOptionsJSON,\r\n  TemplateScroll,\r\n} from \"types\";\r\nimport {\r\n  ElementType,\r\n  BackgroundOptionTypes,\r\n  TemplateTypes,\r\n  ScrollTransitionTypes,\r\n  BackgroundOption2Types,\r\n  BackgroundSizeTypes,\r\n} from \"editor-constants\";\r\nimport {\r\n  ElementPropsResponse,\r\n  ElementTemplateResponse,\r\n  BackdropPropsResponse,\r\n  ElementTemplatesResponse,\r\n} from \"../types\";\r\nimport {\r\n  toBoolean,\r\n  toJSONString,\r\n  toJSONObject,\r\n  getElementBySelector,\r\n  createRGBA,\r\n  fromRgbaStr,\r\n  hasChapterEvaluation,\r\n  hasPageEvaluation,\r\n  hasCustomEvaluation,\r\n  isImage,\r\n} from \"utils\";\r\n\r\nexport const createPropertiesAPI = (model: CourseElementProps) => {\r\n  const result = {} as ElementPropsResponse;\r\n\r\n  //General\r\n  result.nid = model.id;\r\n  result.type = model.type;\r\n  result.title = model.name;\r\n  result.title2 = model.subTitle;\r\n  result.description = model.description;\r\n  result.duration = model.duration;\r\n  result.media_param = toJSONString(model.mediaJSON);\r\n  result.nav_temp = toJSONString(model.navigationJSON);\r\n  result.metadatas = toJSONString(model.metadatasJSON);\r\n  result.hasassociatecontent = model.hasAssociateContent.toString();\r\n  result.stylesummary = model.styleSummary.toString();\r\n  result.screenonsummary = (model.screenSummary || false).toString();\r\n\r\n  //Completion\r\n  result.cust_comp = model.isCompletion.toString();\r\n  result.cust_comp_param = toJSONString(model.completionJSON);\r\n\r\n  //Prerequisite\r\n  result.cust_prereq_param = toJSONString(model.prerequisiteJSON);\r\n\r\n  //Evaluation\r\n  result.theme_ref = model.theme;\r\n  result.isevaluation = model.isEvaluation.toString();\r\n  result.hasfeedback = model.hasFeedback.toString();\r\n  result.eval_param = toJSONString(model.evalutionJSON);\r\n\r\n  //Background\r\n  result.bgm_param = createBackgroundAPI(model.backgroundJSON);\r\n\r\n  //Files\r\n  result.files_param = toJSONString(model.filesJSON);\r\n\r\n  //Props\r\n  result.props_param = toJSONString(model.propsJSON);\r\n\r\n  return result;\r\n};\r\n\r\nexport const createPropertiesModel = (response: ElementPropsResponse, element: CourseElement) => {\r\n  const result = new CourseElementProps(response.nid, response.title, response.type as ElementType);\r\n\r\n  //General\r\n  result.level = element.level;\r\n  result.subTitle = response.title2;\r\n  result.description = response.description;\r\n  result.duration = response.duration;\r\n  result.mediaJSON = toJSONObject(response.media_param);\r\n  result.navigationJSON = toJSONObject(response.nav_temp);\r\n  result.metadatasJSON = toJSONObject(response.metadatas);\r\n  result.hasAssociateContent = toBoolean(response.hasassociatecontent);\r\n  result.styleSummary = response.stylesummary ? toBoolean(response.stylesummary) : true;\r\n  result.screenSummary = response.screenonsummary ? toBoolean(response.screenonsummary) : undefined;\r\n\r\n  //Completion\r\n  result.isCompletion = toBoolean(response.cust_comp || \"\");\r\n  result.completionJSON = toJSONObject(response.cust_comp_param);\r\n\r\n  //Prerequisite\r\n  result.prerequisiteJSON = toJSONObject(response.cust_prereq_param);\r\n\r\n  //Evaluation\r\n  result.theme = response.theme_ref;\r\n  result.isDirectEvaluation = toBoolean(response.direct_evaluation);\r\n  result.isEvaluation = toBoolean(response.isevaluation);\r\n  result.hasFeedback = toBoolean(response.hasfeedback);\r\n\r\n  result.evalutionJSON = toJSONObject(response.eval_param);\r\n\r\n  //Background\r\n  result.backgroundJSON = createBackgroundModel(response.bgm_param);\r\n\r\n  //Files\r\n  result.filesJSON = toJSONObject(response.files_param);\r\n\r\n  //Porps\r\n  result.propsJSON = toJSONObject(response.props_param);\r\n\r\n  //Logs\r\n  result.created = { user: response.changed_by, date: response.created };\r\n  result.modified = { user: response.modified_by, date: response.changed };\r\n\r\n  //Initialize\r\n  if (!result.completionJSON) {\r\n    result.completionJSON = new CompletionProps();\r\n  }\r\n\r\n  if (!result.prerequisiteJSON) {\r\n    result.prerequisiteJSON = new PrerequisiteProps();\r\n  }\r\n\r\n  if (!result.evalutionJSON) {\r\n    if (hasChapterEvaluation(result)) {\r\n      result.evalutionJSON = new ChapterEvaluationProps();\r\n    } else if (hasPageEvaluation(result)) {\r\n      result.evalutionJSON = new PageEvaluationProps();\r\n    } else if (hasCustomEvaluation(result)) {\r\n      result.evalutionJSON = new CustomEvaluationProps();\r\n    }\r\n  } else if (hasChapterEvaluation(result) || hasPageEvaluation(result)) {\r\n    //This is for old elements, we can delete this if database is cleared.\r\n    if (hasChapterEvaluation(result)) {\r\n      if (result.evalutionJSON.theme === undefined) {\r\n        result.evalutionJSON.theme = result.theme;\r\n      }\r\n    }\r\n\r\n    if (hasPageEvaluation(result)) {\r\n      if (result.evalutionJSON.advanced === undefined) {\r\n        result.evalutionJSON.advanced = new BaseAdvancedProps();\r\n      }\r\n    }\r\n\r\n    if (!result.evalutionJSON.related_to) {\r\n      result.evalutionJSON.related_to = new RelatedToProps();\r\n    } else if (typeof result.evalutionJSON.related_to === \"string\") {\r\n      result.evalutionJSON.related_to = new RelatedToProps(true, result.evalutionJSON.related_to);\r\n    }\r\n\r\n    if (result.evalutionJSON.feedback.checked === undefined) {\r\n      result.evalutionJSON.feedback.checked = result.hasFeedback;\r\n    }\r\n\r\n    if (result.evalutionJSON.retry_quiz === undefined) {\r\n      result.evalutionJSON.retry_quiz = new RetryQuizProps();\r\n    }\r\n\r\n    if (result.evalutionJSON.proposition_feedback === undefined) {\r\n      result.evalutionJSON.proposition_feedback = new FeedbackOptions();\r\n    }\r\n\r\n    if (\r\n      !(\r\n        typeof result.evalutionJSON.question_feedback === \"object\" &&\r\n        \"by_question\" in result.evalutionJSON.question_feedback\r\n      )\r\n    ) {\r\n      result.evalutionJSON.question_feedback = new FeedbackOptions();\r\n    }\r\n  }\r\n\r\n  if (\r\n    !result.backgroundJSON &&\r\n    (result.type === ElementType.Page || result.type === ElementType.SimplePage)\r\n  ) {\r\n    result.backgroundJSON = new BackgroundProps();\r\n  }\r\n\r\n  return result;\r\n};\r\n\r\nconst createBackgroundAPI = (background: BackgroundProps | null) => {\r\n  if (background) {\r\n    const result: BackdropPropsResponse = {};\r\n    const {\r\n      media: { main, webm, image, tint, option, optionValue, option2 },\r\n      tint: bgTint,\r\n      mediaSize,\r\n      colorSize,\r\n    } = background;\r\n\r\n    if (main) {\r\n      result.path = main.url;\r\n      result.tint = createRGBA(tint.color, tint.alpha);\r\n      result.option1 = option;\r\n      result.media_size = mediaSize;\r\n      result.main = main;\r\n\r\n      if (isImage(main.type)) {\r\n        result.parallaxe =\r\n          option === BackgroundOptionTypes.Parallax ? (optionValue as number) : undefined;\r\n        result.option2 = option2;\r\n      } else {\r\n        result.pathwebm = webm?.url;\r\n        result.paththumbnaill = image?.url;\r\n        result.loop = Boolean(optionValue);\r\n        result.webm = webm;\r\n        result.image = image;\r\n      }\r\n    }\r\n\r\n    if (bgTint.color) {\r\n      result.color = createRGBA(bgTint.color, bgTint.alpha);\r\n      result.color_size = colorSize;\r\n    }\r\n\r\n    return toJSONString(result);\r\n  }\r\n\r\n  return null;\r\n};\r\n\r\nconst createBackgroundModel = (response: string | null) => {\r\n  const background = toJSONObject<BackdropPropsResponse>(response);\r\n\r\n  if (background) {\r\n    const result = new BackgroundProps();\r\n    const { media } = result;\r\n\r\n    media.main = background.main;\r\n    media.webm = background.webm;\r\n    media.image = background.image;\r\n\r\n    if (background.tint) {\r\n      media.tint = fromRgbaStr(background.tint);\r\n    }\r\n\r\n    if (background.option1) {\r\n      media.option = background.option1 as BackgroundOptionTypes;\r\n\r\n      if (media.option === BackgroundOptionTypes.Autoplay) {\r\n        media.optionValue = background.loop ?? false;\r\n      } else {\r\n        media.optionValue = background.parallaxe || 0;\r\n      }\r\n    }\r\n\r\n    if (background.option2) {\r\n      media.option2 = background.option2 as BackgroundOption2Types;\r\n    }\r\n\r\n    if (background.color) {\r\n      result.tint = fromRgbaStr(background.color);\r\n    }\r\n\r\n    if (background.media_size) {\r\n      result.mediaSize = background.media_size as BackgroundSizeTypes;\r\n    }\r\n\r\n    if (background.color_size) {\r\n      result.colorSize = background.color_size as BackgroundSizeTypes;\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  return null;\r\n};\r\n\r\nexport const createTemplatesModel = (\r\n  response: ElementTemplatesResponse,\r\n  element: CourseElement\r\n) => {\r\n  const { id = \"\", name = \"\", type = ElementType.Screen } = element;\r\n  const result = new CourseElementTemplates(id, name, type);\r\n  result.templates = [];\r\n\r\n  if (element) {\r\n    Object.assign(result, element);\r\n  }\r\n\r\n  if (Array.isArray(response.templates)) {\r\n    for (let resTemplate of response.templates) {\r\n      const template = createTemplateModel(resTemplate);\r\n\r\n      result.templates.push(template);\r\n    }\r\n  } else if (response.templates && response.templates[\"template-type\"]) {\r\n    const template = createTemplateModel(response.templates);\r\n\r\n    result.templates.push(template);\r\n  }\r\n\r\n  return result;\r\n};\r\n\r\nexport const createTemplateModel = (response: ElementTemplateResponse) => {\r\n  const {\r\n    nid,\r\n    name: title,\r\n    type,\r\n    \"template-type\": tempaleType,\r\n    summary,\r\n    html,\r\n    htmlParam,\r\n    template,\r\n  } = response;\r\n  const { id, name, light_url, dark_url } = template;\r\n  const rootElement = getElementBySelector(html, `.outercontainer`);\r\n  const isDarkTemplate = rootElement?.classList.contains(\"dark\") || false;\r\n  const scroll = rootElement?.getAttribute(\"blm-scroll-transition\") || undefined;\r\n  const scrollOption = toJSONObject<TemplateScrollOptionsJSON>(\r\n    rootElement?.getAttribute(\"blm-scroll-option\")\r\n  );\r\n  const hasAnchor = rootElement?.hasAttribute(\"anchor\") || false;\r\n  const associated = new AssociatedTemplate(id, name, light_url, dark_url);\r\n  const result = new CourseElementTemplate(\r\n    nid,\r\n    title,\r\n    type as TemplateTypes,\r\n    tempaleType as TemplateTypes,\r\n    html,\r\n    associated,\r\n    isDarkTemplate\r\n  );\r\n\r\n  result.options = toJSONObject<TemplateOptionsJSON>(rootElement?.getAttribute(\"blm-options\"));\r\n  result.scroll = new TemplateScroll(\r\n    scroll as ScrollTransitionTypes,\r\n    scrollOption?.fixedtransitioneffects,\r\n    scrollOption?.parallaxecomponents\r\n  );\r\n  result.hasAnchor = hasAnchor;\r\n  result.isSummary = toBoolean(summary);\r\n  result.hasAction = hasAction(result.options);\r\n  result.htmlJSON = toJSONObject(htmlParam);\r\n\r\n  return result;\r\n};\r\n\r\nexport const createDuplicateTemplatesAPI = (\r\n  templates: CourseElementTemplate | CourseElementTemplate[]\r\n) => {\r\n  if (Array.isArray(templates)) {\r\n    return { templates: templates.map(createDuplicatePageTemplateAPI) };\r\n  } else {\r\n    return createDuplicateScreenTemplateAPI(templates);\r\n  }\r\n};\r\n\r\nconst createDuplicateScreenTemplateAPI = (template1: any) => {\r\n  const { template, html, htmlParam } = template1;\r\n  return {\r\n    template_id: template.id,\r\n    template_type: template1[\"template-type\"],\r\n    html,\r\n    htmlParam: toJSONString(htmlParam),\r\n  };\r\n};\r\n\r\nconst createDuplicatePageTemplateAPI = (template1: any) => {\r\n  const { nid, name, template, summary, html, htmlJSON } = template1;\r\n  return {\r\n    id: nid,\r\n    name,\r\n    template_id: template.id,\r\n    template_type: template1[\"template-type\"],\r\n    summary: summary.toString(),\r\n    html,\r\n    htmlParam: toJSONString(htmlJSON),\r\n  };\r\n};\r\n\r\nexport const createTemplatesAPI = (templates: CourseElementTemplate | CourseElementTemplate[]) => {\r\n  if (Array.isArray(templates)) {\r\n    return { templates: templates.map(createPageTemplateAPI) };\r\n  } else {\r\n    return createScreenTemplateAPI(templates);\r\n  }\r\n};\r\n\r\nconst createScreenTemplateAPI = (template1: CourseElementTemplate) => {\r\n  const { template, templateType, html, htmlJSON } = template1;\r\n  return {\r\n    template_id: template.id,\r\n    template_type: templateType,\r\n    html,\r\n    htmlParam: toJSONString(htmlJSON),\r\n  };\r\n};\r\n\r\nconst createPageTemplateAPI = (template1: CourseElementTemplate) => {\r\n  const { id, name, template, templateType, isSummary, html, htmlJSON } = template1;\r\n  return {\r\n    id,\r\n    name,\r\n    template_id: template.id,\r\n    template_type: templateType,\r\n    summary: isSummary.toString(),\r\n    html,\r\n    htmlParam: toJSONString(htmlJSON),\r\n  };\r\n};\r\n\r\nexport const resetTemplatesAPI = (medias: MediaFile[]) => {\r\n  const ids = medias.map((item) => item.id);\r\n\r\n  return { medias: ids };\r\n};\r\n\r\nconst hasAction = (options?: TemplateOptionsJSON | null) => {\r\n  if (options) {\r\n    const { onload, oncomplete } = options;\r\n\r\n    return Boolean(\r\n      onload?.hidenext ||\r\n        onload?.hideprevious ||\r\n        onload?.hideprevious ||\r\n        onload?.opensimplecontent?.checked ||\r\n        onload?.changebackground?.checked ||\r\n        onload?.playsound?.checked ||\r\n        onload?.stopsound?.checked ||\r\n        onload?.playbackgroundsound?.checked ||\r\n        onload?.stopbackgroundsound?.checked ||\r\n        oncomplete?.keepnextkidden ||\r\n        oncomplete?.showprevious ||\r\n        oncomplete?.showhome ||\r\n        oncomplete?.opensimplecontent?.checked ||\r\n        oncomplete?.changebackground?.checked ||\r\n        oncomplete?.playsound?.checked\r\n    );\r\n  }\r\n  return false;\r\n};\r\n"]},"metadata":{},"sourceType":"module"}