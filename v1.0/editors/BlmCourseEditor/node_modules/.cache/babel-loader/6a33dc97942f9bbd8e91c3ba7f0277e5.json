{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Rajesh\\\\Downloads\\\\bilim (2)\\\\bilim\\\\v1.0\\\\editors\\\\BlmCourseEditor\\\\src\\\\components\\\\template-editors\\\\core\\\\associated-editor\\\\BlmAssociatedChapterEditor.tsx\";\nimport React, { Fragment, useState, useEffect, useMemo } from \"react\";\nimport { Popper, Backdrop } from \"@material-ui/core\";\nimport { CourseElement } from \"types\";\nimport { ElementType } from \"editor-constants\";\nimport { filterElements, getElementBySelector, toggleAttributeInString, toJSONString } from \"utils\";\nimport { createModifiersForIFrame } from \"../../utils\";\nimport { BlmAssociatedChapter } from \"../../containers\";\nimport \"./styles.scss\";\nconst popperOptions = {\n  eventsEnabled: true\n};\nconst modifiers = createModifiersForIFrame(4, 0);\n\nconst createTemplate = (template, element) => {\n  const newTemplate = { ...template\n  };\n  const rootElement = getElementBySelector(template.html, \".outercontainer\");\n\n  if (rootElement) {\n    const options = { ...template.options,\n      relative_chapter: element.id\n    };\n    const attrs = {\n      \"blm-options\": toJSONString(options)\n    };\n    newTemplate.options = options;\n    newTemplate.html = toggleAttributeInString(newTemplate.html, attrs, \".outercontainer\");\n  }\n\n  return newTemplate;\n};\n\nconst getAssociatedParent = element => {\n  let result = element;\n\n  while (result && result.type !== ElementType.Chapter && result.type !== ElementType.Structure) {\n    result = result.parent;\n  }\n\n  return result;\n};\n\nfunction BlmAssociatedChapterEditor(props) {\n  const {\n    open,\n    anchorEle,\n    element,\n    template,\n    course,\n    onSave,\n    onClose\n  } = props;\n  const {\n    associatedChapter\n  } = template;\n  const [data, setData] = useState();\n  const [associated, setAssociated] = useState(associatedChapter);\n  const showClose = useMemo(() => {\n    return Boolean(associated || data && data.type !== ElementType.Chapter && filterElements(data.children, [ElementType.Chapter]).length === 0);\n  }, [data, associated]);\n  useEffect(() => {\n    if (element && course) {\n      const result = getAssociatedParent(element);\n\n      if (result) {\n        if (result.type === ElementType.Structure) {\n          const root = new CourseElement(course.id, \"Course root\", ElementType.Root);\n          root.children = result.children;\n          setData(root);\n        } else {\n          setData(result);\n        }\n      }\n    }\n  }, [element, course]);\n\n  const handleChange = item => {\n    setAssociated(item);\n  };\n\n  const handleClose = event => {\n    var _template$options;\n\n    if (onSave && associated && ((_template$options = template.options) === null || _template$options === void 0 ? void 0 : _template$options.relative_chapter) !== associated.id) {\n      const newTemplate = createTemplate(template, associated);\n      onSave(newTemplate);\n    }\n\n    if (onClose) {\n      onClose(event);\n    }\n  };\n\n  if (data) {\n    return /*#__PURE__*/React.createElement(Fragment, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 101,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(Popper, {\n      id: \"associated-chapter-popper\",\n      open: open,\n      anchorEl: open ? anchorEle : null,\n      placement: \"bottom-start\",\n      popperOptions: popperOptions,\n      modifiers: modifiers,\n      className: \"associated-chapter-editor\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 102,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(BlmAssociatedChapter, {\n      data: data,\n      associated: associated,\n      showClose: showClose,\n      onChange: handleChange,\n      onClose: handleClose,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 111,\n        columnNumber: 11\n      }\n    })), /*#__PURE__*/React.createElement(Backdrop, {\n      open: open,\n      className: \"associated-chapter-editor-backdrop\",\n      onClick: showClose ? handleClose : undefined,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 119,\n        columnNumber: 9\n      }\n    }));\n  } else {\n    return null;\n  }\n}\n\nexport default BlmAssociatedChapterEditor;","map":{"version":3,"sources":["C:/Users/Rajesh/Downloads/bilim (2)/bilim/v1.0/editors/BlmCourseEditor/src/components/template-editors/core/associated-editor/BlmAssociatedChapterEditor.tsx"],"names":["React","Fragment","useState","useEffect","useMemo","Popper","Backdrop","CourseElement","ElementType","filterElements","getElementBySelector","toggleAttributeInString","toJSONString","createModifiersForIFrame","BlmAssociatedChapter","popperOptions","eventsEnabled","modifiers","createTemplate","template","element","newTemplate","rootElement","html","options","relative_chapter","id","attrs","getAssociatedParent","result","type","Chapter","Structure","parent","BlmAssociatedChapterEditor","props","open","anchorEle","course","onSave","onClose","associatedChapter","data","setData","associated","setAssociated","showClose","Boolean","children","length","root","Root","handleChange","item","handleClose","event","undefined"],"mappings":"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","sourcesContent":["import React, { Fragment, MouseEvent, useState, useEffect, useMemo } from \"react\";\r\nimport { Popper, Backdrop } from \"@material-ui/core\";\r\n\r\nimport { CourseElement, CourseElementTemplate } from \"types\";\r\nimport { ElementType } from \"editor-constants\";\r\nimport { filterElements, getElementBySelector, toggleAttributeInString, toJSONString } from \"utils\";\r\nimport { createModifiersForIFrame } from \"../../utils\";\r\nimport { BlmAssociatedChapter } from \"../../containers\";\r\nimport { ContainerProps } from \"./container\";\r\nimport \"./styles.scss\";\r\n\r\nexport interface CompProps extends ContainerProps {\r\n  open: boolean;\r\n  anchorEle: HTMLElement;\r\n  element: CourseElement;\r\n  template: CourseElementTemplate;\r\n  onSave?: (template: CourseElementTemplate) => void;\r\n  onClose?: (event: MouseEvent) => void;\r\n}\r\n\r\nconst popperOptions = {\r\n  eventsEnabled: true,\r\n};\r\nconst modifiers = createModifiersForIFrame(4, 0);\r\n\r\nconst createTemplate = (template: CourseElementTemplate, element: CourseElement) => {\r\n  const newTemplate = { ...template };\r\n  const rootElement = getElementBySelector(template.html, \".outercontainer\");\r\n\r\n  if (rootElement) {\r\n    const options = { ...template.options, relative_chapter: element.id };\r\n    const attrs = { \"blm-options\": toJSONString(options) };\r\n\r\n    newTemplate.options = options;\r\n    newTemplate.html = toggleAttributeInString(newTemplate.html, attrs, \".outercontainer\");\r\n  }\r\n\r\n  return newTemplate;\r\n};\r\n\r\nconst getAssociatedParent = (element: CourseElement) => {\r\n  let result: CourseElement | undefined = element;\r\n\r\n  while (result && result.type !== ElementType.Chapter && result.type !== ElementType.Structure) {\r\n    result = result.parent;\r\n  }\r\n\r\n  return result;\r\n};\r\n\r\nfunction BlmAssociatedChapterEditor(props: CompProps) {\r\n  const { open, anchorEle, element, template, course, onSave, onClose } = props;\r\n  const { associatedChapter } = template;\r\n  const [data, setData] = useState<CourseElement>();\r\n  const [associated, setAssociated] = useState(associatedChapter);\r\n\r\n  const showClose = useMemo(() => {\r\n    return Boolean(\r\n      associated ||\r\n        (data &&\r\n          data.type !== ElementType.Chapter &&\r\n          filterElements(data.children, [ElementType.Chapter]).length === 0)\r\n    );\r\n  }, [data, associated]);\r\n\r\n  useEffect(() => {\r\n    if (element && course) {\r\n      const result = getAssociatedParent(element);\r\n\r\n      if (result) {\r\n        if (result.type === ElementType.Structure) {\r\n          const root = new CourseElement(course.id, \"Course root\", ElementType.Root);\r\n          root.children = result.children;\r\n\r\n          setData(root);\r\n        } else {\r\n          setData(result);\r\n        }\r\n      }\r\n    }\r\n  }, [element, course]);\r\n\r\n  const handleChange = (item: CourseElement) => {\r\n    setAssociated(item);\r\n  };\r\n\r\n  const handleClose = (event: MouseEvent) => {\r\n    if (onSave && associated && template.options?.relative_chapter !== associated.id) {\r\n      const newTemplate = createTemplate(template, associated);\r\n\r\n      onSave(newTemplate);\r\n    }\r\n\r\n    if (onClose) {\r\n      onClose(event);\r\n    }\r\n  };\r\n\r\n  if (data) {\r\n    return (\r\n      <Fragment>\r\n        <Popper\r\n          id=\"associated-chapter-popper\"\r\n          open={open}\r\n          anchorEl={open ? anchorEle : null}\r\n          placement=\"bottom-start\"\r\n          popperOptions={popperOptions}\r\n          modifiers={modifiers}\r\n          className=\"associated-chapter-editor\"\r\n        >\r\n          <BlmAssociatedChapter\r\n            data={data}\r\n            associated={associated}\r\n            showClose={showClose}\r\n            onChange={handleChange}\r\n            onClose={handleClose}\r\n          />\r\n        </Popper>\r\n        <Backdrop\r\n          open={open}\r\n          className=\"associated-chapter-editor-backdrop\"\r\n          onClick={showClose ? handleClose : undefined}\r\n        />\r\n      </Fragment>\r\n    );\r\n  } else {\r\n    return null;\r\n  }\r\n}\r\n\r\nexport default BlmAssociatedChapterEditor;\r\n"]},"metadata":{},"sourceType":"module"}