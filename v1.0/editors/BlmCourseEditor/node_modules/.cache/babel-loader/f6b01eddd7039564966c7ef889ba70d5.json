{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Rajesh\\\\Downloads\\\\bilim (2)\\\\bilim\\\\v1.0\\\\editors\\\\BlmCourseEditor\\\\src\\\\components\\\\templates\\\\containers\\\\page\\\\BlmPageContainer.tsx\";\nimport React, { useState, useCallback, useContext, useRef, useEffect } from \"react\";\nimport { TemplatePanelOptions } from \"types\";\nimport { ElementType, PageMenuTypes } from \"editor-constants\";\nimport { findIndex, getChildElement, createHTMLElement } from \"utils\";\nimport { BlmAddPartPage, BlmPageMenu } from \"../../controls\";\nimport { withBlmTemplateBoard, BlmTemplateBoardContext } from \"../../hoc\";\nimport BlmPartPageContainer from \"../part-page\";\nimport { setHotspotClass, RemoveHotspotClass, CheckHotspotContainClass, checkPrev } from \"template-builders\";\nimport { usePageContainerStyle } from \"./styles\";\nimport { usePrevious } from \"hooks\";\nconst initAddMenu = {\n  anchorEl: null,\n  templateIndex: -1,\n  addIndex: -1\n};\n\nfunction BlmPageContainer(props) {\n  const {\n    element,\n    child,\n    templates\n  } = props;\n  const [addMenu, setAddMenu] = useState(initAddMenu);\n  const [focus, setFocus] = useState();\n  const itemsRef = useRef([]);\n  const templateRef = useRef(null);\n  const {\n    onShowTemplates,\n    onLoadPartPageHotspot\n  } = useContext(BlmTemplateBoardContext);\n  const classes = usePageContainerStyle();\n  const prevData = usePrevious(props.templates);\n  const prevElement = usePrevious(element);\n  const [size, setSize] = useState(window.innerWidth);\n  let timeout;\n  useEffect(() => {\n    if (child) {\n      setFocus(child);\n    }\n  }, [child]);\n  const checkVal = useCallback((val = false) => {\n    if (val || !checkPrev(templates, prevData) || !CheckHotspotContainClass(templates)) {\n      if (templates && (templates === null || templates === void 0 ? void 0 : templates.length) !== 0) {\n        var newData = [...templates];\n        setTimeout(() => {\n          if (templateRef.current) {\n            var allName = templateRef.current.getElementsByClassName(\"outercontainer\");\n\n            if (allName) {\n              for (let i = 0; i < allName.length; i++) {\n                var _allName$i;\n\n                let refParent = Array.from(allName[i].classList).find(cls => cls.startsWith(\"rt-etr-\"));\n                let refHotspot = (_allName$i = allName[i]) === null || _allName$i === void 0 ? void 0 : _allName$i.querySelectorAll(`div[blm-component=media][blm-media^=hotspot]`);\n                newData === null || newData === void 0 ? void 0 : newData.map((temp, ind) => {\n                  var templateHtml = createHTMLElement(temp.html);\n\n                  if (templateHtml === null || templateHtml === void 0 ? void 0 : templateHtml.classList) {\n                    var templateHotspot = Array.from(templateHtml === null || templateHtml === void 0 ? void 0 : templateHtml.classList).find(cls => cls.startsWith(\"rt-etr-\"));\n\n                    if (templateHotspot === refParent) {\n                      refHotspot === null || refHotspot === void 0 ? void 0 : refHotspot.forEach((val, i) => {\n                        if (val.classList.contains(\"contain\")) {\n                          var _val$querySelector;\n\n                          var componentRatio = val.getBoundingClientRect().width / val.getBoundingClientRect().height;\n                          var imageVal = val === null || val === void 0 ? void 0 : (_val$querySelector = val.querySelector(\".imagewrapper\")) === null || _val$querySelector === void 0 ? void 0 : _val$querySelector.getElementsByTagName(\"img\")[0];\n                          var imageRatio = ((imageVal === null || imageVal === void 0 ? void 0 : imageVal.naturalWidth) ? imageVal === null || imageVal === void 0 ? void 0 : imageVal.naturalWidth : 0) / ((imageVal === null || imageVal === void 0 ? void 0 : imageVal.naturalHeight) ? imageVal === null || imageVal === void 0 ? void 0 : imageVal.naturalHeight : 0);\n                          var id = val === null || val === void 0 ? void 0 : val.getAttribute(\"blm-id\");\n                          var newHtml = setHotspotClass(temp, `[blm-id='${id}']`, componentRatio, imageRatio);\n\n                          if (newHtml) {\n                            newData[ind].html = newHtml;\n                          }\n                        } else {\n                          var blmId = val === null || val === void 0 ? void 0 : val.getAttribute(\"blm-id\");\n                          var newHtmlVal = RemoveHotspotClass(temp, `[blm-id='${blmId}']`);\n\n                          if (newHtmlVal) {\n                            newData[ind].html = newHtmlVal;\n                          }\n                        }\n                      });\n                    }\n                  }\n                });\n              }\n\n              if (onLoadPartPageHotspot) {\n                onLoadPartPageHotspot(element.id, newData);\n              }\n            }\n          }\n        }, 1000);\n      }\n    }\n  }, [element.id, onLoadPartPageHotspot, prevData, templates]);\n  useEffect(() => {\n    if (templates && (templates === null || templates === void 0 ? void 0 : templates.length) > 0) {\n      checkVal();\n    }\n\n    if (templates && focus) {\n      const ind = findIndex(templates, focus.id, \"id\");\n      const item = itemsRef.current[ind];\n\n      if (item) {\n        item.focus();\n        setFocus(undefined);\n      }\n    }\n  }, [templates, focus, prevElement, checkVal]);\n  useEffect(() => {\n    var ok_to_resize = true;\n\n    var handleResize = () => {\n      if (size !== window.innerWidth) {\n        clearTimeout(timeout);\n\n        if (ok_to_resize) {\n          ok_to_resize = false;\n          setTimeout(function () {\n            ok_to_resize = true;\n            setSize(window.innerWidth);\n            checkVal(true);\n          }, 500);\n        }\n      }\n    };\n\n    window.addEventListener(\"resize\", handleResize);\n    return () => window.removeEventListener(\"resize\", handleResize);\n  }, [templates, focus, checkVal, size, timeout]);\n\n  const showTemplates = (type, position) => {\n    if (onShowTemplates) {\n      let templateType;\n\n      if (type === PageMenuTypes.Question) {\n        templateType = ElementType.Question;\n      } else {\n        templateType = element.type === ElementType.Page ? ElementType.PartPage : ElementType.SimplePartPage;\n      }\n\n      const options = new TemplatePanelOptions(templateType);\n      options.position = position;\n      options.isSummary = type === PageMenuTypes.Summary;\n      onShowTemplates(options);\n    }\n  };\n\n  const handleAddClick = (event, templateIndex, addIndex) => {\n    setAddMenu({\n      anchorEl: event.currentTarget,\n      templateIndex: templateIndex,\n      addIndex: addIndex\n    });\n  };\n\n  const handleMenuClose = () => {\n    setAddMenu({\n      anchorEl: null,\n      templateIndex: -1,\n      addIndex: -1\n    });\n  };\n\n  const handleMenuItemClick = type => {\n    showTemplates(type, addMenu.addIndex);\n    handleMenuClose();\n  };\n\n  const renderTemplates = () => {\n    if (templates) {\n      const len = templates.length;\n\n      if (len === 0) {\n        return /*#__PURE__*/React.createElement(BlmAddPartPage, {\n          key: \"addBtn0\",\n          value: 0,\n          onClick: e => handleAddClick(e, 0, 0),\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 212,\n            columnNumber: 16\n          }\n        });\n      } else {\n        return templates.map((template, index) => {\n          const chElement = getChildElement(element, template.id);\n\n          if (chElement) {\n            return /*#__PURE__*/React.createElement(BlmPartPageContainer, {\n              ref: el => itemsRef.current[index] = el,\n              key: template.id,\n              index: index,\n              total: len,\n              element: chElement,\n              template: template,\n              showControls: addMenu.templateIndex === index,\n              onAddClick: handleAddClick,\n              __self: this,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 219,\n                columnNumber: 15\n              }\n            });\n          }\n\n          return undefined;\n        });\n      }\n    }\n  };\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: classes.root,\n    ref: templateRef,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 239,\n      columnNumber: 5\n    }\n  }, renderTemplates(), /*#__PURE__*/React.createElement(BlmPageMenu, {\n    anchorEl: addMenu.anchorEl,\n    showSummary: element.isSummary,\n    onClose: handleMenuClose,\n    onItemClick: handleMenuItemClick,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 241,\n      columnNumber: 7\n    }\n  }));\n}\n\nexport default withBlmTemplateBoard(BlmPageContainer);","map":{"version":3,"sources":["C:/Users/Rajesh/Downloads/bilim (2)/bilim/v1.0/editors/BlmCourseEditor/src/components/templates/containers/page/BlmPageContainer.tsx"],"names":["React","useState","useCallback","useContext","useRef","useEffect","TemplatePanelOptions","ElementType","PageMenuTypes","findIndex","getChildElement","createHTMLElement","BlmAddPartPage","BlmPageMenu","withBlmTemplateBoard","BlmTemplateBoardContext","BlmPartPageContainer","setHotspotClass","RemoveHotspotClass","CheckHotspotContainClass","checkPrev","usePageContainerStyle","usePrevious","initAddMenu","anchorEl","templateIndex","addIndex","BlmPageContainer","props","element","child","templates","addMenu","setAddMenu","focus","setFocus","itemsRef","templateRef","onShowTemplates","onLoadPartPageHotspot","classes","prevData","prevElement","size","setSize","window","innerWidth","timeout","checkVal","val","length","newData","setTimeout","current","allName","getElementsByClassName","i","refParent","Array","from","classList","find","cls","startsWith","refHotspot","querySelectorAll","map","temp","ind","templateHtml","html","templateHotspot","forEach","contains","componentRatio","getBoundingClientRect","width","height","imageVal","querySelector","getElementsByTagName","imageRatio","naturalWidth","naturalHeight","id","getAttribute","newHtml","blmId","newHtmlVal","item","undefined","ok_to_resize","handleResize","clearTimeout","addEventListener","removeEventListener","showTemplates","type","position","templateType","Question","Page","PartPage","SimplePartPage","options","isSummary","Summary","handleAddClick","event","currentTarget","handleMenuClose","handleMenuItemClick","renderTemplates","len","e","template","index","chElement","el","root"],"mappings":"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","sourcesContent":["import React, { useState, MouseEvent, useCallback, useContext, useRef, useEffect } from \"react\";\r\n\r\nimport { CourseElement, TemplatePanelOptions, CourseElementTemplate } from \"types\";\r\nimport { ElementType, PageMenuTypes } from \"editor-constants\";\r\nimport { findIndex, getChildElement, createHTMLElement } from \"utils\";\r\nimport { BlmAddPartPage, BlmPageMenu } from \"../../controls\";\r\nimport { withBlmTemplateBoard, BlmTemplateBoardContext } from \"../../hoc\";\r\nimport BlmPartPageContainer, { PartPageContainer } from \"../part-page\";\r\nimport {\r\n  setHotspotClass,\r\n  RemoveHotspotClass,\r\n  CheckHotspotContainClass,\r\n  checkPrev,\r\n} from \"template-builders\";\r\nimport { usePageContainerStyle } from \"./styles\";\r\nimport { usePrevious } from \"hooks\";\r\n\r\ninterface CompProps {\r\n  element: CourseElement;\r\n  templates?: CourseElementTemplate[];\r\n  child?: CourseElement;\r\n}\r\n\r\ninterface AddMenu {\r\n  anchorEl: HTMLElement | null;\r\n  templateIndex: number;\r\n  addIndex: number;\r\n}\r\n\r\nconst initAddMenu: AddMenu = {\r\n  anchorEl: null,\r\n  templateIndex: -1,\r\n  addIndex: -1,\r\n};\r\n\r\nfunction BlmPageContainer(props: CompProps) {\r\n  const { element, child, templates } = props;\r\n  const [addMenu, setAddMenu] = useState(initAddMenu);\r\n  const [focus, setFocus] = useState<CourseElement>();\r\n  const itemsRef = useRef<(PartPageContainer | null)[]>([]);\r\n  const templateRef = useRef<HTMLDivElement | null>(null);\r\n  const { onShowTemplates, onLoadPartPageHotspot } = useContext(BlmTemplateBoardContext);\r\n  const classes = usePageContainerStyle();\r\n  const prevData = usePrevious(props.templates);\r\n  const prevElement = usePrevious(element);\r\n  const [size, setSize] = useState(window.innerWidth);\r\n  let timeout: any;\r\n\r\n  useEffect(() => {\r\n    if (child) {\r\n      setFocus(child);\r\n    }\r\n  }, [child]);\r\n\r\n  const checkVal = useCallback(\r\n    (val = false) => {\r\n      if (val || !checkPrev(templates, prevData) || !CheckHotspotContainClass(templates)) {\r\n        if (templates && templates?.length !== 0) {\r\n          var newData: any = [...templates];\r\n          setTimeout(() => {\r\n            if (templateRef.current) {\r\n              var allName = templateRef.current.getElementsByClassName(\"outercontainer\");\r\n              if (allName) {\r\n                for (let i = 0; i < allName.length; i++) {\r\n                  let refParent = Array.from(allName[i].classList).find((cls) =>\r\n                    cls.startsWith(\"rt-etr-\")\r\n                  );\r\n                  let refHotspot = allName[i]?.querySelectorAll(\r\n                    `div[blm-component=media][blm-media^=hotspot]`\r\n                  );\r\n                  newData?.map((temp: CourseElementTemplate, ind: number) => {\r\n                    var templateHtml = createHTMLElement(temp.html);\r\n                    if (templateHtml?.classList) {\r\n                      var templateHotspot = Array.from(templateHtml?.classList).find((cls) =>\r\n                        cls.startsWith(\"rt-etr-\")\r\n                      );\r\n                      if (templateHotspot === refParent) {\r\n                        refHotspot?.forEach((val, i) => {\r\n                          if (val.classList.contains(\"contain\")) {\r\n                            var componentRatio =\r\n                              val.getBoundingClientRect().width /\r\n                              val.getBoundingClientRect().height;\r\n\r\n                            var imageVal = val\r\n                              ?.querySelector(\".imagewrapper\")\r\n                              ?.getElementsByTagName(\"img\")[0];\r\n\r\n                            var imageRatio =\r\n                              (imageVal?.naturalWidth ? imageVal?.naturalWidth : 0) /\r\n                              (imageVal?.naturalHeight ? imageVal?.naturalHeight : 0);\r\n\r\n                            var id = val?.getAttribute(\"blm-id\");\r\n                            var newHtml = setHotspotClass(\r\n                              temp,\r\n                              `[blm-id='${id}']`,\r\n                              componentRatio,\r\n                              imageRatio\r\n                            );\r\n                            if (newHtml) {\r\n                              newData[ind].html = newHtml;\r\n                            }\r\n                          } else {\r\n                            var blmId = val?.getAttribute(\"blm-id\");\r\n                            var newHtmlVal = RemoveHotspotClass(temp, `[blm-id='${blmId}']`);\r\n                            if (newHtmlVal) {\r\n                              newData[ind].html = newHtmlVal;\r\n                            }\r\n                          }\r\n                        });\r\n                      }\r\n                    }\r\n                  });\r\n                }\r\n                if (onLoadPartPageHotspot) {\r\n                  onLoadPartPageHotspot(element.id, newData);\r\n                }\r\n              }\r\n            }\r\n          }, 1000);\r\n        }\r\n      }\r\n    },\r\n    [element.id, onLoadPartPageHotspot, prevData, templates]\r\n  );\r\n\r\n  useEffect(() => {\r\n    if (templates && templates?.length > 0) {\r\n      checkVal();\r\n    }\r\n    if (templates && focus) {\r\n      const ind = findIndex(templates, focus.id, \"id\");\r\n      const item = itemsRef.current[ind];\r\n\r\n      if (item) {\r\n        item.focus();\r\n        setFocus(undefined);\r\n      }\r\n    }\r\n  }, [templates, focus, prevElement, checkVal]);\r\n\r\n  useEffect(() => {\r\n    var ok_to_resize = true;\r\n    var handleResize = () => {\r\n      if (size !== window.innerWidth) {\r\n        clearTimeout(timeout);\r\n        if (ok_to_resize) {\r\n          ok_to_resize = false;\r\n          setTimeout(function () {\r\n            ok_to_resize = true;\r\n            setSize(window.innerWidth);\r\n\r\n            checkVal(true);\r\n          }, 500);\r\n        }\r\n      }\r\n    };\r\n\r\n    window.addEventListener(\"resize\", handleResize);\r\n\r\n    return () => window.removeEventListener(\"resize\", handleResize);\r\n  }, [templates, focus, checkVal, size, timeout]);\r\n\r\n  const showTemplates = (type: PageMenuTypes, position: number) => {\r\n    if (onShowTemplates) {\r\n      let templateType: ElementType;\r\n\r\n      if (type === PageMenuTypes.Question) {\r\n        templateType = ElementType.Question;\r\n      } else {\r\n        templateType =\r\n          element.type === ElementType.Page ? ElementType.PartPage : ElementType.SimplePartPage;\r\n      }\r\n\r\n      const options = new TemplatePanelOptions(templateType);\r\n      options.position = position;\r\n      options.isSummary = type === PageMenuTypes.Summary;\r\n\r\n      onShowTemplates(options);\r\n    }\r\n  };\r\n\r\n  const handleAddClick = (\r\n    event: MouseEvent<HTMLElement>,\r\n    templateIndex: number,\r\n    addIndex: number\r\n  ) => {\r\n    setAddMenu({\r\n      anchorEl: event.currentTarget,\r\n      templateIndex: templateIndex,\r\n      addIndex: addIndex,\r\n    });\r\n  };\r\n\r\n  const handleMenuClose = () => {\r\n    setAddMenu({\r\n      anchorEl: null,\r\n      templateIndex: -1,\r\n      addIndex: -1,\r\n    });\r\n  };\r\n\r\n  const handleMenuItemClick = (type: PageMenuTypes) => {\r\n    showTemplates(type, addMenu.addIndex);\r\n    handleMenuClose();\r\n  };\r\n\r\n  const renderTemplates = () => {\r\n    if (templates) {\r\n      const len = templates.length;\r\n\r\n      if (len === 0) {\r\n        return <BlmAddPartPage key=\"addBtn0\" value={0} onClick={(e) => handleAddClick(e, 0, 0)} />;\r\n      } else {\r\n        return templates.map((template, index) => {\r\n          const chElement = getChildElement(element, template.id);\r\n\r\n          if (chElement) {\r\n            return (\r\n              <BlmPartPageContainer\r\n                ref={(el) => (itemsRef.current[index] = el)}\r\n                key={template.id}\r\n                index={index}\r\n                total={len}\r\n                element={chElement}\r\n                template={template}\r\n                showControls={addMenu.templateIndex === index}\r\n                onAddClick={handleAddClick}\r\n              />\r\n            );\r\n          }\r\n\r\n          return undefined;\r\n        });\r\n      }\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className={classes.root} ref={templateRef}>\r\n      {renderTemplates()}\r\n      <BlmPageMenu\r\n        anchorEl={addMenu.anchorEl}\r\n        showSummary={element.isSummary}\r\n        onClose={handleMenuClose}\r\n        onItemClick={handleMenuItemClick}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default withBlmTemplateBoard(BlmPageContainer);\r\n"]},"metadata":{},"sourceType":"module"}