{"ast":null,"code":"import { CourseDisplay, TemplateDisplayTypes } from \"editor-constants\";\nimport { cloneStructure, compareVersion, isValidLinkedElement, updateObject } from \"utils\";\nimport { GET_COURSE_PROPERTIES_SUCCESS, GET_COURSE_STRUCTURE_SUCCESS, GET_COURSE_STYLE_SUCCESS, RENAME_ELEMENT_SUCCESS, UPDATE_COURSE_PROPERTIES_SUCCESS } from \"./constants\"; //https://stackoverflow.com/questions/40900354/updating-state-managed-by-another-reducer\n\nconst crossSliceReducer = (state, action) => {\n  const {\n    type\n  } = action;\n  const {\n    course: {\n      properties: {\n        properties\n      },\n      style: {\n        style\n      },\n      element: {\n        templates,\n        properties: elmProperties\n      }\n    },\n    editor: {\n      core: {\n        templatesPanel\n      }\n    }\n  } = state;\n\n  if (type === GET_COURSE_PROPERTIES_SUCCESS) {\n    if (properties) {\n      state.editor.core.templatesPanel = { ...templatesPanel,\n        display: properties.display !== CourseDisplay.Smartphone ? TemplateDisplayTypes.Desktop : TemplateDisplayTypes.Mobile\n      };\n    }\n  }\n\n  if (state.course.structure.structure && (type === GET_COURSE_PROPERTIES_SUCCESS || type === UPDATE_COURSE_PROPERTIES_SUCCESS || type === GET_COURSE_STYLE_SUCCESS || type === GET_COURSE_STRUCTURE_SUCCESS)) {\n    var _properties$propsJSON, _properties$propsJSON2, _properties$propsJSON3, _properties$propsJSON4, _properties$propsJSON5;\n\n    const linkedIds = properties && ((_properties$propsJSON = properties.propsJSON) === null || _properties$propsJSON === void 0 ? void 0 : (_properties$propsJSON2 = _properties$propsJSON.linkedElements) === null || _properties$propsJSON2 === void 0 ? void 0 : (_properties$propsJSON3 = _properties$propsJSON2.evaluations) === null || _properties$propsJSON3 === void 0 ? void 0 : _properties$propsJSON3.length) ? [...((_properties$propsJSON4 = properties.propsJSON) === null || _properties$propsJSON4 === void 0 ? void 0 : (_properties$propsJSON5 = _properties$propsJSON4.linkedElements) === null || _properties$propsJSON5 === void 0 ? void 0 : _properties$propsJSON5.evaluations)] : undefined;\n    state.course.structure.structure = cloneStructure(state.course.structure.structure, item => {\n      if (linkedIds && !item.isLinked && isValidLinkedElement(item)) {\n        item.isLinked = linkedIds.includes(item.id);\n      }\n\n      if (style === null || style === void 0 ? void 0 : style.config.framework) {\n        var _item$template;\n\n        const {\n          framework\n        } = style.config;\n        const {\n          min,\n          max\n        } = ((_item$template = item.template) === null || _item$template === void 0 ? void 0 : _item$template.framework) || {};\n\n        if (min && compareVersion(framework, min) > 0 || max && compareVersion(framework, max) < 1) {\n          let parent = item.parent;\n\n          while (parent && !parent.isOutdated) {\n            parent.isOutdated = true;\n            parent.forAlertIcon = false;\n            parent = parent.parent;\n          }\n\n          item.forAlertIcon = true;\n          item.isOutdated = true;\n        }\n      }\n    });\n  }\n\n  if (type === RENAME_ELEMENT_SUCCESS && \"meta\" in action) {\n    const template = action.meta;\n\n    if (templates === null || templates === void 0 ? void 0 : templates.templates) {\n      state.course.element.templates = { ...templates,\n        templates: updateObject(templates.templates, \"id\", template === null || template === void 0 ? void 0 : template.id, {\n          name: template === null || template === void 0 ? void 0 : template.name\n        })\n      };\n    }\n\n    if (elmProperties && elmProperties[template === null || template === void 0 ? void 0 : template.id]) {\n      state.course.element.properties = { ...elmProperties,\n        [template === null || template === void 0 ? void 0 : template.id]: { ...elmProperties[template === null || template === void 0 ? void 0 : template.id],\n          name: template === null || template === void 0 ? void 0 : template.name\n        }\n      };\n    }\n  }\n\n  return state;\n};\n\nexport default crossSliceReducer;","map":{"version":3,"sources":["C:/Users/Rajesh/Downloads/bilim (2)/bilim/v1.0/editors/BlmCourseEditor/src/redux/crossReducer.ts"],"names":["CourseDisplay","TemplateDisplayTypes","cloneStructure","compareVersion","isValidLinkedElement","updateObject","GET_COURSE_PROPERTIES_SUCCESS","GET_COURSE_STRUCTURE_SUCCESS","GET_COURSE_STYLE_SUCCESS","RENAME_ELEMENT_SUCCESS","UPDATE_COURSE_PROPERTIES_SUCCESS","crossSliceReducer","state","action","type","course","properties","style","element","templates","elmProperties","editor","core","templatesPanel","display","Smartphone","Desktop","Mobile","structure","linkedIds","propsJSON","linkedElements","evaluations","length","undefined","item","isLinked","includes","id","config","framework","min","max","template","parent","isOutdated","forAlertIcon","meta","name"],"mappings":"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","sourcesContent":["import { CourseDisplay, TemplateDisplayTypes } from \"editor-constants\";\r\nimport { cloneStructure, compareVersion, isValidLinkedElement, updateObject } from \"utils\";\r\nimport { RootActions, RootState } from \"./types\";\r\nimport {\r\n  GET_COURSE_PROPERTIES_SUCCESS,\r\n  GET_COURSE_STRUCTURE_SUCCESS,\r\n  GET_COURSE_STYLE_SUCCESS,\r\n  RENAME_ELEMENT_SUCCESS,\r\n  UPDATE_COURSE_PROPERTIES_SUCCESS,\r\n} from \"./constants\";\r\n\r\n//https://stackoverflow.com/questions/40900354/updating-state-managed-by-another-reducer\r\nconst crossSliceReducer = (state: RootState, action: RootActions) => {\r\n  const { type } = action;\r\n  const {\r\n    course: {\r\n      properties: { properties },\r\n      style: { style },\r\n      element: { templates, properties: elmProperties },\r\n    },\r\n    editor: {\r\n      core: { templatesPanel },\r\n    },\r\n  } = state;\r\n\r\n  if (type === GET_COURSE_PROPERTIES_SUCCESS) {\r\n    if (properties) {\r\n      state.editor.core.templatesPanel = {\r\n        ...templatesPanel,\r\n        display:\r\n          properties.display !== CourseDisplay.Smartphone\r\n            ? TemplateDisplayTypes.Desktop\r\n            : TemplateDisplayTypes.Mobile,\r\n      };\r\n    }\r\n  }\r\n\r\n  if (\r\n    state.course.structure.structure &&\r\n    (type === GET_COURSE_PROPERTIES_SUCCESS ||\r\n      type === UPDATE_COURSE_PROPERTIES_SUCCESS ||\r\n      type === GET_COURSE_STYLE_SUCCESS ||\r\n      type === GET_COURSE_STRUCTURE_SUCCESS)\r\n  ) {\r\n    const linkedIds =\r\n      properties && properties.propsJSON?.linkedElements?.evaluations?.length\r\n        ? [...properties.propsJSON?.linkedElements?.evaluations]\r\n        : undefined;\r\n\r\n    state.course.structure.structure = cloneStructure(state.course.structure.structure, (item) => {\r\n      if (linkedIds && !item.isLinked && isValidLinkedElement(item)) {\r\n        item.isLinked = linkedIds.includes(item.id);\r\n      }\r\n\r\n      if (style?.config.framework) {\r\n        const { framework } = style.config;\r\n        const { min, max } = item.template?.framework || {};\r\n\r\n        if (\r\n          (min && compareVersion(framework, min) > 0) ||\r\n          (max && compareVersion(framework, max) < 1)\r\n        ) {\r\n          let parent = item.parent;\r\n\r\n          while (parent && !parent.isOutdated) {\r\n            parent.isOutdated = true;\r\n            parent.forAlertIcon = false;\r\n            parent = parent.parent;\r\n          }\r\n\r\n          item.forAlertIcon = true;\r\n          item.isOutdated = true;\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  if (type === RENAME_ELEMENT_SUCCESS && \"meta\" in action) {\r\n    const template = action.meta;\r\n\r\n    if (templates?.templates) {\r\n      state.course.element.templates = {\r\n        ...templates,\r\n        templates: updateObject(templates.templates, \"id\", template?.id, { name: template?.name }),\r\n      };\r\n    }\r\n\r\n    if (elmProperties && elmProperties[template?.id]) {\r\n      state.course.element.properties = {\r\n        ...elmProperties,\r\n        [template?.id]: { ...elmProperties[template?.id], name: template?.name },\r\n      };\r\n    }\r\n  }\r\n\r\n  return state;\r\n};\r\n\r\nexport default crossSliceReducer;\r\n"]},"metadata":{},"sourceType":"module"}